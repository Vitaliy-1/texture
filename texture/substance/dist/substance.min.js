!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.substance={})}(this,function(e){"use strict";class t{constructor(e){this._changes=e||{}}getChanges(e,t,r,n){if("function"==typeof t?(n=t,t=0):"function"==typeof r&&(n=r,r=void 0),!(e&&t>=0&&n))throw new Error("Invalid arguments");let s=this._getVersion(e),i=this._getChanges(e);n(null,i=i.slice(t,r),s)}addChange(e,t,r){if(!e||!t)throw new Error("Invalid arguments");this._addChange(e,t),r(null,this._getVersion(e))}deleteChanges(e,t){t(null,this._deleteChanges(e).length)}getVersion(e,t){t(null,this._getVersion(e))}_deleteChanges(e){var t=this._getChanges(e);return delete this._changes[e],t}_getVersion(e){var t=this._changes[e];return t?t.length:0}_getChanges(e){return this._changes[e]||[]}_addChange(e,t){this._changes[e]||(this._changes[e]=[]),this._changes[e].push(t)}}function r(e,t){e&&(e.constructor.prototype.forEach?e.forEach(t):Object.keys(e).forEach(function(r){return t(e[r],r)}))}class n extends Error{constructor(e,t){super(e,t),this.name=e,this.message=t.message,this.info=t.info,this.errorCode=t.errorCode,this.cause=t.cause,Error.captureStackTrace&&Error.captureStackTrace(this,n)}inspect(){var e=[];return e.push(this.stack),this.info&&e.push(this.info+". "),this.cause&&(e.push("\nCaused by: "),this.cause.inspect?e.push(this.cause.inspect()):e.push(this.cause.toString())),e.join("")}}function s(e){const t=typeof e;return Boolean(e)&&("object"===t||"function"===t)}n.fromJSON=function(e){return e?new n(e.name,{message:e.message,info:e.info,errorCode:e.errorCode,cause:n.fromJSON(e.cause)}):null};const i=!1;let o=0;const a="%s listeners registered in the whole system.";class l{emit(e){if(e in this.__events__){for(var t=this.__events__[e].slice(),r=Array.prototype.slice.call(arguments,1),n=0,s=t.length;n<s;n++){var i=t[n];i.method.apply(i.context,r)}return!0}return!1}on(e,t,r){(function(e,t,r){var n;h(t,r),n=this.__events__.hasOwnProperty(e)?this.__events__[e]:this.__events__[e]=[];n.push({method:t,context:r||null}),i&&(o++,console.info("_on()",e,t.name,r,this),console.info(a,o));return this}).call(this,e,t,r)}off(e,t,n){1===arguments.length&&s(arguments[0])?function(e){return r(this.__events__,(t,r)=>{for(let n=t.length-1;n>=0;n--)t[n]&&t[n].context===e&&c.call(this,r,t[n].method,e)}),this}.call(this,arguments[0]):c.apply(this,arguments)}_debugEvents(){console.log("### EventEmitter: ",this),r(this.__events__,(e,t)=>{console.log("- %s listeners for %s: ",e.length,t,e)})}get __events__(){return this.___events___||(this.___events___={}),this.___events___}}function c(e,t,n){if(0===arguments.length)return i&&(r(this.__events__,e=>{e.forEach(e=>{console.info("_off()",e.method.name,e.context,this)}),o-=e.length}),console.info(a,o)),this.___events___={},this;if(1===arguments.length)return i&&(o-=(this.__events__[e]||[]).length,console.info(a,o)),delete this.__events__[e],this;if(h(t,n),!(e in this.__events__&&this.__events__[e].length))return i&&console.info("NO MATCHING BINDINGS"),this;arguments.length<3&&(n=null);let s=this.__events__[e];for(let e=s.length-1;e>=0;e--){const r=s[e];r.method===t&&r.context===n&&(s.splice(e,1),i&&o--)}return 0===s.length&&delete this.__events__[e],i&&console.info(a,o),this}function h(e,t){if("string"==typeof e){if(void 0===t||null===t)throw new Error('Method name "'+e+'" has no context.');if(!(e in t))throw new Error('Method not found: "'+e+'"');if("function"!=typeof t[e])throw new Error('Property "'+e+'" is not a function')}else if("function"!=typeof e)throw new Error("Invalid callback. Function or method name expected.")}function d(e,t){e&&"-"!==e[e.length-1]&&(e=e.concat("-"));var r,n,s="0123456789abcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||32)for(r=0;r<t;r++)i[r]=s[0|16*Math.random()];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=s[19===r?3&n|8:n]);return(e||"")+i.join("")}class u{constructor(e,t){this.message=e,this.ws=t,this.isAuthenticated=!1,this.isAuhorized=!1}setAuthenticated(e){this.isAuthenticated=!0,this.session=e}setAuthorized(e){this.isAuthorized=!0,this.authorizationData=e}setEnhanced(){this.isEnhanced=!0}}class p{constructor(){this.isReady=!1,this.isEnhanced=!1,this.isSent=!1,this.err=null,this.data=null}error(e){this.err=e,this.isReady=!0}send(e){this.data=e,this.isReady=!0}setEnhanced(){this.isEnhanced=!0}setSent(){this.isSent=!0}}class f extends l{constructor(e){super(),this.config=e,this._onConnection=this._onConnection.bind(this)}bind(e){if(this.wss)throw new Error("Server is already bound to a websocket");this.wss=e,this._connections=new WeakMap,this._collaborators={},this.wss.on("connection",this._onConnection);let t=this.config.heartbeat;t&&(this._heartbeat=setInterval(this._sendHeartbeat.bind(this),t)),this._bound=!0}unbind(){if(!this._bound)throw new Error("Server is not yet bound to a websocket.");this.wss.off("connection",this._onConnection)}onConnection(){}onDisconnect(){}authenticate(e,t){e.setAuthenticated(),this.next(e,t)}authorize(e,t){e.setAuthorized(),this.next(e,t)}enhanceRequest(e,t){e.setEnhanced(),this.next(e,t)}execute(){throw new Error("This method needs to be specified")}enhanceResponse(e,t){t.setEnhanced(),this.next(e,t)}_onConnection(e){let t=d(),r={collaboratorId:t};this._connections.set(e,r),this._collaborators[t]={connection:e},e.on("message",this._onMessage.bind(this,e)),e.on("close",this._onClose.bind(this,e))}_onClose(e){let t=this._connections.get(e).collaboratorId;this.onDisconnect(t),delete this._collaborators[t],this._connections.delete(e)}__initial(e,t){return!e.isAuthenticated&&!e.isAuthorized&&!t.isReady}__authenticated(e,t){return e.isAuthenticated&&!e.isAuthorized&&!t.isReady}__authorized(e,t){return e.isAuthenticated&&e.isAuthorized&&!e.isEnhanced&&!t.isReady}__requestEnhanced(e,t){return e.isAuthenticated&&e.isAuthorized&&e.isEnhanced&&!t.isReady}__executed(e,t){return e.isAuthenticated&&e.isAuthorized&&t.isReady&&t.data&&!t.isEnhanced}__enhanced(e,t){return t.isReady&&t.isEnhanced&&!t.isSent}__error(e,t){return t.err&&!t.isSent}__done(e,t){return t.isSent}next(e,t){this.__initial(e,t)?this.authenticate(e,t):this.__authenticated(e,t)?this.authorize(e,t):this.__authorized(e,t)?this.enhanceRequest(e,t):this.__requestEnhanced(e,t)?this.execute(e,t):this.__executed(e,t)?this.enhanceResponse(e,t):this.__enhanced(e,t)?this.sendResponse(e,t):this.__error(e,t)?this.sendError(e,t):this.__done(e,t)}sendError(e,t){let r=e.message.collaboratorId,n=t.err;this.send(r,n),t.setSent(),this.next(e,t)}_sendHeartbeat(){Object.keys(this._collaborators).forEach(function(e){this.send(e,{type:"highfive",scope:"_internal"})}.bind(this))}sendResponse(e,t){let r=e.message.collaboratorId;this.send(r,t.data),t.setSent(),this.next(e,t)}_isWebsocketOpen(e){return e&&1===e.readyState}send(e,t){!t.scope&&this.config.scope&&(t.scope=this.config.scope);let r=this._collaborators[e].connection;this._isWebsocketOpen(r)?r.send(this.serializeMessage(t)):console.error("Server#send: Websocket for collaborator",e,"is no longer open",t)}broadCast(e,t){e.forEach(function(e){this.send(e,t)}.bind(this))}_processRequest(e){let t=new p;this.next(e,t)}_onMessage(e,t){let r=this._connections.get(e);if((t=this.deserializeMessage(t)).scope===this.scope){t.collaboratorId=r.collaboratorId;let n=new u(t,e);this._processRequest(n)}}serializeMessage(e){return JSON.stringify(e)}deserializeMessage(e){return JSON.parse(e)}}function g(e,t){if(!e)return[];if(t||(t=function(e){return e}),Array.isArray(e))return e.map(t);if(e instanceof Map){let r=[];for(let[n,s]of e)r.push(t(s,n));return r}if(e instanceof Set){let r=[],n=0;return e.forEach(e=>{r.push(t(e,n++))}),r}return Object.keys(e).map(function(r){return t(e[r],r)})}function m(e){return Boolean(e)&&e.constructor==={}.constructor}function _(e){return Array.isArray(e)}function y(e){return _(e)?e.slice(0):s(e)?Object.assign({},e):e}const w={inBrowser:!1,inNodeJS:!1,inElectron:!1,isIE:!1,isFF:!1,isOpera:!1,isWebkit:!1,isChromium:!1,version:-1,isWindows:!1,isMac:!1,devtools:!1,_reset:b};function b(){if("undefined"!=typeof window){w.inBrowser=!0;const e=window.navigator.userAgent,t=window.navigator.vendor,r=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/"),i=window.opr,o=window.chrome;r>0?(w.isIE=!0,w.version=10):n>0?(w.isIE=!0,w.version=11,w.isTrident=!0):s>0&&(w.isIE=!0,w.isEdge=!0,w.version=12,parseInt(e.substring(s+5,e.indexOf(".",s)),10)),w.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,w.isWebkit=!w.isFF&&!w.isIE,w.isOpera=void 0!==i,w.isChromium=!!o&&"Google Inc."===t&&!w.isOpera&&!w.isEdge}else w.inBrowser=!1;if(w.inBrowser&&(w.isWindows=void 0!==window.navigator&&window.navigator.appVersion&&-1!==window.navigator.appVersion.indexOf("Win"),w.isMac=void 0!==window.navigator&&window.navigator.platform.indexOf("Mac")>=0),"undefined"!=typeof process&&(w.inBrowser?w.inElectron=!0:w.inNodeJS=!0),w.inBrowser){let e=window.outerWidth-window.innerWidth>160,t=window.outerHeight-window.innerHeight>160,r=e?"vertical":"horizontal";t&&e||!(window.Firebug&&window.Firebug.chrome&&window.Firebug.chrome.isInitialized||e||t)||(w.devtools=!0,w.devtoolsOrientation=r)}}function v(e){return _(e)?e.map(v):w.inBrowser&&e instanceof window.File?e:s(e)?function(e){let t={};return r(e,(e,r)=>{t[r]=v(e)}),t}(e):e}function C(e){return"number"==typeof e}function S(e,t){if(e===t)return!0;if(_(e)&&_(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!S(e[r],t[r]))return!1;return!0}if(m(e)&&m(t)){let r=Object.keys(e).sort();if(!S(r,Object.keys(t).sort()))return!1;for(let n=0;n<r.length;n++){let s=r[n];if(!S(e[s],t[s]))return!1}return!0}return!1}function x(e){return null===e||void 0===e}function E(e){return"string"==typeof e}b();var N="object"==typeof global&&global&&global.Object===Object&&global,T="object"==typeof self&&self&&self.Object===Object&&self,I=N||T||Function("return this")(),A=I.Symbol;function D(e,t){for(var r=-1,n=null==e?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var O=Array.isArray,P=Object.prototype,k=P.hasOwnProperty,M=P.toString,L=A?A.toStringTag:void 0;var R=Object.prototype.toString;var q="[object Null]",B="[object Undefined]",F=A?A.toStringTag:void 0;function j(e){return null==e?void 0===e?B:q:F&&F in Object(e)?function(e){var t=k.call(e,L),r=e[L];try{e[L]=void 0;var n=!0}catch(e){}var s=M.call(e);return n&&(t?e[L]=r:delete e[L]),s}(e):function(e){return R.call(e)}(e)}function H(e){return null!=e&&"object"==typeof e}var U="[object Symbol]";function z(e){return"symbol"==typeof e||H(e)&&j(e)==U}var V=1/0,G=A?A.prototype:void 0,J=G?G.toString:void 0;function K(e){if("string"==typeof e)return e;if(O(e))return D(e,K)+"";if(z(e))return J?J.call(e):"";var t=e+"";return"0"==t&&1/e==-V?"-0":t}function $(e){return null==e?"":K(e)}function X(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(r=r>s?s:r)<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(s);++n<s;)i[n]=e[n+t];return i}var W=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function Y(e){return W.test(e)}var Z="[\\ud800-\\udfff]",Q="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",ee="\\ud83c[\\udffb-\\udfff]",te="[^\\ud800-\\udfff]",re="(?:\\ud83c[\\udde6-\\uddff]){2}",ne="[\\ud800-\\udbff][\\udc00-\\udfff]",se="(?:"+Q+"|"+ee+")"+"?",ie="[\\ufe0e\\ufe0f]?"+se+("(?:\\u200d(?:"+[te,re,ne].join("|")+")[\\ufe0e\\ufe0f]?"+se+")*"),oe="(?:"+[te+Q+"?",Q,re,ne,Z].join("|")+")",ae=RegExp(ee+"(?="+ee+")|"+oe+ie,"g");function le(e){return Y(e)?function(e){return e.match(ae)||[]}(e):function(e){return e.split("")}(e)}var ce,he=(ce="toUpperCase",function(e){var t,r,n,s,i=Y(e=$(e))?le(e):void 0,o=i?i[0]:e.charAt(0),a=i?(t=i,r=1,s=t.length,n=void 0===n?s:n,!r&&n>=s?t:X(t,r,n)).join(""):e.slice(1);return o[ce]()+a});function de(e){return he($(e).toLowerCase())}var ue,pe=(ue={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},function(e){return null==ue?void 0:ue[e]}),fe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ge=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var me=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var _e=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var ye="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",we="["+ye+"]",be="\\d+",ve="[\\u2700-\\u27bf]",Ce="[a-z\\xdf-\\xf6\\xf8-\\xff]",Se="[^\\ud800-\\udfff"+ye+be+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",xe="(?:\\ud83c[\\udde6-\\uddff]){2}",Ee="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Te="(?:"+Ce+"|"+Se+")",Ie="(?:"+Ne+"|"+Se+")",Ae="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",De="[\\ufe0e\\ufe0f]?"+Ae+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",xe,Ee].join("|")+")[\\ufe0e\\ufe0f]?"+Ae+")*"),Oe="(?:"+[ve,xe,Ee].join("|")+")"+De,Pe=RegExp([Ne+"?"+Ce+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[we,Ne,"$"].join("|")+")",Ie+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[we,Ne+Te,"$"].join("|")+")",Ne+"?"+Te+"+(?:['’](?:d|ll|m|re|s|t|ve))?",Ne+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",be,Oe].join("|"),"g");function ke(e,t,r){return e=$(e),void 0===(t=r?void 0:t)?function(e){return _e.test(e)}(e)?function(e){return e.match(Pe)||[]}(e):function(e){return e.match(me)||[]}(e):e.match(t)||[]}var Me=RegExp("['’]","g");var Le,Re=(Le=function(e,t,r){return t=t.toLowerCase(),e+(r?de(t):t)},function(e){return function(e,t,r,n){var s=-1,i=null==e?0:e.length;for(n&&i&&(r=e[++s]);++s<i;)r=t(r,e[s],s,e);return r}(ke(function(e){return(e=$(e))&&e.replace(fe,pe).replace(ge,"")}(e).replace(Me,"")),Le,"")});function qe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Be=function(){return I.Date.now()},Fe=NaN,je=/^\s+|\s+$/g,He=/^[-+]0x[0-9a-f]+$/i,Ue=/^0b[01]+$/i,ze=/^0o[0-7]+$/i,Ve=parseInt;function Ge(e){if("number"==typeof e)return e;if(z(e))return Fe;if(qe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=qe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(je,"");var r=Ue.test(e);return r||ze.test(e)?Ve(e.slice(2),r?2:8):He.test(e)?Fe:+e}var Je="Expected a function",Ke=Math.max,$e=Math.min;function Xe(e,t,r){var n,s,i,o,a,l,c=0,h=!1,d=!1,u=!0;if("function"!=typeof e)throw new TypeError(Je);function p(t){var r=n,i=s;return n=s=void 0,c=t,o=e.apply(i,r)}function f(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-c>=i}function g(){var e=Be();if(f(e))return m(e);a=setTimeout(g,function(e){var r=t-(e-l);return d?$e(r,i-(e-c)):r}(e))}function m(e){return a=void 0,u&&n?p(e):(n=s=void 0,o)}function _(){var e=Be(),r=f(e);if(n=arguments,s=this,l=e,r){if(void 0===a)return function(e){return c=e,a=setTimeout(g,t),h?p(e):o}(l);if(d)return a=setTimeout(g,t),p(l)}return void 0===a&&(a=setTimeout(g,t)),o}return t=Ge(t)||0,qe(r)&&(h=!!r.leading,i=(d="maxWait"in r)?Ke(Ge(r.maxWait)||0,t):i,u="trailing"in r?!!r.trailing:u),_.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=l=s=a=void 0},_.flush=function(){return void 0===a?o:m(Be())},_}var We=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ye=/^\w*$/;function Ze(e,t){if(O(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!z(e))||(Ye.test(e)||!We.test(e)||null!=t&&e in Object(t))}var Qe="[object AsyncFunction]",et="[object Function]",tt="[object GeneratorFunction]",rt="[object Proxy]";function nt(e){if(!qe(e))return!1;var t=j(e);return t==et||t==tt||t==Qe||t==rt}var st,it=I["__core-js_shared__"],ot=(st=/[^.]+$/.exec(it&&it.keys&&it.keys.IE_PROTO||""))?"Symbol(src)_1."+st:"";var at=Function.prototype.toString;function lt(e){if(null!=e){try{return at.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var ct=/^\[object .+?Constructor\]$/,ht=Function.prototype,dt=Object.prototype,ut=ht.toString,pt=dt.hasOwnProperty,ft=RegExp("^"+ut.call(pt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function gt(e){return!(!qe(e)||ot&&ot in e)&&(nt(e)?ft:ct).test(lt(e))}function mt(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return gt(r)?r:void 0}var _t=mt(Object,"create");var yt="__lodash_hash_undefined__",wt=Object.prototype.hasOwnProperty;var bt=Object.prototype.hasOwnProperty;var vt="__lodash_hash_undefined__";function Ct(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function St(e,t){return e===t||e!=e&&t!=t}function xt(e,t){for(var r=e.length;r--;)if(St(e[r][0],t))return r;return-1}Ct.prototype.clear=function(){this.__data__=_t?_t(null):{},this.size=0},Ct.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ct.prototype.get=function(e){var t=this.__data__;if(_t){var r=t[e];return r===yt?void 0:r}return wt.call(t,e)?t[e]:void 0},Ct.prototype.has=function(e){var t=this.__data__;return _t?void 0!==t[e]:bt.call(t,e)},Ct.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=_t&&void 0===t?vt:t,this};var Et=Array.prototype.splice;function Nt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Nt.prototype.clear=function(){this.__data__=[],this.size=0},Nt.prototype.delete=function(e){var t=this.__data__,r=xt(t,e);return!(r<0||(r==t.length-1?t.pop():Et.call(t,r,1),--this.size,0))},Nt.prototype.get=function(e){var t=this.__data__,r=xt(t,e);return r<0?void 0:t[r][1]},Nt.prototype.has=function(e){return xt(this.__data__,e)>-1},Nt.prototype.set=function(e,t){var r=this.__data__,n=xt(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var Tt=mt(I,"Map");function It(e,t){var r,n,s=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?s["string"==typeof t?"string":"hash"]:s.map}function At(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}At.prototype.clear=function(){this.size=0,this.__data__={hash:new Ct,map:new(Tt||Nt),string:new Ct}},At.prototype.delete=function(e){var t=It(this,e).delete(e);return this.size-=t?1:0,t},At.prototype.get=function(e){return It(this,e).get(e)},At.prototype.has=function(e){return It(this,e).has(e)},At.prototype.set=function(e,t){var r=It(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};var Dt="Expected a function";function Ot(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Dt);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],i=r.cache;if(i.has(s))return i.get(s);var o=e.apply(this,n);return r.cache=i.set(s,o)||i,o};return r.cache=new(Ot.Cache||At),r}Ot.Cache=At;var Pt=500;var kt,Mt,Lt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rt=/\\(\\)?/g,qt=(kt=Ot(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Lt,function(e,r,n,s){t.push(n?s.replace(Rt,"$1"):r||e)}),t},function(e){return Mt.size===Pt&&Mt.clear(),e}),Mt=kt.cache,kt);function Bt(e,t){return O(e)?e:Ze(e,t)?[e]:qt($(e))}var Ft=1/0;function jt(e){if("string"==typeof e||z(e))return e;var t=e+"";return"0"==t&&1/e==-Ft?"-0":t}function Ht(e,t){for(var r=0,n=(t=Bt(t,e)).length;null!=e&&r<n;)e=e[jt(t[r++])];return r&&r==n?e:void 0}function Ut(e,t,r){var n=null==e?void 0:Ht(e,t);return void 0===n?r:n}var zt=200;function Vt(e){var t=this.__data__=new Nt(e);this.size=t.size}Vt.prototype.clear=function(){this.__data__=new Nt,this.size=0},Vt.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Vt.prototype.get=function(e){return this.__data__.get(e)},Vt.prototype.has=function(e){return this.__data__.has(e)},Vt.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Nt){var n=r.__data__;if(!Tt||n.length<zt-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new At(n)}return r.set(e,t),this.size=r.size,this};var Gt="__lodash_hash_undefined__";function Jt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new At;++t<r;)this.add(e[t])}function Kt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function $t(e,t){return e.has(t)}Jt.prototype.add=Jt.prototype.push=function(e){return this.__data__.set(e,Gt),this},Jt.prototype.has=function(e){return this.__data__.has(e)};var Xt=1,Wt=2;function Yt(e,t,r,n,s,i){var o=r&Xt,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var h=-1,d=!0,u=r&Wt?new Jt:void 0;for(i.set(e,t),i.set(t,e);++h<a;){var p=e[h],f=t[h];if(n)var g=o?n(f,p,h,t,e,i):n(p,f,h,e,t,i);if(void 0!==g){if(g)continue;d=!1;break}if(u){if(!Kt(t,function(e,t){if(!$t(u,t)&&(p===e||s(p,e,r,n,i)))return u.push(t)})){d=!1;break}}else if(p!==f&&!s(p,f,r,n,i)){d=!1;break}}return i.delete(e),i.delete(t),d}var Zt=I.Uint8Array;function Qt(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function er(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var tr=1,rr=2,nr="[object Boolean]",sr="[object Date]",ir="[object Error]",or="[object Map]",ar="[object Number]",lr="[object RegExp]",cr="[object Set]",hr="[object String]",dr="[object Symbol]",ur="[object ArrayBuffer]",pr="[object DataView]",fr=A?A.prototype:void 0,gr=fr?fr.valueOf:void 0;var mr=Object.prototype.propertyIsEnumerable,_r=Object.getOwnPropertySymbols,yr=_r?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,s=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[s++]=o)}return i}(_r(e),function(t){return mr.call(e,t)}))}:function(){return[]};var wr="[object Arguments]";function br(e){return H(e)&&j(e)==wr}var vr=Object.prototype,Cr=vr.hasOwnProperty,Sr=vr.propertyIsEnumerable,xr=br(function(){return arguments}())?br:function(e){return H(e)&&Cr.call(e,"callee")&&!Sr.call(e,"callee")};var Er="object"==typeof e&&e&&!e.nodeType&&e,Nr=Er&&"object"==typeof module&&module&&!module.nodeType&&module,Tr=Nr&&Nr.exports===Er?I.Buffer:void 0,Ir=(Tr?Tr.isBuffer:void 0)||function(){return!1},Ar=9007199254740991,Dr=/^(?:0|[1-9]\d*)$/;function Or(e,t){var r=typeof e;return!!(t=null==t?Ar:t)&&("number"==r||"symbol"!=r&&Dr.test(e))&&e>-1&&e%1==0&&e<t}var Pr=9007199254740991;function kr(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Pr}var Mr={};function Lr(e){return function(t){return e(t)}}Mr["[object Float32Array]"]=Mr["[object Float64Array]"]=Mr["[object Int8Array]"]=Mr["[object Int16Array]"]=Mr["[object Int32Array]"]=Mr["[object Uint8Array]"]=Mr["[object Uint8ClampedArray]"]=Mr["[object Uint16Array]"]=Mr["[object Uint32Array]"]=!0,Mr["[object Arguments]"]=Mr["[object Array]"]=Mr["[object ArrayBuffer]"]=Mr["[object Boolean]"]=Mr["[object DataView]"]=Mr["[object Date]"]=Mr["[object Error]"]=Mr["[object Function]"]=Mr["[object Map]"]=Mr["[object Number]"]=Mr["[object Object]"]=Mr["[object RegExp]"]=Mr["[object Set]"]=Mr["[object String]"]=Mr["[object WeakMap]"]=!1;var Rr="object"==typeof e&&e&&!e.nodeType&&e,qr=Rr&&"object"==typeof module&&module&&!module.nodeType&&module,Br=qr&&qr.exports===Rr&&N.process,Fr=function(){try{var e=qr&&qr.require&&qr.require("util").types;return e||Br&&Br.binding&&Br.binding("util")}catch(e){}}(),jr=Fr&&Fr.isTypedArray,Hr=jr?Lr(jr):function(e){return H(e)&&kr(e.length)&&!!Mr[j(e)]},Ur=Object.prototype.hasOwnProperty;function zr(e,t){var r=O(e),n=!r&&xr(e),s=!r&&!n&&Ir(e),i=!r&&!n&&!s&&Hr(e),o=r||n||s||i,a=o?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],l=a.length;for(var c in e)!t&&!Ur.call(e,c)||o&&("length"==c||s&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Or(c,l))||a.push(c);return a}var Vr=Object.prototype;function Gr(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Vr)}function Jr(e,t){return function(r){return e(t(r))}}var Kr=Jr(Object.keys,Object),$r=Object.prototype.hasOwnProperty;function Xr(e){return null!=e&&kr(e.length)&&!nt(e)}function Wr(e){return Xr(e)?zr(e):function(e){if(!Gr(e))return Kr(e);var t=[];for(var r in Object(e))$r.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}function Yr(e){return function(e,t,r){var n=t(e);return O(e)?n:function(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}(n,r(e))}(e,Wr,yr)}var Zr=1,Qr=Object.prototype.hasOwnProperty;var en=mt(I,"DataView"),tn=mt(I,"Promise"),rn=mt(I,"Set"),nn=mt(I,"WeakMap"),sn=lt(en),on=lt(Tt),an=lt(tn),ln=lt(rn),cn=lt(nn),hn=j;(en&&"[object DataView]"!=hn(new en(new ArrayBuffer(1)))||Tt&&"[object Map]"!=hn(new Tt)||tn&&"[object Promise]"!=hn(tn.resolve())||rn&&"[object Set]"!=hn(new rn)||nn&&"[object WeakMap]"!=hn(new nn))&&(hn=function(e){var t=j(e),r="[object Object]"==t?e.constructor:void 0,n=r?lt(r):"";if(n)switch(n){case sn:return"[object DataView]";case on:return"[object Map]";case an:return"[object Promise]";case ln:return"[object Set]";case cn:return"[object WeakMap]"}return t});var dn=hn,un=1,pn="[object Arguments]",fn="[object Array]",gn="[object Object]",mn=Object.prototype.hasOwnProperty;function _n(e,t,r,n,s,i){var o=O(e),a=O(t),l=o?fn:dn(e),c=a?fn:dn(t),h=(l=l==pn?gn:l)==gn,d=(c=c==pn?gn:c)==gn,u=l==c;if(u&&Ir(e)){if(!Ir(t))return!1;o=!0,h=!1}if(u&&!h)return i||(i=new Vt),o||Hr(e)?Yt(e,t,r,n,s,i):function(e,t,r,n,s,i,o){switch(r){case pr:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ur:return!(e.byteLength!=t.byteLength||!i(new Zt(e),new Zt(t)));case nr:case sr:case ar:return St(+e,+t);case ir:return e.name==t.name&&e.message==t.message;case lr:case hr:return e==t+"";case or:var a=Qt;case cr:var l=n&tr;if(a||(a=er),e.size!=t.size&&!l)return!1;var c=o.get(e);if(c)return c==t;n|=rr,o.set(e,t);var h=Yt(a(e),a(t),n,s,i,o);return o.delete(e),h;case dr:if(gr)return gr.call(e)==gr.call(t)}return!1}(e,t,l,r,n,s,i);if(!(r&un)){var p=h&&mn.call(e,"__wrapped__"),f=d&&mn.call(t,"__wrapped__");if(p||f){var g=p?e.value():e,m=f?t.value():t;return i||(i=new Vt),s(g,m,r,n,i)}}return!!u&&(i||(i=new Vt),function(e,t,r,n,s,i){var o=r&Zr,a=Yr(e),l=a.length;if(l!=Yr(t).length&&!o)return!1;for(var c=l;c--;){var h=a[c];if(!(o?h in t:Qr.call(t,h)))return!1}var d=i.get(e);if(d&&i.get(t))return d==t;var u=!0;i.set(e,t),i.set(t,e);for(var p=o;++c<l;){var f=e[h=a[c]],g=t[h];if(n)var m=o?n(g,f,h,t,e,i):n(f,g,h,e,t,i);if(!(void 0===m?f===g||s(f,g,r,n,i):m)){u=!1;break}p||(p="constructor"==h)}if(u&&!p){var _=e.constructor,y=t.constructor;_!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y)&&(u=!1)}return i.delete(e),i.delete(t),u}(e,t,r,n,s,i))}function yn(e,t,r,n,s){return e===t||(null==e||null==t||!H(e)&&!H(t)?e!=e&&t!=t:_n(e,t,r,n,yn,s))}var wn=1,bn=2;function vn(e,t,r,n){var s=r.length,i=s,o=!n;if(null==e)return!i;for(e=Object(e);s--;){var a=r[s];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++s<i;){var l=(a=r[s])[0],c=e[l],h=a[1];if(o&&a[2]){if(void 0===c&&!(l in e))return!1}else{var d=new Vt;if(n)var u=n(c,h,l,e,t,d);if(!(void 0===u?yn(h,c,wn|bn,n,d):u))return!1}}return!0}function Cn(e){return e==e&&!qe(e)}function Sn(e){for(var t=Wr(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,Cn(s)]}return t}function xn(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function En(e,t){return null!=e&&t in Object(e)}function Nn(e,t){return null!=e&&function(e,t,r){for(var n=-1,s=(t=Bt(t,e)).length,i=!1;++n<s;){var o=jt(t[n]);if(!(i=null!=e&&r(e,o)))break;e=e[o]}return i||++n!=s?i:!!(s=null==e?0:e.length)&&kr(s)&&Or(o,s)&&(O(e)||xr(e))}(e,t,En)}var Tn=1,In=2;function An(e){return e}function Dn(e){return Ze(e)?(t=jt(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return Ht(t,e)}}(e);var t}function On(e){return"function"==typeof e?e:null==e?An:"object"==typeof e?O(e)?(n=e[0],s=e[1],Ze(n)&&Cn(s)?xn(jt(n),s):function(e){var t=Ut(e,n);return void 0===t&&t===s?Nn(e,n):yn(s,t,Tn|In)}):1==(r=Sn(t=e)).length&&r[0][2]?xn(r[0][0],r[0][1]):function(e){return e===t||vn(e,t,r)}:Dn(e);var t,r,n,s}function Pn(e,t,r,n){for(var s=e.length,i=r+(n?1:-1);n?i--:++i<s;)if(t(e[i],i,e))return i;return-1}var kn=1/0,Mn=1.7976931348623157e308;function Ln(e){var t=function(e){return e?(e=Ge(e))===kn||e===-kn?(e<0?-1:1)*Mn:e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}var Rn=Math.max;var qn,Bn=(qn=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var s=null==r?0:Ln(r);return s<0&&(s=Rn(n+s,0)),Pn(e,On(t),s)},function(e,t,r){var n=Object(e);if(!Xr(e)){var s=On(t);e=Wr(e),t=function(e){return s(n[e],e,n)}}var i=qn(e,t,r);return i>-1?n[s?e[i]:i]:void 0});function Fn(e,t){return e===t||vn(e,t,Sn(t))}var jn=function(){try{var e=mt(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();function Hn(e,t,r){"__proto__"==t&&jn?jn(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Un(e,t,r){(void 0===r||St(e[t],r))&&(void 0!==r||t in e)||Hn(e,t,r)}var zn,Vn=function(e,t,r){for(var n=-1,s=Object(e),i=r(e),o=i.length;o--;){var a=i[zn?o:++n];if(!1===t(s[a],a,s))break}return e},Gn="object"==typeof e&&e&&!e.nodeType&&e,Jn=Gn&&"object"==typeof module&&module&&!module.nodeType&&module,Kn=Jn&&Jn.exports===Gn?I.Buffer:void 0,$n=Kn?Kn.allocUnsafe:void 0;function Xn(e,t){var r,n,s=t?(r=e.buffer,n=new r.constructor(r.byteLength),new Zt(n).set(new Zt(r)),n):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}var Wn=Object.create,Yn=function(){function e(){}return function(t){if(!qe(t))return{};if(Wn)return Wn(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Zn=Jr(Object.getPrototypeOf,Object);function Qn(e){return H(e)&&Xr(e)}var es="[object Object]",ts=Function.prototype,rs=Object.prototype,ns=ts.toString,ss=rs.hasOwnProperty,is=ns.call(Object);function os(e,t){return"__proto__"==t?void 0:e[t]}var as=Object.prototype.hasOwnProperty;function ls(e,t,r){var n=e[t];as.call(e,t)&&St(n,r)&&(void 0!==r||t in e)||Hn(e,t,r)}var cs=Object.prototype.hasOwnProperty;function hs(e){if(!qe(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=Gr(e),r=[];for(var n in e)("constructor"!=n||!t&&cs.call(e,n))&&r.push(n);return r}function ds(e){return Xr(e)?zr(e,!0):hs(e)}function us(e){return function(e,t,r,n){var s=!r;r||(r={});for(var i=-1,o=t.length;++i<o;){var a=t[i],l=n?n(r[a],e[a],a,r,e):void 0;void 0===l&&(l=e[a]),s?Hn(r,a,l):ls(r,a,l)}return r}(e,ds(e))}function ps(e,t,r,n,s,i,o){var a=os(e,r),l=os(t,r),c=o.get(l);if(c)Un(e,r,c);else{var h=i?i(a,l,r+"",e,t,o):void 0,d=void 0===h;if(d){var u=O(l),p=!u&&Ir(l),f=!u&&!p&&Hr(l);h=l,u||p||f?O(a)?h=a:Qn(a)?h=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(a):p?(d=!1,h=function(e,t){if(t)return e.slice();var r=e.length,n=$n?$n(r):new e.constructor(r);return e.copy(n),n}(l,!0)):f?(d=!1,h=Xn(l,!0)):h=[]:function(e){if(!H(e)||j(e)!=es)return!1;var t=Zn(e);if(null===t)return!0;var r=ss.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&ns.call(r)==is}(l)||xr(l)?(h=a,xr(a)?h=us(a):(!qe(a)||n&&nt(a))&&(h=function(e){return"function"!=typeof e.constructor||Gr(e)?{}:Yn(Zn(e))}(l))):d=!1}d&&(o.set(l,h),s(h,l,n,i,o),o.delete(l)),Un(e,r,h)}}function fs(e,t,r,n,s){e!==t&&Vn(t,function(i,o){if(qe(i))s||(s=new Vt),ps(e,t,o,r,fs,n,s);else{var a=n?n(os(e,o),i,o+"",e,t,s):void 0;void 0===a&&(a=i),Un(e,o,a)}},ds)}var gs=Math.max;var ms=jn?function(e,t){return jn(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:An,_s=800,ys=16,ws=Date.now;var bs=function(e){var t=0,r=0;return function(){var n=ws(),s=ys-(n-r);if(r=n,s>0){if(++t>=_s)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(ms);function vs(e,t){return bs(function(e,t,r){return t=gs(void 0===t?e.length-1:t,0),function(){for(var n=arguments,s=-1,i=gs(n.length-t,0),o=Array(i);++s<i;)o[s]=n[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=n[s];return a[t]=r(o),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,a)}}(e,t,An),e+"")}function Cs(e){return vs(function(t,r){var n=-1,s=r.length,i=s>1?r[s-1]:void 0,o=s>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(s--,i):void 0,o&&function(e,t,r){if(!qe(r))return!1;var n=typeof t;return!!("number"==n?Xr(r)&&Or(t,r.length):"string"==n&&t in r)&&St(r[t],e)}(r[0],r[1],o)&&(i=s<3?void 0:i,s=1),t=Object(t);++n<s;){var a=r[n];a&&e(t,a,n,i)}return t})}var Ss=Cs(function(e,t,r){fs(e,t,r)}),xs=Cs(function(e,t,r,n){fs(e,t,r,n)});function Es(e,t,r,n){return n="function"==typeof n?n:void 0,null==e?e:function(e,t,r,n){if(!qe(e))return e;for(var s=-1,i=(t=Bt(t,e)).length,o=i-1,a=e;null!=a&&++s<i;){var l=jt(t[s]),c=r;if(s!=o){var h=a[l];void 0===(c=n?n(h,l,a):void 0)&&(c=qe(h)?h:Or(t[s+1])?[]:{})}ls(a,l,c),a=a[l]}return e}(e,t,r,n)}function Ns(e){return e!=e}function Ts(e,t){return!!(null==e?0:e.length)&&function(e,t,r){return t==t?function(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}(e,t,r):Pn(e,Ns,r)}(e,t,0)>-1}function Is(e,t,r){for(var n=-1,s=null==e?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}var As=rn&&1/er(new rn([,-0]))[1]==1/0?function(e){return new rn(e)}:function(){},Ds=200;function Os(e,t){return null==(e=function(e,t){return t.length<2?e:Ht(e,X(t,0,-1))}(e,t=Bt(t,e)))||delete e[jt((r=t,n=null==r?0:r.length,n?r[n-1]:void 0))];var r,n}var Ps=200;var ks=vs(function(e,t){return Qn(e)?function(e,t,r,n){var s=-1,i=Ts,o=!0,a=e.length,l=[],c=t.length;if(!a)return l;r&&(t=D(t,Lr(r))),n?(i=Is,o=!1):t.length>=Ps&&(i=$t,o=!1,t=new Jt(t));e:for(;++s<a;){var h=e[s],d=null==r?h:r(h);if(h=n||0!==h?h:0,o&&d==d){for(var u=c;u--;)if(t[u]===d)continue e;l.push(h)}else i(t,d,n)||l.push(h)}return l}(e,t):[]});var Ms=function(e,t){return function(r,n){if(null==r)return r;if(!Xr(r))return e(r,n);for(var s=r.length,i=t?s:-1,o=Object(r);(t?i--:++i<s)&&!1!==n(o[i],i,o););return r}}(function(e,t){return e&&Vn(e,t,Wr)});function Ls(e,t){if(e!==t){var r=void 0!==e,n=null===e,s=e==e,i=z(e),o=void 0!==t,a=null===t,l=t==t,c=z(t);if(!a&&!c&&!i&&e>t||i&&o&&l&&!a&&!c||n&&o&&l||!r&&l||!s)return 1;if(!n&&!i&&!c&&e<t||c&&r&&s&&!n&&!i||a&&r&&s||!o&&s||!l)return-1}return 0}function Rs(e,t,r){var n=-1;return t=D(t.length?t:[An],Lr(On)),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(function(e,t){var r=-1,n=Xr(e)?Array(e.length):[];return Ms(e,function(e,s,i){n[++r]=t(e,s,i)}),n}(e,function(e,r,s){return{criteria:D(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return function(e,t,r){for(var n=-1,s=e.criteria,i=t.criteria,o=s.length,a=r.length;++n<o;){var l=Ls(s[n],i[n]);if(l)return n>=a?l:l*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)})}function qs(e,t,r,n){return null==e?[]:(O(t)||(t=null==t?[]:[t]),O(r=n?void 0:r)||(r=null==r?[]:[r]),Rs(e,t,r))}class Bs{constructor(e){e&&(this.__root__=e)}contains(e){return Boolean(this.getRoot()[e])}getRoot(){return this.__root__?this.__root__:this}get(e){if(e){if(E(e))return this.getRoot()[e];if(arguments.length>1&&(e=Array.prototype.slice(arguments,0)),!_(e))throw new Error("Illegal argument for PathObject.get()");return Ut(this.getRoot(),e)}}set(e,t){if(!e)throw new Error("Illegal argument: PathObject.set(>path<, value) - path is mandatory.");E(e)?this.getRoot()[e]=t:Es(this.getRoot(),e,t)}delete(e){if(E(e))delete this.getRoot()[e];else if(1===e.length)delete this.getRoot()[e[0]];else{if(!function(e,t){return null==e||Os(e,t)}(this.getRoot(),e))throw new Error("Could not delete property at path"+e)}}clear(){var e=this.getRoot();for(var t in e)e.hasOwnProperty(t)&&delete e[t]}}Bs.prototype._isPathObject=!0;class Fs extends Error{constructor(e,t){super("Conflict: "+JSON.stringify(e)+" vs "+JSON.stringify(t)),this.a=e,this.b=t}}const js="insert",Hs="delete";class Us{constructor(e){if(!e||void 0===e.type||void 0===e.pos||void 0===e.str)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.pos=e.pos,this.str=e.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!E(this.str))throw new Error("Illegal argument: expecting string.");if(!C(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}apply(e){if(this.isEmpty())return e;if(this.type===js){if(e.length<this.pos)throw new Error("Provided string is too short.");return e.splice?e.splice(this.pos,0,this.str):e.slice(0,this.pos).concat(this.str).concat(e.slice(this.pos))}if(e.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return e.splice?e.splice(this.pos,this.str.length):e.slice(0,this.pos).concat(e.slice(this.pos+this.str.length))}clone(){return new Us(this)}isNOP(){return"NOP"===this.type||0===this.str.length}isInsert(){return this.type===js}isDelete(){return this.type===Hs}getLength(){return this.str.length}invert(){var e={type:this.isInsert()?Hs:js,pos:this.pos,str:this.str};return new Us(e)}hasConflict(e){return zs(this,e)}isEmpty(){return 0===this.str.length}toJSON(){return{type:this.type,pos:this.pos,str:this.str}}toString(){return["(",this.isInsert()?js:Hs,",",this.pos,",'",this.str,"')"].join("")}get _isOperation(){return!0}get _isTextOperation(){return!0}static transform(e,t,r){return function(e,t,r){if((r=r||{})["no-conflict"]&&zs(e,t))throw new Fs(e,t);r.inplace||(e=e.clone(),t=t.clone());e.type===js&&t.type===js?function(e,t){e.pos===t.pos?t.pos+=e.str.length:e.pos<t.pos?t.pos+=e.str.length:e.pos+=t.str.length}(e,t):e.type===Hs&&t.type===Hs?function e(t,r,n){if(t.pos>r.pos)return e(r,t,!n);if(t.pos===r.pos&&t.str.length>r.str.length)return e(r,t,!n);if(r.pos<t.pos+t.str.length){var s=r.pos-t.pos,i=t.str.length-s,o=s+r.str.length;t.str=t.str.slice(0,s)+t.str.slice(o),r.str=r.str.slice(i),r.pos-=s}else r.pos-=t.str.length}(e,t,!0):function e(t,r){if(t.type===Hs)return e(r,t);if(t.pos<=r.pos)r.pos+=t.str.length;else if(t.pos>=r.pos+r.str.length)t.pos-=r.str.length;else{var n=t.pos-r.pos;r.str=r.str.slice(0,n)+t.str+r.str.slice(n),t.str=""}}(e,t);return[e,t]}(e,t,r)}static hasConflict(e,t){return zs(e,t)}static Insert(e,t){return new Us({type:js,pos:e,str:t})}static Delete(e,t){return new Us({type:Hs,pos:e,str:t})}static fromJSON(e){return new Us(e)}static get INSERT(){return js}static get DELETE(){return Hs}}function zs(e,t){return e.type===js&&t.type===js?e.pos===t.pos:e.type===Hs&&t.type===Hs?!(e.pos>=t.pos+t.str.length||t.pos>=e.pos+e.str.length):(e.type===Hs?(r=e,n=t):(r=t,n=e),n.pos>=r.pos&&n.pos<r.pos+r.str.length);var r,n}const Vs="NOP",Gs="delete",Js="insert";class Ks{constructor(e){if(!e||!e.type)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.type!==Vs){if(this.type!==Js&&this.type!==Gs)throw new Error("Illegal type.");if(this.pos=e.pos,this.val=e.val,!C(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}}apply(e){if(this.type===Vs)return e;if(this.type===Js){if(e.length<this.pos)throw new Error("Provided array is too small.");return e.splice(this.pos,0,this.val),e}if(e.length<this.pos)throw new Error("Provided array is too small.");if(!S(e[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+e[this.pos]);return e.splice(this.pos,1),e}clone(){var e={type:this.type,pos:this.pos,val:v(this.val)};return new Ks(e)}invert(){var e=this.toJSON();return this.type===Vs?e.type=Vs:this.type===Js?e.type=Gs:e.type=Js,new Ks(e)}hasConflict(e){return Ks.hasConflict(this,e)}toJSON(){var e={type:this.type};return this.type===Vs?e:(e.pos=this.pos,e.val=v(this.val),e)}isInsert(){return this.type===Js}isDelete(){return this.type===Gs}getOffset(){return this.pos}getValue(){return this.val}isNOP(){return this.type===Vs}toString(){return["(",this.isInsert()?Js:Gs,",",this.getOffset(),",'",this.getValue(),"')"].join("")}get _isOperation(){return!0}get _isArrayOperation(){return!0}static transform(e,t,r){return Xs(e,t,r)}static hasConflict(e,t){return $s(e,t)}static Insert(e,t){return new Ks({type:Js,pos:e,val:t})}static Delete(e,t){return new Ks({type:Gs,pos:e,val:t})}static Nop(){return new Ks({type:Vs})}static fromJSON(e){return new Ks(e)}static get NOP(){return Vs}static get DELETE(){return Gs}static get INSERT(){return Js}}function $s(e,t){return e.type!==Vs&&t.type!==Vs&&(e.type===Js&&t.type===Js&&e.pos===t.pos)}var Xs=function(e,t,r){if((r=r||{})["no-conflict"]&&$s(e,t))throw new Fs(e,t);return r.inplace||(e=e.clone(),t=t.clone()),e.type===Vs||t.type===Vs||(e.type===Js&&t.type===Js?function(e,t){e.pos===t.pos?t.pos+=1:e.pos<t.pos?t.pos+=1:e.pos+=1}(e,t):e.type===Gs&&t.type===Gs?function(e,t){if(e.pos===t.pos)return t.type=Vs,void(e.type=Vs);e.pos<t.pos?t.pos-=1:e.pos-=1}(e,t):function(e,t){if(e.type===Gs){var r=e;e=t,t=r}e.pos<=t.pos?t.pos+=1:e.pos-=1}(e,t)),[e,t]};const Ws="shift";class Ys{constructor(e){if(!e||void 0===e.type)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.val=e.val,!this.isShift())throw new Error("Illegal type.");if(!C(this.val))throw new Error("Illegal argument: expecting number as shift value.")}apply(e){e.offset=e.offset+this.val}isShift(){return this.type===Ws}isNOP(){switch(this.type){case Ws:return 0===this.val;default:return!1}}clone(){return new Ys(this)}invert(){let e;switch(this.type){case Ws:e={type:Ws,val:-this.val};break;default:throw new Error("Invalid type.")}return new Ys(e)}hasConflict(){return!1}toJSON(){return{type:this.type,val:this.val}}toString(){return["(",this.type,",",this.val,"')"].join("")}get _isOperation(){return!0}get _isCoordinateOperation(){return!0}static transform(e,t,r){return function(e,t,r){(r=r||{}).inplace||(e=e.clone(),t=t.clone());if(e.type!==Ws||t.type!==Ws)throw new Error("Illegal type");!function(e,t){e.val+=t.val,t.val+=e.val}(e,t);return[e,t]}(e,t,r)}static fromJSON(e){return new Ys(e)}static Shift(e){return new Ys({type:Ws,val:e})}static get SHIFT(){return Ws}}const Zs="NOP",Qs="create",ei="delete",ti="update",ri="set";class ni{constructor(e){if(!e)throw new Error("Data of ObjectOperation is missing.");if(!e.type)throw new Error("Invalid data: type is mandatory.");if(this.type=e.type,e.type!==Zs){if(this.path=e.path,!e.path)throw new Error("Invalid data: path is mandatory.");if(this.type===Qs||this.type===ei){if(!e.val)throw new Error("Invalid data: value is missing.");this.val=e.val}else if(this.type===ti){if(!e.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=e.diff,e.diff._isTextOperation)this.propertyType="string";else if(e.diff._isArrayOperation)this.propertyType="array";else{if(!e.diff._isCoordinateOperation)throw new Error("Invalid data: diff must be a TextOperation or an ArrayOperation.");this.propertyType="coordinate"}}else{if(this.type!==ri)throw new Error("Invalid type: "+e.type);this.val=e.val,this.original=e.original}}}apply(e){if(this.type===Zs)return e;var t;if(t=e._isPathObject?e:new Bs(e),this.type===Qs)return t.set(this.path,v(this.val)),e;if(this.type===ei)t.delete(this.path,"strict");else if(this.type===ti){var r=this.diff;switch(this.propertyType){case"array":{let e=t.get(this.path);r.apply(e);break}case"string":{let e=t.get(this.path);x(e)&&(e=""),e=r.apply(e),t.set(this.path,e);break}case"coordinate":{let e=t.get(this.path);if(!e)throw new Error("No coordinate with path "+this.path);r.apply(e);break}default:throw new Error("Invalid state.")}}else{if(this.type!==ri)throw new Error("Invalid type.");t.set(this.path,v(this.val))}return e}clone(){var e={type:this.type,path:this.path};return this.val&&(e.val=v(this.val)),this.diff&&(e.diff=this.diff.clone()),new ni(e)}isNOP(){return this.type===Zs||(this.type===ti?this.diff.isNOP():void 0)}isCreate(){return this.type===Qs}isDelete(){return this.type===ei}isUpdate(e){return e?this.type===ti&&this.propertyType===e:this.type===ti}isSet(){return this.type===ri}invert(){if(this.type===Zs)return new ni({type:Zs});var e=new ni(this);if(this.type===Qs)e.type=ei;else if(this.type===ei)e.type=Qs;else if(this.type===ti){var t;if(this.diff._isTextOperation)t=Us.fromJSON(this.diff.toJSON()).invert();else if(this.diff._isArrayOperation)t=Ks.fromJSON(this.diff.toJSON()).invert();else{if(!this.diff._isCoordinateOperation)throw new Error("Illegal type");t=Ys.fromJSON(this.diff.toJSON()).invert()}e.diff=t}else e.val=this.original,e.original=this.val;return e}hasConflict(e){return ni.hasConflict(this,e)}toJSON(){if(this.type===Zs)return{type:Zs};var e={type:this.type,path:this.path};if(this.type===Qs||this.type===ei)e.val=this.val;else if(this.type===ti){if(this.diff._isTextOperation)e.propertyType="string";else if(this.diff._isArrayOperation)e.propertyType="array";else{if(!this.diff._isCoordinateOperation)throw new Error("Invalid property type.");e.propertyType="coordinate"}e.diff=this.diff.toJSON()}else e.val=this.val,e.original=this.original;return e}getType(){return this.type}getPath(){return this.path}getValue(){return this.val}getOldValue(){return this.original}getValueOp(){return this.diff}toString(){switch(this.type){case Qs:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case ei:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case ti:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case ri:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case Zs:return"NOP";default:throw new Error("Invalid type")}}static transform(e,t,r){return function(e,t,r){if((r=r||{})["no-conflict"]&&si(e,t))throw new Fs(e,t);r.inplace||(e=e.clone(),t=t.clone());if(e.isNOP()||t.isNOP())return[e,t];S(e.path,t.path)&&mi[gi[e.type]|gi[t.type]](e,t);return[e,t]}(e,t,r)}static hasConflict(e,t){return si(e,t)}static Create(e,t){var r;return r=E(e)?[e]:e,new ni({type:Qs,path:r,val:t})}static Delete(e,t){var r;return r=E(e)?[e]:e,new ni({type:ei,path:r,val:t})}static Update(e,t){return new ni({type:ti,path:e,diff:t})}static Set(e,t,r){return new ni({type:ri,path:e,val:v(r),original:v(t)})}static fromJSON(e){if("update"===(e=v(e)).type)switch(e.propertyType){case"string":e.diff=Us.fromJSON(e.diff);break;case"array":e.diff=Ks.fromJSON(e.diff);break;case"coordinate":e.diff=Ys.fromJSON(e.diff);break;default:throw new Error("Unsupported update diff:"+JSON.stringify(e.diff))}return new ni(e)}static get NOP(){return Zs}static get CREATE(){return Qs}static get DELETE(){return ei}static get UPDATE(){return ti}static get SET(){return ri}get _isOperation(){return!0}get _isObjectOperation(){return!0}}function si(e,t){return e.type!==Zs&&t.type!==Zs&&S(e.path,t.path)}function ii(e,t){e.type=Zs,t.type=Zs}function oi(){throw new Error("Can not transform two concurring creates of the same property")}function ai(){throw new Error("Illegal state: can not create and delete a value at the same time.")}function li(e,t,r){if(e.type!==ei)return li(t,e,!0);var n;switch(t.propertyType){case"string":n=Us.fromJSON(t.diff);break;case"array":n=Ks.fromJSON(t.diff);break;case"coordinate":n=Ys.fromJSON(t.diff);break;default:throw new Error("Illegal type")}r?(e.val=n.apply(e.val),t.type=Zs):(e.type=Zs,t.type=Qs,t.val=n.apply(e.val))}function ci(){throw new Error("Can not transform a concurring create and update of the same property")}function hi(e,t){let r,n,s;switch(t.propertyType){case"string":r=Us.fromJSON(e.diff),n=Us.fromJSON(t.diff),s=Us.transform(r,n,{inplace:!0});break;case"array":r=Ks.fromJSON(e.diff),n=Ks.fromJSON(t.diff),s=Ks.transform(r,n,{inplace:!0});break;case"coordinate":r=Ys.fromJSON(e.diff),n=Ys.fromJSON(t.diff),s=Ys.transform(r,n,{inplace:!0});break;default:throw new Error("Illegal type")}e.diff=s[0],t.diff=s[1]}function di(){throw new Error("Illegal state: can not create and set a value at the same time.")}function ui(e,t,r){if(e.type!==ei)return ui(t,e,!0);r?(e.val=t.val,t.type=Zs):(e.type=Zs,t.type=Qs,t.original=void 0)}function pi(){throw new Error("Unresolvable conflict: update + set.")}function fi(e,t){e.type=Zs,t.original=e.val}const gi=(()=>{const e={};return e[Zs]=0,e[Qs]=1,e[ei]=2,e[ti]=4,e[ri]=8,e})(),mi=(()=>{const e={};return e[2]=ii,e[3]=ai,e[6]=li,e[1]=oi,e[5]=ci,e[4]=hi,e[9]=di,e[10]=ui,e[12]=pi,e[8]=fi,e})();class _i{constructor(){this.SEPARATOR="\t"}serialize(e){var t=[];switch(e.type){case"create":t.push("c"),t.push(e.val.id),t.push(e.val);break;case"delete":t.push("d"),t.push(e.val.id),t.push(e.val);break;case"set":t.push("s"),t.push(e.path.join(".")),t.push(e.val),t.push(e.original);break;case"update":t.push("u"),t.push(e.path.join(".")),Array.prototype.push.apply(t,this.serializePrimitiveOp(e.diff));break;default:throw new Error("Unsupported operation type.")}return t}serializePrimitiveOp(e){var t=[];if(e._isTextOperation)e.isInsert()?t.push("t+"):e.isDelete()&&t.push("t-"),t.push(e.pos),t.push(e.str);else if(e._isArrayOperation)e.isInsert()?t.push("a+"):e.isDelete()&&t.push("a-"),t.push(e.pos),t.push(e.val);else{if(!e._isCoordinateOperation)throw new Error("Unsupported operation type.");if(!e.isShift())throw new Error("Unsupported CoordinateOperation type.");t.push("c>>"),t.push(e.pos),t.push(e.val)}return t}deserialize(e,t){t||(t=new yi(e,this.SEPARATOR));var r,n,s,i,o,a=t.getString();switch(a){case"c":n=t.getPath(),s=t.getObject(),r=ni.Create(n,s);break;case"d":n=t.getPath(),s=t.getObject(),r=ni.Delete(n,s);break;case"s":n=t.getPath(),s=t.getAny(),i=t.getAny(),r=ni.Set(n,i,s);break;case"u":n=t.getPath(),o=this.deserializePrimitiveOp(e,t),r=ni.Update(n,o);break;default:throw new Error("Illegal type for ObjectOperation: "+a)}return r}deserializePrimitiveOp(e,t){t||(t=new yi(e,this.SEPARATOR));var r,n,s,i=t.getString();switch(i){case"t+":n=t.getNumber(),s=t.getString(),r=Us.Insert(n,s);break;case"t-":n=t.getNumber(),s=t.getString(),r=Us.Delete(n,s);break;case"a+":n=t.getNumber(),s=t.getAny(),r=Ks.Insert(n,s);break;case"a-":n=t.getNumber(),s=t.getAny(),r=Ks.Delete(n,s);break;case"c>>":s=t.getNumber(),r=Ys.Shift(s);break;default:throw new Error("Unsupported operation type: "+i)}return r}}class yi{constructor(e,t){_(arguments[0])?this.tokens=arguments[0]:this.tokens=e.split(t),this.pos=-1}error(e){throw new Error("Parsing error: "+e+"\n"+this.tokens[this.pos])}getString(){this.pos++;var e=this.tokens[this.pos];return'"'===e[0]&&(e=e.slice(1,-1)),e}getNumber(){this.pos++;var e=this.tokens[this.pos];try{return C(e)?e:parseInt(this.tokens[this.pos],10)}catch(e){this.error("expected number")}}getObject(){this.pos++;var e=this.tokens[this.pos];try{return s(e)?e:JSON.parse(this.tokens[this.pos])}catch(e){this.error("expected object")}}getAny(){return this.pos++,this.tokens[this.pos]}getPath(){return this.getString().split(".")}}function wi(e){return e[e.length-1]}_i.Tokenizer=yi;class bi{constructor(){var e={};Object.defineProperty(this,"_internal",{enumerable:!1,value:e}),e.doc=null}clone(){var e=this._clone();return this._internal.doc&&e.attach(this._internal.doc),e}getDocument(){var e=this._internal.doc;if(!e)throw new Error("Selection is not attached to a document.");return e}isAttached(){return Boolean(this._internal.doc)}attach(e){return this._internal.doc=e,this}isNull(){return!1}isPropertySelection(){return!1}isContainerSelection(){return!1}isNodeSelection(){return!1}isCustomSelection(){return!1}isCollapsed(){return!0}isReverse(){return!1}getType(){throw new Error("Selection.getType() is abstract.")}get type(){return this.getType()}equals(e){return this===e||!!e&&(this.isNull()===e.isNull()&&this.getType()===e.getType())}toString(){return"null"}toJSON(){throw new Error("This method is abstract.")}createWith(e){let t=this.constructor,r=this.toJSON();return Object.assign(r,e),t.fromJSON(r)}get _isSelection(){return!0}static get nullSelection(){return vi}}const vi=Object.freeze(new class extends bi{isNull(){return!0}getType(){return"null"}toJSON(){return null}clone(){return this}});function Ci(e,t){if(e===t)return!0;if(!_(e)||!_(t))return!1;if(e.length!==t.length)return!1;let r=e.length;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}class Si{constructor(e,t){if("SKIP"!==arguments[0]){if(1===arguments.length){let e=arguments[0];this.path=e.path,this.offset=e.offset}else this.path=e,this.offset=t;if(!_(this.path))throw new Error("Invalid arguments: path should be an array.");if(!C(this.offset)||this.offset<0)throw new Error("Invalid arguments: offset must be a positive number.")}}equals(e){return e===this||Ci(e.path,this.path)&&e.offset===this.offset}withCharPos(e){return new Si(this.path,e)}getNodeId(){return this.path[0]}getPath(){return this.path}getOffset(){return this.offset}toJSON(){return{path:this.path.slice(),offset:this.offset}}toString(){return"("+this.path.join(".")+", "+this.offset+")"}isPropertyCoordinate(){return this.path.length>1}isNodeCoordinate(){return 1===this.path.length}hasSamePath(e){return Ci(this.path,e.path)}get _isCoordinate(){return!0}}class xi extends bi{constructor(e,t,r,n,s,i){if(super(),1===arguments.length){let o=arguments[0];e=o.path,t=o.startOffset,r=o.endOffset,n=o.reverse,s=o.containerId,i=o.surfaceId}if(!e||!C(t))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this.start=new Si(e,t),this.end=new Si(e,C(r)?r:t),this.reverse=Boolean(n),this.containerId=s,this.surfaceId=i}get path(){return this.start.path}get startOffset(){return console.warn("DEPRECATED: Use sel.start.offset instead"),this.start.offset}get endOffset(){return console.warn("DEPRECATED: Use sel.end.offset instead"),this.end.offset}toJSON(){return{type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset,reverse:this.reverse,containerId:this.containerId,surfaceId:this.surfaceId}}isPropertySelection(){return!0}getType(){return"property"}isNull(){return!1}isCollapsed(){return this.start.offset===this.end.offset}isReverse(){return this.reverse}equals(e){return bi.prototype.equals.call(this,e)&&this.start.equals(e.start)&&this.end.equals(e.end)}toString(){return["PropertySelection(",JSON.stringify(this.path),", ",this.start.offset," -> ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(e){var t;return t="left"===e?this.start.offset:this.end.offset,this.createWithNewRange(t,t)}getPath(){return this.start.path}getNodeId(){return this.start.path[0]}isInsideOf(e,t){return!e.isNull()&&(e.isContainerSelection()?e.contains(this,t):t?Ci(this.path,e.path)&&this.start.offset>e.start.offset&&this.end.offset<e.end.offset:Ci(this.path,e.path)&&this.start.offset>=e.start.offset&&this.end.offset<=e.end.offset)}contains(e,t){return!e.isNull()&&e.isInsideOf(this,t)}overlaps(e,t){return!e.isNull()&&(e.isContainerSelection()?e.overlaps(this):!!Ci(this.path,e.path)&&(t?!(this.start.offset>=e.end.offset||this.end.offset<=e.start.offset):!(this.start.offset>e.end.offset||this.end.offset<e.start.offset)))}isRightAlignedWith(e){return!e.isNull()&&(e.isContainerSelection()?e.isRightAlignedWith(this):Ci(this.path,e.path)&&this.end.offset===e.end.offset)}isLeftAlignedWith(e){return!e.isNull()&&(e.isContainerSelection()?e.isLeftAlignedWith(this):Ci(this.path,e.path)&&this.start.offset===e.start.offset)}expand(e){if(e.isNull())return this;if(e.isContainerSelection())return e.expand(this);if(!Ci(this.path,e.path))throw new Error("Can not expand PropertySelection to a different property.");var t=Math.min(this.start.offset,e.start.offset),r=Math.max(this.end.offset,e.end.offset);return this.createWithNewRange(t,r)}truncateWith(e){if(e.isNull())return this;if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;var t,r,n,s;if(e.isPropertySelection())t=e.start.offset,r=e.end.offset;else{if(!e.isContainerSelection())return this;t=Ci(e.start.path,this.start.path)?e.start.offset:this.start.offset,r=Ci(e.end.path,this.start.path)?e.end.offset:this.end.offset}if(this.start.offset>t&&this.end.offset>r)n=r,s=this.end.offset;else if(this.start.offset<t&&this.end.offset<r)n=this.start.offset,s=t;else if(this.start.offset===t){if(this.end.offset<=r)return bi.nullSelection;n=r,s=this.end.offset}else{if(this.end.offset!==r){if(e.contains(this))return bi.nullSelection;throw new Error("Illegal state.")}if(this.start.offset>=t)return bi.nullSelection;n=this.start.offset,s=t}return this.createWithNewRange(n,s)}createWithNewRange(e,t){var r=new xi(this.path,e,t,!1,this.containerId,this.surfaceId),n=this._internal.doc;return n&&r.attach(n),r}_clone(){return new xi(this.start.path,this.start.offset,this.end.offset,this.reverse,this.containerId,this.surfaceId)}}xi.fromJSON=function(e){return new xi(e)};class Ei extends bi{constructor(e,t,r,n,s,i,o){if(super(),1===arguments.length){let a=arguments[0];e=a.containerId,t=a.startPath,r=a.startOffset,n=a.endPath,s=a.endOffset,i=a.reverse,o=a.surfaceId}if(this.containerId=e,!this.containerId)throw new Error("Invalid arguments: `containerId` is mandatory");this.start=new Si(t,r),this.end=new Si(x(n)?t:n,x(s)?r:s),this.reverse=Boolean(i),this.surfaceId=o}get startPath(){return console.warn("DEPRECATED: use sel.start.path instead."),this.start.path}get startOffset(){return console.warn("DEPRECATED: use sel.start.offset instead."),this.start.offset}get endPath(){return console.warn("DEPRECATED: use sel.end.path instead."),this.end.path}get endOffset(){return console.warn("DEPRECATED: use sel.end.offset instead."),this.end.offset}toJSON(){return{type:"container",containerId:this.containerId,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset,reverse:this.reverse,surfaceId:this.surfaceId}}isContainerSelection(){return!0}getType(){return"container"}isNull(){return!1}isCollapsed(){return this.start.equals(this.end)}isReverse(){return this.reverse}equals(e){return bi.prototype.equals.call(this,e)&&this.containerId===e.containerId&&this.start.equals(e.start)&&this.end.equals(e.end)}toString(){return["ContainerSelection(",this.containerId,", ",JSON.stringify(this.start.path),", ",this.start.offset," -> ",JSON.stringify(this.end.path),", ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}getContainer(){return this._internal.container||(this._internal.container=this.getDocument().get(this.containerId)),this._internal.container}isInsideOf(e,t){if(e.isNull())return!1;t=Boolean(t);let r=this._range(this),n=this._range(e);return n.start.isBefore(r.start,t)&&r.end.isBefore(n.end,t)}contains(e,t){if(e.isNull())return!1;t=Boolean(t);let r=this._range(this),n=this._range(e);return r.start.isBefore(n.start,t)&&n.end.isBefore(r.end,t)}containsNode(e,t){const r=this.getContainer();if(!r.contains(e))return!1;const n=new Si([e],0),s=r.getAddress(n),i=this._range(this);let o=i.start.isBefore(s,t);return o&&(s.offset=1,o=i.end.isAfter(s,t)),o}overlaps(e){let t=this._range(this),r=this._range(e);return!(t.end.isBefore(r.start,!1)||r.end.isBefore(t.start,!1))}isLeftAlignedWith(e){let t=this._range(this),r=this._range(e);return t.start.isEqual(r.start)}isRightAlignedWith(e){let t=this._range(this),r=this._range(e);return t.end.isEqual(r.end)}collapse(e){let t;return Ni(this,t="left"===e?this.start:this.end,t)}expand(e){let t,r,n=this._range(this),s=this._range(e);return Ni(this,t=n.start.isEqual(s.start)?new Si(this.start.path,Math.min(this.start.offset,e.start.offset)):n.start.isAfter(s.start)?new Si(e.start.path,e.start.offset):this.start,r=n.end.isEqual(s.end)?new Si(this.end.path,Math.max(this.end.offset,e.end.offset)):n.end.isBefore(s.end,!1)?new Si(e.end.path,e.end.offset):this.end)}truncateWith(e){if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;let t,r,n=this._range(this),s=this._range(e);if(s.start.isBefore(n.start,"strict")&&s.end.isBefore(n.end,"strict"))t=e.end,r=this.end;else if(n.start.isBefore(s.start,"strict")&&n.end.isBefore(s.end,"strict"))t=this.start,r=e.start;else if(n.start.isEqual(s.start)){if(!s.end.isBefore(n.end,"strict"))return bi.nullSelection;t=e.end,r=this.end}else{if(!n.end.isEqual(s.end)){if(this.isInsideOf(e))return bi.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!n.start.isBefore(s.start,"strict"))return bi.nullSelection;t=this.start,r=e.start}return Ni(this,t,r)}getNodeIds(){const e=this.getContainer(),t=e.getPosition(this.start.path[0]),r=e.getPosition(this.end.path[0]);return e.getContent().slice(t,r+1)}splitIntoPropertySelections(){let e=[];return this.getFragments().forEach(function(t){t instanceof bi.Fragment&&e.push(new xi(t.path,t.startOffset,t.endOffset,!1,this.containerId,this.surfaceId))}.bind(this)),e}_clone(){return new Ei(this)}_range(e){if(e._internal.addressRange)return e._internal.addressRange;let t,r=this.getContainer(),n=r.getAddress(e.start),s={start:n,end:t=e.isCollapsed()?n:r.getAddress(e.end)};return e._isContainerSelection&&(e._internal.addressRange=s),s}get path(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")}get _isContainerSelection(){return!0}static fromJSON(e){return new Ei(e)}}function Ni(e,t,r){let n;n=t===r?new xi({path:t.path,startOffset:t.offset,endOffset:t.offset,containerId:e.containerId,surfaceId:e.surfaceId}):new Ei(e.containerId,t.path,t.offset,r.path,r.offset,!1,e.surfaceId);const s=e._internal.doc;return s&&n.attach(s),n}class Ti extends bi{constructor(e,t,r,n,s){if(super(),1===arguments.length){let i=arguments[0];e=i.containerId,t=i.nodeId,r=i.mode,n=i.reverse,s=i.surfaceId}if(!E(e))throw new Error("'containerId' is mandatory.");if(!E(t))throw new Error("'nodeId' is mandatory.");r=r||"full",this.containerId=e,this.nodeId=t,this.mode=r,this.reverse=Boolean(n),this.surfaceId=s,this.start=new Si([t],0),this.end=new Si([t],1)}equals(e){return super.equals(e)&&this.nodeId===e.nodeId&&this.mode===e.mode}isNodeSelection(){return!0}getType(){return"node"}getNodeId(){return this.nodeId}isFull(){return"full"===this.mode}isBefore(){return"before"===this.mode}isAfter(){return"after"===this.mode}isCollapsed(){return"full"!==this.mode}toJSON(){return{type:"node",nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,containerId:this.containerId,surfaceId:this.surfaceId}}toString(){return["NodeSelection(",this.containerId,".",this.nodeId,", ",this.mode,", ",this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(e){if("left"===e)return this.isBefore()?this:new Ti(this.containerId,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===e)return this.isAfter()?this:new Ti(this.containerId,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'")}_getCoordinate(){return"before"===this.mode?new Si([this.nodeId],0):"after"===this.mode?new Si([this.nodeId],1):void 0}_clone(){return new Ti(this)}static fromJSON(e){return new Ti(e)}static _createFromCoordinate(e){var t=e.containerId,r=e.getNodeId(),n=0===e.offset?"before":"after";return new Ti(t,r,n,!1)}get _isNodeSelection(){return!0}}class Ii extends bi{constructor(e,t,r){if(super(),1===arguments.length){let n=arguments[0];e=n.customType,t=n.data,r=n.surfaceId}this.customType=e,this.data=t||{},this.surfaceId=r}isCustomSelection(){return!0}getType(){return"custom"}getCustomType(){return this.customType}toJSON(){return{type:"custom",customType:this.customType,data:v(this.data),surfaceId:this.surfaceId}}toString(){return["CustomSelection(",this.customType,", ",JSON.stringify(this.data),")"].join("")}equals(e){return bi.prototype.equals.call(this,e)&&e.isCustomSelection()&&S(this.data,e.data)}_clone(){return new Ii(this)}get _isCustomSelection(){return!0}static fromJSON(e){return new Ii(e)}}function Ai(e){if(!e)return bi.nullSelection;switch(e.type){case"property":return xi.fromJSON(e);case"container":return Ei.fromJSON(e);case"node":return Ti.fromJSON(e);case"custom":return Ii.fromJSON(e);default:return bi.nullSelection}}function Di(e,t){if(t.isNodeCoordinate()&&0===t.offset)return!0;let r=e.get(t.path[0]).getContainerRoot();if(r.isText()&&0===t.offset)return!0;if(r.isList()){let e=t.path[0];if(r.items[0]===e&&0===t.offset)return!0}}function Oi(e,t){if(t.isNodeCoordinate()&&t.offset>0)return!0;let r=e.get(t.path[0]).getContainerRoot();if(r.isText()&&t.offset>=r.getLength())return!0;if(r.isList()){let n=t.path[0],s=e.get(n);if(wi(r.items)===n&&t.offset===s.getLength())return!0}}function Pi(e,t,r,n){let{isEntirelySelected:s}=ki(e,t,r,n);return s}function ki(e,t,r,n){let s=!0,i=!0;if(t.isText())r&&0!==r.offset&&(s=!1),n&&n.offset<t.getLength()&&(i=!1);else if(t.isList()){if(r){let e=r.path[0];(t.getItemPosition(e)>0||0!==r.offset)&&(s=!1)}if(n){let r=n.path[0],s=t.getItemPosition(r),o=e.get(r);(s<t.items.length-1||n.offset<o.getLength())&&(i=!1)}}return{isFirst:s,isLast:i,isEntirelySelected:s&&i}}function Mi(e,t,r,n){if(t.isText()){let s=0;if("after"===n){s=t.getText().length}e.setSelection({type:"property",path:t.getPath(),startOffset:s,containerId:r})}else if(t.isList()){let s,i;"after"===n?i=(s=t.getLastItem()).getLength():(s=t.getFirstItem(),i=0),e.setSelection({type:"property",path:s.getPath(),startOffset:i,containerId:r})}else e.setSelection({type:"node",containerId:r,nodeId:t.id})}function Li(e,t,r){e.setSelection(Ri({doc:e,nodeId:t,containerId:r}))}function Ri({doc:e,nodeId:t,containerId:r,mode:n,reverse:s,surfaceId:i}){let o=e.get(t);if(!o)return bi.nullSelection;if((o=o.getContainerRoot()).isText())return new xi({path:o.getPath(),startOffset:"after"===n?o.getLength():0,endOffset:"before"===n?0:o.getLength(),reverse:s,containerId:r,surfaceId:i});if(o.isList()&&o.getLength()>0){let e=o.getFirstItem(),t=o.getLastItem(),a={path:e.getPath(),offset:0},l={path:t.getPath(),offset:t.getLength()};return"after"===n?a=l:"before"===n&&(l=a),new Ei({startPath:a.path,startOffset:a.offset,endPath:l.path,endOffset:l.offset,reverse:s,containerId:r,surfaceId:i})}return new Ti({nodeId:t,mode:n,reverse:s,containerId:r,surfaceId:i})}function qi(e,t){if(t.grabFocus())return!0;let r=t.find(".sc-surface");if(r){if(r._isTextPropertyEditor){const t=e.getDocument(),n=r.getPath(),s=t.get(n,"strict");return e.setSelection({type:"property",path:n,startOffset:s.length,surfaceId:r.id}),!0}if(r._isContainerEditor){let t=r.getContainer();if(t.length>0){Mi(e,t.getChildAt(0),t.id,"after")}return!0}}return!1}function Bi(e,t){return e&&t&&!e.surfaceId&&!t.isNull()&&(e.containerId=e.containerId||t.containerId,e.surfaceId=e.surfaceId||t.surfaceId),e}var Fi=Object.freeze({fromJSON:Ai,isFirst:Di,isLast:Oi,isEntirelySelected:Pi,getRangeInfo:ki,setCursor:Mi,selectNode:Li,createNodeSelection:Ri,stepIntoIsolatedNode:qi,augmentSelection:Bi});class ji{constructor(e,t,r){if(1===arguments.length&&m(arguments[0])){let e=arguments[0];this.sha=e.sha,this.timestamp=e.timestamp,this.before=e.before||{},this.ops=e.ops,this.info=e.info,this.after=e.after||{}}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=d(),this.info={},this.timestamp=Date.now(),this.ops=e.slice(0),this.before=t||{},this.after=r||{}}this.updated=null,this.created=null,this.deleted=null}_extractInformation(e){if(this._extracted)return;let t=this.ops,n={},s={},i={},o=[];function a(t){switch(t.type){case"create":case"delete":{let e=t.val;e.hasOwnProperty("start")&&(i[e.start.path]=!0),e.hasOwnProperty("end")&&(i[e.end.path]=!0);break}case"update":case"set":{let r=e.get(t.path[0]);r&&(r.isPropertyAnnotation()?i[r.start.path]=!0:r.isContainerAnnotation()&&o.push(r));break}}}for(let e=0;e<t.length;e++){let r=t[e];"create"===r.type&&(n[r.val.id]=r.val,delete s[r.val.id]),"delete"===r.type&&(delete n[r.val.id],s[r.val.id]=r.val),"set"!==r.type&&"update"!==r.type||(i[r.path]=!0,i[r.path[0]]=!0),a(r)}o.forEach(function(t){let r=e.get(t.containerId,"strict"),n=r.getPosition(t.start.path[0]),o=r.getPosition(t.end.path[0]);for(let e=n;e<=o;e++){let t,n=r.getChildAt(e);t=n.isText()?n.getPath():[n.id],s[n.id]||(i[t]=!0)}}),Object.keys(s).length>0&&r(i,function(e,t){let r=t.split(",")[0];s[r]&&delete i[t]}),this.created=n,this.deleted=s,this.updated=i,this._extracted=!0}invert(){let e=this.toJSON();e.ops=[];let t=e.before;e.before=e.after,e.after=t;let r=ji.fromJSON(e),n=[];for(let e=this.ops.length-1;e>=0;e--)n.push(this.ops[e].invert());return r.ops=n,r}isAffected(e){return console.error("DEPRECATED: use change.hasUpdated() instead"),this.hasUpdated(e)}isUpdated(e){return console.error("DEPRECATED: use change.hasUpdated() instead"),this.hasUpdated(e)}hasUpdated(e){return this.updated[e]}hasDeleted(e){return this.deleted[e]}serialize(){let e=new _i,t=this.toJSON();return t.ops=this.ops.map(function(t){return e.serialize(t)}),JSON.stringify(t)}clone(){return ji.fromJSON(this.toJSON())}toJSON(){let e={sha:this.sha,before:y(this.before),ops:g(this.ops,function(e){return e.toJSON()}),info:this.info,after:y(this.after)};e.after.selection=void 0,e.before.selection=void 0;let t=this.before.selection;return t&&t._isSelection&&(e.before.selection=t.toJSON()),(t=this.after.selection)&&t._isSelection&&(e.after.selection=t.toJSON()),e}}function Hi(e,t){!function(e,t){_(e)||(e=[e]);_(t)||(t=[t]);for(let r=0;r<e.length;r++){let n=e[r];for(let e=0;e<t.length;e++){let r=t[e];zi(n,r)}}}(e,t)}function Ui(e,t){let r=e.clone();return Vi(r,t)?r:e}function zi(e,t){for(let r=0;r<e.ops.length;r++){let n=e.ops[r];for(let e=0;e<t.ops.length;e++){let r=t.ops[e];ni.transform(n,r,{inplace:!0})}}e.before&&Vi(e.before.selection,t),e.after&&Vi(e.after.selection,t),t.before&&Vi(t.before.selection,e),t.after&&Vi(t.after.selection,e)}function Vi(e,t){if(!e||!e.isPropertySelection()&&!e.isContainerSelection())return!1;let r=t.ops,n=!1,s=e.isCollapsed();for(let t=0;t<r.length;t++){let i=r[t];n|=Gi(e.start,i),s?(e.isContainerSelection()&&(e.end.path=e.start.path),e.end.offset=e.start.offset):n|=Gi(e.end,i)}return n}function Gi(e,t){if(!S(t.path,e.path))return!1;let r=!1;if("update"===t.type&&"string"===t.propertyType){let n,s=t.diff;s.isInsert()&&s.pos<=e.offset?(n=e.offset+s.str.length,e.offset=n,r=!0):s.isDelete()&&s.pos<=e.offset&&(n=Math.max(s.pos,e.offset-s.str.length),e.offset=n,r=!0)}return r}ji.deserialize=function(e){let t=new _i,r=JSON.parse(e);return r.ops=r.ops.map(function(e){return t.deserialize(e)}),r.before.selection&&(r.before.selection=Ai(r.before.selection)),r.after.selection&&(r.after.selection=Ai(r.after.selection)),new ji(r)},ji.fromJSON=function(e){let t=v(e);return t.ops=e.ops.map(function(e){return ni.fromJSON(e)}),t.before.selection=Ai(e.before.selection),t.after.selection=Ai(e.after.selection),new ji(t)};var Ji=Object.freeze({transformDocumentChange:Hi,transformSelection:Ui});class Ki extends l{constructor(e){super(),this.documentEngine=e,this._collaborators={}}_register(e,t,r){let n=this._collaborators[e];n||(n=this._collaborators[e]={collaboratorId:e,documents:{}}),n.info=r,n.documents[t]={}}_unregister(e,t){let r=this._collaborators[e];delete r.documents[t],0===Object.keys(r.documents).length&&delete this._collaborators[e]}getDocumentIds(e){let t=this._collaborators[e];return t?Object.keys(t.documents):[]}getCollaborators(e,t){let n={};return r(this._collaborators,function(r){if(r.documents[e]&&r.collaboratorId!==t){let e={collaboratorId:r.collaboratorId};e=Object.assign({},r.info,e),n[r.collaboratorId]=e}}),n}getCollaboratorIds(e,t){return g(this.getCollaborators(e,t),function(e){return e.collaboratorId})}sync({documentId:e,version:t,change:r,collaboratorId:n},s){this._sync({documentId:e,version:t,change:r},function(t,r){if(t)return s(t);this._register(n,e),s(null,r)}.bind(this))}_sync({documentId:e,version:t,change:r},s){this.documentEngine.getVersion(e,(i,o)=>{if(i)return s(i);t>o?s(new n("InvalidVersionError",{message:"Client version greater than server version"})):r&&o===t?this._syncFF({documentId:e,version:t,change:r},s):r&&o>t?this._syncRB({documentId:e,version:t,change:r},s):r?console.warn("Unhandled case"):this._syncPullOnly({documentId:e,version:t,change:r},s)})}_syncPullOnly({documentId:e,version:t,change:r},n){this.documentEngine.getChanges(e,t,(e,s)=>{if(e)return n(e);let i;if(s.length>0){let e=[];s.forEach(t=>{e=e.concat(t.ops)}),i=new ji(e,{},{}),i=this.serializeChange(i)}n(null,{serverChange:i,change:r,version:t})})}_syncFF({documentId:e,change:t},r){this.documentEngine.addChange(e,t,(e,n)=>{if(e)return r(e);r(null,{change:t,serverChange:null,version:n})})}_syncRB({documentId:e,change:t,version:r},n){this._rebaseChange({documentId:e,change:t,version:r},function(r,s){if(r)return n(r);this.documentEngine.addChange(e,t,function(e,t){if(e)return n(e);n(null,{change:s.change,serverChange:s.serverChange,version:t})})}.bind(this))}_rebaseChange({documentId:e,change:t,version:r},n){this.documentEngine.getChanges(e,r,function(e,r,s){if(e)return n(e);let i=r.map(this.deserializeChange),o=this.deserializeChange(t);Hi(o,i);let a=i.reduce(function(e,t){return e.concat(t.ops)},[]),l=new ji(a,{},{});n(null,{change:this.serializeChange(o),serverChange:this.serializeChange(l),version:s})}.bind(this))}disconnect(e){this._unregister(e.collaboratorId,e.documentId)}serializeChange(e){return e.toJSON()}deserializeChange(e){return ji.fromJSON(e)}}function $i(e,t,r,n){var s=new XMLHttpRequest;s.open(e,t,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.onload=function(){if(!(s.status>=200&&s.status<400))return n(new Error("Request failed. Returned status: "+s.status));var e=s.responseText;(function(e){try{JSON.parse(e)}catch(e){return!1}return!0})(e)&&(e=JSON.parse(e)),n(null,e)},r?s.send(JSON.stringify(r)):s.send()}class Xi extends l{constructor(e){super(),this.config=e,this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this._connect()}_createWebSocket(){throw n("AbstractMethodError")}_connect(){this.ws=this._createWebSocket(),this.ws.addEventListener("open",this._onConnectionOpen),this.ws.addEventListener("close",this._onConnectionClose),this.ws.addEventListener("message",this._onMessage)}_disconnect(){this.ws.removeEventListener("message",this._onMessage),this.ws.removeEventListener("open",this._onConnectionOpen),this.ws.removeEventListener("close",this._onConnectionClose),this.ws=null}_onConnectionOpen(){this.emit("open")}_onConnectionClose(){this._disconnect(),this.emit("close"),console.info("websocket connection closed. Attempting to reconnect in 5s."),setTimeout(function(){this._connect()}.bind(this),5e3)}_onMessage(e){e=this.deserializeMessage(e.data),this.emit("message",e)}send(e){this.isOpen()?this.ws.send(this.serializeMessage(e)):console.warn("Message could not be sent. Connection is not open.",e)}isOpen(){return this.ws&&1===this.ws.readyState}serializeMessage(e){return JSON.stringify(e)}deserializeMessage(e){return JSON.parse(e)}}function Wi(e,t){let r=(e=v(e)).nodes;return t.forEach(e=>{e.ops.forEach(e=>{try{ni.fromJSON(e).apply(r)}catch(t){console.error(t,e)}})}),e}const Yi={nodes:{}};class Zi{constructor(e){this.changeStore=e.changeStore,this.snapshotStore=e.snapshotStore}getSnapshot(e,t,r){let n=Yi;this._getClosestSnapshot(e,t,(s,i,o)=>{if(s)return r(s);if(i&&t===o)return r(null,i,t);let a;a=i?o:0,i&&(n=i),this.changeStore.getChanges(e,a,t,(e,s)=>e?r(e):s.length<t-a?r(new Error("Changes missing for reconstructing version "+t)):(n=Wi(n,s),void r(null,n,t)))})}createSnapshot(e,t,r){this.getSnapshot(e,t,(n,s)=>{if(n)return r(n);this.snapshotStore.saveSnapshot(e,t,s,r)})}_getClosestSnapshot(e,t,r){let n;this.snapshotStore.getVersions(e,(s,i)=>{if(s)return r(s);if(0===i.length)return r(null,void 0);if(i.indexOf(t)>=0)n=t;else{let e=i.filter(function(e){return parseInt(e,10)<t});n=Math.max.apply(null,e)}if(!n)return r(null,void 0);this.snapshotStore.getSnapshot(e,n,r)})}}class Qi extends l{constructor(e){super(),this.changeStore=e.changeStore,this.snapshotStore=e.snapshotStore,this.snapshotFrequency=e.snapshotFrequency||1,this.snapshotEngine=new Zi({changeStore:this.changeStore,snapshotStore:this.snapshotStore})}createDocument(e,t,r){this.addChange(e,t,r)}getDocument(e,t,r){if("function"==typeof t&&(r=t,t=void 0),!e)throw new Error("Invalid Arguments");void 0===t?this.getVersion(e,(t,n)=>{if(t)return r(t);this.snapshotEngine.getSnapshot(e,n,r)}):this.snapshotEngine.getSnapshot(e,t,r)}deleteDocument(e,t){this.changeStore.deleteChanges(e,e=>{if(e)return t(new Error("Deleting changes failed"))})}documentExists(e,t){this.getVersion(e,(e,r)=>{if(e)return t(e);t(null,r>=0)})}getChanges(e,t,r,n){this.changeStore.getChanges(e,t,r,n)}getVersion(e,t){this.changeStore.getVersion(e,t)}requestSnapshot(e,t,r){t%this.snapshotFrequency==0?this.snapshotEngine.createSnapshot(e,t,r):r(null)}addChange(e,t,r){this.changeStore.addChange(e,t,(t,n)=>{if(t)return r(t);this.requestSnapshot(e,n,()=>{r(null,n)})})}}class eo{constructor(e){this._snapshots=e||{}}getVersions(e,t){t(null,this._getVersions(e))}getSnapshot(e,t,r){if(3===!arguments.length)throw new Error("Invalid Arguments");let n=this._snapshots[e];if(!n)return r(null,void 0);let s=n[t];s?r(null,s,t):r(null,void 0)}saveSnapshot(e,t,r,n){if(!e||!t||!r)throw new Error("Invalid arguments");let s=this._snapshots[e];s||(s=this._snapshots[e]={}),s[t]=r,n(null,s[t])}deleteSnapshot(e,t,r){let n=this._snapshots[e];if(!n||!n[t])return r(new Error("Snapshot does not exist and can not be deleted"));let s=this._snapshots[e][t];delete this._snapshots[e][t],r(null,s)}_getVersions(e){let t=this._snapshots[e];return t?Object.keys(t):[]}}var to={name:"collab-server",configure:function(e){e.setChangeStore(new t),e.setSnapshotStore(new eo)}};function ro(...e){return Object.assign(...e)}function no(e){return"function"==typeof e}class so{constructor(e){this.arr=e,this.pos=-1}get _isArrayIterator(){return!0}hasNext(){return this.pos<this.arr.length-1}next(){return this.pos+=1,this.arr[this.pos]}back(){return this.pos>=0&&(this.pos-=1),this}peek(){return this.arr[this.pos+1]}}function io(e,t){if(!no(t))return e.indexOf(t);for(let r=0;r<e.length;r++)if(t(e[r]))return r;return-1}class oo{constructor(e,t,r){if(!E(e)||!no(t))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");var n=t,s=(r=r||{}).context,i=Boolean(r.capture);s&&(t=t.bind(s)),!0===r.once&&(t=function(e,t){return function(r){t(r),e._el.removeEventListener(e)}}(this,t)),this.eventName=e,this.originalHandler=n,this.handler=t,this.capture=i,this.context=s,this.options=r,this._el=null}get _isDOMEventListener(){return!0}static findIndex(e,t,r){return arguments[1]._isDOMEventListener?e.indexOf(arguments[1]):io(e,function(e,t){return e.eventName===t.eventName&&e.originalHandler===t.originalHandler}.bind(null,{eventName:t,originalHandler:r}))}}const ao="This method is not implemented.";class lo{getNativeElement(){throw new Error(ao)}isTextNode(){return!1}isElementNode(){return!1}isCommentNode(){return!1}isDocumentNode(){return!1}getTagName(){throw new Error(ao)}setTagName(e){throw new Error(ao)}getId(){return this.getAttribute("id")}setId(e){return this.setAttribute("id",e),this}hasClass(e){throw new Error(ao)}addClass(e){throw new Error(ao)}removeClass(e){throw new Error(ao)}hasAttribute(e){return Boolean(this.getAttribute(e))}attr(){if(1===arguments.length){if(E(arguments[0]))return this.getAttribute(arguments[0]);s(arguments[0])&&r(arguments[0],function(e,t){this.setAttribute(t,e)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this}removeAttr(e){var t=e.split(/\s+/);return 1===t.length?this.removeAttribute(e):t.forEach(function(e){this.removeAttribute(e)}.bind(this)),this}getAttribute(e){throw new Error(ao)}setAttribute(e,t){throw new Error(ao)}removeAttribute(e){throw new Error(ao)}getAttributes(){throw new Error(ao)}htmlProp(){if(1===arguments.length){if(E(arguments[0]))return this.getProperty(arguments[0]);s(arguments[0])&&r(arguments[0],function(e,t){this.setProperty(t,e)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this}getProperty(e){throw new Error(ao)}setProperty(e,t){throw new Error(ao)}val(e){return 0===arguments.length?this.getValue():(this.setValue(e),this)}getValue(){return this.getProperty("value")}setValue(e){return this.setProperty("value",e),this}css(){if(1===arguments.length){if(E(arguments[0]))return this.getStyle(arguments[0]);if(!s(arguments[0]))throw new Error("Illegal arguments.");r(arguments[0],function(e,t){this.setStyle(t,e)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this}getStyle(e){throw new Error(ao)}setStyle(e,t){throw new Error(ao)}text(e){return 0===arguments.length?this.getTextContent():(this.setTextContent(e),this)}getTextContent(){throw new Error(ao)}setTextContent(e){throw new Error(ao)}html(e){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(e),this)}getInnerHTML(){throw new Error(ao)}getInnerXML(){return this.getInnerHTML()}setInnerHTML(e){throw new Error(ao)}setInnerXML(e){return this.setInnerHTML(e)}getOuterHTML(){throw new Error(ao)}getOuterXML(){return this.getOuterHTML()}on(e,t,r,n){if(!E(e))throw new Error('Illegal argument: "event" must be a String.');if(n=n||{},r&&(n.context=r),!t||!no(t))throw new Error("Illegal argument: invalid handler function for event "+e);return this.addEventListener(e,t,n),this}off(e,t){if(1!==arguments.length||E(e))this.removeEventListener(e,t);else{let e=arguments[0];this.getEventListeners().filter(function(t){return t.context===e}).forEach(function(e){this.removeEventListener(e)}.bind(this))}return this}addEventListener(e,t,r={}){let n;return n=1===arguments.length&&arguments[0]?arguments[0]:this._createEventListener(e,t,r),this.eventListeners||(this.eventListeners=[]),n._el=this,this.eventListeners.push(n),this._addEventListenerNative(n),this}_createEventListener(e,t,r){return new oo(e,t,r)}_addEventListenerNative(e){}removeEventListener(e,t){if(!this.eventListeners)return;let r=null,n=oo.findIndex(this.eventListeners,e,t);return r=this.eventListeners[n],n>-1&&(this.eventListeners.splice(n,1),r._el=null,this._removeEventListenerNative(r)),this}_removeEventListenerNative(e){}removeAllEventListeners(){if(this.eventListeners){for(let e=0;e<this.eventListeners.length;e++){let t=this.eventListeners[e];t._el=null,this._removeEventListenerNative(t)}delete this.eventListeners}}getEventListeners(){return this.eventListeners||[]}getNodeType(){throw new Error(ao)}getContentType(){throw new Error(ao)}getChildCount(){throw new Error(ao)}getChildNodes(){throw new Error(ao)}getChildren(){throw new Error(ao)}getChildAt(e){throw new Error(ao)}getChildIndex(e){throw new Error(ao)}getChildNodeIterator(){return new so(this.getChildNodes())}getLastChild(){throw new Error(ao)}getFirstChild(){throw new Error(ao)}getNextSibling(){throw new Error(ao)}getPreviousSibling(){throw new Error(ao)}clone(e){throw new Error(ao)}createElement(e){throw new Error(ao)}createTextNode(e){throw new Error(ao)}createComment(e){throw new Error(ao)}createProcessingInstruction(e,t){throw new Error(ao)}createCDATASection(e){throw new Error(ao)}is(e){throw new Error(ao)}getParent(){throw new Error(ao)}getOwnerDocument(){throw new Error(ao)}getDoctype(){throw new Error("NOT_IMPLEMENTED")}setDoctype(e,t,r){throw new Error("NOT_IMPLEMENTED")}setDocType(...e){return console.error("DEPRECATED: use setDoctype() instead"),this.setDoctype(...e)}find(e){throw new Error(ao)}findAll(e){throw new Error(ao)}append(e){var t;if(1===arguments.length){if(!_(e))return this.appendChild(e),this;t=e}else t=arguments;return t&&Array.prototype.forEach.call(t,this.appendChild.bind(this)),this}appendChild(e){throw new Error(ao)}insertAt(e,t){throw new Error(ao)}insertBefore(e,t){throw new Error(ao)}removeAt(e){throw new Error(ao)}removeChild(e){throw new Error(ao)}replaceChild(e,t){throw new Error(ao)}remove(){var e=this.getParent();e&&e.removeChild(this)}empty(){throw new Error(ao)}serialize(){return this.getOuterHTML()}isInDocument(){let e=this;for(;e;){if(e.isDocumentNode())return!0;e=e.getParent()}}focus(){return this}select(){return this}blur(){return this}click(){return this}getWidth(){return 0}getHeight(){return 0}getOuterHeight(e){return 0}getOffset(){return{top:0,left:0}}getPosition(){return{top:0,left:0}}getElementFactory(){return this.createElement.bind(this)}emit(e,t){throw new Error(ao)}get id(){return this.getId()}set id(e){this.setId(e)}get tagName(){return this.getTagName()}set tagName(e){this.setTagName(e)}get nodeName(){return this.getTagName()}get nodeType(){return this.getNodeType()}get className(){return this.getAttribute("class")}set className(e){this.setAttribute("class",e)}get textContent(){return this.getTextContent()}set textContent(e){this.setTextContent(e)}get innerHTML(){return this.getInnerHTML()}set innerHTML(e){this.setInnerHTML(e)}get outerHTML(){return this.getOuterHTML()}get firstChild(){return this.getFirstChild()}get lastChild(){return this.getLastChild()}get nextSibling(){return this.getNextSibling()}get previousSibling(){return this.getPreviousSibling()}get parentNode(){return this.getParent()}get height(){return this.getHeight()}get width(){return this.getWidth()}get value(){return this.getValue()}set value(e){return this.setValue(e)}get _isDOMElement(){return!0}static get pxStyles(){return co}static get EMPTY_HTML(){return ho}}const co={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0},ho="<html><head></head><body></body></html>",uo=d("_BrowserDOMElement");function po(e,t){e[uo]=t}function fo(e){return e[uo]}class go extends lo{constructor(e){super(),console.assert(e instanceof window.Node,"Expecting native DOM node."),this.el=e,po(e,this)}getNativeElement(){return this.el}getNodeType(){switch(this.el.nodeType){case window.Node.TEXT_NODE:return"text";case window.Node.ELEMENT_NODE:return"element";case window.Node.DOCUMENT_NODE:return"document";case window.Node.COMMENT_NODE:return"comment";case window.Node.PROCESSING_INSTRUCTION_NODE:return"directive";case window.Node.CDATA_SECTION_NODE:return"cdata"}}getDoctype(){return this.isDocumentNode()?this.el.doctype:this.getOwnerDocument().getDoctype()}setDoctype(e,t,r){let n=this._getNativeOwnerDocument(),s=n.doctype,i=n.implementation.createDocumentType(e,t,r);s?s.parentNode.replaceChild(i,s):n.insertBefore(i,n.firstChild)}isTextNode(){return this.el.nodeType===window.Node.TEXT_NODE}isElementNode(){return this.el.nodeType===window.Node.ELEMENT_NODE}isCommentNode(){return this.el.nodeType===window.Node.COMMENT_NODE}isDocumentNode(){return this.el.nodeType===window.Node.DOCUMENT_NODE}hasClass(e){return this.el.classList.contains(e)}addClass(e){return this.el.classList.add(e),this}removeClass(e){return this.el.classList.remove(e),this}getAttribute(e){return this.el.getAttribute(e)}setAttribute(e,t){return this.el.setAttribute(e,String(t)),this}removeAttribute(e){return this.el.removeAttribute(e),this}getAttributes(){return this.el.attributes._mapAdapter||(this.el.attributes._mapAdapter=new _o(this.el.attributes)),this.el.attributes._mapAdapter}getProperty(e){return this.el[e]}setProperty(e,t){if(this._isXML())throw new Error("setProperty() is only supported for HTML elements.");return this.el[e]=t,this}getTagName(){return this._isXML()?this.el.tagName:this.el.tagName?this.el.tagName.toLowerCase():void 0}setTagName(e){let t,r=this.createElement(e),n=this.el.attributes,s=n.length;for(t=0;t<s;t++){let e=n.item(t);r.setAttribute(e.name,e.value)}return this.eventListeners&&this.eventListeners.forEach(function(e){r.addEventListener(e.eventName,e.handler,e.capture)}),r.append(this.getChildNodes()),this._replaceNativeEl(r.getNativeElement()),this}getId(){return this.el.id}setId(e){return this.el.id=e,this}getStyle(e){let t=this.el.style[e];if(!t){t=this.getComputedStyle()[e]}return t}getComputedStyle(){return window.getComputedStyle(this.el)}setStyle(e,t){return lo.pxStyles[e]&&C(t)&&(t+="px"),this.el.style[e]=t,this}getTextContent(){return this.el.textContent}setTextContent(e){return this.el.textContent=e,this}getInnerHTML(){if(this._isXML()){let e=new window.XMLSerializer;return Array.prototype.map.call(this.el.childNodes,t=>e.serializeToString(t)).join("")}return this.el.innerHTML}setInnerHTML(e){return this.el.innerHTML=e,this}getOuterHTML(){if(this._isXML()){return(new window.XMLSerializer).serializeToString(this.el)}return this.el.outerHTML}_addEventListenerNative(e){this.el.addEventListener(e.eventName,e.handler,e.capture)}_removeEventListenerNative(e){this.el.removeEventListener(e.eventName,e.handler)}getEventListeners(){return this.eventListeners||[]}getChildCount(){return this.el.childNodes.length}getChildNodes(){let e=[];for(let t=this.el.firstChild;t;t=t.nextSibling)e.push(go.wrap(t));return e}getChildNodeIterator(){return new yo(this.el)}get childNodes(){return this.getChildNodes()}getChildren(){let e=[];for(let t=this.el.firstChild;t;t=t.nextSibling)t.nodeType===window.Node.ELEMENT_NODE&&e.push(go.wrap(t));return e}get children(){return this.getChildren()}getChildAt(e){return go.wrap(this.el.childNodes[e])}getChildIndex(e){if(!e._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,e.el)}getFirstChild(){let e=this.el.firstChild;return e?go.wrap(e):null}getLastChild(){var e=this.el.lastChild;return e?go.wrap(e):null}getNextSibling(){let e=this.el.nextSibling;return e?go.wrap(e):null}getPreviousSibling(){let e=this.el.previousSibling;return e?go.wrap(e):null}clone(e){let t=this.el.cloneNode(e);return go.wrap(t)}createDocument(e,t){return go.createDocument(e,t)}createElement(e){let t=this._getNativeOwnerDocument().createElement(e);return go.wrap(t)}createTextNode(e){let t=this._getNativeOwnerDocument().createTextNode(e);return go.wrap(t)}createComment(e){let t=this._getNativeOwnerDocument().createComment(e);return go.wrap(t)}createProcessingInstruction(e,t){let r=this._getNativeOwnerDocument().createProcessingInstruction(e,t);return go.wrap(r)}createCDATASection(e){let t=this._getNativeOwnerDocument().createCDATASection(e);return go.wrap(t)}is(e){let t=this.el;return!!this.isElementNode()&&function(e,t){let r=window.Element.prototype;return(r.matches||r.matchesSelector||r.msMatchesSelector||r.webkitMatchesSelector).call(e,t)}(t,e)}getParent(){let e=this.el.parentNode;return e?go.wrap(e):null}getOwnerDocument(){return go.wrap(this._getNativeOwnerDocument())}get ownerDocument(){return this.getOwnerDocument()}_getNativeOwnerDocument(){return this.isDocumentNode()?this.el:this.el.ownerDocument}find(e){let t=null;return this.el.querySelector&&(t=this.el.querySelector(e)),t?go.wrap(t):null}findAll(e){let t=[];return this.el.querySelectorAll&&(t=this.el.querySelectorAll(e)),Array.prototype.map.call(t,function(e){return go.wrap(e)})}_normalizeChild(e){if(x(e))return e;if(e instanceof window.Node?e=go.wrap(e):!e._isBrowserDOMElement||e instanceof go?(E(e)||C(e))&&(e=this.createTextNode(e)):e=go.wrap(e),!e||!e._isBrowserDOMElement)throw new Error("Illegal child type.");return console.assert(fo(e.el)===e,"The backlink to the wrapper should be consistent"),e.getNativeElement()}appendChild(e){let t=this._normalizeChild(e);return t&&this.el.appendChild(t),this}insertAt(e,t){let r=this._normalizeChild(t),n=this.el.childNodes;return e>=n.length?this.el.appendChild(r):this.el.insertBefore(r,n[e]),this}insertBefore(e,t){if(x(t))return this.appendChild(e);if(!t._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var r=this._normalizeChild(e);return r&&this.el.insertBefore(r,t.el),this}removeAt(e){return this.el.removeChild(this.el.childNodes[e]),this}removeChild(e){if(!e||!e._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(e.el),this}replaceChild(e,t){if(!(t&&e&&t._isBrowserDOMElement&&e._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(t.el,e.el),this}empty(){let e=this.el;for(;e.lastChild;)e.removeChild(e.lastChild);return this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}serialize(){let e=this.el.outerHTML;if(E(e))return e;return(new window.XMLSerializer).serializeToString(this.el)}isInDocument(){let e=this.el;for(;e;){if(e.nodeType===window.Node.DOCUMENT_NODE)return!0;e=e.parentNode}}_replaceNativeEl(e){console.assert(e instanceof window.Node,"Expecting a native element.");let t=this.el,r=t.parentNode;r&&r.replaceChild(e,t),this.el=e,delete t[uo],po(e,this)}_getChildNodeCount(){return this.el.childNodes.length}focus(e){return this.el.focus(e),this}select(){return this.el.select(),this}blur(){return this.el.blur(),this}click(){return this.el.click(),this}getWidth(){let e=this.el.getClientRects()[0];return e?e.width:0}getHeight(){let e=this.el.getClientRects()[0];return e?e.height:0}getOffset(){let e=this.el.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}}getPosition(){return{left:this.el.offsetLeft,top:this.el.offsetTop}}getOuterHeight(e){let t=this.el.offsetHeight;if(e){let e=this.getComputedStyle();t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10)}return t}getContentType(){return this._getNativeOwnerDocument().contentType}_isXML(){return"application/xml"===this.getContentType()}emit(e,t){let r;r=t?new window.CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}):new window.Event(e,{bubbles:!0,cancelable:!0}),this.el.dispatchEvent(r)}}go.prototype._isBrowserDOMElement=!0,go.createDocument=function(e,t={}){let r;if("xml"===e){let e,n=[];t.version&&n.push(`version="${t.version}"`),t.encoding&&n.push(`encoding="${t.encoding}"`),e=n.length>0?`<?xml ${n.join(" ")}?><dummy/>`:"<dummy/>",(r=(new window.DOMParser).parseFromString(e,"application/xml")).removeChild(r.firstChild)}else r=(new window.DOMParser).parseFromString(lo.EMPTY_HTML,"text/html");return go.wrap(r)},go.parseMarkup=function(e,t,r={}){if(!e)return go.createDocument(t);let n;r.snippet&&(e=`<div id='__snippet__'>${e}</div>`);let s=new window.DOMParser;if("html"===t?n=go.wrap(i(s.parseFromString(e,"text/html"))):"xml"===t&&(n=go.wrap(i(s.parseFromString(e,"application/xml")))),r.snippet){let e=n.find("#__snippet__").childNodes;return 1===e.length?e[0]:e}return n;function i(e){if(e){let t=e.querySelector("parsererror");if(t)throw new Error("ParserError: "+go.wrap(t).outerHTML)}return e}},go.wrap=go.wrapNativeElement=function(e){if(!e)return null;{let t=fo(e);if(t)return t;if(e instanceof window.Node)return new go(e);if(e._isBrowserDOMElement)return new go(e.getNativeElement());if(e===window)return go.getBrowserWindow()}},go.unwrap=function(e){return fo(e)};class mo{constructor(){this.el=window,po(window,this)}}mo.prototype.on=go.prototype.on,mo.prototype.off=go.prototype.off,mo.prototype.addEventListener=go.prototype.addEventListener,mo.prototype.removeEventListener=go.prototype.removeEventListener,mo.prototype._createEventListener=go.prototype._createEventListener,mo.prototype._addEventListenerNative=go.prototype._addEventListenerNative,mo.prototype._removeEventListenerNative=go.prototype._removeEventListenerNative,mo.prototype.getEventListeners=go.prototype.getEventListeners,go.getBrowserWindow=function(){return window[uo]?window[uo]:new mo(window)},go.isReverse=function(e,t,r,n){if(r&&e){go.isReverse._r1||(go.isReverse._r1=window.document.createRange(),go.isReverse._r2=window.document.createRange());const s=go.isReverse._r1,i=go.isReverse._r2;if(s.setStart(e.getNativeElement(),t),i.setStart(r.getNativeElement(),n),1===s.compareBoundaryPoints(window.Range.START_TO_START,i))return!0}return!1},go.getWindowSelection=function(){let e=window.getSelection();return{anchorNode:go.wrap(e.anchorNode),anchorOffset:e.anchorOffset,focusNode:go.wrap(e.focusNode),focusOffset:e.focusOffset}};class _o{constructor(e){this.attributes=e}get size(){return this.attributes.length}get(e){let t=this.attributes.getNamedItem(e);if(t)return t.value}set(e,t){this.attributes.setNamedItem(e,t)}forEach(e){const t=this.size;for(let r=0;r<t;r++){const t=this.attributes.item(r);e(t.value,t.name)}}map(e){let t=[];return this.forEach((r,n)=>{t.push(e(r,n))}),t}keys(){return this.map((e,t)=>t)}values(){return this.map(e=>e)}entries(){return this.map((e,t)=>[t,e])}}class yo{constructor(e){this._next=e.firstChild,this._curr=null}hasNext(){return Boolean(this._next)}next(){let e=this._next;return this._curr=e,this._next=e.nextSibling,go.wrap(e)}back(){this._next=this._curr,this._curr=this._curr.previousSibling}peek(){return go.wrap(this._curr)}}var wo=w.inBrowser,bo={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}},vo=function(){return!0},Co=function(){return!1},So=function(e){if("even"===(e=e.trim().toLowerCase()))return[2,0];if("odd"===e)return[2,1];var t,r=e.match(xo);if(!r)throw new SyntaxError("n-th rule couldn't be parsed ('"+e+"')");return r[1]?(t=parseInt(r[1],10),isNaN(t)&&(t="-"===r[1].charAt(0)?-1:1)):t=0,[t,r[3]?parseInt((r[2]||"")+r[3],10):0]},xo=/^([+\-]?\d*n)?\s*(?:([+\-]?)\s*(\d+))?$/;var Eo=function(e){var t=e[0],r=e[1]-1;if(r<0&&t<=0)return To;if(-1===t)return function(e){return e<=r};if(0===t)return function(e){return e===r};if(1===t)return r<0?No:function(e){return e>=r};var n=r%t;n<0&&(n+=t);if(t>1)return function(e){return e>=r&&e%t===n};return t*=-1,function(e){return e<=r&&e%t===n}},No=vo,To=Co;var Io=function(e){return Eo(So(e))},Ao=So,Do=Eo;Io.parse=Ao,Io.compile=Do;var Oo=function(e,t){var r=[];if(""!==(e=function e(t,r,n){var s,i,o,a,l=[],c=!1;function h(){var e=r.match(Po)[0];return r=r.substr(e.length),Uo(e)}function d(e){for(;zo(r.charAt(e));)e++;r=r.substr(e)}for(d(0);""!==r;)if(zo(i=r.charAt(0)))c=!0,d(1);else if(i in Ro)l.push({type:Ro[i]}),c=!1,d(1);else if(","===i){if(0===l.length)throw new SyntaxError("empty sub-selector");t.push(l),l=[],c=!1,d(1)}else if(c&&(l.length>0&&l.push({type:"descendant"}),c=!1),"*"===i)r=r.substr(1),l.push({type:"universal"});else if(i in qo)r=r.substr(1),l.push({type:"attribute",name:qo[i][0],action:qo[i][1],value:h(),ignoreCase:!1});else if("["===i){if(r=r.substr(1),!(s=r.match(Mo)))throw new SyntaxError("Malformed attribute selector: "+r);r=r.substr(s[0].length),o=Uo(s[1]),n&&("lowerCaseAttributeNames"in n?!n.lowerCaseAttributeNames:n.xmlMode)||(o=o.toLowerCase()),l.push({type:"attribute",name:o,action:Lo[s[2]],value:Uo(s[4]||s[5]||""),ignoreCase:!!s[6]})}else if(":"===i){if(":"===r.charAt(1)){r=r.substr(2),l.push({type:"pseudo-element",name:h().toLowerCase()});continue}if(r=r.substr(1),o=h().toLowerCase(),s=null,"("===r.charAt(0))if(o in Bo){var u=(a=r.charAt(1))in jo;if(r=r.substr(u+1),r=e(s=[],r,n),u){if(r.charAt(0)!==a)throw new SyntaxError("unmatched quotes in :"+o);r=r.substr(1)}if(")"!==r.charAt(0))throw new SyntaxError("missing closing parenthesis in :"+o+" "+r);r=r.substr(1)}else{for(var p=1,f=1;f>0&&p<r.length;p++)"("===r.charAt(p)?f++:")"===r.charAt(p)&&f--;if(f)throw new SyntaxError("parenthesis not matched");s=r.substr(1,p-2),r=r.substr(p),o in Fo&&((a=s.charAt(0))===s.slice(-1)&&a in jo&&(s=s.slice(1,-1)),s=Uo(s))}l.push({type:"pseudo",name:o,data:s})}else{if(!Po.test(r))return l.length&&"descendant"===l[l.length-1].type&&l.pop(),Vo(t,l),r;o=h(),n&&("lowerCaseTags"in n?!n.lowerCaseTags:n.xmlMode)||(o=o.toLowerCase()),l.push({type:"tag",name:o})}return Vo(t,l),r}(r,e+"",t)))throw new SyntaxError("Unmatched selector: "+e);return r},Po=/^(?:\\.|[\w\-\u00c0-\uFFFF])+/,ko=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,Mo=/^\s*((?:\\.|[\w\u00c0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])(.*?)\3|(#?(?:\\.|[\w\u00c0-\uFFFF\-])*)|)|)\s*(i)?\]/,Lo={__proto__:null,undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"},Ro={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent"},qo={__proto__:null,"#":["id","equals"],".":["class","element"]},Bo={__proto__:null,has:!0,not:!0,matches:!0},Fo={__proto__:null,contains:!0,icontains:!0},jo={__proto__:null,'"':!0,"'":!0};function Ho(e,t,r){var n="0x"+t-65536;return n!=n||r?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)}function Uo(e){return e.replace(ko,Ho)}function zo(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function Vo(e,t){if(e.length>0&&0===t.length)throw new SyntaxError("empty sub-selector");e.push(t)}const Go=(e=>{let t=Ko({amp:"&",gt:">",lt:"<"});return Qo(t,$o(t))})(),Jo=(e=>{let t=Ko({quot:'"'});return Qo(t,$o(t))})();function Ko(e){return Object.keys(e).sort().reduce(function(t,r){return t[e[r]]="&"+r+";",t},{})}function $o(e){let t=[],r=[];return Object.keys(e).forEach(function(e){1===e.length?t.push("\\"+e):r.push(e)}),r.unshift("["+t.join("")+"]"),new RegExp(r.join("|"),"g")}const Xo=/[^\0-\x7F]/g,Wo=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function Yo(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function Zo(e){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function Qo(e,t){function r(t){return e[t]}return function(e){return e.replace(t,r).replace(Wo,Zo).replace(Xo,Yo)}}const ea={__proto__:null,allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,muted:!0,open:!0,readonly:!0,required:!0,reversed:!0,scoped:!0,seamless:!0,selected:!0,typemustmatch:!0},ta={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0},ra={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};class na{isTag(e){return bo.isTag(e)}removeElement(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.childNodes;let r=t.lastIndexOf(e);if(r<0)throw new Error("Invalid state");t.splice(r,1),e.parent=null}}replaceElement(e,t){t.parent&&this.removeElement(t);var r=t.prev=e.prev;r&&(r.next=t);var n=t.next=e.next;n&&(n.prev=t);var s=t.parent=e.parent;if(s){var i=s.childNodes;let r=i.lastIndexOf(e);if(r<0)throw new Error("Invalid state");i[r]=t}}appendChild(e,t){if(t.parent&&this.removeElement(t),t.parent=e,1!==e.childNodes.push(t)){var r=e.childNodes[e.childNodes.length-2];r.next=t,t.prev=r,t.next=null}}append(e,t){t.parent&&this.removeElement(t);let r=e.parent,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=r,n){if(n.prev=t,r){var s=r.childNodes;let e=s.lastIndexOf(n);if(e<0)throw new Error("Invalid state");s.splice(e,0,t)}}else r&&r.childNodes.push(t)}prepend(e,t){t.parent&&this.removeElement(t);var r=e.parent;if(r){var n=r.childNodes;let s=n.lastIndexOf(e);if(s<0)throw new Error("Invalid state");n.splice(s,0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}filter(e,t,r,n){return Array.isArray(t)||(t=[t]),"number"==typeof n&&isFinite(n)||(n=1/0),this.find(e,t,!1!==r,n)}find(e,t,r,n){let s,i=[];for(var o=0,a=t.length;o<a&&!(e(t[o])&&(i.push(t[o]),--n<=0))&&(s=this.getChildren(t[o]),!(r&&s&&s.length>0&&(s=this.find(e,s,r,n),i=i.concat(s),(n-=s.length)<=0)));o++);return i}findOneChild(e,t){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return t[r];return null}findOne(e,t){for(var r=null,n=0,s=t.length;n<s&&!r;n++){const s=t[n];if(this.isTag(s))if(e(s))r=s;else{const t=this.getChildren(s);t.length>0&&(r=this.findOne(e,t))}}return r}existsOne(e,t){for(var r=0,n=t.length;r<n;r++){const n=t[r];if(!this.isTag(n))continue;if(e(n))return!0;const s=this.getChildren(n);if(s.length>0&&this.existsOne(e,s))return!0}return!1}findAll(e,t){for(var r=[],n=0,s=t.length;n<s;n++){const s=t[n];if(!this.isTag(s))continue;e(s)&&r.push(s);const i=this.getChildren(s);i.length>0&&(r=r.concat(this.findAll(e,i)))}return r}getAttributes(e){let t=e.getAttributes();if(t instanceof Map)return Array.from(t);if(t&&t.forEach){let e=[];return t.forEach((t,r)=>{e.push([r,t])}),e}return[]}formatAttribs(e,t={}){let r=[];return this.getAttributes(e).forEach(([e,n])=>{!n&&ea[e]?r.push(e):r.push(e+'="'+(t.decodeEntities?Jo(n):n)+'"')}),r.join(" ")}render(e,t){Array.isArray(e)||(e=[e]),t=t||{};let r=[];for(var n=0;n<e.length;n++){let s=e[n];switch(s.type){case"root":case"document":s._xmlInstruction&&r.push(this.render(s._xmlInstruction,t)),r.push(this.render(this.getChildren(s),t));break;case bo.Tag:case bo.Script:case bo.Style:r.push(this.renderTag(s,t));break;case bo.CDATA:r.push(this.renderCdata(s));break;case bo.Comment:r.push(this.renderComment(s));break;case bo.Directive:r.push(this.renderDirective(s));break;case bo.Doctype:r.push(this.renderDoctype(s));break;case bo.Text:r.push(this.renderText(s,t));break;default:throw new Error("Not implement yet: render of element type "+s.type)}}return r.join("")}renderTag(e,t){const r=this.getName(e);"svg"===r&&(t={decodeEntities:t.decodeEntities,xmlMode:!0});let n="<"+r,s=this.formatAttribs(e,t);s&&(n+=" "+s);const i=this.getChildren(e);return t.xmlMode&&0===i.length?n+="/>":(n+=">",i.length>0&&(n+=this.render(i,t)),ra[r]&&!t.xmlMode||(n+="</"+r+">")),n}renderDirective(e){return"<?"+this.getName(e)+" "+this.getData(e)+"?>"}renderDoctype(e){const{name:t,publicId:r,systemId:n}=this.getData(e);let s=["DOCTYPE",t];return r&&(s.push("PUBLIC"),s.push('"'+r+'"'),n&&s.push('"'+n+'"')),"<!"+s.join(" ")+">"}renderText(e,t){let r=this.getText(e);if(t.decodeEntities){const t=this.getParent(e);t&&this.getName(t)in ta||(r=Go(r))}return r}renderCdata(e){return"<![CDATA["+this.getData(e)+"]]>"}renderComment(e){return"\x3c!--"+this.getData(e)+"--\x3e"}getInnerHTML(e,t){return this.getChildren(e).map(e=>this.render(e,t)).join("")}getOuterHTML(e,t){return this.render(e,t)}getData(e){return e.data}getText(e,t){if(Array.isArray(e))return e.map(e=>this.getText(e,t)).join("");switch(e.type){case bo.Tag:case bo.Script:case bo.Style:return this.getText(this.getChildren(e),!0);case bo.Text:case bo.CDATA:return e.data;case bo.Comment:return t?"":e.data;default:return""}}getChildren(e){return e.childNodes}getParent(e){return e.parent}getSiblings(e){var t=this.getParent(e);return t?this.getChildren(t):[e]}getAttributeValue(e,t){return e.getAttribute(t)}hasAttrib(e,t){return e.hasAttribute(t)}getName(e){return e.name}getNameWithoutNS(e){return e.nameWithoutNS}}const sa=new na;sa.DomUtils=na;var ia={universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1},oa=Object.freeze({universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1,default:ia}),aa=oa&&ia||oa,la=function(e){for(var t=e.map(ha),r=1;r<e.length;r++){var n=t[r];if(!(n<0))for(var s=r-1;s>=0&&n<t[s];s--){var i=e[s+1];e[s+1]=e[s],e[s]=i,t[s+1]=t[s],t[s]=n}}},ca={__proto__:null,exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function ha(e){var t=aa[e.type];if(t===aa.attribute)(t=ca[e.action])===ca.equals&&"id"===e.name&&(t=9),e.ignoreCase&&(t>>=1);else if(t===aa.pseudo)if(e.data)if("has"===e.name||"contains"===e.name)t=0;else if("matches"===e.name||"not"===e.name){t=0;for(var r=0;r<e.data.length;r++)if(1===e.data[r].length){var n=ha(e.data[r][0]);if(0===n){t=0;break}n>t&&(t=n)}e.data.length>1&&t>0&&(t-=1)}else t=1;else t=3;return t}var da=Co,ua=/[-[\]{}()*+?.,\\^$|#\s]/g;var pa=function(e){var t={__proto__:null,equals:function(t,r){var n=r.name,s=r.value;return r.ignoreCase?(s=s.toLowerCase(),function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.toLowerCase()===s&&t(r)}):function(r){return e.getAttributeValue(r,n)===s&&t(r)}},hyphen:function(t,r){var n=r.name,s=r.value,i=s.length;return r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&(o.length===i||"-"===o.charAt(i))&&o.substr(0,i).toLowerCase()===s&&t(r)}):function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(0,i)===s&&(o.length===i||"-"===o.charAt(i))&&t(r)}},element:function(t,r){var n=r.name,s=r.value;if("class"===r.name){let e=r.value;return/\s/.test(e)?function(){return!1}:function(r){let n=r.classes;return n&&n.has(e)&&t(r)}}if(/\s/.test(s))return da;var i="(?:^|\\s)"+(s=s.replace(ua,"\\$&"))+"(?:$|\\s)",o=r.ignoreCase?"i":"",a=new RegExp(i,o);return function(r){var s=e.getAttributeValue(r,n);return null!=s&&a.test(s)&&t(r)}},exists:function(t,r){var n=r.name;return function(r){return e.hasAttrib(r,n)&&t(r)}},start:function(t,r){var n=r.name,s=r.value,i=s.length;return 0===i?da:r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(0,i).toLowerCase()===s&&t(r)}):function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(0,i)===s&&t(r)}},end:function(t,r){var n=r.name,s=r.value,i=-s.length;return 0===i?da:r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(i).toLowerCase()===s&&t(r)}):function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(i)===s&&t(r)}},any:function(t,r){var n=r.name,s=r.value;if(""===s)return da;if(r.ignoreCase){var i=new RegExp(s.replace(ua,"\\$&"),"i");return function(r){var s=e.getAttributeValue(r,n);return null!=s&&i.test(s)&&t(r)}}return function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.indexOf(s)>=0&&t(r)}},not:function(t,r){var n=r.name,s=r.value;return""===s?function(r){return!!e.getAttributeValue(r,n)&&t(r)}:r.ignoreCase?(s=s.toLowerCase(),function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.toLowerCase()!==s&&t(r)}):function(r){return e.getAttributeValue(r,n)!==s&&t(r)}}};return{compile:function(e,r,n){if(n&&n.strict&&(r.ignoreCase||"not"===r.action))throw new Error("Unsupported attribute selector");return t[r.action](e,r)},rules:t}};var fa=function(e,t){return{__proto__:null,attribute:pa(e).compile,pseudo:t.compile,tag:function(t,r){var n=r.name;return function(r){return e.getNameWithoutNS(r)===n&&t(r)}},descendant:function(t){return function(r){for(var n=!1;!n&&(r=e.getParent(r));)n=t(r);return n}},_flexibleDescendant:function(t){return function(r){for(var n=t(r);!n&&(r=e.getParent(r));)n=t(r);return n}},parent:function(t,r,n){if(n&&n.strict)throw new Error("Parent selector isn't part of CSS3");return function(t){return e.getChildren(t).some(s)};function s(r){return e.isTag(r)&&t(r)}},child:function(t){return function(r){var n=e.getParent(r);return!!n&&t(n)}},sibling:function(t){return function(r){for(var n=e.getSiblings(r),s=0;s<n.length;s++)if(e.isTag(n[s])){if(n[s]===r)break;if(t(n[s]))return!0}return!1}},adjacent:function(t){return function(r){for(var n,s=e.getSiblings(r),i=0;i<s.length;i++)if(e.isTag(s[i])){if(s[i]===r)break;n=s[i]}return!!n&&t(n)}},universal:function(e){return e}}},ga=vo,ma=Co;function _a(e){var t=pa(e).rules.equals;function r(e,r){var n={name:e,value:r};return function(e){return t(e,n)}}function n(t){return function(r){return!!e.getParent(r)&&t(r)}}var s={contains:function(t,r){return function(n){return t(n)&&e.getText(n).indexOf(r)>=0}},icontains:function(t,r){var n=r.toLowerCase();return function(r){return t(r)&&e.getText(r).toLowerCase().indexOf(n)>=0}},"nth-child":function(t,r){var s=Io(r);return s===ma?s:s===ga?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=0;i<n.length;i++)if(e.isTag(n[i])){if(n[i]===r)break;o++}return s(o)&&t(r)}},"nth-last-child":function(t,r){var s=Io(r);return s===ma?s:s===ga?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=n.length-1;o>=0;o--)if(e.isTag(n[o])){if(n[o]===r)break;i++}return s(i)&&t(r)}},"nth-of-type":function(t,r){var s=Io(r);return s===ma?s:s===ga?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=0;o<n.length;o++)if(e.isTag(n[o])){if(n[o]===r)break;e.getName(n[o])===e.getName(r)&&i++}return s(i)&&t(r)}},"nth-last-of-type":function(t,r){var s=Io(r);return s===ma?s:s===ga?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=n.length-1;o>=0;o--)if(e.isTag(n[o])){if(n[o]===r)break;e.getName(n[o])===e.getName(r)&&i++}return s(i)&&t(r)}},root:function(t){return function(r){return!e.getParent(r)&&t(r)}},scope:function(t,r,n,i){return i&&0!==i.length?1===i.length?function(r){return n=i[0],s=r,("function"==typeof e.equals?e.equals(n,s):n===s)&&t(r);var n,s}:function(e){return i.indexOf(e)>=0&&t(e)}:s.root(t)},checkbox:r("type","checkbox"),file:r("type","file"),password:r("type","password"),radio:r("type","radio"),reset:r("type","reset"),image:r("type","image"),submit:r("type","submit")};return s}function ya(e){var t={empty:function(t){return!e.getChildren(t).some(function(t){return e.isTag(t)||"text"===t.type})},"first-child":function(t){return function(t){for(var r=0;t&&r<t.length;r++)if(e.isTag(t[r]))return t[r]}(e.getSiblings(t))===t},"last-child":function(t){for(var r=e.getSiblings(t),n=r.length-1;n>=0;n--){if(r[n]===t)return!0;if(e.isTag(r[n]))break}return!1},"first-of-type":function(t){for(var r=e.getSiblings(t),n=0;n<r.length;n++)if(e.isTag(r[n])){if(r[n]===t)return!0;if(e.getName(r[n])===e.getName(t))break}return!1},"last-of-type":function(t){for(var r=e.getSiblings(t),n=r.length-1;n>=0;n--)if(e.isTag(r[n])){if(r[n]===t)return!0;if(e.getName(r[n])===e.getName(t))break}return!1},"only-of-type":function(t){for(var r=e.getSiblings(t),n=0,s=r.length;n<s;n++)if(e.isTag(r[n])){if(r[n]===t)continue;if(e.getName(r[n])===e.getName(t))return!1}return!0},"only-child":function(t){for(var r=e.getSiblings(t),n=0;n<r.length;n++)if(e.isTag(r[n])&&r[n]!==t)return!1;return!0},link:function(t){return e.hasAttrib(t,"href")},visited:ma,selected:function(t){if(e.hasAttrib(t,"selected"))return!0;if("option"!==e.getName(t))return!1;var r=e.getParent(t);if(!r||"select"!==e.getName(r)||e.hasAttrib(r,"multiple"))return!1;for(var n=e.getChildren(r),s=!1,i=0;i<n.length;i++)if(e.isTag(n[i]))if(n[i]===t)s=!0;else{if(!s)return!1;if(e.hasAttrib(n[i],"selected"))return!1}return s},disabled:function(t){return e.hasAttrib(t,"disabled")},enabled:function(t){return!e.hasAttrib(t,"disabled")},checked:function(r){return e.hasAttrib(r,"checked")||t.selected(r)},required:function(t){return e.hasAttrib(t,"required")},optional:function(t){return!e.hasAttrib(t,"required")},parent:function(e){return!t.empty(e)},header:function(t){var r=e.getName(t);return"h1"===r||"h2"===r||"h3"===r||"h4"===r||"h5"===r||"h6"===r},button:function(t){var r=e.getName(t);return"button"===r||"input"===r&&"button"===e.getAttributeValue(t,"type")},input:function(t){var r=e.getName(t);return"input"===r||"textarea"===r||"select"===r||"button"===r},text:function(t){var r;return"input"===e.getName(t)&&(!(r=e.getAttributeValue(t,"type"))||"text"===r.toLowerCase())}};return t}function wa(e,t,r){if(null===r){if(e.length>1&&"scope"!==t)throw new Error("pseudo-selector :"+t+" requires an argument")}else if(1===e.length)throw new Error("pseudo-selector :"+t+" doesn't have any arguments")}var ba=/^(?:(?:nth|last|first|only)-(?:child|of-type)|root|empty|(?:en|dis)abled|checked|not)$/;var va=function(e){var t=ya(e),r=_a(e);return{compile:function(e,n,s,i){var o=n.name,a=n.data;if(s&&s.strict&&!ba.test(o))throw new Error(":"+o+" isn't part of CSS3");if("function"==typeof r[o])return wa(r[o],o,a),r[o](e,a,s,i);if("function"==typeof t[o]){var l=t[o];return wa(l,o,a),e===ga?l:function(t){return l(t,a)&&e(t)}}throw new Error("unmatched pseudo-class :"+o)},filters:r,pseudos:t}},Ca=function(e){var t=va(e),r=t.filters,n=fa(e,t);function s(e,t,r){var n=o(e,t,r);return i(n)}function i(t){return function(r){return e.isTag(r)&&t(r)}}function o(e,t,r){var n=Oo(e,t);return u(n,t,r)}function a(e){return"pseudo"===e.type&&("scope"===e.name||Array.isArray(e.data)&&e.data.some(function(e){return e.some(a)}))}var l={type:"descendant"},c={type:"_flexibleDescendant"},h={type:"pseudo",name:"scope"},d={};function u(t,r,s){(t=t.filter(function(e){return e.length>0})).forEach(la);var i=Array.isArray(s);(s=r&&r.context||s)&&!i&&(s=[s]),function(t,r){var n=!!r&&!!r.length&&r.every(function(t){return t===d||!!e.getParent(t)});t.forEach(function(e){if(e.length>0&&p(e[0])&&"descendant"!==e[0].type);else{if(!n||a(e))return;e.unshift(l)}e.unshift(h)})}(t,s);var o=!1,u=t.map(function(e){if(e[0]&&e[1]&&"scope"===e[0].name){var t=e[1].type;i&&"descendant"===t?e[1]=c:"adjacent"!==t&&"sibling"!==t||(o=!0)}return function(e,t,r){return e.reduce(function(e,s){return e===xa?e:n[s.type](e,s,t,r)},t&&t.rootFunc||Sa)}(e,r,s)}).reduce(f,xa);return u.shouldTestNextSiblings=o,u}function p(e){return aa[e.type]<0}function f(e,t){return t===xa||e===Sa?e:e===xa||t===Sa?t:function(r){return e(r)||t(r)}}function g(e){return e.some(p)}return r.not=function(e,t,r,n){var s={xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict)};if(s.strict&&(t.length>1||t.some(g)))throw new Error("complex selectors in :not aren't allowed in strict mode");var i=u(t,s,n);return i===xa?e:i===Sa?xa:function(t){return!i(t)&&e(t)}},r.has=function(t,r,n){var s={xmlMode:!(!n||!n.xmlMode),strict:!(!n||!n.strict)},o=r.some(g)?[d]:null,a=u(r,s,o);return a===xa?xa:a===Sa?function(r){return e.getChildren(r).some(e.isTag)&&t(r)}:(a=i(a),o?function(r){return t(r)&&(o[0]=r,e.existsOne(a,e.getChildren(r)))}:function(r){return t(r)&&e.existsOne(a,e.getChildren(r))})},r.matches=function(e,t,r,n){return u(t,{xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict),rootFunc:e},n)},s.compileToken=u,s.compileUnsafe=o,s.Pseudos=t,s},Sa=vo,xa=Co;var Ea=ka,Na=Co,Ta=Ca(sa);function Ia(e){return e.__compile__||(e.__compile__=Ca(e)),e.__compile__}function Aa(e){return function(t,r,n){(n=n||{}).adapter=n.adapter||sa;var s=Ia(n.adapter);return"function"!=typeof t&&(t=s.compileUnsafe(t,n,r)),t.shouldTestNextSiblings&&(r=function(e,t){Array.isArray(e)||(e=[e]);for(var r=e.slice(0),n=0,s=e.length;n<s;n++){var i=Da(r[n],t);r.push.apply(r,i)}return r}(n&&n.context||r,n.adapter)),r=Array.isArray(r)?n.adapter.removeSubsets(r):n.adapter.getChildren(r),e(t,r,n)}}function Da(e,t){var r=t.getSiblings(e);if(!Array.isArray(r))return[];for(r=r.slice(0);r.shift()!==e;);return r}var Oa=Aa(function(e,t,r){return e!==Na&&t&&0!==t.length?r.adapter.findAll(e,t):[]}),Pa=Aa(function(e,t,r){return e!==Na&&t&&0!==t.length?r.adapter.findOne(e,t):null});function ka(e,t,r){return Oa(e,t,r)}ka.compile=Ta,ka.filters=Ta.Pseudos.filters,ka.pseudos=Ta.Pseudos.pseudos,ka.selectAll=Oa,ka.selectOne=Pa,ka.is=function(e,t,r){(r=r||{}).adapter=r.adapter||sa;var n=Ia(r.adapter);return("function"==typeof t?t:n(t,r))(e)},ka.parse=Ta,ka.iterate=Oa,ka._compileUnsafe=Ta.compileUnsafe,ka._compileToken=Ta.compileToken;var Ma={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'},La=Object.freeze({amp:"&",apos:"'",gt:">",lt:"<",quot:'"',default:Ma}),Ra={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌",in:"∈",Map:"⤅"},qa=Object.freeze({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌",default:Ra}),Ba=qa&&Ra||qa,Fa=za(La&&Ma||La),ja=Xa(Fa,Va(Fa)),Ha=za(Ba),Ua=Xa(Ha,Va(Ha));function za(e){return Object.keys(e).sort().reduce(function(t,r){return t[e[r]]="&"+r+";",t},{})}function Va(e){var t=[],r=[];return Object.keys(e).forEach(function(e){1===e.length?t.push("\\"+e):r.push(e)}),r.unshift("["+t.join("")+"]"),new RegExp(r.join("|"),"g")}var Ga=/[^\0-\x7F]/g,Ja=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function Ka(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function $a(e){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function Xa(e,t){function r(t){return e[t]}return function(e){return e.replace(t,r).replace(Ja,$a).replace(Ga,Ka)}}var Wa=Va(Fa);var Ya={XML:ja,HTML:Ua,escape:function(e){return e.replace(Wa,Ka).replace(Ja,$a).replace(Ga,Ka)}},Za={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376},Qa=Object.freeze({default:Za}),el=Qa&&Za||Qa;var tl,rl,nl={encodeXML:Ya.XML,decodeCodepoint:function(e){if(e>=55296&&e<=57343||e>1114111)return"�";e in el&&(e=el[e]);var t="";e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e);return t+=String.fromCharCode(e)},entitiesJSON:Ra,legacyJSON:{Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"},xmlJSON:Ma},sl=nl.decodeCodepoint,il=Object.freeze({default:sl}),ol=nl.entitiesJSON,al=Object.freeze({default:ol}),ll=nl.legacyJSON,cl=Object.freeze({default:ll}),hl=nl.xmlJSON,dl=Object.freeze({default:hl}),ul=il&&sl||il,pl=al&&ol||al,fl=cl&&ll||cl,gl=dl&&hl||dl,ml=Nc,_l=0,yl=_l++,wl=_l++,bl=_l++,vl=_l++,Cl=_l++,Sl=_l++,xl=_l++,El=_l++,Nl=_l++,Tl=_l++,Il=_l++,Al=_l++,Dl=_l++,Ol=_l++,Pl=_l++,kl=_l++,Ml=_l++,Ll=_l++,Rl=_l++,ql=_l++,Bl=_l++,Fl=_l++,jl=_l++,Hl=_l++,Ul=_l++,zl=_l++,Vl=_l++,Gl=_l++,Jl=_l++,Kl=_l++,$l=_l++,Xl=_l++,Wl=_l++,Yl=_l++,Zl=_l++,Ql=_l++,ec=_l++,tc=_l++,rc=_l++,nc=_l++,sc=_l++,ic=_l++,oc=_l++,ac=_l++,lc=_l++,cc=_l++,hc=_l++,dc=_l++,uc=_l++,pc=_l++,fc=_l++,gc=_l++,mc=_l++,_c=_l++,yc=_l++,wc=0,bc=wc++,vc=wc++,Cc=wc++;function Sc(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function xc(e,t,r){var n=e.toLowerCase();return e===n?function(e){e===n?this._state=t:(this._state=r,this._index--)}:function(s){s===n||s===e?this._state=t:(this._state=r,this._index--)}}function Ec(e,t){var r=e.toLowerCase();return function(n){n===r||n===e?this._state=t:(this._state=bl,this._index--)}}function Nc(e,t){this._state=yl,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=yl,this._special=bc,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}Nc.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=wl,this._sectionStart=this._index):this._decodeEntities&&this._special===bc&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=yl,this._state=fc,this._sectionStart=this._index)},Nc.prototype._stateBeforeTagName=function(e){"/"===e?this._state=Cl:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==bc||Sc(e)?this._state=yl:"!"===e?(this._state=Pl,this._sectionStart=this._index+1):"?"===e?(this._state=Ml,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?bl:$l,this._sectionStart=this._index)},Nc.prototype._stateInTagName=function(e){("/"===e||">"===e||Sc(e))&&(this._emitToken("onopentagname"),this._state=El,this._index--)},Nc.prototype._stateBeforeCloseingTagName=function(e){Sc(e)||(">"===e?this._state=yl:this._special!==bc?"s"===e||"S"===e?this._state=Xl:(this._state=yl,this._index--):(this._state=Sl,this._sectionStart=this._index))},Nc.prototype._stateInCloseingTagName=function(e){(">"===e||Sc(e))&&(this._emitToken("onclosetag"),this._state=xl,this._index--)},Nc.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=yl,this._sectionStart=this._index+1)},Nc.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=yl,this._sectionStart=this._index+1):"/"===e?this._state=vl:Sc(e)||(this._state=Nl,this._sectionStart=this._index)},Nc.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=yl,this._sectionStart=this._index+1):Sc(e)||(this._state=El,this._index--)},Nc.prototype._stateInAttributeName=function(e){("="===e||"/"===e||">"===e||Sc(e))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=Tl,this._index--)},Nc.prototype._stateAfterAttributeName=function(e){"="===e?this._state=Il:"/"===e||">"===e?(this._cbs.onattribend(),this._state=El,this._index--):Sc(e)||(this._cbs.onattribend(),this._state=Nl,this._sectionStart=this._index)},Nc.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=Al,this._sectionStart=this._index+1):"'"===e?(this._state=Dl,this._sectionStart=this._index+1):Sc(e)||(this._state=Ol,this._sectionStart=this._index,this._index--)},Nc.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=El):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=fc,this._sectionStart=this._index)},Nc.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=El):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=fc,this._sectionStart=this._index)},Nc.prototype._stateInAttributeValueNoQuotes=function(e){Sc(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=El,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=fc,this._sectionStart=this._index)},Nc.prototype._stateBeforeDeclaration=function(e){this._state="["===e?Fl:"-"===e?Ll:kl},Nc.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=yl,this._sectionStart=this._index+1)},Nc.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=yl,this._sectionStart=this._index+1)},Nc.prototype._stateBeforeComment=function(e){"-"===e?(this._state=Rl,this._sectionStart=this._index+1):this._state=kl},Nc.prototype._stateInComment=function(e){"-"===e&&(this._state=ql)},Nc.prototype._stateAfterComment1=function(e){this._state="-"===e?Bl:Rl},Nc.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=yl,this._sectionStart=this._index+1):"-"!==e&&(this._state=Rl)},Nc.prototype._stateBeforeCdata1=xc("C",jl,kl),Nc.prototype._stateBeforeCdata2=xc("D",Hl,kl),Nc.prototype._stateBeforeCdata3=xc("A",Ul,kl),Nc.prototype._stateBeforeCdata4=xc("T",zl,kl),Nc.prototype._stateBeforeCdata5=xc("A",Vl,kl),Nc.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=Gl,this._sectionStart=this._index+1):(this._state=kl,this._index--)},Nc.prototype._stateInCdata=function(e){"]"===e&&(this._state=Jl)},Nc.prototype._stateAfterCdata1=(tl="]",rl=Kl,function(e){e===tl&&(this._state=rl)}),Nc.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=yl,this._sectionStart=this._index+1):"]"!==e&&(this._state=Gl)},Nc.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=Wl:"t"===e||"T"===e?this._state=oc:(this._state=bl,this._index--)},Nc.prototype._stateBeforeSpecialEnd=function(e){this._special!==vc||"c"!==e&&"C"!==e?this._special!==Cc||"t"!==e&&"T"!==e?this._state=yl:this._state=hc:this._state=tc},Nc.prototype._stateBeforeScript1=Ec("R",Yl),Nc.prototype._stateBeforeScript2=Ec("I",Zl),Nc.prototype._stateBeforeScript3=Ec("P",Ql),Nc.prototype._stateBeforeScript4=Ec("T",ec),Nc.prototype._stateBeforeScript5=function(e){("/"===e||">"===e||Sc(e))&&(this._special=vc),this._state=bl,this._index--},Nc.prototype._stateAfterScript1=xc("R",rc,yl),Nc.prototype._stateAfterScript2=xc("I",nc,yl),Nc.prototype._stateAfterScript3=xc("P",sc,yl),Nc.prototype._stateAfterScript4=xc("T",ic,yl),Nc.prototype._stateAfterScript5=function(e){">"===e||Sc(e)?(this._special=bc,this._state=Sl,this._sectionStart=this._index-6,this._index--):this._state=yl},Nc.prototype._stateBeforeStyle1=Ec("Y",ac),Nc.prototype._stateBeforeStyle2=Ec("L",lc),Nc.prototype._stateBeforeStyle3=Ec("E",cc),Nc.prototype._stateBeforeStyle4=function(e){("/"===e||">"===e||Sc(e))&&(this._special=Cc),this._state=bl,this._index--},Nc.prototype._stateAfterStyle1=xc("Y",dc,yl),Nc.prototype._stateAfterStyle2=xc("L",uc,yl),Nc.prototype._stateAfterStyle3=xc("E",pc,yl),Nc.prototype._stateAfterStyle4=function(e){">"===e||Sc(e)?(this._special=bc,this._state=Sl,this._sectionStart=this._index-5,this._index--):this._state=yl},Nc.prototype._stateBeforeEntity=xc("#",gc,mc),Nc.prototype._stateBeforeNumericEntity=xc("X",yc,_c),Nc.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var e=this._buffer.substring(this._sectionStart+1,this._index),t=this._xmlMode?gl:pl;t.hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)}},Nc.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(t>6&&(t=6);t>=2;){var r=this._buffer.substr(e,t);if(fl.hasOwnProperty(r))return this._emitPartial(fl[r]),void(this._sectionStart+=t+1);t--}},Nc.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||e>"z")&&(e<"A"||e>"Z")&&(e<"0"||e>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==yl?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},Nc.prototype._decodeNumericEntity=function(e,t){var r=this._sectionStart+e;if(r!==this._index){var n=this._buffer.substring(r,this._index),s=parseInt(n,t);this._emitPartial(ul(s)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},Nc.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},Nc.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},Nc.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===yl?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},Nc.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},Nc.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===yl?this._stateText(e):this._state===wl?this._stateBeforeTagName(e):this._state===bl?this._stateInTagName(e):this._state===Cl?this._stateBeforeCloseingTagName(e):this._state===Sl?this._stateInCloseingTagName(e):this._state===xl?this._stateAfterCloseingTagName(e):this._state===vl?this._stateInSelfClosingTag(e):this._state===El?this._stateBeforeAttributeName(e):this._state===Nl?this._stateInAttributeName(e):this._state===Tl?this._stateAfterAttributeName(e):this._state===Il?this._stateBeforeAttributeValue(e):this._state===Al?this._stateInAttributeValueDoubleQuotes(e):this._state===Dl?this._stateInAttributeValueSingleQuotes(e):this._state===Ol?this._stateInAttributeValueNoQuotes(e):this._state===Pl?this._stateBeforeDeclaration(e):this._state===kl?this._stateInDeclaration(e):this._state===Ml?this._stateInProcessingInstruction(e):this._state===Ll?this._stateBeforeComment(e):this._state===Rl?this._stateInComment(e):this._state===ql?this._stateAfterComment1(e):this._state===Bl?this._stateAfterComment2(e):this._state===Fl?this._stateBeforeCdata1(e):this._state===jl?this._stateBeforeCdata2(e):this._state===Hl?this._stateBeforeCdata3(e):this._state===Ul?this._stateBeforeCdata4(e):this._state===zl?this._stateBeforeCdata5(e):this._state===Vl?this._stateBeforeCdata6(e):this._state===Gl?this._stateInCdata(e):this._state===Jl?this._stateAfterCdata1(e):this._state===Kl?this._stateAfterCdata2(e):this._state===$l?this._stateBeforeSpecial(e):this._state===Xl?this._stateBeforeSpecialEnd(e):this._state===Wl?this._stateBeforeScript1(e):this._state===Yl?this._stateBeforeScript2(e):this._state===Zl?this._stateBeforeScript3(e):this._state===Ql?this._stateBeforeScript4(e):this._state===ec?this._stateBeforeScript5(e):this._state===tc?this._stateAfterScript1(e):this._state===rc?this._stateAfterScript2(e):this._state===nc?this._stateAfterScript3(e):this._state===sc?this._stateAfterScript4(e):this._state===ic?this._stateAfterScript5(e):this._state===oc?this._stateBeforeStyle1(e):this._state===ac?this._stateBeforeStyle2(e):this._state===lc?this._stateBeforeStyle3(e):this._state===cc?this._stateBeforeStyle4(e):this._state===hc?this._stateAfterStyle1(e):this._state===dc?this._stateAfterStyle2(e):this._state===uc?this._stateAfterStyle3(e):this._state===pc?this._stateAfterStyle4(e):this._state===fc?this._stateBeforeEntity(e):this._state===gc?this._stateBeforeNumericEntity(e):this._state===mc?this._stateInNamedEntity(e):this._state===_c?this._stateInNumericEntity(e):this._state===yc?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},Nc.prototype.pause=function(){this._running=!1},Nc.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},Nc.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},Nc.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},Nc.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);this._state===Gl||this._state===Jl||this._state===Kl?this._cbs.oncdata(e):this._state===Rl||this._state===ql||this._state===Bl?this._cbs.oncomment(e):this._state!==mc||this._xmlMode?this._state!==_c||this._xmlMode?this._state!==yc||this._xmlMode?this._state!==bl&&this._state!==El&&this._state!==Il&&this._state!==Tl&&this._state!==Nl&&this._state!==Dl&&this._state!==Al&&this._state!==Ol&&this._state!==Sl&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},Nc.prototype.reset=function(){Nc.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},Nc.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},Nc.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},Nc.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},Nc.prototype._emitPartial=function(e){this._baseState!==yl?this._cbs.onattribdata(e):this._cbs.ontext(e)};var Tc=function(){},Ic=Object.freeze({default:Tc}),Ac={},Dc=Object.freeze({default:Ac}),Oc=ml,Pc={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},kc={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:Pc,input:Pc,output:Pc,button:Pc,datalist:Pc,textarea:Pc,option:{option:!0},optgroup:{optgroup:!0}},Mc={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,path:!0,circle:!0,ellipse:!0,line:!0,rect:!0,use:!0,stop:!0,polyline:!0,polygon:!0},Lc=/\s|\//;function Rc(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(Oc=this._options.Tokenizer),this._tokenizer=new Oc(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}(Ic&&Tc||Ic)(Rc,(Dc&&Ac||Dc).EventEmitter),Rc.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},Rc.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},Rc.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in kc)for(var t;(t=this._stack[this._stack.length-1])in kc[e];this.onclosetag(t));!this._options.xmlMode&&e in Mc||this._stack.push(e),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},Rc.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in Mc&&this._cbs.onclosetag(this._tagname),this._tagname=""},Rc.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),this._options.xmlMode){const t=this._stack;let r=t.pop();for(;r!==e;)this._cbs.onerror&&this._cbs.onerror("Unclosed tag <"+r+">"),r=t.pop();this.onopentagend(),this._cbs.onclosetag&&this._cbs.onclosetag(r)}else if(!this._stack.length||e in Mc)"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{let t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"===e&&(this.onopentagname(e),this._closeCurrentTag())}},Rc.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing?this._closeCurrentTag():this.onopentagend()},Rc.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},Rc.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},Rc.prototype.onattribdata=function(e){this._attribvalue+=e},Rc.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},Rc.prototype._getInstructionName=function(e){var t=e.search(Lc),r=t<0?e:e.substr(0,t);return this._lowerCaseTagNames&&(r=r.toLowerCase()),r},Rc.prototype.ondeclaration=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},Rc.prototype.onprocessinginstruction=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("?"+t,"?"+e)}},Rc.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},Rc.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},Rc.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},Rc.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;e>0;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},Rc.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},Rc.prototype.parseComplete=function(e){this.reset(),this.end(e)},Rc.prototype.write=function(e){this._tokenizer.write(e)},Rc.prototype.end=function(e){this._tokenizer.end(e)},Rc.prototype.pause=function(){this._tokenizer.pause()},Rc.prototype.resume=function(){this._tokenizer.resume()},Rc.prototype.parseChunk=Rc.prototype.write,Rc.prototype.done=Rc.prototype.end;var qc=Rc;function Bc(e,t){let r=t.ownerDocument?t.ownerDocument.format:t.format;if(!r)throw new Error("Either 'ownerDocument' or 'format' must be set.");let n=Object.assign({},t,{xmlMode:"xml"===r}),s=new Hc({format:r,elementFactory:t.elementFactory});return new qc(s,n).end(e),s.document}qc.prototype.ondeclaration=function(e){if(this._cbs.ondeclaration)this._cbs.ondeclaration(e);else if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},qc.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")};const Fc=/\s+/g,jc=/^DOCTYPE\s+([^\s]+)(?:\s+PUBLIC\s+["]([^"]+)["](?:\s+["]([^"]+)["])?)\s*$/;class Hc{constructor(e={}){if(this.elementFactory=e.elementFactory,!this.elementFactory)throw new Error("'elementFactory' is required");this.options=e,this.document=null,this._tagStack=[]}onparserinit(){this.document=this.elementFactory("document",{format:this.options.format}),this._tagStack=[this.document]}onend(){if(this._tagStack.length>1)throw new Error("Unexpected EOF. Tag was opened but not closed.")}onerror(e){throw new Error(e)}onclosetag(){this._tagStack.pop()}_addDomElement(e){let t=this._tagStack[this._tagStack.length-1];t.childNodes||(t.childNodes=[]);let r=t.childNodes,n=r[r.length-1];e.next=null,n?(e.prev=n,n.next=e):e.prev=null,r.push(e),e.parent=t||null}onopentag(e,t){let n=this.document.createElement(e);r(t,(e,t)=>{n.setAttribute(t,e)}),this._addDomElement(n),this._tagStack.push(n)}ontext(e){let t;this.options.normalizeWhitespace&&(e=e.replace(Fc," "));let r=this._tagStack[this._tagStack.length-1];if(r&&r.childNodes&&(t=r.childNodes[r.childNodes.length-1]),t&&t.type===bo.Text)t.data+=e;else{let t=this.document.createTextNode(e);this._addDomElement(t)}}oncomment(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===bo.Comment)t.data+=e;else{let t=this.document.createComment(e);this._addDomElement(t),this._tagStack.push(t)}}oncommentend(){this._tagStack.pop()}oncdatastart(e){let t=this.document.createCDATASection(e);this._addDomElement(t),this._tagStack.push(t)}oncdataend(){this._tagStack.pop()}onprocessinginstruction(e,t){t=t.slice(e.length,-1).trim(),e=e.slice(1);let r=this.document.createProcessingInstruction(e,t);"xml"===e?this.document._xmlInstruction=r:this._addDomElement(r)}ondeclaration(e){if(!e.startsWith("DOCTYPE"))throw new Error("Not implemented: parse declaration "+e);{let t=jc.exec(e);if(!t)throw new Error("Could not parse DOCTYPE element: "+e);this.document.setDoctype(t[1],t[2],t[3])}}}let Uc;class zc extends lo{constructor(e,t={}){if(super(),this.type=e,!e)throw new Error("'type' is mandatory");if(this.ownerDocument=t.ownerDocument,"document"!==e&&!this.ownerDocument)throw new Error("'ownerDocument' is mandatory");switch(e){case bo.Tag:if(!t.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(t.name),this.nameWithoutNS=Zc(this.name),this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=t.children||t.childNodes||[],this._assign(t);break;case bo.Text:case bo.Comment:case bo.CDATA:this.data=t.data||"";break;case bo.Directive:if(!t.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(t.name),this.nameWithoutNS=Zc(this.name),this.data=t.data;break;case bo.Doctype:this.data=t.data;break;case"document":{let e=t.format;if(this.format=e,!e)throw new Error("'format' is mandatory.");switch(this.childNodes=t.children||t.childNodes||[],e){case"xml":this.contentType="application/xml";break;case"html":this.contentType="text/html";break;default:throw new Error("Unsupported format "+e)}break}default:this.name=null,this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=t.children||t.childNodes||[]}}getNativeElement(){return this}getNodeType(){switch(this.type){case bo.Tag:case bo.Script:case bo.Style:return"element";default:return this.type}}isTextNode(){return"text"===this.type}isElementNode(){return"tag"===this.type||"script"===this.type}isCommentNode(){return"comment"===this.type}isDocumentNode(){return"document"===this.type}isComponentNode(){return"component"===this.type}clone(e){let t=new zc(this.type,this);return this.childNodes&&(t.childNodes.length=0,e&&this.childNodes.forEach(r=>{t.appendChild(r.clone(e))})),t}get tagName(){return this.getTagName()}set tagName(e){this.setTagName(e)}getTagName(){return this.name}setTagName(e){return this._isXML()?this.name=String(e):this.name=String(e).toLowerCase(),this.nameWithoutNS=Zc(this.name),this}hasAttribute(e){if(this.attributes)return this.attributes.has(e)}getAttribute(e){if(this.attributes)return this.attributes.get(e)}setAttribute(e,t){if(this.attributes){switch(t=String(t),e){case"class":this.classes=new Set,Jc(this.classes,t);break;case"style":this.styles=new Map,$c(this.styles,t)}this.attributes.set(e,t),this._isHTML()&&function(e,t,r){const n=Qc[e.tagName];if(n){let s=n[t];!0===s?e.setProperty(t,r):s&&s(e,t,r)}}(this,e,t)}return this}removeAttribute(e){if(this.attributes){switch(e){case"class":this.classes=new Set;break;case"style":this.styles=new Map}this.attributes.delete(e)}return this}getAttributes(){return this.attributes}getProperty(e){if(this.properties)return this.properties.get(e)}setProperty(e,t){if(this.properties){if(this._isXML())throw new Error("setProperty() is only be used on HTML elements");!function(e,t,r){const n=eh[e.tagName];if(n){let s=n[t];if(s)return void s(e,t,r)}th(e,t,r)}(this,e,t)}return this}hasClass(e){if(this.classes)return this.classes.has(e)}addClass(e){return this.classes&&(this.classes.add(e),this.attributes.set("class",Kc(this.classes))),this}removeClass(e){return this.classes&&this.classes.has(e)&&(this.classes.delete(e),this.attributes.set("class",Kc(this.classes))),this}getContentType(){return this.getOwnerDocument().contentType}getDoctype(){return this.isDocumentNode()?rh(this):this.getOwnerDocument().getDoctype()}setDoctype(e,t,r){let n=this.getOwnerDocument(),s=rh(n),i=this.createDocumentType(e,t,r);s?n.replaceChild(i,s):n.insertBefore(i,n.getChildren()[0]),n.doctype=i}getInnerHTML(){let e=this._isXML();return sa.getInnerHTML(this,{xmlMode:e,decodeEntities:!e})}setInnerHTML(e){if(this.childNodes){let t=this._isXML(),r=Bc(e,{ownerDocument:this.getOwnerDocument(),format:t?"xml":"html",decodeEntities:!t,elementFactory:Vc});this.empty(),r.childNodes.slice(0).forEach(e=>{this.appendChild(e)})}return this}getOuterHTML(){let e=this._isXML();return sa.getOuterHTML(this,{xmlMode:e,decodeEntities:!e})}getTextContent(){return sa.getText(this)}setTextContent(e){switch(this.type){case bo.Text:case bo.Comment:case bo.CDATA:this.data=e;break;default:if(this.childNodes){let t=this.createTextNode(e);this.empty(),this.appendChild(t)}}return this}getStyle(e){if(this.styles)return this.styles.get(e)}setStyle(e,t){return this.styles&&(lo.pxStyles[e]&&C(t)&&(t+="px"),this.styles.set(e,t),this.attributes.set("style",function(e){if(!e)return"";let t=Object.keys(e).map(t=>t+":"+e[t]).join(";");t.length>0&&(t+=";");return t}(this.styles))),this}is(e){return Ea.is(this,e,{xmlMode:this._isXML()})}find(e){return Ea.selectOne(e,this,{xmlMode:this._isXML()})}findAll(e){return Ea.selectAll(e,this,{xmlMode:this._isXML()})}getChildCount(){return this.childNodes?this.childNodes.length:0}getChildNodes(){return this.childNodes.slice(0)}getChildren(){return this.childNodes.filter(function(e){return"tag"===e.type})}get children(){return this.getChildren()}getChildAt(e){if(this.childNodes)return this.childNodes[e]}getChildIndex(e){if(this.childNodes)return this.childNodes.indexOf(e)}getLastChild(){if(this.childNodes)return wi(this.childNodes)}getFirstChild(){if(this.childNodes)return this.childNodes[0]}getNextSibling(){return this.next}getPreviousSibling(){return this.prev}getParent(){return this.parent}getOwnerDocument(){return"document"===this.type?this:this.ownerDocument}getFormat(){return this.getOwnerDocument().format}createDocument(e){return zc.createDocument(e)}createElement(e){return new zc(bo.Tag,{name:e,ownerDocument:this.getOwnerDocument()})}createTextNode(e){return new zc(bo.Text,{data:e,ownerDocument:this.getOwnerDocument()})}createComment(e){return new zc(bo.Comment,{data:e,ownerDocument:this.getOwnerDocument()})}createProcessingInstruction(e,t){return new zc(bo.Directive,{name:e,data:t,ownerDocument:this.getOwnerDocument()})}createDocumentType(e,t,r){return new Gc(bo.Doctype,{data:{name:e,publicId:t,systemId:r},ownerDocument:this.getOwnerDocument()})}createCDATASection(e){return new zc(bo.CDATA,{data:e,ownerDocument:this.getOwnerDocument()})}appendChild(e){if(this.childNodes&&!x(e)){if(!(e=this._normalizeChild(e)))return this;sa.appendChild(this,e),e.ownerDocument=this.getOwnerDocument()}return this}removeChild(e){e.parentNode===this&&e.remove()}insertAt(e,t){if(!(t=this._normalizeChild(t)))return this;let r=this.childNodes;return r&&(e>=r.length?sa.appendChild(this,t):sa.prepend(r[e],t),t.ownerDocument=this.getOwnerDocument()),this}insertBefore(e,t){if(x(t))return this.appendChild(e);if(this.childNodes){if(!(this.childNodes.indexOf(t)>-1))throw new Error("insertBefore(): reference node is not a child of this element.");sa.prepend(t,e),e.ownerDocument=this.getOwnerDocument()}return this}removeAt(e){let t=this.childNodes;if(t){t[e].remove()}return this}empty(){let e=this.childNodes;return e&&(e.forEach(e=>{e.next=e.prev=e.parent=null}),e.length=0),this}remove(){return sa.removeElement(this),this}replaceChild(e,t){return e.parent===this&&e.replaceWith(t),this}replaceWith(e){return e=this._normalizeChild(e),sa.replaceElement(this,e),e.ownerDocument=this.getOwnerDocument(),this}getEventListeners(){return this.eventListeners||[]}click(){return this.emit("click",{target:this}),this}emit(e,t){this._propagateEvent(new Wc(e,this,t))}getBoundingClientRect(){return{top:0,left:0,height:0,width:0}}getClientRects(){return[{top:0,left:0,height:0,width:0}]}_propagateEvent(e){let t=this.eventListeners;if(t){if(t.forEach(t=>{t.eventName===e.type&&t.handler(e)}),e.stopped)return;let r=this.parentNode;r&&r._propagateEvent(e)}}removeAllEventListeners(){return this.eventListeners=[],this}_assign(e){e.name&&(this.name=e.name),this.classes&&e.classes&&e.classes.forEach(e=>{this.classes.add(e)}),this.styles&&e.styles&&r(e.styles,(e,t)=>{this.styles.set(t,e)});let t=e.attributes||e.attribs;this.attributes&&t&&r(t,(e,t)=>{switch(t){case"class":Jc(this.classes,e);break;case"style":$c(this.styles,e)}this.attributes.set(t,e)}),this.eventListeners&&e.eventListeners&&(this.eventListeners=this.eventListeners.concat(e.eventListeners))}_normalizeChild(e){if(!x(e)){if(E(e)&&(e=this.createTextNode(e)),!e||!e._isMemoryDOMElement)throw new Error("Illegal argument: only String and MemoryDOMElement instances are valid.");return e}}_normalizeName(e){return this._isXML()?e:e.toLowerCase()}_isHTML(){return"html"===this.getFormat()}_isXML(){return"xml"===this.getFormat()}get _isMemoryDOMElement(){return!0}static createDocument(e,t={}){if("xml"===e){let r=new zc("document",{format:e}),n=[];return t.version&&n.push(`version="${t.version}"`),t.encoding&&n.push(`encoding="${t.encoding}"`),n.length>0&&(r._xmlInstruction=r.createProcessingInstruction("xml",n.join(" "))),r}return zc.parseMarkup(lo.EMPTY_HTML,"html")}static parseMarkup(e,t,r={}){if(!e)return zc.createDocument(t);let n,s="html"===t,i=Object.assign({format:t,decodeEntities:s,elementFactory:Vc},r);if(r.raw)return Bc(e,i);if(r.snippet&&(e=`<__snippet__>${e}</__snippet__>`),"html"===t?function(e){let t=e.find("html");if(!t){let r=e.find("head"),n=e.find("title"),s=e.findAll("meta"),i=e.find("body");r&&r.remove(),n&&n.remove(),s.forEach(e=>e.remove()),i&&i.remove();let o=e.childNodes.slice();o.forEach(e=>{e.parent=null}),e.childNodes.length=0,t=e.createElement("html"),r||((r=e.createElement("head")).appendChild(n),r.append(s),t.appendChild(r)),i||(i=e.createElement("body")).append(o),t.appendChild(i),e.append(t)}}(n=Bc(e,i)):"xml"===t&&(n=Bc(e,i)),r.snippet){let e=n.find("__snippet__").childNodes;return 1===e.length?e[0]:e}return n}static wrapNativeElement(e){if(wo){if(e===window||e===window.document)return new Yc;e instanceof window.Node||e._isBrowserDOMElement}if(!e._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return e}static wrap(e){return zc.wrapNativeElement(e)}static unwrap(e){if(!e._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return e}static isReverse(){return!1}static getBrowserWindow(){return Uc||(Uc=zc.createDocument("html")),Uc}}function Vc(e,t){return new zc(e,t)}class Gc extends zc{get name(){return this.data.name}get publicId(){return this.data.publicId}get systemId(){return this.data.systemId}}function Jc(e,t){t.split(/\s+/).forEach(t=>{e.add(t)})}function Kc(e){return Array.from(e).join(" ")}function $c(e,t){(t=(t||"").trim())&&t.split(";").forEach(t=>{let r=t.indexOf(":");if(r<1||r===t.length-1)return;let n=t.slice(0,r).trim(),s=t.slice(r+1).trim();e.set(n,s)})}const Xc=["keydown","keyup","keypress","mousedown","mouseup","mouseover","click","dblclick"].reduce((e,t)=>(e[t]=!0,e),{});class Wc{constructor(e,t,r){this.type=e,this.timeStamp=Date.now(),this.target=t,Xc[e]?r&&Object.assign(this,r):this.detail=r}stopPropagation(){this.stopped=!0}preventDefault(){this.defaultPrevented=!0}}class Yc{on(){}off(){}}function Zc(e){const t=e.indexOf(":");return t>0?e.slice(t+1):e}const Qc={input:{value:!0,checked:(e,t,r)=>{const n="off"!==r;e.setProperty("checked",n)}}};const eh={input:{checked:(e,t,r)=>{!0===r?(e.properties.set(t,!0),e.properties.set("value","on")):(e.properties.set(t,!1),e.properties.set("value","off"))},value:(e,t,r)=>{switch(e.getAttribute("type")){case"checkbox":"on"===r?(e.properties.set(t,!0),e.properties.set("value","on")):(e.properties.set(t,!1),e.properties.set("value","off"));break;default:th(e,t,r)}}}};function th(e,t,r){void 0===r?e.properties.delete(t):e.properties.set(t,String(r))}function rh(e){if(e.doctype)return e.doctype;const t=e.childNodes;for(let r=0;r<t.length;r++){let n=t[r];if(n.type===bo.Doctype)return e.doctype=n,n}}let nh={};function sh(){return w.inBrowser||w.inElectron?go:zc}nh.createDocument=function(e,t){return sh().createDocument(e,t)},nh.createElement=function(e){return console.error("DEPRECATED: every element should have an ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),nh.createDocument("html").createElement(e)},nh.createTextNode=function(e){return console.error("DEPRECATED: every element should have a ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),nh.createDocument("html").createTextNode(e)},nh.getBrowserWindow=function(){return sh().getBrowserWindow()},nh.parseHTML=function(e,t){return sh().parseMarkup(e,"html",t)},nh.parseXML=function(e,t){return sh().parseMarkup(e,"xml",t)},nh.parseSnippet=function(e,t){return sh().parseMarkup(e,t,{snippet:!0})},nh.wrap=nh.wrapNativeElement=function(e){if(!e)throw new Error("Illegal argument");return sh().wrap(e)},nh.unwrap=function(e){if(!e)throw new Error("Illegal argument");return sh().unwrap(e)},nh.isReverse=function(e,t,r,n){return sh().isReverse(e,t,r,n)};const ih="undefined"!=typeof global?global:window,oh=ih.hasOwnProperty("Substance")?ih.Substance:ih.Substance={DEBUG_RENDERING:!1};function ah(e){return Array.prototype.concat.apply([],e)}function lh(e,t){if(!(t>0))throw new Error("'max' must be a positive number");let r=e.length;e=ah(e);let n=1;for(;n<t&&r<e.length;)r=e.length,e=ah(e),n++;return e}function ch(e){return!0===e||!1===e||e&&e.constructor===Boolean}class hh extends lo{constructor(e){super(),this.parent=null,this._owner=e,this._ref=null}getParent(){return this.parent}get childNodes(){return this.getChildNodes()}getChildCount(){return this.children.length}getChildAt(e){return this.children[e]}getComponent(){return this._comp}ref(e){if(!e)throw new Error("Illegal argument");if(this._ref)throw new Error("A VirtualElement can only be referenced once.");if(this._ref=e,this._context){const t=this._context.refs;if(t[e])throw new Error('An item with reference "'+e+'" already exists.');t[e]=this}return this}isInDocument(){return!1}get _isVirtualElement(){return!0}}class dh extends hh{constructor(e){super(),this._tagName=e,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}getTagName(){return this._tagName}setTagName(e){return this._tagName=e,this}hasClass(e){return!!this.classNames&&this.classNames.indexOf(e)>-1}addClass(e){return this.classNames||(this.classNames=[]),this.classNames.push(e),this}removeClass(e){return this.classNames&&(this.classNames=ks(this.classNames,e)),this}removeAttribute(e){return this.attributes&&delete this.attributes[e],this}getAttribute(e){if(this.attributes)return this.attributes[e]}setAttribute(e,t){return this.attributes||(this.attributes={}),this.attributes[e]=t,this}getAttributes(){var e={};return this.attributes&&Object.assign(e,this.attributes),this.classNames&&(e.class=this.classNames.join(" ")),this.style&&(e.style=g(this.style,function(e,t){return t+":"+e}).join(";")),e}getId(){return this.getAttribute("id")}setId(e){return this.setAttribute("id",e),this}setTextContent(e){return e=String(e||""),this.empty(),this.appendChild(e),this}setInnerHTML(e){return e=e||"",this.empty(),this._innerHTMLString=e,this}getInnerHTML(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")}getValue(){return this.htmlProp("value")}setValue(e){return this.htmlProp("value",e),this}getChildNodes(){return this.children}getChildren(){return this.children.filter(function(e){return"text"!==e.getNodeType()})}isTextNode(){return!1}isElementNode(){return!0}isCommentNode(){return!1}isDocumentNode(){return!1}append(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this}appendChild(e){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,e),this}insertAt(e,t){if(!(t=this._normalizeChild(t)))throw new Error("Illegal child: "+t);if(!t._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+t);if(e<0||e>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,e,t),this}insertBefore(e,t){var r=this.children.indexOf(t);if(!(r>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(r,e),this}removeAt(e){if(e<0||e>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(e),this}removeChild(e){if(!e||!e._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var t=this.children.indexOf(e);if(t<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(t),this}replaceChild(e,t){if(!(t&&e&&t._isVirtualElement&&e._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var r=this.children.indexOf(e);if(r<0)throw new Error("replaceChild(): element is not a child.");return this.removeAt(r),this.insertAt(r,t),this}empty(){for(var e=this.children;e.length;){e.pop().parent=null}return delete this._innerHTMLString,this}getProperty(e){if(this.htmlProps)return this.htmlProps[e]}setProperty(e,t){return this.htmlProps||(this.htmlProps={}),this.htmlProps[e]=t,this}removeProperty(e){return this.htmlProps&&delete this.htmlProps[e],this}getStyle(e){if(this.style)return this.style[e]}setStyle(e,t){return this.style||(this.style={}),lo.pxStyles[e]&&C(t)&&(t+="px"),this.style[e]=t,this}_createEventListener(e,t,r){return r.context=r.context||this._owner._comp,super._createEventListener(e,t,r)}getNodeType(){return"element"}hasInnerHTML(){return Boolean(this._innerHTMLString)}_normalizeChild(e){if(!x(e)){if(e._isVirtualElement)return e;if(E(e)||ch(e)||C(e))return new fh(String(e));throw new Error("Unsupported child type")}}_append(e,t){if(1!==t.length||_(t[0])){var r;if(_(t[0]))r=t[0];else{if(!(arguments.length>1))return;r=Array.prototype.slice.call(t,0)}r.forEach(this._appendChild.bind(this,e))}else this._appendChild(e,t[0])}_appendChild(e,t){if(t=this._normalizeChild(t))return e.push(t),this._attach(t),t}_insertAt(e,t,r){r&&(e.splice(t,0,r),this._attach(r))}_removeAt(e,t){var r=e[t];e.splice(t,1),this._detach(r)}_attach(e){e.parent=this,this._context&&e._owner!==this._owner&&e._ref&&(this._context.foreignRefs[e._ref]=e)}_detach(e){e.parent=null,this._context&&e._owner!==this._owner&&e._ref&&delete this.context.foreignRefs[e._ref]}_mergeHTMLConfig(e){e.classNames&&(this.classNames||(this.classNames=[]),this.classNames=this.classNames.concat(e.classNames)),e.attributes&&(this.attributes||(this.attributes={}),Object.assign(this.attributes,e.attributes)),e.htmlProps&&(this.htmlProps||(this.htmlProps={}),Object.assign(this.htmlProps,e.htmlProps)),e.style&&(this.style||(this.style={}),Object.assign(this.style,e.style)),e.eventListeners&&(this.eventListeners||(this.eventListeners=[]),this.eventListeners=this.eventListeners.concat(e.eventListeners))}get _isVirtualHTMLElement(){return!0}}class uh extends dh{constructor(e,t){super(),t=t||{},this.ComponentClass=e,this.props=t,t.children||(t.children=[]),this.children=t.children}getComponent(){return this._comp}getChildren(){return this.props.children}getNodeType(){return"component"}outlet(e){return new ph(this,e)}_attach(e){e._preliminaryParent=this}_detach(e){e._preliminaryParent=null}_copyHTMLConfig(){return{classNames:y(this.classNames),attributes:y(this.attributes),htmlProps:y(this.htmlProps),style:y(this.style),eventListeners:y(this.eventListeners)}}get _isVirtualHTMLElement(){return!1}get _isVirtualComponent(){return!0}}class ph{constructor(e,t){this.virtualEl=e,this.name=t,Object.freeze(this)}_getOutlet(){var e=this.virtualEl.props[this.name];return e||(e=[],this.virtualEl.props[this.name]=e),e}append(){var e=this._getOutlet();return this.virtualEl._append(e,arguments),this}empty(){var e=this.virtualEl.props[this.name];return e.forEach(function(e){this._detach(e)}.bind(this)),e.splice(0,e.length),this}}class fh extends hh{constructor(e){super(),this.text=e}get _isVirtualTextNode(){return!0}}hh.Component=uh,hh.TextNode=fh,hh.createElement=function(){var e,t,r=arguments[0],n=arguments[1];if(E(r))t="element";else{if(!no(r)||!r.prototype._isComponent)throw x(r)?new Error("$$(null): provided argument was null or undefined."):new Error("Illegal usage of $$()");t="component"}var s,i,o={};for(var a in n)if(n.hasOwnProperty(a)){var l=n[a];switch(a){case"class":s=l;break;case"ref":i=l;break;default:o[a]=l}}return"element"===t?(e=new dh(r)).attr(o):e=new uh(r,o),e._owner=this.owner,s&&e.addClass(s),i&&e.ref(i),[].forEach(function(t){if(no(t.handler))e.on(t.name,t.handler);else{if(!m(t.handler))throw new Error("Illegal arguments for $$(_,{ on"+t.name+"})");var r=t.handler;e.on(t.name,r.handler,r.context,r)}}),arguments.length>2&&e.append(lh(Array.prototype.slice.call(arguments,2),3)),e};class gh{constructor(e={}){if(this.componentFactory=e.componentFactory,!this.componentFactory)throw new Error("'componentFactory' is mandatory");if(this.elementFactory=e.elementFactory||nh.createDocument("html"),!this.elementFactory)throw new Error("'elementFactory' is mandatory")}_render(e,t,r){var n=Ih(e),s=this._createState();t&&s.setOldProps(n,t),r&&s.setOldState(n,r);try{_h(s,n,"forceCapture"),yh(s,n),function e(t,r){r._isVirtualComponent?(t.isSkipped(r)||r._content.children.forEach(e.bind(null,t)),t.isUpdated(r)&&r._comp.didUpdate(t.getOldProps(r),t.getOldState(r))):r._isVirtualHTMLElement&&r.children.forEach(e.bind(null,t))}(s,n)}finally{s.dispose()}}_renderChild(e,t){var r=this._createState();t.parent={_comp:e};try{return _h(r,t),yh(r,t),t._comp}finally{r.dispose()}}_createState(){return new Ah(this.componentFactory,this.elementFactory)}}function mh(e,t){var r=t._comp;console.assert(!r,"Component instance should not exist when this method is used.");var n=t.parent._comp;return n||(n=mh(e,t.parent)),t._isVirtualComponent?(console.assert(n,"A Component should have a parent."),r=e.componentFactory.createComponent(t.ComponentClass,n,t.props),t.props=r.props,r.__htmlConfig__=t._copyHTMLConfig()):t._isVirtualHTMLElement?r=e.componentFactory.createElementComponent(n,t):t._isVirtualTextNode&&(r=e.componentFactory.createTextNodeComponent(n,t)),t._ref&&(r._ref=t._ref),t._owner&&(r._owner=t._owner._comp),t._comp=r,r}function _h(e,t,n){if(e.isCaptured(t))return t;var s,i=t._comp;if(i||(i=mh(e,t),e.setNew(t)),t._isVirtualComponent)if(n?s=!0:(s=!i.el||i.shouldRerender(t.props,i.state),i.__htmlConfig__=t._copyHTMLConfig(),e.setOldProps(t,i.props),e.setOldState(t,i.state),i._setProps(t.props),e.isNew(t)||e.setUpdated(t)),s){var o=new Th(t),a=i.render(o.$$);if(!a)throw new Error("Component.render() returned nil.");if(a._isVirtualComponent)a._isForwarded=!0,a.parent=t;else if(!a._isVirtualHTMLElement)throw new Error("render() must return a plain element or a Component");if(i.__htmlConfig__&&a._mergeHTMLConfig(i.__htmlConfig__),a._isVirtualComponent||(a._comp=i),t._content=a,!e.isNew(t)&&i.isMounted()&&e.setUpdated(t),function(e,t,n){var s={},i={};n._context&&(s=n._context.refs,i=n._context.foreignRefs);var o=t.refs,a=t.__foreignRefs__;r(s,function(t,r){var n=o[r];n&&xh(e,n,t)}),r(i,function(t,r){var n=a[r];n&&xh(e,n,t)})}(e,i,a),oh.DEBUG_RENDERING&&!t._content._isForwarded){for(var l=a.children.slice(0);l.length;){var c=l.shift();e.isCaptured(c)||(c._isVirtualComponent||(c._comp||mh(e,c),c._isVirtualHTMLElement&&c.children.length>0&&(l=l.concat(c.children)),e.setCaptured(c)))}e.setCaptured(a);for(var h=new Nh(e,o);h.hasPendingCaptures();)h.reset(),i.render(h.$$)}else _h(e,t._content)}else e.setSkipped(t);else if(t._isVirtualHTMLElement)for(var d=0;d<t.children.length;d++)_h(e,t.children[d]);return e.setCaptured(t),t}function yh(e,t){if(e.isSkipped(t))return;let n=t._comp;if(console.assert(n&&n._isComponent,"A captured VirtualElement must have a component instance attached."),t._isVirtualComponent){yh(e,t._content);const s=t._content._context;let i={},o={};return r(s.refs,(e,t)=>{i[t]=e._comp}),r(s.foreignRefs,(e,t)=>{o[t]=e._comp}),n.refs=i,n.__foreignRefs__=o,void(t._content._isVirtualComponent&&(n.el=t._content._comp.el,t._content._comp.triggerDidMount(),n.triggerDidMount()))}if(n.el||(n.el=function(e,t){var r;r=t._isVirtualTextNode?e.elementFactory.createTextNode(t.text):e.elementFactory.createElement(t.tagName);return r}(e,t),n.el._comp=n),function(e,t){if(e._isTextNodeComponent)return void e.setTextContent(t.text);var r=e.el;console.assert(r,"Component's element should exist at this point.");var n=r.getTagName();t.tagName.toLowerCase()!==n&&r.setTagName(t.tagName);if(Eh({oldHash:r.getAttributes(),newHash:t.getAttributes(),update:function(e,t){r.setAttribute(e,t)},remove:function(e){r.removeAttribute(e)}}),Eh({oldHash:r.htmlProps,newHash:t.htmlProps,update:function(e,t){r.setProperty(e,t)},remove:function(e){r.removeProperty(e)}}),function(e){var t=e.el,r=e.newListeners||[];t.removeAllEventListeners();for(var n=0;n<r.length;n++)t.addEventListener(r[n])}({el:r,oldListeners:r.getEventListeners(),newListeners:t.getEventListeners()}),t.hasInnerHTML()){if(r._hasInnerHTML){var s=r.getInnerHTML(),i=t.getInnerHTML();s!==i&&r.setInnerHTML(i)}else r.empty(),r.setInnerHTML(t.getInnerHTML());r._hasInnerHTML=!0}}(n,t),t._isVirtualHTMLElement&&!t.hasInnerHTML()){var s,i,o,a=t.children,l=0,c=0,h=[];for(n.el.getChildNodes().forEach(function(t){var r=t._comp;!r||e.isRelocated(r)?n.el.removeChild(t):h.push(r)});l<h.length||c<a.length;){do{s=h[l++]}while(s&&e.isDetached(s));if(i=a[c++],s&&!i){for(;s;)Ch(e,n,s),s=h[l++];break}s&&s.el.isTextNode()&&i&&i._isVirtualTextNode&&s.el.textContent===i.text||(e.isRendered(i)||yh(e,i),o=i._comp,e.isRelocated(o)&&o._setParent(n),console.assert(o,"Component instance should now be available."),!i||s?e.isMapped(i)?o===s||(e.isMapped(s)?(e.setDetached(s),Ch(e,n,s),c--):(Ch(e,n,s),c--)):e.isMapped(s)?(vh(e,n,o,s),l--):bh(e,n,s,o):wh(e,n,o))}}e.setRendered(t)}function wh(e,t,r){t.el.appendChild(r.el),Sh(e,t,r)}function bh(e,t,r,n){t.el.replaceChild(r.el,n.el),e.isDetached(r)||r.triggerDispose(),Sh(e,t,n)}function vh(e,t,r,n){t.el.insertBefore(r.el,n.el),Sh(e,t,r)}function Ch(e,t,r){t.el.removeChild(r.el),e.isDetached(r)||r.triggerDispose()}function Sh(e,t,r){e.isDetached(r)||!t.isMounted()||r.isMounted()||r.triggerDidMount(!0)}function xh(e,t,r){if(!t&&!r)return!0;if(!t||!r)return!1;if(e.isMapped(r)||e.isMapped(t))return r._comp===t;if(r._comp)return r._comp===t&&(e.setMapped(r),e.setMapped(t),!0);if(!function(e,t){return e._isElementComponent&&t._isVirtualHTMLElement||e._isComponent&&t._isVirtualComponent&&e.constructor===t.ComponentClass||e._isTextNodeComponent&&t._isVirtualTextNode}(t,r))return!1;var n;r._comp=t,e.setMapped(r),e.setMapped(t);var s=t.getParent();if(r.parent)n=xh(e,s,r.parent);else if(r._preliminaryParent){for(;s&&s._isElementComponent;)s=s.getParent();n=xh(e,s,r._preliminaryParent)}return n||(e.setRelocated(r),e.setRelocated(t)),n}function Eh(e){const t=e.newHash,r=e.oldHash||{},n=e.update,s=e.remove;let i={};for(let e in t)if(t.hasOwnProperty(e)){var o=r[e],a=t[e];i[e]=!0,o!==a&&n(e,a)}if(no(r.keys)&&r.size>0){Array.from(r.keys()).forEach(e=>{i[e]||s(e)})}else for(let e in r)r.hasOwnProperty(e)&&!i[e]&&s(e)}class Nh{constructor(e,t){this.state=e,this.owner=t.owner,this.refs={},this.foreignRefs={},this.elements=t.elements,this.pos=0,this.updates=t.components.length,this.remaining=this.updates,this.$$=this._createComponent.bind(this)}_createComponent(){var e=this.state,t=this.elements[this.pos++];return!e.isCaptured(t)&&t._isVirtualComponent&&t.parent&&e.isCaptured(t.parent)&&(_h(e,t),this.updates++,this.remaining--),(t=hh.createElement.apply(this,arguments))._context=this,t._owner=this.owner,t._attach=function(){},t._detach=function(){},t}hasPendingCaptures(){return this.updates>0&&this.remaining>0}reset(){this.pos=0,this.updates=0,this.refs={}}_ancestorsReady(e){for(;e;){if(this.state.isCaptured(e)||e===this.owner||e===this.owner._content)return!0;e=e.parent}return!1}}gh._internal={_capture:_h,_wrap:Ih};class Th{constructor(e){this.owner=e,this.refs={},this.foreignRefs={},this.elements=[],this.components=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0}_createComponent(){var e=hh.createElement.apply(this,arguments);return e._context=this,e._owner=this.owner,e._isVirtualComponent&&this.components.push(e),this.elements.push(e),e}}function Ih(e){var t=new hh.Component(e.constructor);return t._comp=e,e.__htmlConfig__&&t._mergeHTMLConfig(e.__htmlConfig__),t}gh.createContext=function(e){var t=Ih(e);return new Th(t)};class Ah{constructor(e,t){this.componentFactory=e,this.elementFactory=t,this.poluted=[],this.id="__"+d()}dispose(){var e=this.id;this.poluted.forEach(function(t){delete t[e]})}set(e,t,r){var n=e[this.id];n||(n={},e[this.id]=n,this.poluted.push(e)),n[t]=r}get(e,t){var r=e[this.id];if(r)return r[t]}setMapped(e){this.set(e,"mapped",!0)}isMapped(e){return Boolean(this.get(e,"mapped"))}setRelocated(e){this.set(e,"relocated",!0)}isRelocated(e){return Boolean(this.get(e,"relocated"))}setDetached(e){this.set(e,"detached",!0)}isDetached(e){return Boolean(this.get(e,"detached"))}setCaptured(e){this.set(e,"captured",!0)}isCaptured(e){return Boolean(this.get(e,"captured"))}setNew(e){this.set(e,"created",!0)}isNew(e){return Boolean(this.get(e,"created"))}setUpdated(e){this.set(e,"updated",!0)}isUpdated(e){return Boolean(this.get(e,"updated"))}setSkipped(e){this.set(e,"skipped",!0)}isSkipped(e){return Boolean(this.get(e,"skipped"))}setRendered(e){this.set(e,"rendered",!0)}isRendered(e){return Boolean(this.get(e,"rendered"))}setOldProps(e,t){this.set(e,"oldProps",t)}getOldProps(e){return this.get(e,"oldProps")}setOldState(e,t){this.set(e,"oldState",t)}getOldState(e){return this.get(e,"oldState")}}const Dh={createComponent:(e,t,r)=>new e(t,r),createElementComponent:(e,t)=>new Lh(e,t),createTextNodeComponent:(e,t)=>new Rh(e,t)};class Oh extends l{constructor(e,t={},r={}){let n;super(),this.parent=e&&e._isComponent?e:null,this.el=r.el,n=no(this.defineContext)?this.defineContext(t,e):r.context||this._getContext(),this.context=n||{},this.renderingEngine=e&&e.renderingEngine||r.renderingEngine||new gh({componentFactory:Dh}),this._SKIP_COMPONENT_INIT||(this.__id__=d(),this.refs={},this.__foreignRefs__={},this._actionHandlers=this.getActionHandlers(),this.props=t,this.state=this.getInitialState()||{})}getId(){return this.__id__}setId(){throw new Error("'id' is readonly")}getActionHandlers(){return{}}getChildContext(){return{}}getInitialState(){return{}}getParent(){return this.parent}getRoot(){for(var e=this,t=e;t;)t=(e=t).getParent();return e}getElement(){return this.el}getNativeElement(){return this.el.getNativeElement()}getLabel(e,...t){let r=this.getLabelProvider();if(!r)throw new Error("Missing labelProvider.");return r.getLabel(e,...t)}getLabelProvider(){return this.context.labelProvider}getComponent(e,t){let r=this.getComponentRegistry();if(!r)throw new Error("Missing componentRegistry.");const n=r.get(e);if(!t&&!n)throw new Error("No Component registered with name "+e);return n}getComponentRegistry(){return this.context.componentRegistry}render(e){return e("div")}mount(e){if(!e)throw new Error("Element is required.");return e=nh.wrap(e),this.el=null,this.renderingEngine=Oh.createRenderingEngine(e.getOwnerDocument()),this._render(),e.appendChild(this.el),e.isInDocument()&&this.triggerDidMount(!0),this}shouldRerender(e,t){return!0}rerender(){this._rerender(this.props,this.state)}_rerender(e,t){this._render(e,t),this.isMounted()||this.didUpdate(e,t)}_render(e,t){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{this.renderingEngine._render(this,e,t)}finally{delete this.__isRendering__}}triggerDidMount(){this.__isMounted__||(this.__isMounted__=!0,this.didMount()),this.getChildren().forEach(function(e){e.triggerDidMount(!0)})}didMount(){}didUpdate(){}isMounted(){return this.__isMounted__}triggerDispose(){this.getChildren().forEach(function(e){e.triggerDispose()}),this.dispose(),this.__isMounted__=!1}dispose(){}_setParent(e){this.parent=e,this.context=this._getContext()||{},Object.freeze(this.context)}send(e){for(var t=this;t;){if(t._actionHandlers&&t._actionHandlers[e])return t._actionHandlers[e].apply(t,Array.prototype.slice.call(arguments,1)),!0;t=t.getParent()}return console.warn("Action",e,"was not handled."),!1}handleActions(e){return r(e,function(e,t){this.handleAction(t,e)}.bind(this)),this}handleAction(e,t){if(!e||!t||!no(t))throw new Error("Illegal arguments.");t=t.bind(this),this._actionHandlers[e]=t}getState(){return this.state}setState(e){var t=this.props,r=this.state,n=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),e);this.willUpdateState(e),this.state=e||{},Object.freeze(this.state),n?this._rerender(t,r):this.__isSettingProps__||this.didUpdate(t,r)}extendState(e){e=ro({},this.state,e),this.setState(e)}willUpdateState(e){}getProps(){return this.props}setProps(e){var t=this.props,r=this.state,n=this.shouldRerender(e,this.state);this._setProps(e),n?this._rerender(t,r):this.didUpdate(t,r)}_setProps(e){e=e||{},this.__isSettingProps__=!0;try{this.willReceiveProps(e),this.props=e||{},Object.freeze(e)}finally{delete this.__isSettingProps__}}extendProps(e){var t=ro({},this.props,e);this.setProps(t)}willReceiveProps(e){}getTextContent(){if(this.el)return this.el.textContent}get textContent(){return this.getTextContent()}getInnerHTML(){if(this.el)return this.el.getInnerHTML()}get innerHTML(){return this.getInnerHTML()}getOuterHTML(){if(this.el)return this.el.getOuterHTML()}get outerHTML(){return this.getOuterHTML()}getAttribute(e){if(this.el)return this.el.getAttribute(e)}setAttribute(e,t){return this.el&&this.el.setAttribute(e,t),this}getProperty(e){if(this.el)return this.el.getProperty(e)}setProperty(e,t){return this.el&&this.el.setProperty(e,t),this}hasClass(e){if(this.el)return this.el.hasClass(e)}addClass(e){return this.el&&this.el.addClass(e),this}removeClass(e){return this.el&&this.el.removeClass(e),this}getStyle(e){if(this.el)return this.el.getStyle(e)}setStyle(e,t){return this.el?this.el.setStyle(e,t):this}getValue(){if(this.el)return this.el.getValue()}setValue(e){return this.el&&this.el.setValue(e),this}getChildCount(){return this.el?this.el.getChildCount():0}get childNodes(){return this.getChildNodes()}getChildNodes(){if(!this.el)return[];var e=this.el.getChildNodes();return e=e.map(kh).filter(Boolean)}getChildren(){if(!this.el)return[];let e=this.el.getChildren();return e=e.map(kh).filter(Boolean)}getChildAt(e){let t=this.el.getChildAt(e);if(t)return Mh(t)}find(e){return kh(this.el.find(e))}findAll(e){return this.el.findAll(e).map(kh).filter(Boolean)}appendChild(e){this.insertAt(this.getChildCount(),e)}insertAt(e,t){if(E(t)&&(t=new hh.TextNode(t)),!t._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');var r=this.renderingEngine._renderChild(this,t);this.el.insertAt(e,r.el),function(e,t){e.isMounted()&&t.triggerDidMount(!0);t._owner&&t._ref&&(t._owner.refs[t._ref]=t)}(this,r)}removeAt(e){var t=this.el.getChildAt(e);t&&(Ph(Mh(t)),this.el.removeAt(e))}removeChild(e){if(!e||!e._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");Ph(e),this.el.removeChild(e.el)}replaceChild(e,t){if(!(t&&e&&t._isComponent&&e._isComponent))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");Ph(e),this.el.replaceChild(t.el,e.el),this.isMounted()&&t.triggerDidMount(!0)}empty(){return this._clear(),this}_clear(){let e=this.el;e&&(this.getChildNodes().forEach(function(e){Ph(e)}),e.empty()),this.refs={},this.__foreignRefs__={}}remove(){Ph(this),this.el.remove()}addEventListener(){throw new Error("Not supported.")}removeEventListener(){throw new Error("Not supported.")}insertBefore(){throw new Error("Not supported.")}click(){return this.el&&this.el.click(),this}getComponentPath(){let e=[],t=this;for(;t;)e.unshift(t),t=t.getParent();return e}_getContext(){var e={},t=this.getParent();return t&&(e=ro(e,t.context),t.getChildContext)?ro(e,t.getChildContext()):e}get _isComponent(){return!0}attr(){return lo.prototype.attr.apply(this,arguments)}htmlProp(){return lo.prototype.htmlProp.apply(this,arguments)}val(){return lo.prototype.val.apply(this,arguments)}css(){return lo.prototype.css.apply(this,arguments)}text(){return lo.prototype.text.apply(this,arguments)}append(){return lo.prototype.append.apply(this,arguments)}static unwrap(){return kh.apply(this,arguments)}static render(e){var t=new this(null,e=e||{});return t._render(),t}static mount(e,t){if(1===arguments.length&&(t=e,e={}),!t)throw new Error("'el' is required.");if(E(t)){var r=t;if(!w.inBrowser)throw new Error("This selector is not supported on server side.");t=window.document.querySelector(r)}t=nh.wrap(t);let n=new this(null,e);return n.mount(t),n}static getComponentForDOMElement(e){return kh(e)}static unwrapDOMElement(e){return console.warn("DEPRECATED: Use Component.getComponentForDOMElement"),Oh.getComponentForDOMElement(e)}static getComponentFromNativeElement(e){return kh(nh.wrap(e))}static createRenderingEngine(e){return new gh({componentFactory:Dh,elementFactory:e})}static get Element(){return Lh}static get TextNode(){return Rh}}function Ph(e){e.triggerDispose(),e._owner&&e._ref&&(console.assert(e._owner.refs[e._ref]===e,"Owner's ref should point to this child instance."),delete e._owner.refs[e._ref])}function kh(e){if(e&&(e._isDOMElement||(e=nh.unwrap(e)),e))return e._comp}function Mh(e){let t=kh(e);if(!t)throw new Error("Expecting a back-link to the component instance.");return t}class Lh extends Oh{get _isElementComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class Rh extends Oh{setTextContent(e){if(!this.el)throw new Error("Component must be rendered first.");this.el.textContent!==e&&(this.el.textContent=e)}getChildNodes(){return[]}getChildren(){return[]}get _isTextNodeComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class qh{constructor(e,t,r,n,s){if("SKIP"!==arguments[0])if(1===arguments.length&&m(arguments[0])){let e=arguments[0];this.start=e.start,this.end=e.end,this.reverse=Boolean(e.reverse),this.containerId=e.containerId,this.surfaceId=e.surfaceId}else this.start=e,this.end=t,this.reverse=Boolean(r),this.containerId=n,this.surfaceId=s}isCollapsed(){return this.start.equals(this.end)}equals(e){return this===e||this.containerId===e.containerId&&this.start.equals(e.start)&&this.end.equals(e.end)}isReverse(){return this.reverse}toString(){let e=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&e.push("[reverse]"),this.containerId&&e.push("[container="+this.containerId+"]"),this.surfaceId&&e.push("[surface="+this.surfaceId+"]"),e.join("")}get _isRange(){return!0}}const Bh=1,Fh=-1,jh=-2;class Hh{constructor(e){Object.assign(this,e)}start(e,t,r){if(!E(t))throw new Error("Illegal argument: 'text' must be a String, but was "+t);this._start(e,t,r)}onText(e,t,r){}onEnter(e,t){return null}onExit(e,t,r){}_enter(e,t){return e.counter++,this.onEnter(e,t)}_exit(e,t,r){this.onExit(e,t,r)}_createText(e,t,r){this.onText(e,t,r)}_start(e,t,n){for(var s=function(e){let t=[],n=[];r(e,function(e){let r=e.isAnchor();if(r)t.push({mode:jh,pos:e.offset,id:e.id,level:Hh.ALWAYS_ON_TOP,type:"anchor",node:e,counter:-1,length:0});else{var s=Hh.NORMAL,i=e.isInlineNode();i?s=Number.MAX_VALUE:e.constructor.hasOwnProperty("fragmentation")?s=e.constructor.fragmentation:e.hasOwnProperty("fragmentationHint")&&(s=e.fragmentationHint);var o=Math.min(e.start.offset,e.end.offset),a=Math.max(e.start.offset,e.end.offset),l={pos:o,mode:Bh,level:s,id:e.id,type:e.type,node:e,length:0,counter:-1};t.push(l),n.push({pos:a,mode:Fh,level:s,id:e.id,type:e.type,node:e,opener:l})}}),t.sort(Uh);for(var s=t.length-1;s>=0;s--)t[s].idx=s;n.sort(zh);var i=new Array(t.length+n.length),o=0,a=0,l=0,c=t[a],h=n[l];for(;c||h;)c&&h?h.pos<=c.pos&&h.opener!==c?(i[o]=h,l++):(i[o]=c,a++):c?(i[o]=c,a++):h&&(i[o]=h,l++),c=t[a],h=n[l],o++;return i}.call(this,n),i=[{context:e,entry:null}],o=0,a=0;a<s.length;a++){var l,c,h,d=s[a],u=t.substring(o,d.pos);if(u&&this._createText(i[i.length-1].context,u,d),o=d.pos,d.mode===Bh||d.mode===jh){for(l=1;l<i.length&&!(d.level<i[l].entry.level);l++);for(c=i.length-1;c>=l;c--)(h=i[c].entry).length=o-h.pos,this._exit(h,i[c].context,i[c-1].context);for(i.splice(l,0,{entry:d}),c=l;c<i.length;c++)(h=i[c].entry).pos=o,i[c].context=this._enter(h,i[c-1].context)}if(d.mode===Fh||d.mode===jh){for(l=1;l<i.length&&i[l].entry.node!==d.node;l++);for(c=i.length-1;c>=l;c--)(h=i[c].entry).length=o-h.pos,this._exit(h,i[c].context,i[c-1].context);for(i.splice(l,1),c=l;c<i.length;c++)(h=i[c].entry).pos=o,i[c].context=this._enter(h,i[c-1].context)}}var p=t.substring(o);p&&this._createText(e,p)}}function Uh(e,t){if(e.pos<t.pos)return-1;if(e.pos>t.pos)return 1;if(e.mode<t.mode)return-1;if(e.mode>t.mode)return 1;if(e.mode===t.mode){if(e.level<t.level)return-1;if(e.level>t.level)return 1}return 0}function zh(e,t){return e.pos<t.pos?-1:e.pos>t.pos?1:e.pos===e.opener.pos&&t.pos===t.opener.pos?e.opener.idx<t.opener.idx?-1:1:e.opener.idx>t.opener.idx?-1:e.opener.idx<t.opener.idx?1:0}Hh.SHOULD_NOT_SPLIT=0,Hh.NORMAL=10,Hh.ANY=100,Hh.ALWAYS_ON_TOP=Number.MAX_VALUE;class Vh extends Oh{render(e){return this._renderContent(e).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"})}getPath(){return this.props.path}getText(){return this.getDocument().get(this.props.path)||""}isEmpty(){return!this.getText()}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.props.path)}getDocument(){return this.props.doc||this.context.doc}_getTagName(){return this.props.tagName}_onDocumentChange(e){e.change&&e.change.updated[this.getPath()]&&this.rerender()}_renderContent(e){let t=this.getText(),r=this.getAnnotations(),n=e(this._getTagName()||"span");if(r&&r.length>0){new Hh({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this,e),onExit:this._finishFragment.bind(this)}).start(n,t,r)}else n.append(t);return n}_renderTextNode(e,t){t&&t.length>0&&e.append(t)}_renderFragment(e,t){let r=t.node;return e(this._getFragmentComponentClass(r),this._getFragmentProps(r))}_getFragmentComponentClass(e,t){let r=this.getComponent(e.type,"not-strict");return!e.isInlineNode()||r.prototype._isInlineNodeComponent||r.isCustom||(r=this.getComponent("inline-node")),r||t||(r=this._getUnsupportedInlineNodeComponentClass()),r}_getUnsupportedInlineNodeComponentClass(){return this.getComponent("annotation")}_getFragmentProps(e){return{node:e}}_finishFragment(e,t,r){r.append(t)}}class Gh extends Oh{render(e){let t=e("span").addClass("se-selection-fragment");if(this.props.collaborator){let e=this.props.collaborator.colorIndex;t.addClass("sm-collaborator-"+e)}else t.addClass("sm-local-user");return t.append(this.props.children),t}}class Jh extends Vh{getInitialState(){const e=this.context.markersManager;let t,r=this.getPath();if(e)t=e.getMarkers(r,{surfaceId:this.getSurfaceId(),containerId:this.getContainerId()});else{t=this.getDocument().getAnnotations(r)}return{markers:t}}didMount(){const e=this.context.markersManager;e&&e.register(this)}dispose(){const e=this.context.markersManager;e&&e.deregister(this)}render(e){let t=this.getPath(),r=this._renderContent(e).addClass("sc-text-property").attr({"data-path":t.join(".")}).css({"white-space":"pre-wrap"});return this.isEmpty()&&(r.addClass("sm-empty"),this.props.placeholder&&r.append(e("span").addClass("se-placeholder").append(this.props.placeholder))),this.props.withoutBreak||r.append(e("br")),r}getAnnotations(){return this.props.markers?this.state.markers.concat(this.props.markers):this.state.markers}_renderFragment(e,t){let r,n=t.node,s=n.id;return"selection-fragment"===n.type?r=e(Gh,{collaborator:n.collaborator}):(r=super._renderFragment.apply(this,arguments),s&&r.ref(s+"@"+t.counter)),r.attr("data-offset",t.pos),r}getSurface(){return this.props.surface||this.context.surface}getSurfaceId(){let e=this.getSurface();return e?e.id:null}getContainerId(){let e=this.getSurface();return e?e.getContainerId():null}isEditable(){const e=this.getSurface();return!!e&&e.isEditable()}isReadonly(){const e=this.getSurface();return!e||e.isReadonly()}getDOMCoordinate(e){return this._getDOMCoordinate(this.el,e)}_finishFragment(e,t,r){t.attr("data-length",e.length),r.append(t)}_getDOMCoordinate(e,t){let r,n=0;if(0===t)return{container:e.getNativeElement(),offset:0};for(let s=e.getFirstChild();s;s=s.getNextSibling(),n++)if(s.isTextNode()){if((r=s.textContent.length)>=t)return{container:s.getNativeElement(),offset:t};t-=r}else if(s.isElementNode()){let i=s.getAttribute("data-length");if(!i)return console.error("FIXME: Can not map to DOM coordinates."),null;if((r=parseInt(i,10))>=t){if(s.attr("data-inline")){let t=s.getNextSibling();return t&&t.isTextNode()?{container:t.getNativeElement(),offset:0}:{container:e.getNativeElement(),offset:e.getChildIndex(s)+1}}return this._getDOMCoordinate(s,t,n)}t-=r}}get _isTextPropertyComponent(){return!0}static getCoordinate(e,t,r){let n,s=function(e,t,r){let n={comp:null,el:null,path:null,node:t,offset:r};for(;t&&t!==e;){if(t.isElementNode()){let e=Oh.unwrap(t);if(e&&e._isTextPropertyComponent)return n.comp=e,n.el=t,n.path=e.getPath(),n;t.getAttribute("data-inline")&&(n.node=t,r>0&&(n.offset=1))}t=t.getParent()}return null}(e,t,r);if(!s)return null;if(C(n=t.parentNode&&t.parentNode.is(".se-placeholder")?0:function e(t,r){let n=r;let s,i;s=t.getParent();if(t.isTextNode())if(t===s.firstChild){let t=s.getAttribute("data-path"),i=s.getAttribute("data-offset");n=t?r:i?parseInt(i,10)+r:e(s,0)+r}else i=s.getChildIndex(t),n=e(s,i)+r;else{if(!t.isElementNode())return null;{let o=t.getAttribute("data-path"),a=t.getAttribute("data-offset");o?n=Kh(t,r):a?(i=s.getChildIndex(t),n=parseInt(a,10)+Kh(t,r)):(i=s.getChildIndex(t),n=e(s,i)+Kh(t,r))}}return n}(s.node,s.offset))){let e=new Si(s.path,n);return e._comp=s.comp,e}return null}}function Kh(e,t){let r=0;if(e.getAttribute("data-inline"))return 0===t?0:1;let n=e.getChildCount();1===arguments.length&&(t=n),t=Math.min(n,t);for(let n=0,s=e.getFirstChild();n<t;s=s.getNextSibling(),n++)if(s.isTextNode())r+=s.getTextContent().length;else if(s.isElementNode()){let e=s.getAttribute("data-length");s.getAttribute("data-inline")?r+=1:r+=e?parseInt(e,10):Kh(s)}return r}let $h={UNDEFINED:0,BACKSPACE:8,DELETE:46,INSERT:45,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,RETURN:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,ESC:27,SHIFT:16,SPACE:32,PLUS:171,VOLUMEUP:183,VOLUMEDOWN:182,VOLUMEMUTE:181,PRINTSCREEN:44};for(let e=1;e<=24;e++)$h["F"+e]=111+e;class Xh extends Oh{constructor(...e){super(...e),this.name=this.props.node.id,this._state={selectionFragment:null},this.handleAction("escape",this.escape),this.ContentClass=this._getContentClass();let t=w.isFF||!this.ContentClass.noBlocker;this.blockingMode=t?"closed":"open"}getInitialState(){let e=this.getEditorSession().getSelection(),t=this.getEditorSession().getSelectionState();return this._deriveStateFromSelectionState(e,t)}getChildContext(){return{parentSurfaceId:this.getId(),isolatedNodeComponent:this,surface:void 0}}didMount(){super.didMount(),this.getEditorSession().onRender("selection",this._onSelectionChanged,this)}dispose(){super.dispose.call(this),this.getEditorSession().off(this)}renderContent(e,t,r={}){let n=this.ContentClass;if(n){return e(n,Object.assign(this._getContentProps(),r))}return console.error("Could not resolve a component for type: "+t.type),e(this.__elementTag)}getId(){return this._id||(this._id=this.context.parentSurfaceId+"/"+this.name),this._id}get id(){return this.getId()}getMode(){return this.state.mode}escape(){this.selectNode()}isOpen(){return"open"===this.blockingMode}isClosed(){return"closed"===this.blockingMode}isNotSelected(){return!this.state.mode}isSelected(){return"selected"===this.state.mode}isCoSelected(){return"co-selected"===this.state.mode}isFocused(){return"focused"===this.state.mode}isCoFocused(){return"co-focused"===this.state.mode}getParentSurface(){return this.context.surface}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}_onSelectionChanged(){const e=this.getEditorSession(),t=e.getSelection(),r=e.getSelectionState(),n=this._deriveStateFromSelectionState(t,r);!n&&this.state.mode?this.extendState({mode:null}):n&&n.mode!==this.state.mode&&this.extendState(n)}onKeydown(e){e.keyCode===$h.ESCAPE&&"focused"===this.state.mode&&(e.stopPropagation(),e.preventDefault(),this.escape())}_getContentClass(){const e=this.props.node;let t;return(t=this.getComponent(e.type,!0))||(t=Oh),t}_getContentProps(){return{disabled:this.props.disabled,node:this.props.node,isolatedNodeState:this.state.mode,focused:"focused"===this.state.mode}}_getSurfaceForSelection(e,t){let r=t.surface;if(!r){if(e&&e.surfaceId){r=this.getSurfaceManager().getSurface(e.surfaceId)}else r=null;t.surface=r}return r}_getIsolatedNodes(e,t){let r=t.isolatedNodes;if(!r){if(r=[],e&&e.surfaceId){let t=this.getSurfaceManager().getSurface(e.surfaceId);t&&(r=t.getComponentPath().filter(e=>e._isAbstractIsolatedNodeComponent))}t.isolatedNodes=r}return r}_shouldConsumeEvent(e){let t=Oh.unwrap(e.target);return this._getIsolatedNode(t)===this}_getIsolatedNode(e){return e._isAbstractIsolatedNodeComponent?this:e.context.isolatedNodeComponent?e.context.isolatedNodeComponent:e.context.surface?e.context.surface.context.isolatedNodeComponent:void 0}get _isAbstractIsolatedNodeComponent(){return!0}}const Wh="X",Yh="/".charCodeAt(0);class Zh extends Xh{render(e){const t=this.props.node,r=this.ContentClass,n=this.props.disabled;let s=e("div");s.addClass(this.getClassNames()).addClass("sc-isolated-node").addClass("sm-"+this.props.node.type).attr("data-id",t.id),n&&s.addClass("sm-disabled"),this.state.mode&&s.addClass("sm-"+this.state.mode),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown);const i="closed"===this.blockingMode&&!this.state.unblocked;s.append(e("div").addClass("se-bracket sm-left").ref("left").append(Wh));let o=this.renderContent(e,t,{disabled:this.props.disabled||i}).ref("content");return o.attr("contenteditable",!1),s.append(o),s.append(e(Qh).ref("blocker")),s.append(e("div").addClass("se-bracket sm-right").ref("right").append(Wh)),i||(s.addClass("sm-no-blocker"),s.on("click",this.onClick).on("dblclick",this.onDblClick)),s.on("mousedown",this._reserveMousedown,this),s}getClassNames(){return""}getContent(){return this.refs.content}selectNode(){const e=this.getEditorSession(),t=this.getParentSurface(),r=this.props.node.id;e.setSelection({type:"node",nodeId:r,containerId:t.getContainerId(),surfaceId:t.id})}onClick(e){e.stopPropagation()}onDblClick(e){e.stopPropagation()}grabFocus(e){let t=this.refs.content;if(t.grabFocus)return t.grabFocus(e),!0}_reserveMousedown(e){e.__reserved__||(e.__reserved__=this)}_deriveStateFromSelectionState(e,t){const r=this._getSurfaceForSelection(e,t),n=this.getParentSurface();let s={mode:null,unblocked:null};if(!r)return s;if(r===n){let t=this.props.node.id;e.isNodeSelection()&&e.getNodeId()===t&&(e.isFull()?(s.mode="selected",s.unblocked=!0):e.isBefore()?(s.mode="cursor",s.position="before"):e.isAfter()&&(s.mode="cursor",s.position="after")),e.isContainerSelection()&&e.containsNode(t)&&(s.mode="co-selected")}else{let t=e.surfaceId,r=this.getId();if(r.length<t.length&&t.startsWith(r)&&t.charCodeAt(r.length)===Yh){t.slice(r.length+1).indexOf("/")>0?(s.mode="co-focused",s.unblocked=!0):(s.mode="focused",s.unblocked=!0)}}return s}get _isIsolatedNodeComponent(){return!0}static getDOMCoordinate(e,t){let{start:r,end:n}=Zh.getDOMCoordinates(e);return 0===t.offset?r:n}static getDOMCoordinates(e){const t=e.refs.left,r=e.refs.right;return{start:{container:t.getNativeElement(),offset:0},end:{container:r.getNativeElement(),offset:r.getChildCount()}}}static getCoordinate(e,t){let r,n=Oh.unwrap(e,"strict").context.isolatedNodeComponent,s=null;return"left"===t.direction||e===n.refs.left.el?s=0:"right"!==t.direction&&e!==n.refs.right.el||(s=1),null!==s&&((r=new Si([n.props.node.id],s))._comp=n),r}}class Qh extends Oh{render(e){return e("div").addClass("sc-isolated-node-blocker").attr("draggable",!0).attr("contenteditable",!1).on("click",this.onClick).on("dblclick",this.onDblClick)}onClick(e){if(e.target!==this.getNativeElement())return;e.stopPropagation();const t=this._getIsolatedNodeComponent();t.extendState({mode:"selected",unblocked:!0}),t.selectNode()}onDblClick(e){e.stopPropagation()}_getIsolatedNodeComponent(){return this.context.isolatedNodeComponent}}const ed=!1;class td{constructor(e){this.editor=e,w.inBrowser&&(this.wRange=window.document.createRange()),this.state={dom:null,model:null}}getSelection(e){if(!w.inBrowser)return;let t=this.mapDOMSelection(e);return this.editor.getDocument()._createSelectionFromRange(t)}getSelectionForDOMRange(e){let t=this.mapDOMRange(e);return this.editor.getDocument()._createSelectionFromRange(t)}mapDOMSelection(e){let t,r=window.getSelection(),n=this.state;if(ed&&console.info("DOM->Model: ",r.anchorNode,r.anchorOffset,r.focusNode,r.focusOffset),0===r.rangeCount)return i();let s=nh.wrapNativeElement(r.anchorNode);if(r.isCollapsed){let n=this._getCoordinate(s,r.anchorOffset,e);if(!n)return i();t=rd({start:n,end:n})}else{let n=nh.wrapNativeElement(r.focusNode);t=this._getRange(s,r.anchorOffset,n,r.focusOffset,e)}return ed&&console.info("DOM->Model: range ",t?t.toString():null),n.model=t,t;function i(){return n.dom=null,n.model=null,null}}setSelection(e){if(!w.inBrowser)return;let t=this.state,r=window.getSelection(),n=this.wRange;if(!e||e.isNull())return this.clear();let{start:s,end:i}=this.mapModelToDOMCoordinates(e);if(!s)return this.clear();e.isReverse()&&([s,i]=[i,s]),t.dom={anchorNode:s.container,anchorOffset:s.offset,focusNode:i.container,focusOffset:i.offset},function({anchorNode:e,anchorOffset:t,focusNode:s,focusOffset:i}){r.removeAllRanges(),n.setStart(e,t),n.setEnd(e,t),r.addRange(n),(s!==t||i!==t)&&r.extend(s,i)}(t.dom)}mapModelToDOMCoordinates(e){let t;ed&&console.info("Model->DOM: sel =",e.toString());let r,n,s=this.editor.getSurfaceManager().getSurface(e.surfaceId);if(s?t=s.el:(console.warn("No surface:",e.surfaceId),t=this.editor.getElement()),e.isNull()||e.isCustomSelection())return{};if(e.isPropertySelection()||e.isContainerSelection()){if(!(r=this._getDOMCoordinate(t,e.start)))return console.warn("FIXME: selection seems to be invalid."),{};if(e.isCollapsed())n=r;else if(!(n=this._getDOMCoordinate(t,e.end)))return console.warn("FIXME: selection seems to be invalid."),{}}else if(e.isNodeSelection()){let s=Oh.unwrap(t.find('*[data-id="'+e.getNodeId()+'"]'));if(!s)return console.error("Could not find component with id",e.getNodeId()),{};if(s._isIsolatedNodeComponent){let t=Zh.getDOMCoordinates(s,e);r=t.start,n=t.end}else{let e=s.el;r={container:e.getNativeElement(),offset:0},n={container:e.getNativeElement(),offset:e.getChildCount()}}}return ed&&console.info("Model->DOM:",r.container,r.offset,n.container,n.offset,"isReverse?",e.isReverse()),{start:r,end:n}}_getDOMCoordinate(e,t){let r,n=null;if(t.isNodeCoordinate()){if(r=Oh.unwrap(e.find('*[data-id="'+t.getNodeId()+'"]')))if(r._isIsolatedNodeComponent)n=Zh.getDOMCoordinate(r,t);else{let e=0;t.offset>0&&(e=r.getChildCount()),n={container:r.getNativeElement(),offset:e}}}else(r=Oh.unwrap(e.find('.sc-text-property[data-path="'+t.path.join(".")+'"]')))&&(n=r.getDOMCoordinate(t.offset));return n}mapDOMRange(e,t){return this._getRange(nh.wrapNativeElement(e.startContainer),e.startOffset,nh.wrapNativeElement(e.endContainer),e.endOffset,t)}clear(){window.getSelection().removeAllRanges(),this.state.dom=null,this.state.model=null}collapse(e){let t,r=window.getSelection();r.rangeCount>0&&((t=r.getRangeAt(0)).collapse("left"===e),r.removeAllRanges(),r.addRange(t))}select(e){let t=window.getSelection(),r=window.document.createRange();r.selectNode(e.getNativeElement()),t.removeAllRanges(),t.addRange(r)}extend(e,t){window.getSelection().extend(e.getNativeElement(),t)}setCursor(e,t){let r=window.getSelection(),n=window.document.createRange();n.setStart(e.getNativeElement(),t),r.removeAllRanges(),r.addRange(n)}_getRange(e,t,r,n,s={}){let i,o,a=nh.isReverse(e,t,r,n);return e===r&&t===n?i=o=this._getCoordinate(e,t,s):(i=this._getCoordinate(e,t,{direction:a?"right":"left"}),o=this._getCoordinate(r,n,s)),i&&o?rd({start:i,end:o,isReverse:a}):null}_getCoordinate(e,t,r={}){let n=null;n||(n=Jh.getCoordinate(this.editor.getElement(),e,t));let s=Oh.unwrap(e);if(!n&&s&&s.context.isolatedNodeComponent&&(n=Zh.getCoordinate(e,r)),!n)if(s&&s._isContainerEditor){let e=0===t?0:t-1,r=0===t,i=s.getContainer().getNodeAt(e),o=s.getChildAt(e);(n=new Si([i.id],r?0:1))._comp=o}else if(e.isElementNode()&&e.getChildCount()>0){let r,s=t>0?e.getChildAt(t-1):e.firstChild,i=Oh.unwrap(s);i&&i._isTextPropertyComponent&&(r=s),r&&(n=Jh.getCoordinate(e,r,t>0?r.getChildCount():0))}return n}}function rd({start:e,end:t,isReverse:r}){if(r&&([e,t]=[t,e]),!e._comp||!t._comp)return console.error("FIXME: getCoordinate() should provide a component instance"),null;let n=e._comp.context.surface;return n?n!==t._comp.context.surface?(console.error("Coordinates are within two different surfaces. Can not create a selection."),null):new qh(e,t,r,n.getContainerId(),n.id):(console.error("FIXME: Editable components should have their surface in the context"),null)}class nd{constructor(e,t){this.editorSession=e,this.context=t,this.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.editorSession.off(this)}triggerFetch(e){e.fetchPayload(this.context,(t,r)=>{t?this._updateNode(e.id,{errorMessage:t.toString()}):this._updateNode(e.id,r)})}_onDocumentChange(e){let t=this.editorSession.getDocument();r(e.created,(e,r)=>{let n=t.get(r);n.constructor.isResource&&setTimeout(()=>{this.triggerFetch(n)})})}_updateNode(e,t){this.editorSession.transaction(n=>{r(t,(t,r)=>{n.set([e,r],t)})})}}class sd extends Oh{constructor(...e){super(...e),this._initialize(this.props)}didMount(){this.getEditorSession().attachEditor(this)}dispose(){this._dispose()}_initialize(e){const t=e.editorSession;if(!t)throw new Error("EditorSession instance required");this.editorSession=t,this.doc=t.getDocument();let r=t.getConfigurator();this.componentRegistry=r.getComponentRegistry(),this.commandGroups=r.getCommandGroups(),this.keyboardShortcuts=r.getKeyboardShortcutsByCommand(),this.tools=r.getTools(),this.labelProvider=r.getLabelProvider(),this.iconProvider=r.getIconProvider(),this.surfaceManager=t.surfaceManager,this.commandManager=t.commandManager,this.dragManager=t.dragManager,this.macroManager=t.macroManager,this.converterRegistry=t.converterRegistry,this.globalEventHandler=t.globalEventHandler,this.editingBehavior=t.editingBehavior,this.markersManager=t.markersManager,this.resourceManager=new nd(t,this.getChildContext()),this.domSelection=new td(this),this.labelProvider.setLanguage(t.getLanguage()),t.onUpdate("lang",e=>{this.labelProvider.setLanguage(e)},this),t.onRender("lang",this.rerender,this)}willReceiveProps(e){let t=e.editorSession;t&&t!==this.editorSession&&(this._dispose(),this._initialize(e))}_dispose(){const e=this.getEditorSession();e.off(this),e.detachEditor(this),this.empty(),this.resourceManager.dispose()}getChildContext(){return{editor:this,editorSession:this.editorSession,configurator:this.editorSession.getConfigurator(),doc:this.doc,document:this.doc,componentRegistry:this.componentRegistry,surfaceManager:this.surfaceManager,domSelection:this.domSelection,commandManager:this.commandManager,markersManager:this.markersManager,converterRegistry:this.converterRegistry,dragManager:this.dragManager,editingBehavior:this.editingBehavior,globalEventHandler:this.globalEventHandler,iconProvider:this.iconProvider,labelProvider:this.labelProvider,resourceManager:this.resourceManager,commandGroups:this.commandGroups,tools:this.tools,keyboardShortcuts:this.keyboardShortcuts}}onKeyDown(e){if("Dead"===e.key)return;return this.editorSession.keyboardManager.onKeydown(e)}getDocument(){return this.editorSession.getDocument()}getConfigurator(){return this.editorSession.getConfigurator()}getEditorSession(){return this.editorSession}getComponentRegistry(){return this.componentRegistry}getSurfaceManager(){return this.surfaceManager}getLabelProvider(){return this.labelProvider}}const id={};class od{constructor(e,t){this.entries={},this.names=[],this.validator=t,e&&r(e,function(e,t){this.add(t,e)}.bind(this))}contains(e){return this.entries.hasOwnProperty(e)}add(e,t){if(this.validator&&this.validator(t),id[e])throw new Error('Illegal key: "'+e+'" is a property of Object which is thus not allowed as a key.');this.contains(e)&&this.remove(e),this.entries[e]=t,this.names.push(e)}remove(e){let t=this.names.indexOf(e);t>=0&&this.names.splice(t,1),delete this.entries[e]}clear(){this.names=[],this.entries={}}get(e,t){let r=this.entries[e];if(t&&!r)throw new Error("No entry registered for name "+e);return r}forEach(e){for(let t=0;t<this.names.length;t++){let r=this.names[t];if(!1===e(this.entries[r],r))break}}map(e){let t=[];return this.forEach((r,n)=>{t.push(e(r,n))}),t}filter(e){let t=[];return this.forEach(function(r,n){e(r,n)&&t.push(r)}),t}values(){return this.filter(()=>!0)}get _isRegistry(){return!0}}class ad{constructor(e,t){if(!e.editorSession)throw new Error("EditorSession required.");this.editorSession=e.editorSession,this.commands=t,this.context=Object.assign({},e,{doc:this.editorSession.getDocument()}),this._initialize(),this.editorSession.on("pre-render",this._onSessionUpdate,this),this._updateCommandStates(this.editorSession)}dispose(){this.editorSession.off(this)}executeCommand(e,t,r){let n=this._getCommand(e);if(!n)return void console.warn("command",e,"not registered");let s=this.editorSession.getCommandStates()[e],i=Object.assign(this._getCommandParams(),t,{commandState:s});if(!n.isAsync){return n.execute(i,this._getCommandContext())}this.editorSession.lock(),n.execute(i,this._getCommandContext(),(e,t)=>{e?r?r(e):console.error(e):r&&r(null,t),this.editorSession.unlock()})}_initialize(){this.commandRegistry=new od,r(this.commands,e=>{this.commandRegistry.add(e.name,e)})}_getCommand(e){return this.commandRegistry.get(e)}_updateCommandStates(e){const t=this._getCommandContext(),r=this._getCommandParams(),n=r.surface,s=this.commandRegistry;let i={},o=s.names.slice();if(o.forEach(e=>{i[e]={disabled:!0}}),n){let e=n.props.commands,t=n.props.excludedCommands;e?o=e.filter(e=>s.contains(e)):t&&(o=ks(o,...t))}o.map(e=>s.get(e)).forEach(e=>{e&&(i[e.getName()]=e.getCommandState(r,t))}),this.commandStates=i,e.setCommandStates(i)}_onSessionUpdate(){const e=this.editorSession;(e.hasChanged("change")||e.hasChanged("selection")||e.hasChanged("commandStates"))&&this._updateCommandStates(e)}_getCommandContext(){return this.context}_getCommandParams(){let e=this.context.editorSession;return{editorSession:e,selectionState:e.getSelectionState(),selection:e.getSelection(),surface:e.getFocusedSurface()}}}class ld extends od{register(e){var t=e.prototype.type;if("string"!=typeof t||""===t)throw new Error("Node names must be strings and must not be empty");if(!e.prototype._isNode)throw new Error("Nodes must be subclasses of Substance.Data.Node");this.contains(t)&&(console.info("Overriding node type",t),this.remove(t)),this.add(t,e)}}class cd{constructor(e,t){this.name=e,this.definition=t,Object.freeze(this),Object.freeze(t)}isArray(){return _(this.definition.type)}isReference(){return this.isArray()?"id"===wi(this.definition.type):"id"===this.definition.type}isText(){return Boolean(this.definition._isText)}isOwned(){return Boolean(this.definition.owned)}isOptional(){return this.definition.optional||this.hasDefault()}isNotNull(){return Boolean(this.definition.notNull)}hasDefault(){return this.definition.hasOwnProperty("default")}getDefault(){return this.definition.default}createDefaultValue(){if(_(this.definition.type))return[];switch(this.definition.type){case"object":return{};case"number":return-1;case"coordinate":return new Si([],0);case"boolean":return!1;case"id":return null;case"string":return"";default:return null}}get type(){return this.definition.type}get targetTypes(){return this.definition.targetTypes}}class hd{constructor(e,t){this.properties=e,this._superTypes=t,this._ownedPropNames=new Set,this._ownedProps=[],r(e,e=>{(e.isReference()&&e.isOwned()||"file"===e.type)&&(this._ownedPropNames.add(e.name),this._ownedProps.push(e))})}getProperty(e){return this.properties[e]}hasOwnedProperties(){return this._ownedPropNames.size>0}getOwnedProperties(){return this._ownedProps.slice()}isOwned(e){return this._ownedPropNames.has(e)}getSuperType(){return this._superTypes[0]}getSuperTypes(){return this._superTypes.slice()}[Symbol.iterator](){const e=this.properties;let t=Object.keys(e),r=0;return{next(){let n=r>t.length-1;return n?{done:n}:{value:e[t[r++]]}}}}}const dd=new Set(["string","number","boolean","object","array","coordinate"]);class ud extends l{constructor(...e){super(),this._initialize(...e)}_initialize(e){let t=this.constructor.schema;for(let r of t){let t=r.name;const n=void 0!==e[t],s=r.isOptional(),i=r.hasDefault();if(!s&&!n)throw new Error("Property "+t+" is mandatory for node type "+this.type);n?this[t]=gd(r,e[t]):i&&(this[t]=v(gd(r,r.getDefault())))}}dispose(){this._disposed=!0}isDisposed(){return Boolean(this._disposed)}isInstanceOf(e){return ud.isInstanceOf(this.constructor,e)}getSchema(){return this.constructor.schema}getTypeNames(){let e=this.constructor,t=this.schema.getSuperTypes();return e.hasOwnProperty("type")&&t.unshift(e.type),t}getPropertyType(e){return this.constructor.schema.getProperty(e).type}toJSON(){var e={type:this.type};const t=this.getSchema();for(let r of t){let t=this[r.name];r.isOptional()&&void 0===t||((_(t)||s(t))&&(t=v(t)),e[r.name]=t)}return e}get type(){return this.constructor.type}static isInstanceOf(e,t){let r=e.schema;if(!r)return!1;if(e.type===t)return!0;for(let e of r._superTypes)if(e===t)return!0;return!1}get _isNode(){return!0}static define(e){pd(e)}static defineSchema(e){pd(e)}}function pd(e){console.error("DEPRECATED: use 'Node.schema = {...}' instead");this.schema=e}function fd(e){return dd.has(e)}function gd(e,t){let r,n=e.name;if(r=e.isArray()?"array":e.type,null===t){if(e.isNotNull())throw new Error("Value for property "+n+" is null.");return t}if(void 0===t)throw new Error("Value for property "+n+" is undefined.");if("string"===r&&!E(t)||"boolean"===r&&!ch(t)||"number"===r&&!C(t)||"array"===r&&!_(t)||"id"===r&&!E(t)||"object"===r&&!s(t))throw new Error("Illegal value type for property "+n+": expected "+r+", was "+typeof t);return t}function md(e){var t=[];let r=_d(e);for(;r&&"@node"!==r.type;)r.hasOwnProperty("type")&&t.push(r.type),r=_d(r);return t}function _d(e){var t=Object.getPrototypeOf(e.prototype);if(t)return t.constructor}Object.defineProperty(ud,"schema",{get(){let e=this;if(!e.hasOwnProperty("_schema")){let t=_d(e).schema;e._schema=new hd(t.properties,md(e))}return e._schema},set(e){let t=this;e.type&&(t.type=e.type),t._schema=function(e,t){let n=[function(e){let t={};return r(e,function(e,r){"type"!==r&&((e=function(e){let t=Object.assign({},e),r=e.type;if(_(r)){let e=r,n=e.length-1,s=e[0],i=e[n],o="array"===s;o?(t.type=e.slice(),"id"===i||fd(i)||(t.targetTypes=[i],t.type[n]="id")):e.length>1?(e.forEach(e=>{if(fd(e))throw new Error("Multi-types must consist of node types.")}),t.type=["array","id"],t.targetTypes=e):fd(s)?t.type=["array",s]:(t.type=["array","id"],t.targetTypes=e)}else"text"===r?t={type:"string",default:"",_isText:!0,targetTypes:e.targetTypes}:"id"===r||fd(r)||(t.type="id",t.targetTypes=[r]);return t}(e=E(e)||_(e)?{type:e}:v(e))).name=r,t[r]=new cd(r,e))}),t}(t)],s=_d(e);for(;s;)s&&s._schema&&n.unshift(s._schema.properties),s=_d(s);n.unshift({});let i=md(e);return new hd(Object.assign.apply(null,n),i)}(t,e)}}),ud.schema={type:"@node",id:"string"};class yd{constructor(e,t){if(!e)throw new Error("'name' is mandatory");if(!t)throw new Error("'version' is mandatory");this.name=e,this.version=t,this.nodeRegistry=new ld,this.tocTypes=[],this.addNodes(this.getBuiltIns())}addNodes(e){e&&r(e,function(e){e.prototype._isNode?this.addNode(e):console.error("Illegal node class: ",e)}.bind(this))}addNode(e){this.nodeRegistry.register(e),e.tocType&&this.tocTypes.push(e.type)}getNodeClass(e,t){return this.nodeRegistry.get(e,t)}getBuiltIns(){return[]}isInstanceOf(e,t){var r=this.getNodeClass(e);return!!r&&ud.isInstanceOf(r,t)}each(...e){return this.nodeRegistry.each(...e)}getTocTypes(){return this.tocTypes}getDefaultTextType(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")}getNodeSchema(e){var t=this.getNodeClass(e);return t?t.schema:(console.error("Unknown node type ",e),null)}}class wd extends ud{_initialize(e,t){this.document=e,super._initialize(t)}getDocument(){return this.document}hasParent(){return Boolean(this.parent)}getParent(){return E(this.parent)?this.document.get(this.parent):this.parent}setParent(e){E(e)&&(e=this.document.get(e)),this.parent=e}getRoot(){let e=this;for(;e.parent;)e=e.parent;return e}getContainerRoot(){let e=this;for(;e.parent;){if(e.parent.isContainer())return e;e=e.parent}return e}hasChildren(){return!1}getChildIndex(e){return-1}getChildAt(e){return null}getChildCount(){return 0}isAnchor(){return this.constructor.isAnchor()}isAnnotation(){return this.constructor.isAnnotation()}isBlock(){return this.constructor.isBlock()}isContainer(){return this.constructor.isContainer()}isContainerAnnotation(){return this.constructor.isContainerAnnotation()}isInlineNode(){return this.constructor.isInlineNode()}isList(){return this.constructor.isList()}isListItem(){return this.constructor.isListItem()}isPropertyAnnotation(){return this.constructor.isPropertyAnnotation()}isText(){return this.constructor.isText()}static isAnchor(){return!1}static isAnnotation(){return!1}static isBlock(){return!1}static isContainer(){return!1}static isContainerAnnotation(){return!1}static isInlineNode(){return!1}static isList(){return!1}static isListItem(){return!1}static isPropertyAnnotation(){return!1}static isText(){return!1}get _isDocumentNode(){return!0}}class bd{constructor(e,t){this.pos=e,this.offset=t}isBefore(e,t){return t=Boolean(t),this.pos<e.pos||!(this.pos>e.pos)&&(this.offset<e.offset||!(this.offset>e.offset)&&!t)}isAfter(e,t){return e.isBefore(this,t)}isEqual(e){return this.pos===e.pos&&this.offset===e.offset}toString(){return[this.pos,".",this.offset].join("")}}function vd(e,t){if(!e)return[];if(e.constructor.prototype.filter&&no(e.constructor.prototype.filter))return e.filter(t);let n=[];return r(e,(e,r)=>{t(e,r)&&n.push(e)}),n}class Cd{select(e){throw new Error("This method is abstract.")}clear(){throw new Error("This method is abstract")}create(e){throw new Error("This method is abstract.")}delete(e){throw new Error("This method is abstract.")}set(e,t,r,n){this.update(e,t,r,n)}update(e,t,r,n){throw new Error("This method is abstract.")}reset(e){this.clear(),this._initialize(e)}clone(){return new(0,this.constructor)}_initialize(e){r(e.getNodes(),function(e){this.select(e)&&this.create(e)}.bind(this))}}Cd.create=function(e){var t=Object.assign(new Cd,e);return t.clone=function(){return Cd.create(e)},t},Cd.filterByType=function(e){return function(t){return t.isInstanceOf(e)}};class Sd extends Cd{}var xd={insertedText:function(e,t,r){if(!r)return;var n=e.getIndex("annotations").get(t.path);for(let c=0;c<n.length;c++){let h=n[c];var s=t.offset,i=h.start.offset,o=h.end.offset,a=i,l=o;(s<i||s===i)&&(a+=r),(s<o||s===o&&!h.isInlineNode())&&(l+=r),a!==i&&e.set([h.id,"start","offset"],a),l!==o&&e.set([h.id,"end","offset"],l)}},deletedText:function(e,t,r,n){if(r===n)return;var s=e.getIndex("annotations").get(t),i=n-r;for(let t=0;t<s.length;t++){let u=s[t];var o=r,a=n,l=u.start.offset,c=u.end.offset,h=l,d=c;a<=l?(h-=i,d-=i,e.set([u.id,"start","offset"],h),e.set([u.id,"end","offset"],d)):(o<=l&&(h=l-Math.min(a-o,l-o)),o<=c&&(d=c-Math.min(a-o,c-o)),l!==c&&h===d?e.delete(u.id):(l!==h&&e.set([u.id,"start","offset"],h),c!==d&&e.set([u.id,"end","offset"],d)))}},transferAnnotations:function(e,t,r,n,s){var i=e.getIndex("annotations").get(t,r);for(let t=0;t<i.length;t++){let c=i[t];var o=r>c.start.offset&&r<c.end.offset,a=c.start.offset,l=c.end.offset;if(o){if(c.canSplit()){let t=c.toJSON();t.id=d(c.type+"_"),t.start.path=n,t.start.offset=s,t.end.path=n,t.end.offset=s+c.end.offset-r,e.create(t)}let t=c.start.offset,i=r;i===t?e.delete(c.id):(t!==a&&e.set([c.id,"start","offset"],t),i!==l&&e.set([c.id,"end","offset"],i))}else c.start.offset>=r&&(e.set([c.id,"start","path"],n),e.set([c.id,"start","offset"],s+c.start.offset-r),e.set([c.id,"end","path"],n),e.set([c.id,"end","offset"],s+c.end.offset-r))}},expandAnnotation:Ed,fuseAnnotation:function(e,t){if(!_(t)||t.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");let r,n;t.forEach(function(e,t){if(0===t)r=e.getSelection(),n=e.type;else{if(e.type!==n)throw new Error("fuseAnnotation(): all annotations must be of the same type.");r=r.expand(e.getSelection())}});for(var s=1;s<t.length;s++)e.delete(t[s].id);Ed(e,t[0],r),e.setSelection(r)},truncateAnnotation:function(e,t,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!t||!t.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=t.getSelection().truncateWith(r);return t._updateRange(e,n),t}};function Ed(e,t,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!t||!t.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=t.getSelection().expand(r);return t._updateRange(e,n),t}function Nd(e,t,r){if(r=r||{},!t.isPropertySelection())return[];let n=t.getPath(),s=e.getIndex("annotations").get(n,t.start.offset,t.end.offset);return r.type&&(s=vd(s,Sd.filterByType(r.type))),s}function Td(e,t,r,n){if(!r)throw new Error("'containerId' is required.");n=n||{};let s=e.getIndex("container-annotations"),i=[];return s&&(i=vd(i=s.get(r,n.type),function(e){return t.overlaps(e.getSelection())})),i}function Id(e,t){if(!t||t.isNull())return"";if(t.isPropertySelection()){return e.get(t.start.path).substring(t.start.offset,t.end.offset)}if(t.isContainerSelection()){let r=[],n=t.getNodeIds(),s=n.length;for(let i=0;i<s;i++){let o=n[i],a=e.get(o);if(a.isText()){let e=a.getText();i===s-1&&(e=e.slice(0,t.end.offset)),0===i&&(e=e.slice(t.start.offset)),r.push(e)}}return r.join("\n")}}function Ad(e,t){if(!t||!t.isPropertySelection())return[];const r=t.getPath();return vd(e.getIndex("markers").get(r),function(e){return e.containsSelection(t)})}function Dd(e,t){if(!t)return void console.warn("Invalid arguments");if(t.isText()){let r=e.getIndex("annotations").get(t.id);for(let t=0;t<r.length;t++)e.delete(r[t].id)}let r=t.getSchema();e.delete(t.id),r.getOwnedProperties().forEach(r=>{let n=t[r.name];if(r.isArray()){let t=n;t.length>0&&(_(t[0])&&(t=lh(t,2)),t.forEach(t=>{Dd(e,e.get(t))}))}else Dd(e,e.get(n))})}function Od(e){let t=[],n=e.getDocument(),s=e.getSchema();for(let r of s)if(r.isReference()&&r.isOwned()||"file"===r.type){let n=e[r.name];t.push(i(n))}return t.push(e.toJSON()),r(e.getDocument().getIndex("annotations").get([e.id]),function(e){t.push(e.toJSON())}),ah(t).filter(Boolean);function i(e){if(!e)return null;if(_(e))return ah(e.map(i));{let t=e;if(!t)return null;let r=n.get(t);if(!r)return;return Od(r)}}}function Pd(e,t,r){t||(t={path:r.path,offset:0});let n=t.path,s=e.get(n);if(r||(r={path:t.path,offset:s.length}),!Ci(t.path,r.path))throw new Error("start and end must be on one property");let i=t.offset;if(i<0)throw new Error("start offset must be >= 0");let o=r.offset;if(o>s.length)throw new Error("end offset must be smaller than the text length");e.update(n,{type:"delete",start:i,end:o}),e.getAnnotations(n).forEach(function(t){let r=t.start.offset,n=t.end.offset;n<=i||(r>=o?(e.update([t.id,"start"],{type:"shift",value:i-o}),e.update([t.id,"end"],{type:"shift",value:i-o})):r>=i&&n<=o?e.delete(t.id):r>=i&&n>=o?(r>i&&e.update([t.id,"start"],{type:"shift",value:i-r}),e.update([t.id,"end"],{type:"shift",value:i-o})):r<=i&&n<=o?e.update([t.id,"end"],{type:"shift",value:i-n}):r<i&&n>=o?e.update([t.id,"end"],{type:"shift",value:i-o}):console.warn("TODO: handle annotation update case."))})}function kd(e,t,r,n){let s,i;e!==t.getDocument()&&(t=e.get(t.id)),r?s=e.get(r.path[0]):r={path:(s=t.getItemAt(0)).getPath(),offset:0},n?i=e.get(n.path[0]):n={path:(i=t.getLastItem()).getPath(),offset:i.getLength()};let o=t.getItemPosition(s),a=t.getItemPosition(i);if(o===a)return void Pd(e,r,n);o>a&&([r,n]=[n,r],[o,a]=[a,o],[s,i]=[i,s]);let l=Pi(e,s,r,null),c=Pi(e,i,null,n);c?(t.removeItemAt(a),Dd(e,i)):Pd(e,null,n);let h=t.getItems();for(let r=a-1;r>o;r--){let n=h[r];t.removeItemAt(r),Dd(e,n)}Pd(e,r,null),l||c||Md(e,t.id,o)}function Md(e,t,r){let n=e.get(t),s=n.getItemAt(r),i=s.getPath(),o=s.getLength(),a=n.getItemAt(r+1),l=a.getPath();n.removeItemAt(r+1),e.update(i,{type:"insert",start:o,text:a.getText()}),xd.transferAnnotations(e,l,0,i,o),Dd(e,a)}function Ld(e,t){return t.map(t=>e.get(t,"strict"))}const Rd="snippet",qd="text-snippet";var Bd=Object.freeze({getPropertyAnnotationsForSelection:Nd,getContainerAnnotationsForSelection:Td,isContainerAnnotation:function(e,t){return e.getSchema().isInstanceOf(t,"@container-annotation")},getTextForSelection:Id,getMarkersForSelection:Ad,deleteNode:Dd,copyNode:Od,deleteTextRange:Pd,deleteListRange:kd,mergeListItems:Md,getNodes:Ld,SNIPPET_ID:Rd,TEXT_SNIPPET_ID:qd});function Fd(e){return class extends e{contains(e){return this.getPosition(e)>=0}getPosition(e,t){if(E(e)&&(e=this.document.get(e)),!e)return-1;let r=this._getPosition(e);if(t&&r<0)throw new Error("Node is not within this container: "+e.id);return r}getNodeAt(e){const t=this.getNodeIdAt(e);if(t)return this.getDocument().get(t)}getNodeIdAt(e){let t=this.getContent();return e<0||e>=t.length?void 0:t[e]}getNodes(){const e=this.getDocument();return this.getContent().map(t=>e.get(t)).filter(Boolean)}show(e,t){const r=arguments[0];return E(r)||r._isNode&&(e=r.id),arguments.length>1?console.error("DEPRECATED: use container.showAt(pos, nodeId) instead"):t=this.getLength(),this.showAt(t,e)}showAt(e,t){const r=this.getDocument(),n=this.getLength();if(!C(e)||e<0||e>n)throw new Error("Index out of bounds");if(!E(t)){if(!t._isNode)throw new Error("Invalid argument.");t=t.id}r.update(this.getContentPath(),{type:"insert",pos:e,value:t})}hide(e){const t=this.getPosition(e);this.hideAt(t)}hideAt(e){const t=this.getLength();if(!(e>=0&&e<t))throw new Error("Index out of bounds.");this.getDocument().update(this.getContentPath(),{type:"delete",pos:e})}getAddress(e){if(!e._isCoordinate)throw new Error("Illegal argument: Container.getAddress(coor) expects a Coordinate instance.");var t,r=e.path[0],n=this.getPosition(r);return t=e.isNodeCoordinate()?e.offset>0?Number.MAX_VALUE:0:e.offset,new bd(n,t)}getLength(){return this.getContent().length}get length(){return this.getLength()}_getPosition(e){return this._isCaching?this._getCachedPosition(e):this._lookupPosition(e)}_getCachedPosition(e){let t=this._cachedPositions||this._fillCache(),r=e.id,n=-1;return t.hasOwnProperty(r)?n=t[r]:(n=this._lookupPosition(e),t[r]=n),n}_fillCache(){let e={};return this.nodes.forEach((t,r)=>{e[t]=r}),this._cachedPositions=e,e}_invalidateCache(){this._cachedPositions=null}_lookupPosition(e){return e.hasParent()&&(e=e.getContainerRoot()),this.getContent().indexOf(e.id)}_enableCaching(){this.document&&(this.document.data.on("operation:applied",this._onOperationApplied,this),this._isCaching=!0)}_onOperationApplied(e){"set"!==e.type&&"update"!==e.type||e.path[0]===this.id&&this._invalidateCache()}_onDocumentChange(e){e.hasUpdated(this.getContentPath())&&this._invalidateCache()}hasChildren(){return this.getContent().length>0}getChildIndex(e){return this.getContent().indexOf(e.id)}getChildren(){return Ld(this.getDocument(),this.getContent())}getChildAt(e){var t=this.getContent();if(e<0||e>=t.length)throw new Error("Array index out of bounds: "+e+", "+t.length);return this.getDocument().get(t[e],"strict")}getChildCount(){return this.getContent().length}static isContainer(){return!0}}}class jd extends(Fd(wd)){constructor(...e){super(...e),this._enableCaching()}dispose(){this.document.off(this)}getContentPath(){return[this.id,"nodes"]}getContent(){return this.nodes}get _isContainer(){return!0}}function Hd(e){class t extends e{constructor(e,t){super(e,function(e){if(e.hasOwnProperty("start"))e.hasOwnProperty("end")&&!e.end.path&&(e.end.path=e.start.path);else{let t,r;(e.hasOwnProperty("startPath")||e.hasOwnProperty("path"))&&(t={path:e.startPath||e.path,offset:e.startOffset}),(e.hasOwnProperty("endPath")||e.hasOwnProperty("endOffset"))&&(r={path:e.endPath||e.path,offset:e.endOffset}),t&&!r&&(r=v(t)),t&&(delete(e=Object.assign({},e)).path,delete e.startPath,delete e.endPath,delete e.startOffset,delete e.endOffset,e.start=t,e.end=r)}return e}(t)),this.start=new Si(this.start),this.end=new Si(this.end)}get path(){return console.warn("DEPRECATED: use annotation.start.path instead"),this.start.path}getPath(){return this.start.path}get startPath(){return console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path}set startPath(e){console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path=e}get startOffset(){return console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset}set startOffset(e){console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset=e}get endPath(){return console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path}set endPath(e){console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path=e}get endOffset(){return console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset}set endOffset(e){console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset=e}getText(){var e=this.getDocument();return e?Id(e,this.getSelection()):(console.warn("Trying to use a Annotation which is not attached to the document."),"")}isAnnotation(){return!0}canSplit(){return!0}getSelection(){const e=this.getDocument();return e?this.isContainerAnnotation()?e.createSelection({type:"container",containerId:this.containerId,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset}):this.getDocument().createSelection({type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),bi.nullSelection())}_updateRange(e,t){if(t.isContainerSelection())S(this.start.path,t.start.path)||e.set([this.id,"start","path"],t.start.path),this.start.offset!==t.start.offset&&e.set([this.id,"start","offset"],t.start.offset),S(this.end.path,t.end.path)||e.set([this.id,"end","path"],t.end.path),this.end.offset!==t.end.offset&&e.set([this.id,"end","offset"],t.end.offset);else{if(!t.isPropertySelection())throw new Error("Invalid selection.");Ci(this.start.path,t.start.path)||e.set([this.id,"path"],t.start.path),this.start.offset!==t.start.offset&&e.set([this.id,"start","offset"],t.start.offset),this.end.offset!==t.end.offset&&e.set([this.id,"end","offset"],t.end.offset)}}static isAnnotation(){return!0}}return t.schema={start:{type:"coordinate",default:{path:[],offset:0}},end:{type:"coordinate",default:{path:[],offset:0}}},t}jd.schema={type:"@container",nodes:{type:["array","id"],default:[],owned:!0}};class Ud extends(Hd(wd)){get _isAnnotation(){return!0}get _isPropertyAnnotation(){return!0}static isPropertyAnnotation(){return!0}static get autoExpandRight(){return!0}}Ud.schema={type:"@annotation",_content:{type:"string",optional:!0}};class zd extends(Hd(wd)){setHighlighted(e,t){this.highlighted!==e&&(this.highlighted=e,this.highlightedScope=t,this.emit("highlighted",e,t),r(this.fragments,function(r){r.emit("highlighted",e,t)}))}static isAnnotation(){return!0}static isContainerAnnotation(){return!0}}zd.schema={type:"@container-annotation",containerId:"string",start:"coordinate",end:"coordinate"};class Vd extends yd{constructor(e){if(super(e.name,e.version),!e.DocumentClass)throw new Error("DocumentClass is mandatory");Object.assign(this,e)}getDocumentClass(){return this.DocumentClass}getDefaultTextType(){return this.defaultTextType}getBuiltIns(){return[wd,Ud,jd,zd]}}class Gd extends od{constructor(e){super(e,function(e){if(!e.prototype._isComponent)throw new Error("Component registry: wrong type. Expected a ComponentClass. Was: "+String(e))})}}class Jd extends Oh{render(e){return this.props.stack?e("span").addClass("fa-stack").append(this.props.stack.map(t=>e("i").addClass("fa "+t+" fa-stack"))):e("i").addClass("fa "+this.props.icon)}}class Kd{constructor(e){this.faMap={},this.textMap={},r(e,(e,t)=>{let r=e.fontawesome;r&&(E(r)&&(r={icon:r}),this.addFAIcon(t,r));let n=e.text;n&&this.addTextIcon(t,n)})}renderIcon(e,t){let r=this.faMap[t],n=this.textMap[t];return r?e(Jd,r):n||void 0}addFAIcon(e,t){this.faMap[e]=t}addTextIcon(e,t){this.textMap[e]=t}}class $d{constructor(e,t){this.lang=t||"en",this.labels=e}getLabel(e,t){let r=this.labels[this.lang];if(!r)return e;let n=r[e]||e;return t?this._evalTemplate(n,t):n}setLanguage(e){this.lang=e||"en"}_evalTemplate(e,t){return this._extractVariables(e).forEach(r=>{let n=new RegExp(`\\\${${r}}`,"g"),s=t[r];e=e.replace(n,s)}),e}_extractVariables(e){let t,r=/\${(\w+)}/g,n=[];for(;t=r.exec(e);)n.push(t[1]);return n}}function Xd(e){let t,r=e.clientX,n=e.clientY;if(document.body.createTextRange)(t=document.body.createTextRange()).moveToPoint(r,n);else if(!x(document.createRange))if(x(e.rangeParent))if(document.caretPositionFromPoint){let e=document.caretPositionFromPoint(r,n);(t=document.createRange()).setStart(e.offsetNode,e.offset),t.collapse(!0)}else document.caretRangeFromPoint&&(t=document.caretRangeFromPoint(r,n));else(t=document.createRange()).setStart(e.rangeParent,e.rangeOffset),t.collapse(!0);return t}function Wd(e,t){var r=t.left-e.left,n=t.top-e.top;return{left:r,top:n,right:e.width-r-t.width,bottom:e.height-n-t.height,width:t.width,height:t.height}}function Yd(e){if(w.inBrowser){const t=window.getSelection();if(0===t.rangeCount)return;const r=t.getRangeAt(0);let n=e,s=r.getBoundingClientRect();if(0===s.top&&0===s.bottom){let e=function(e,t){let r=e.anchorNode;if(!r||!r.getBoundingClientRect)return;let n=r.getBoundingClientRect();return{left:n.left,top:n.top,width:0,height:n.height,right:n.width,bottom:n.bottom}}(t);e&&(s=e)}return Wd(n,s)}}function Zd(e){let t=window.getSelection();if(0===t.rangeCount)return!1;let r=t.getRangeAt(0).getBoundingClientRect();return e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom}class Qd{match(e,t){return!1}drop(e,t){}get _isDragAndDropHandler(){return!0}}class eu extends l{constructor(e,t){super(),this.context=t;let r=[],n=[];e.forEach(e=>{switch(e.type||"drop-asset"){case"drop-asset":r.push(e);break;case"move-inline":n.push(e);break;default:console.warn("Unknown type of drop handler.",e)}}),this.dropHandlers=[new ru(n),new tu,new nu(r,this.context),new su],w.inBrowser&&(this.el=nh.wrapNativeElement(document),this.el.on("dragstart",this.onDragStart,this),this.el.on("drop",this.onDragEnd,this),this.el.on("dragenter",this.onDragEnter,this),this.el.on("dragexit",this.onDragExit,this),this.el.on("mousedown",this.onMousedown,this))}dispose(){this.el&&this.el.off(this)}onDragStart(e){this._initDrag(e,{external:!1});var t=document.createElement("img");t.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",e.dataTransfer.setDragImage(t,0,0),"inline"===this.dragState.mode?e.dataTransfer.setData("text/html",t.outerHTML):e.dataTransfer.setData("text/html","<div></div>")}onDragEnter(e){this.dragState||this._initDrag(e,{external:!0})}onDragEnd(e){e.__reserved__||this.dragState&&(e.stopPropagation(),e.preventDefault(),this._onDragEnd(e))}onDragExit(e){w.isFF||this._onDragEnd(e)}extendDragState(e){Object.assign(this.dragState,e)}onMousedown(e){this.dragState&&(this.dragState=null,this._onDragEnd(e))}_onDragEnd(e){this.dragState?this._handleDrop(e):console.warn("Not in a valid drag state."),this.emit("drag:finished"),this.dragState=null}_handleDrop(e){let t,r,n=this.dragState,s=!1;for(n.event=e,n.data=this._getData(e),t=0;t<this.dropHandlers.length&&!s;t++)s=(r=this.dropHandlers[t]).match(n);if(s){this.context.editorSession.transaction(e=>{r.drop(e,n)})}else console.error("No drop handler could be found.")}_initDrag(e,t){let r=this._getSelection(),n=Object.assign({startEvent:e},t);if(this.dragState=n,n.external)return n.selectionDrag=!1,n.sourceSelection=null,n.scrollPanes=this._getSurfacesGroupedByScrollPane(),void this.emit("drag:started",n);if((r.isPropertySelection()||r.isContainerSelection())&&Zd(e))return r.isContainerSelection()?(console.warn("Dragging of ContainerSelection is not supported yet."),a()):(n.inline=!0,n.selectionDrag=!0,void(n.sourceSelection=r));let s,i=Oh.unwrap(e.target);if(!i)return a();if(i._isInlineNodeComponent?(s=i,n.inline=!0,n.sourceNode=i.props.node):s=i.context.isolatedNodeComponent,!s)return a();let o=s.context.surface;if(s._isInlineNodeComponent){let e=s.props.node;return n.inline=!0,n.selectionDrag=!0,void(n.sourceSelection={type:"property",path:e.start.path,startOffset:e.start.offset,endOffset:e.end.offset,containerId:o.getContainerId(),surfaceId:o.id})}function a(){e.preventDefault(),e.stopPropagation()}n.selectionDrag=!1,n.nodeDrag=!0,n.sourceSelection={type:"node",nodeId:s.props.node.id,containerId:o.getContainerId(),surfaceId:o.id},n.scrollPanes=this._getSurfacesGroupedByScrollPane(),this.emit("drag:started",n)}_getSurfacesGroupedByScrollPane(){let e={};return this.context.surfaceManager.getSurfaces().forEach(t=>{if(!t.isContainerEditor())return;let r=t.context.scrollPane,n=r.getName(),s=t.getName();if(e[n])e[n].surfaces[s]=t;else{let i={};i[s]=t,e[n]={scrollPane:r,surfaces:i}}}),e}_getSelection(){return this.context.editorSession.getSelection()}_getComponents(e){let t=[],r=e;for(;r;){let e=Oh.getComponentForDOMElement(r);if(e&&(t.unshift(e),e._isSurface))return t;r=r.parentNode}return null}_getIsolatedNodeOrContainerChild(e){let t,r;for(t=(r=e).parentNode;t;){if(t._comp&&t._comp._isContainerEditor)return r._comp;if(r._comp&&r._comp._isIsolatedNode)return r._comp;t=(r=t).parentNode}}_extractUris(e){let t=[],r=e.getData("text/uri-list");return r&&(t=r.split("\n").filter(function(e){return!e.startsWith("#")})),t}_getData(e){let t=e.dataTransfer;if(t)return{files:Array.prototype.slice.call(t.files),uris:this._extractUris(t),text:t.getData("text/plain"),html:t.getData("text/html")}}}class tu extends Qd{match(e){let{insertPos:t}=e.dropParams;return!e.external&&e.nodeDrag&&"place"===e.dropType&&t>=0}drop(e,t){let{insertPos:r}=t.dropParams;e.setSelection(t.sourceSelection);let n=e.copySelection();e.deleteSelection({clear:!0});let s=t.targetSurface.getContainerId(),i=t.targetSurface.getName(),o=e.get(s),a=o.getNodeIdAt(r),l="before";a||(a=o.getNodeIdAt(r-1),l="after"),e.setSelection({type:"node",nodeId:a,mode:l,containerId:s,surfaceId:i}),e.paste(n)}}class ru extends Qd{match(e){return!e.external&&e.inline}drop(e,t){let r=t.event,n=t.sourceSelection,s=Xd(r);if(!s)return;let i=Oh.unwrap(r.target);if(!i)return;let o=i.context.domSelection;if(!o)return;let a=o.mapDOMRange(s);if(!a)return;let l=e.getDocument()._createSelectionFromRange(a);e.selection=n;let c=e.copySelection();e.deleteSelection(),e.selection=Ui(l,e),e.paste(c)}}class nu extends Qd{constructor(e,t){super(),this.assetHandlers=e,this.context=t}match(e){return"place"===e.dropType&&e.external}drop(e,t){let{insertPos:r}=t.dropParams,n=t.data.files,s=t.data.uris,i=t.targetSurface.getContainerId(),o=t.targetSurface.id,a=e.get(i),l=a.getNodeIdAt(r),c="before";l||(l=a.getNodeIdAt(r-1),c="after"),e.setSelection({type:"node",nodeId:l,mode:c,containerId:i,surfaceId:o}),n.length>0?n.forEach(t=>{this._callHandlers(e,{file:t,type:"file"})}):s.length>0?s.forEach(t=>{this._callHandlers(e,{uri:t,type:"uri"})}):console.info("TODO: implement html/text drop here")}_callHandlers(e,t){let r,n;for(r=0;r<this.assetHandlers.length;r++){if((n=this.assetHandlers[r]).match(t,this.context)){n.drop(e,t,this.context);break}}}}class su extends Qd{match(e){return"custom"===e.dropType}drop(e,t){t.component.handleDrop(e,t)}}class iu{constructor(e,t){this.extensions=e,this.proxies={},this.context=t;const n=t.editorSession;if(!n)throw new Error("'context.editorSession' is required.");r(n.getDocument().getNodes(),e=>{e._isFileNode&&this.storeFile(e)}),n.onUpdate("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}storeFile(e){let t=this.proxies[e.id];return t||(t=this.createFileProxy(e))&&(this.proxies[e.id]=t),e.proxy=t,t}createFileProxy(e){let t=this.context;for(var r=0;r<this.extensions.length;r++){let n=this.extensions[r];if(n.match(e,t))return new n(e,t)}console.error("No file adapter found for ",e)}getProxy(e){return this.proxies[e.id]}sync(){let e=g(this.proxies,e=>e.sync());return Promise.all(e)}_onDocumentChange(e){let t=this.context.editorSession.getDocument();r(e.created,(e,r)=>{let n=t.get(r);n._isFileNode&&this.storeFile(n)})}}const ou=["keydown","keyup","keypress","mousedown","mouseup","copy"];class au{constructor(){this.listeners=[],this.initialize()}initialize(){if(w.inBrowser){let e=nh.wrapNativeElement(window.document);ou.forEach(function(t){e.on(t,this._dispatch.bind(this,t),this)}.bind(this))}}dispose(){if(w.inBrowser){nh.wrapNativeElement(window.document).off(this)}}addEventListener(e,t,r){if(!r.id)throw new Error("GlobalEventHandler can only be used with option 'id'");let n=new oo(e,t,r);this.listeners.push(n)}removeEventListener(e){let t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}getEventListeners(){return this.listeners}_getActiveListener(e){const t=this.getSelection();if(t){let r=t.surfaceId;for(let t=0;t<this.listeners.length;t++){let n=this.listeners[t];if(n.eventName===e&&n.options.id===r)return n}}}_dispatch(e,t){const r=this._getActiveListener(e);r&&r.handler(t)}on(...e){return lo.prototype.on.apply(this,e)}off(...e){return lo.prototype.off.apply(this,e)}}class lu extends au{constructor(e){super(),this.editorSession=e}getSelection(){return this.editorSession.getSelection()}}function cu(e,t){let r=[];return e.altKey&&("AltRight"===e.code?r.push("ALTGR"):r.push("ALT")),e.ctrlKey&&r.push("CTRL"),e.metaKey&&r.push("META"),e.shiftKey&&r.push("SHIFT"),t||r.push(e.keyCode),r.join("+")}class hu{constructor(e){const t=e.editorSession;t&&(this.editorSession=t,this.selection=t.getSelection(),this.selectionState=t.getSelectionState(),this.surface=t.getFocusedSurface())}}class du{onKeydown(e,t){let r=cu(e),n=this._getBindings("keydown",r);if(n){t=t||this._getContext();let r=this._getParams(t),s=!1;for(let e=0;e<n.length&&!s;e++){s=(0,n[e])(r,t)}return s&&(e.preventDefault(),e.stopPropagation()),s}}onTextInput(e,t){let r=this._getBindings("textinput",e);if(r){t=t||this._getContext();let e=this._getParams(t),n=!1;for(let s=0;s<r.length&&!n;s++){n=(0,r[s])(e,t)}return n}}_getParams(e){return new hu(e)}_getBindings(e,t){throw new Error("This method is abstract")}_getContext(){throw new Error("This method is abstract")}}function uu(e){let t=e.split("+"),r={keyCode:-1};for(var n=0;n<t.length;n++){let s=t[n].toUpperCase();switch(s){case"ALT":r.altKey=!0;break;case"ALTGR":r.altKey=!0,r.code="AltRight";break;case"CMD":r.metaKey=!0;break;case"CTRL":r.ctrlKey=!0;break;case"COMMANDORCONTROL":w.isMac?r.metaKey=!0:r.ctrlKey=!0;break;case"MEDIANEXTTRACK":r.code="MediaTrackNext";break;case"MEDIAPLAYPAUSE":r.code="MediaPlayPause";break;case"MEDIAPREVIOUSTRACK":r.code="MediaPreviousTrack";break;case"MEDIASTOP":r.code="MediaStop";break;case"SHIFT":r.shiftKey=!0;break;case"SUPER":r.metaKey=!0;break;default:if(1===s.length)r.keyCode=s.charCodeAt(0);else{if(!$h.hasOwnProperty(s))throw new Error("Unsupported keyboard command: "+e);r.keyCode=$h[s]}}}return cu(r)}class pu extends du{constructor(e,t,r){super(),this.editorSession=e,this.context=r.context||{},this.keydownBindings={},this.textInputBindings={},t.forEach(({key:t,spec:r})=>{let n=r.type||"keydown";if(!r.command)throw new Error("Keyboard binding not supported",r);{let s=new fu(e,r.command),i=s.execute.bind(s);"keydown"===n?(t=uu(t),this.keydownBindings[t]||(this.keydownBindings[t]=[]),this.keydownBindings[t].push(i)):"textinput"===n&&(this.textInputBindings[t]=i)}})}_getBindings(e,t){switch(e){case"keydown":return this.keydownBindings[t];case"textinput":return this.textInputBindings[t];default:throw new Error("Unsupported keyboard event type")}}_getContext(){return this.context}static parseCombo(...e){return uu(...e)}}class fu{constructor(e,t){this.editorSession=e,this.commandName=t}execute(e){let t=e.editorSession.getCommandStates()[this.commandName];return!(!t||t.disabled)&&(this.editorSession.executeCommand(this.commandName,e),!0)}}class gu{constructor(e,t){this.context=e,this.macros=t,this.context.editorSession.onFinalize("document",this.onDocumentChanged,this)}dispose(){this.context.editorSession.off(this)}onDocumentChanged(e,t){this.executeMacros(e,t)}executeMacros(e,t){let r,n,s,i,o,a,l=this.context.editorSession.getDocument();switch(t.action){case"type":{let t=e.ops[0];"update"===t.type&&t.diff._isTextOperation&&(r=(a=t.path)[0],n=l.get(r),s=l.get(a),o=(i=t.diff.pos)+t.diff.getLength());break}case"break":{let t=e.before.selection;if(!t.isPropertySelection())return;if(r=(a=t.path)[0],!(n=l.get(r))||!n.isText())return;s=n.getText(),o=i=t.start.offset;break}case"paste":if(1===e.ops.length){let t=e.ops[0];if("update"===t.type&&"string"===t.propertyType){if(r=(a=t.path)[0],!(n=l.get(r)).isText())return;s=n.getText(),o=(i=t.diff.pos)+t.diff.getLength()}}break;default:return}let c={action:t.action,node:n,path:a,text:s,start:i,end:o,editorSession:this.context.editorSession,selection:this.context.editorSession.getSelection()};setTimeout(()=>{for(let e=0;e<this.macros.length;e++){if(this.macros[e].execute(c,this.context))break}})}}function mu(e,t){if(e)for(var r=0;r<e.length;r++)e[r]===t&&(e.splice(r,1),r--)}class _u{add(e,t){this[e]||(this[e]=[]),this[e].push(t)}remove(e,t){this[e]&&mu(this[e],t)}get(e){return this[e]||[]}}class yu extends Ud{_initialize(e,t){if(this.document=e,this.type=t.type,!t.type)throw new Error("'type' is mandatory");if(!t.start)throw new Error("'start' is mandatory");if(!t.end)throw new Error("'end' is mandatory");Object.assign(this,t)}containsSelection(e){return!e.isNull()&&(e.isPropertySelection()?Ci(this.start.path,e.start.path)&&this.start.offset<=e.start.offset&&this.end.offset>=e.end.offset:void console.warn("Marker.contains() does not support other selection types."))}get type(){return this._type}set type(e){this._type=e}get _isPropertyAnnotation(){return!1}get _isMarker(){return!0}}class wu{constructor(e){this.editorSession=e,this._textProperties={},this._dirtyProps={},this._markers=new bu(this),e.onUpdate("document",this._onChange,this),e.onRender(this._updateProperties,this)}dispose(){this.editorSession.off(this),this._markers.dispose()}setMarkers(e,t){this.clearMarkers(e),t.forEach(t=>this.addMarker(e,t))}addMarker(e,t){t._key=e,t._isMarker||(t=new yu(this.editorSession.getDocument(),t)),this._markers.add(t)}clearMarkers(e){this._markers.clear(e)}register(e){let t=String(e.getPath()),r=this._textProperties[t];r||(r=this._textProperties[t]=[]),r.push(e)}deregister(e){let t=String(e.getPath()),r=this._textProperties[t];r&&(mu(this._textProperties[t],e),0===r.length&&delete this._textProperties[t])}getMarkers(e,t){t=t||{};let r=this.editorSession.getDocument().getAnnotations(e)||[],n=this._markers.get(e,t.surfaceId,t.containerId);return r.concat(n)}_onChange(e){this._markers._onDocumentChange(e),this._recordDirtyTextProperties(e)}_recordDirtyTextProperties(e){r(e.updated,(e,t)=>{this._dirtyProps[t]=!0})}_updateProperties(){Object.keys(this._dirtyProps).forEach(e=>{let t=this._textProperties[e];t&&t.forEach(this._updateTextProperty.bind(this))}),this._dirtyProps={}}_updateTextProperty(e){let t=e.getPath(),r=this.getMarkers(t,{surfaceId:e.getSurfaceId(),containerId:e.getContainerId()});e.setState({markers:r})}}class bu{constructor(e){this._manager=e,this._byKey=new _u,this._documentMarkers=new _u,this._surfaceMarkers={},this._containerMarkers={}}get(e,t){let r=this._documentMarkers[e]||[];if(t&&this._surfaceMarkers[t]){let n=this._surfaceMarkers[t][e];n&&(r=r.concat(n))}return r}add(e){const t=e._key;this._byKey.add(t,e),this._add(e)}remove(e){const t=e._key;this._byKey.remove(t,e),this._remove(e)}clear(e){this._byKey.get(e).forEach(e=>{this._remove(e)})}_add(e){const t=this._manager._dirtyProps;switch(e.scope||"document"){case"document":{const r=e.start.path;t[r]=!0,this._documentMarkers.add(r,e);break}case"surface":{this._surfaceMarkers[e.surfaceId]||(this._surfaceMarkers[e.surfaceId]=new _u);const r=e.start.path;t[r]=!0,this._surfaceMarkers[e.surfaceId].add(r,e);break}case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}}_remove(e){const t=this._manager._dirtyProps;switch(e.scope||"document"){case"document":{const r=e.start.path;t[r]=!0,this._documentMarkers.remove(r,e);break}case"surface":{this._surfaceMarkers[e.surfaceId]||(this._surfaceMarkers[e.surfaceId]=new _u);const r=e.start.path;t[r]=!0,this._surfaceMarkers[e.surfaceId].remove(r,e);break}case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}}_getAllCustomMarkers(e){let t=this._documentMarkers[e]||[];for(let r in this._surfaceMarkers){if(!this._surfaceMarkers.hasOwnProperty(r))continue;let n=this._surfaceMarkers[r][e];n&&(t=t.concat(n))}return t}_onDocumentChange(e){e.ops.forEach(e=>{if("update"===e.type&&e.diff._isTextOperation){let t=this._getAllCustomMarkers(e.path),r=e.diff;switch(r.type){case"insert":this._transformInsert(t,r);break;case"delete":this._transformDelete(t,r)}}})}_transformInsert(e,t){const r=t.pos,n=t.str.length;0!==n&&e.forEach(e=>{var t=e.start.offset,s=e.end.offset,i=t,o=s;if(!(r>=s))return r<=t?(i+=n,o+=n,e.start.offset=i,void(e.end.offset=o)):void(r<s&&(o+=n,e.end.offset=o,this._remove(e)))})}_transformDelete(e,t){const r=t.pos,n=t.str.length,s=r+n;r!==s&&e.forEach(e=>{var t=e.start.offset,i=e.end.offset,o=t,a=i;if(s<=t)o-=n,a-=n,e.start.offset=o,e.end.offset=a;else if(r>=i);else{if(r<=t&&(o=t-Math.min(s-r,t-r)),r<=i&&(a=i-Math.min(s-r,i-r)),t!==i&&o===a)return void this._remove(e);t!==o&&(e.start.offset=o),i!==a&&(e.end.offset=a),this._remove(e)}})}}class vu{constructor(e){this.editorSession=e,this.surfaces={},this._state={selection:null},e.onUpdate("selection",this._onSelectionChanged,this),e.onPostRender(this._recoverDOMSelection,this)}dispose(){this.editorSession.off(this)}getSurface(e){if(e)return this.surfaces[e]}getFocusedSurface(){const e=this._state.selection;if(e&&e.surfaceId)return this.getSurface(e.surfaceId)}getSurfaces(){return Object.keys(this.surfaces).map(e=>this.surfaces[e])}registerSurface(e){const t=e.getId();this.surfaces[t]&&console.error(`A surface with id ${t} has already been registered.`),this.surfaces[t]=e}unregisterSurface(e){e.off(this);let t=e.getId();this.surfaces[t]===e&&delete this.surfaces[t]}_onSelectionChanged(e){this._state.selection=e,e&&e.isCustomSelection()&&w.inBrowser&&(window.getSelection().removeAllRanges(),window.document.activeElement.blur())}_recoverDOMSelection(){if(this.editorSession._blurred)return;let e=this.getFocusedSurface();e&&!e.isDisabled()&&(e._focus(),e.rerenderDOMSelection())}}class Cu{saveDocument({fileManager:e}){return console.info("Simulating save ..."),e.sync().then(()=>{console.info("Creating document snapshot...")})}}class Su{constructor(){this.config={schema:{},nodes:{},tools:{},components:{},converters:{},importers:{},exporters:{},fileProxies:[],commands:{},commandGroups:{},toolPanels:{},editingBehaviors:[],macros:[],managers:{},dropHandlers:[],keyboardShortcuts:[],icons:{},labels:{},lang:"en",editorOptions:[],CommandManagerClass:ad,DragManagerClass:eu,SaveHandlerClass:null}}defineSchema(e){if(e.ArticleClass&&(console.warn("DEPRECATED: schema.ArticleClass is now called schema.DocumentClass"),e.DocumentClass=e.ArticleClass),!e.DocumentClass)throw new Error("schema.DocumentClass is mandatory");this.config.schema=e}addEditorOption(e){if(!e.key)throw new Error("An option key must be defined");if(!e.value)throw new Error("An option value must be defined");this.config.editorOptions[e.key]=e.value}getEditorOptions(){return this.config.editorOptions}addNode(e,t){let r=e.type;if(!r)throw new Error("A NodeClass must have a type.");if(this.config.nodes[r]&&!t)throw new Error("NodeClass with this type name is already registered: "+r);this.config.nodes[r]=e}addConverter(e,t){let r=this.config.converters[e];if(r||(r={},this.config.converters[e]=r),no(t)){t=new t}if(!t.type)throw new Error("A converter needs an associated type.");r[t.type]=t}addImporter(e,t){this.config.importers[e]=t}addExporter(e,t){this.config.exporters[e]=t}addComponent(e,t,r){if(!r&&this.config.components[e])throw new Error(e+" already registered");if(!t)throw new Error("Provided nil for component "+e);if(!t.prototype._isComponent)throw new Error("ComponentClass must be a subclass of ui/Component.");this.config.components[e]=t}addCommand(e,t,r){if(!E(e))throw new Error("Expecting 'name' to be a String");if(!t)throw new Error("Provided nil for command "+e);if(!t.prototype._isCommand)throw new Error("Expecting 'CommandClass' to be of type ui/Command.");if(r=r||{},this.config.commands[e]&&!r.force)throw new Error(`Another command with name ${e} has already been registered. Use 'options.force' if this is intentional.`);this.config.commands[e]={name:e,CommandClass:t,options:r};let n=r.commandGroup;n&&(this.config.commandGroups[n]||(this.config.commandGroups[n]=[]),this.config.commandGroups[n].push(e))}addTool(e,t){if(!E(e))throw new Error("Expecting 'name' to be a String");if(!t)throw new Error("Provided nil for tool "+e);if(!t||!t.prototype._isTool)throw new Error("Expecting 'ToolClass' to be of type ui/Tool. name:",e);this.config.tools[e]=t}getTools(){return this.config.tools}addToolPanel(e,t){this.config.toolPanels[e]=t}getToolPanel(e){return this.config.toolPanels[e]}addManager(e,t){this.config.managers[e]=t}getManagers(){return this.config.managers}addIcon(e,t){var r=this.config.icons[e];r||(r={},this.config.icons[e]=r),Object.assign(r,t)}addLabel(e,t){E(t)?(this.config.labels.en||(this.config.labels.en={}),this.config.labels.en[e]=t):r(t,function(t,r){this.config.labels[r]||(this.config.labels[r]={}),this.config.labels[r][e]=t}.bind(this))}addSeed(e){this.config.seed=e}addEditingBehavior(e){console.error("Support for custom EditingBehaviors has been removed. Instead you can override Document.getEditingInterface()")}addMacro(e){this.config.macros.push(e)}addDragAndDrop(e){if(console.warn("DEPRECATED: Use addDropHandler() instead"),!e.prototype._isDragAndDropHandler)throw new Error("Only instances of DragAndDropHandler are allowed.");this.addDropHandler(new e)}addDropHandler(e){e._isDragAndDropHandler&&(e.type=e.type||"drop-asset"),this.config.dropHandlers.push(e)}addKeyboardShortcut(e,t){let r={key:e,spec:t};this.config.keyboardShortcuts.push(r)}addFileProxy(e){this.config.fileProxies.push(e)}getFileAdapters(){return this.config.fileProxies.slice(0)}import(e,t){return e.configure(this,t||{}),this}getConfig(){return this.config}getStyles(){return this.config.styles}getSchema(){return this.schema||(this.schema=new Vd(this.config.schema),this.schema.addNodes(this.config.nodes)),this.schema}getDocumentClass(){return this.config.schema.DocumentClass}createArticle(e){return console.warn("DEPRECATED: createArticle is now called createDocument"),this.createDocument(e)}createDocument(e){const t=this.getSchema();let r=new(t.getDocumentClass())(t);return e&&e(r),r}createImporter(e,t,r={}){return new(0,this.config.importers[e])(Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(e).values()},r),t)}createExporter(e,t,r={}){return new(0,this.config.exporters[e])(Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(e).values()},r),t)}getComponentRegistry(){var e=new Gd;return r(this.config.components,function(t,r){e.add(r,t)}),e}getCommands(){return g(this.config.commands,function(e,t){return new e.CommandClass(Object.assign({name:t},e.options))})}getCommandGroups(){return this.config.commandGroups}getConverterRegistry(){if(!this.converterRegistry){var e=new od;r(this.config.converters,function(t,r){e.add(r,new od(t))}),this.converterRegistry=e}return this.converterRegistry}getDropHandlers(){return this.config.dropHandlers.slice(0)}getSeed(){return this.config.seed}getIconProvider(){return new Kd(this.config.icons)}getEditingBehavior(){console.error("Support for custom EditingBehaviors has been removed. Instead you can override Document.getEditingInterface()")}getMacros(){return this.config.macros}getKeyboardShortcuts(){return this.config.keyboardShortcuts}getFindAndReplaceConfig(){return this.config.findAndReplace}setFindAndReplaceConfig(e){this.config.findAndReplace=e}getKeyboardShortcutsByCommand(){let e={};return this.config.keyboardShortcuts.forEach(t=>{if(t.spec.command){let r=t.key.toUpperCase();r=w.isMac?(r=(r=(r=(r=(r=r.replace(/CommandOrControl/i,"⌘")).replace(/Ctrl/i,"^")).replace(/Shift/i,"⇧")).replace(/Enter/i,"↵")).replace(/Alt/i,"⌥")).replace(/\+/g,""):r.replace(/CommandOrControl/i,"Ctrl"),e[t.spec.command]=r}}),e}setDefaultLanguage(e){this.config.lang=e}getDefaultLanguage(){return this.config.lang||"en"}setCommandManagerClass(e){this.config.CommandManagerClass=e}getCommandManagerClass(){return this.config.CommandManagerClass||ad}setDragManagerClass(e){this.config.DragManagerClass=e}getDragManagerClass(){return this.config.DragManagerClass||eu}setFileManagerClass(e){this.config.FileManagerClass=e}getFileManagerClass(){return this.config.FileManagerClass||iu}setGlobalEventHandlerClass(e){this.config.GlobalEventHandlerClass=e}getGlobalEventHandlerClass(){return this.config.GlobalEventHandlerClass||lu}setKeyboardManagerClass(e){this.config.KeyboardManagerClass=e}getKeyboardManagerClass(){return this.config.KeyboardManagerClass||pu}setMacroManagerClass(e){this.config.MacroManagerClass=e}getMacroManagerClass(){return this.config.MacroManagerClass||gu}setMarkersManagerClass(e){this.config.MarkersManagerClass=e}getMarkersManagerClass(){return this.config.MarkersManagerClass||wu}setSurfaceManagerClass(e){this.config.SurfaceManagerClass=e}getSurfaceManagerClass(){return this.config.SurfaceManagerClass||vu}setSaveHandlerClass(e){this.config.SaveHandlerClass=e}getSaveHandler(){return new(this.config.SaveHandlerClass||Cu)}getLabelProviderClass(){return this.config.LabelProviderClass||$d}setLabelProviderClass(e){this.config.LabelProviderClass=e}getLabelProvider(){return new(this.getLabelProviderClass())(this.config.labels)}}class xu extends Oh{didMount(){this.context.editorSession.onRender("commandStates",this._onCommandStatesChanged,this)}dispose(){this.context.editorSession.off(this)}render(e){throw new Error("This method is abstract")}getEntryTypeComponents(){return{"tool-group":this.getComponent("tool-group"),"tool-dropdown":this.getComponent("tool-dropdown"),"tool-prompt":this.getComponent("tool-prompt"),"tool-separator":this.getComponent("tool-separator")}}renderEntries(e){return this.props.toolPanel.map(t=>{let r=this.getEntryTypeComponents()[t.type];if(!r)throw new Error("Toolpanel entry type not found");let n=Object.assign({},t,{theme:this.getTheme()}),s=e(r,n);return t.name&&s.ref(t.name),s})}hasEnabledTools(){let e=!1;return this.refs.entriesContainer.childNodes.forEach(t=>{t.hasEnabledTools()&&(e=!0)}),e}getActiveToolGroupNames(){throw new Error("Abstract method")}showDisabled(){return!1}getToolStyle(){throw new Error("Abstract method")}getTheme(){return this.props.theme||"dark"}_onCommandStatesChanged(){this.rerender()}}class Eu extends xu{didMount(){if(super.didMount(),!this.context.scrollPane)throw new Error("Requires a scrollPane context");this.context.scrollPane.on("context-menu:opened",this._onContextMenuOpened,this)}dispose(){super.dispose(),this.context.scrollPane.off(this)}render(e){let t=e("div").addClass("sc-context-menu sm-hidden");return t.addClass("sm-theme-"+this.getTheme()),t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}show(e){this.el.removeClass("sm-hidden"),this._position(e)}hide(){this.el.addClass("sm-hidden")}_onContextMenuOpened(e){let t=e.mouseBounds;this.el.removeClass("sm-hidden");let r=this.el.htmlProp("offsetWidth");this.el.css("top",t.top);let n=t.left;n=Math.max(n,0);let s=t.left+t.right-r;n=Math.min(n,s),this.el.css("left",n)}getTheme(){return this.props.theme||"dark"}}function Nu(e,t){let r;var n,s,i,o,a;r=t._isDOMElement?t.getNativeElement():t,_(e)||(e=[e]);let l=Tu(e.map(e=>{let t;return t=e._isDOMElement?e.getNativeElement():e,e=t,s=r.getBoundingClientRect(),i=Tu(e.getClientRects()),o=i.left-s.left,a=i.top-s.top,{left:o,top:a,right:s.width-o-i.width,bottom:s.height-a-i.height,width:i.width,height:i.height}})),c=r.getBoundingClientRect();return{left:l.left,top:l.top,right:c.width-l.left-l.width,bottom:c.height-l.top-l.height,width:l.width,height:l.height}}function Tu(e){var t={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};return r(e,function(e){e.left<t.left&&(t.left=e.left),e.top<t.top&&(t.top=e.top),e.left+e.width>t.right&&(t.right=e.left+e.width),e.top+e.height>t.bottom&&(t.bottom=e.top+e.height)}),t.width=t.right-t.left,t.height=t.bottom-t.top,t}class Iu extends Oh{didMount(){const e=this._getDragManager();e&&(e.on("drag:started",this.onDragStarted,this),e.on("drag:finished",this.onDragFinished,this))}dispose(){const e=this._getDragManager();e&&e.off(this)}render(e){let t=e("div").addClass("sc-dropzones");return this.state.dropzones?(t.on("dragenter",this.onDrag).on("dragover",this.onDrag),r(this.state.dropzones,(r,n)=>{r.forEach((r,s)=>{let i,o=r.type;if("place"===o?i=e("div").addClass("se-dropzone").attr({"data-dropzone-index":s,"data-dropzone-surface":n}).append(e("div").addClass("se-drop-teaser").css({top:r.teaserPos})):"custom"===o&&(i=e("div").addClass("se-custom-dropzone").attr({"data-dropzone-index":s,"data-dropzone-surface":n}).append(e("div").addClass("se-message").append(r.message))),i){let n=e("div").addClass("se-drop-shield").on("dragenter",this.onDragEnter).on("dragleave",this.onDragLeave).on("drop",this.onDrop).on("mouseenter",this.onDragEnter).on("mouseleave",this.onDragLeave).on("mouseup",this.onDrop);i.append(n),i.css({position:"absolute",top:r.top,left:r.left,width:r.width,height:r.height}),t.append(i)}})})):t.addClass("sm-hidden"),t}onDragStarted(e){let t=this._computeDropzones(e);setTimeout(()=>{this.setState({dropzones:t})},250)}onDragFinished(){this.setState({})}onDragEnter(e){e.target.parentNode.classList.add("sm-over")}onDragLeave(e){e.target.parentNode.classList.remove("sm-over")}onDrag(e){e.preventDefault()}onDrop(e){e.__reserved__=!0,e.preventDefault(),e.stopPropagation();let t=e.target.parentNode.dataset.dropzoneIndex,r=e.target.parentNode.dataset.dropzoneSurface,n=this.state.dropzones[r][t],s=n.dropParams,i=n.type,o=this.context.surfaceManager.getSurface(r),a=n.component,l=n.dropzoneComponent,c=this.context.dragManager;c.extendDragState({targetSurface:o,dropType:i,dropParams:s,component:a,dropzoneComponent:l}),c._onDragEnd(e)}_getDragManager(){return this.context.dragManager}_getBoundingRect(e){let t=e.context.scrollPane.getContentElement();return Nu(e.el,t)}_computeDropzones(e){let t=this.context.scrollPane.getName(),n={};return r(e.scrollPanes[t].surfaces,e=>{let t=e.childNodes,r=t.length+1,s=[];for(let e=0;e<r;e++){if(0===e){let r=this._getBoundingRect(t[0]);s.push({type:"place",left:r.left,top:r.top,width:r.width,height:r.height/2,teaserPos:0,dropParams:{insertPos:e}})}else if(e===r-1){let r=this._getBoundingRect(t[e-1]);s.push({type:"place",left:r.left,top:r.top+r.height/2,width:r.width,height:r.height/2,teaserPos:r.height/2,dropParams:{insertPos:e}})}else{let r=this._getBoundingRect(t[e-1]),n=this._getBoundingRect(t[e]),i=r.top+r.height/2,o=n.top+n.height/2;s.push({type:"place",left:r.left,top:i,width:r.width,height:o-i,teaserPos:(r.top+r.height+n.top)/2-i,dropParams:{insertPos:e}})}if(e<r-1){let r=t[e];if(r._isIsolatedNodeComponent&&(r=r.getContent()),r.getDropzoneSpecs){r.getDropzoneSpecs().forEach(e=>{let t=e.component,n=this._getBoundingRect(t);s.push({type:"custom",component:r,dropzoneComponent:t,left:n.left,top:n.top,width:n.width,height:n.height,message:e.message,dropParams:e.dropParams})})}}}n[e.getName()]=s}),n}_renderDropTeaser(e){e.visible?(this.el.removeClass("sm-hidden"),this.el.css("top",e.rect.top),this.el.css("left",e.rect.left),this.el.css("right",e.rect.right)):this.el.addClass("sm-hidden")}}class Au{constructor(){this.reset()}reset(){this.doneChanges=[],this.undoneChanges=[],this.lastChange=null}canUndo(){return this.doneChanges.length>0}canRedo(){return this.undoneChanges.length>0}push(e){this.doneChanges.push(e),this.undoneChanges=[]}}class Du{constructor(e){this.master=e,this.stage=e.newInstance().createFromDocument(e),this.stage._isTransactionDocument=!0,this.tx=this.stage.createEditingInterface(),this._isTransacting=!1,e._ops.length=0}dispose(){this.stage.dispose()}get ops(){return this.stage._ops}set ops(e){this.stage._ops=e}_reset(){this._before={},this._after={},this.stage._ops.length=0,this._info={}}_recordChange(e,t){if(this._isTransacting)throw new Error("Nested transactions are not supported.");if(!no(e))throw new Error("Document.transaction() requires a transformation function.");let r,n=!1;this._isTransacting=!0,this._reset();try{e(this.tx);let s=this.ops;if(s.length>0&&((r=new ji(s,{},{})).info=t,this.master._isXMLDocument))if(t&&"type"===t.action);else{let e=this.stage._validateChange(r);if(!e.ok)throw new Error("Transaction is violating the schema: \n"+e.errors.map(e=>e.msg).join("\n"))}n=!0}finally{n||this._rollback(),this._isTransacting=!1}return r}_sync(){const e=this.master,t=this.stage;let r=e._ops;for(let e=0;e<r.length;e++)t._applyOp(r[e]);r.length=0}__applyChange__(e){const t=this.stage,r=e.ops;for(let e=0;e<r.length;e++)t._applyOp(r[e])}_rollback(){const e=this.stage;let t=e._ops;for(let r=t.length-1;r>=0;r--)e._applyOp(t[r].invert());t.length=0}}class Ou{constructor(e){this.document=e,this.selection=bi.nullSelection,this._reset()}getSelection(){return this.selection}setSelection(e){return e?e.attach(this.document):e=bi.nullSelection,this.selection=e,this._deriveState(e),!0}_deriveState(e){this._reset(),this._deriveContainerSelectionState(e),this._deriveAnnoState(e),this.document.getIndex("markers")&&this._deriveMarkerState(e)}_deriveContainerSelectionState(e){let t=this.document;if(e.containerId){let r=t.get(e.containerId);this.container=r;let n,s,i=e.start.getNodeId(),o=e.end.getNodeId(),a=t.get(i).getContainerRoot(),l=r.getPosition(a);l>0&&(this.previousNode=r.getNodeAt(l-1)),this.isFirst=Di(t,e.start),o===i?(n=a,s=l):(n=t.get(o).getContainerRoot(),s=r.getPosition(n)),s<r.getLength()-1&&(this.nextNode=r.getNodeAt(s+1)),this.isLast=Oi(t,e.end)}}_deriveAnnoState(e){const t=this.document;let r={};function n(e){r[e.type]||(r[e.type]=[]),r[e.type].push(e)}const s=Nd(t,e);s.forEach(n),1===s.length&&s[0].isInlineNode()&&(this.isInlineNodeSelection=s[0].getSelection().equals(e));const i=e.containerId;if(i){Td(t,e,i).forEach(n)}this.annosByType=r}_deriveMarkerState(e){let t=Ad(this.document,e);this.markers=t}_reset(){this.annosByType={},this.markers=null,this.isInlineNodeSelection=!1,this.container=null,this.previousNode=null,this.nextNode=null,this.isFirst=!1,this.isLast=!1,this.surface=null,this.isolatedNodes=null}}class Pu extends l{constructor(e,t){super(),t=t||{},this.__id__=d(),this.document=e;const n=t.configurator;if(!n)throw new Error("No configurator provided.");var s,i;this.configurator=n,this._transaction=new Du(e),s=this._transaction,i=this,s.setSelection=function(e){return ku(e=Du.prototype.setSelection.call(s,e),i),Mu(e,i),e},this._history=new Au,this._currentChange=null,this._selectionState=new Ou(e),this._commandStates=[],this._resources=["document","selection","commandStates"],this._dirtyFlags={},this._change=null,this._info=null,this._flowStages=["update","pre-render","render","post-render","position","finalize"],this._postponed=[],this._observers={},this._lang=t.lang||this.configurator.getDefaultLanguage(),this._dir=t.dir||"ltr";const o=n.getCommandManagerClass(),a=n.getDragManagerClass(),l=n.getFileManagerClass(),c=n.getGlobalEventHandlerClass(),h=n.getKeyboardManagerClass(),u=n.getMacroManagerClass(),p=n.getMarkersManagerClass(),f=n.getSurfaceManagerClass();this.surfaceManager=new f(this),this._context={editorSession:this,surfaceManager:this.surfaceManager},t.context&&Object.assign(this._context,t.context);let g=n.getCommands(),m=n.getDropHandlers(),_=n.getMacros(),y=n.getConverterRegistry();this.fileManager=t.fileManager||new l(n.getFileAdapters(),this._context),this._hasUnsavedChanges=!1,this._isSaving=!1,t.saveHandler?this.saveHandler=t.saveHandler:this.saveHandler=n.getSaveHandler(),this._managers={},r(n.getManagers(),(e,t)=>{this._managers[t]=new e(this._context)}),this.commandManager=t.commandManager||new o(this._context,g),this.dragManager=new a(m,Object.assign({},this._context,{commandManager:this.commandManager})),this.macroManager=new u(this._context,_),this.globalEventHandler=new c(this,this.surfaceManager),this.markersManager=new p(this),this.keyboardManager=new h(this,n.getKeyboardShortcuts(),{context:this._context}),this.converterRegistry=y}dispose(){this._transaction.dispose(),this.surfaceManager.dispose(),this.fileManager.dispose(),this.commandManager.dispose(),this.dragManager.dispose(),this.macroManager.dispose(),this.globalEventHandler.dispose(),this.markersManager.dispose(),r(this._managers,e=>{e.dispose&&e.dispose()})}hasChanged(e){return this._dirtyFlags[e]}hasDocumentChanged(){return this.hasChanged("document")}hasSelectionChanged(){return this.hasChanged("selection")}hasCommandStatesChanged(){return this.hasChanged("commandStates")}hasLanguageChanged(){return this.hasChanged("lang")}hasTextDirectionChanged(){return this.hasChanged("dir")}get(e){switch(e){case"document":return this.getDocument();case"selection":return this.getSelection();case"commandStates":return this.getCommandStates();case"change":return this.getChange();case"lang":return this.getLanguage();case"dir":return this.getTextDirection();default:throw new Error("Unknown resource: "+e)}}getConfigurator(){return this.configurator}getContext(){return this._context}getDocument(){return this.document}getManager(e){return this._managers[e]}getSelection(){return this.getSelectionState().getSelection()}getSelectionState(){return this._selectionState}getCommandStates(){return this._commandStates}getChange(){return this._change}getChangeInfo(){return this._info}getFocusedSurface(){return this.surfaceManager.getFocusedSurface()}getSurface(e){return this.surfaceManager.getSurface(e)}getLanguage(){return this._lang}getTextDirection(){return this._dir}canUndo(){return this._history.canUndo()}canRedo(){return this._history.canRedo()}resetHistory(){this._history.reset(),this._setDirty("commandStates"),this._flowing||this.startFlow()}executeCommand(...e){this.commandManager.executeCommand(...e)}attachEditor(e){this.editor=e}detachEditor(){this.editor=void 0}getEditor(){return this.editor}setSelection(e,t){if(e&&m(e)&&(e=this.getDocument().createSelection(e)),e&&!e.isNull()&&!e.surfaceId){let t=this.getFocusedSurface();t&&(e.surfaceId=t.id)}return ku(e,this),Mu(e,this),this._setSelection(e)&&!t&&this.startFlow(),e}selectNode(e){let t=this.getFocusedSurface();this.setSelection({type:"node",nodeId:e,containerId:t.getContainerId(),surfaceId:t.id})}setCommandStates(e){this._commandStates=e,this._setDirty("commandStates")}setLanguage(e){this._lang!==e&&(this._lang=e,this._setDirty("lang"),this.startFlow())}setTextDirection(e){this._dir!==e&&(this._dir=e,this._setDirty("dir"),this.startFlow())}createSelection(){const e=this.getDocument();return e.createSelection.apply(e,arguments)}getCollaborators(){return null}setSaveHandler(e){this.saveHandler=e}transaction(e,t){const r=this._transaction,n=r.tx;t=t||{},r._sync();let s=this.getSelection();n.selection=s;let i=r._recordChange(e,t),o=n.selection;return i?(i.before={selection:s},i.after={selection:o},this._commit(i,t)):(this._setSelection(n.selection),this.startFlow()),i}undo(){this._undoRedo("undo")}redo(){this._undoRedo("redo")}on(...e){let t=e[0];if(this._flowStages.indexOf(t)>=0){e.shift();let r=e[2]||{},n=r.resource;n&&(delete r.resource,e.unshift(n)),this._registerObserver(t,e)}else l.prototype.on.apply(this,e)}off(...e){if(1===e.length){let t=e[0];if(super.off(...e),t[this.__id__]){const e=t[this.__id__];delete t[this.__id__],e.forEach(e=>{this.__deregisterObserver(e)})}}else{const t=e[0],r=e[1],n=e[2];this._deregisterObserver(t,r,n)}}onUpdate(...e){return this._registerObserver("update",e)}onPreRender(...e){return this._registerObserver("pre-render",e)}onRender(...e){return this._registerObserver("render",e)}onPostRender(...e){return this._registerObserver("post-render",e)}onPosition(...e){return this._registerObserver("position",e)}onFinalize(...e){return this._registerObserver("finalize",e)}_setSelection(e){let t=this.getSelectionState().setSelection(e);return t&&this._setDirty("selection"),t}_undoRedo(e){const t=this.getDocument();var r,n;"redo"===e?(r=this._history.undoneChanges,n=this._history.doneChanges):(r=this._history.doneChanges,n=this._history.undoneChanges);var s=r.pop();if(s){this._applyChange(s,{}),this._transaction.__applyChange__(s),n.push(t.invert(s));let e=s.after.selection;e&&e.attach(t),this._setSelection(e),this.startFlow()}else console.warn("No change can be %s.","undo"===e?"undone":"redone")}_transformLocalChangeHistory(e){var t={ops:e.ops.map(function(e){return e.clone()})};Hi(t,this._history.doneChanges),Hi(t,this._history.undoneChanges)}_transformSelection(e){return Ui(this.getSelection(),e)}_commit(e,t){this._commitChange(e,t),this._hasUnsavedChanges=!0,this.startFlow()}_commitChange(e,t){if(e.timestamp=Date.now(),this._applyChange(e,t),!1!==t.history&&!t.hidden){let t=this.getDocument().invert(e);this._history.push(t)}var r=e.after.selection||bi.nullSelection;r.isNull()||r.surfaceId||(r.surfaceId=e.after.surfaceId),this._setSelection(r),this.emit("commit",e)}_applyChange(e,t){if(!e)return void console.error("FIXME: change is null.");const r=this.getDocument();r._apply(e),r._notifyChangeListeners(e,t),this._setDirty("document"),this._change=e,this._info=t}_applyRemoteChange(e){e.ops.length>0&&(this._applyChange(e,{remote:!0}),this._transaction.__applyChange__(e),this._transformLocalChangeHistory(e),this._setSelection(this._transformSelection(e)),this.startFlow())}hasUnsavedChanges(){return this._hasUnsavedChanges}save(){var e=this.saveHandler;if(this._hasUnsavedChanges&&!this._isSaving){if(this._isSaving=!0,e){let t={editorSession:this,fileManager:this.fileManager};return e.saveDocument(t).then(()=>{this._hasUnsavedChanges=!1,this.setSelection(this.getSelection())}).catch(e=>{console.error("Error during save",e)}).then(()=>{this._isSaving=!1})}{let e="Document saving is not handled at the moment. Make sure saveHandler instance provided to editorSession";return console.error(e),Promise.reject(new Error(e))}}}startFlow(){if(this._flowing)throw new Error("Already in a flow. You need to postpone the update.");this._flowing=!0;try{this.performFlow()}finally{this._resetFlow(),this._flowing=!1}const e=this._postponed,t=this;this._postponed=[],setTimeout(function(){e.forEach(function(e){e(t)})},0)}performFlow(){this._flowStages.forEach(e=>{this._notifyObservers(e)})}postpone(e){this._postponed.push(e)}_parseObserverArgs(e){let t={stage:null,resource:null,handler:null,context:null,options:{}},r=0,n=e[r];if(E(n)&&(t.resource=n,n=e[++r]),!n)throw new Error("Provided handler function was nil.");if(!no(n))throw new Error("Expecting a handler Function.");return t.handler=n,(n=e[++r])&&(t.context=n,n=e[++r]),n&&(t.options=n),t}_registerObserver(e,t){let r=this._parseObserverArgs(t);r.stage=e,this.__registerObserver(e,r)}__registerObserver(e,t){if(t.context){const e=t.context;e[this.__id__]||(e[this.__id__]=[]),e[this.__id__].push(t)}let r=this._observers[e];r||(r=this._observers[e]=[]),r.push(t)}_deregisterObserver(e,t,n){let s=this;if(1===arguments.length)r(s._observers,e=>{for(let t=e.length-1;t>=0;t--){const r=e[t];r.context===n&&(e.splice(t,1),r._deregistered=!0)}});else{let r=s._observers[e];if(r)for(let e=r.length-1;e>=0;e--){let s=r[e];s.handler===t&&s.context===n&&(r.splice(e,1),s._deregistered=!0)}else l.prototype.off.apply(s,arguments)}}__deregisterObserver(e){const t=e.stage,r=this._observers[t],n=e.context,s=e.handler;for(let e=r.length-1;e>=0;e--){let t=r[e];t.handler===s&&t.context===n&&(r.splice(e,1),t._deregistered=!0)}}_notifyObservers(e){let t=this._observers[e];if(!t)return;let r=t.slice();for(let e=0;e<r.length;e++){let t=r[e];if(!t._deregistered)if(t.resource)if("document"===t.resource){if(!this.hasDocumentChanged())continue;const e=this.getChange(),r=this.getChangeInfo(),n=t.options.path;n?e.hasUpdated(n)&&t.handler.call(t.context,e,r,this):t.handler.call(t.context,e,r,this)}else{if(!this.hasChanged(t.resource))continue;const e=this.get(t.resource);t.handler.call(t.context,e,this)}else t.handler.call(t.context,this)}}_setDirty(e){this._dirtyFlags[e]=!0}_resetFlow(){Object.keys(this._dirtyFlags).forEach(e=>{this._dirtyFlags[e]=!1}),this._change=null,this._info=null}setBlurred(e){this._blurred=e,this.commandManager._updateCommandStates(this),this._setDirty("commandStates")}isBlurred(){return Boolean(this._blurred)}}function ku(e,t){if(e&&!e.isNull()&&!e.surfaceId){let r=t.getFocusedSurface();r&&(e.surfaceId=r.id)}}function Mu(e,t){if(e&&!e.isNull()&&e.surfaceId&&!e.containerId){let r=t.getSurface(e.surfaceId);if(r){let t=r.getContainerId();t&&(e.containerId=t)}}}class Lu extends Oh{render(e){let t=this.props.commandState,r=e("button").addClass("sc-menu-item").append(this._renderIcon(e),this._renderLabel(e),this._renderKeyboardShortcut(e)).on("click",this._onClick);return this.props.label&&r.append(this.renderLabel(e)),t.active&&r.addClass("sm-active"),t.disabled?r.attr("tabindex",-1).attr("disabled",!0):r.attr("tabindex",1),r}_renderLabel(e){return e("div").addClass("se-label").append(this._getLabel())}_renderIcon(e){return e("div").addClass("se-icon").append(this.context.iconProvider.renderIcon(e,this.props.name))}_renderKeyboardShortcut(e){return e("div").addClass("se-keyboard-shortcut").append(this._getKeyboardShortcut())}_getLabel(){return this.context.labelProvider.getLabel(this.props.name,this.props.commandState)}_getKeyboardShortcut(){let e=this.props.name,t=this.context.keyboardShortcuts;return t[e]?t[e]:""}_onClick(e){e.preventDefault(),e.stopPropagation(),this.props.commandState.disabled||this.executeCommand()}executeCommand(e){this.context.commandManager.executeCommand(this.props.name,e)}}class Ru extends Oh{render(e){let t=this.props.commandStates,r=e("div").addClass("sc-menu");return this.props.items.forEach(n=>{n.command?r.append(e(Lu,{name:n.command,commandState:t[n.command]})):"separator"===n.type&&r.append(e("div").addClass("separator"))}),r}}class qu extends Oh{render(e){let t=e("div").addClass("sc-tooltip");return t.append(this.props.text),t}}class Bu extends Oh{render(e){let t=e("div").addClass("sc-toggle-tool"),r=this.getClassNames();return r&&t.addClass(r),t.append(this.renderButton(e)),t.append(e(qu,{text:this._getTooltipText()})),t}renderButton(e){let t=this.props.commandState;return e(this.getComponent("button"),{icon:this.getIconName(),active:t.active,disabled:t.disabled,theme:this.props.theme}).on("click",this.onClick)}getClassNames(){return""}getCommandName(){return this.getName()}getName(){return this.props.name}getIconName(){return this.props.name}onClick(e){e.preventDefault(),e.stopPropagation(),this.props.disabled||this.executeCommand()}_getTooltipText(){let e=this.props.name,t=this.context.labelProvider.getLabel(e),r=this.context.keyboardShortcuts;return r[e]?[t," (",r[e],")"].join(""):t}executeCommand(e){e=Object.assign({mode:this.props.mode},e),this.context.commandManager.executeCommand(this.getCommandName(),e)}get _isTool(){return!0}}class Fu extends Oh{isToolEnabled(e,t){let r=!0;return this.props.contextual&&!t.showInContext&&(r=!1),t.disabled&&(r=!1),r}hasEnabledTools(e){let t;return e||(e=this._getCommandStates()),r(e,(e,r)=>{this.isToolEnabled(r,e)&&(t=!0)}),t}render(e){let t=this._getCommandStates(),n=e("div").addClass(this._getClassNames());return n.addClass("sm-"+this.props.name),r(t,(t,r)=>{if(this.isToolEnabled(r,t)||this.props.showDisabled){let s=this._getToolClass(r);n.append(e(s,{name:r,commandState:t,style:this.props.style,theme:this.props.theme}).ref(r))}}),n}_getCommandStates(){let e=this.context.editorSession.getCommandStates(),t=this.context.commandGroups,r={};return this.props.commandGroups.forEach(n=>{t[n]&&t[n].forEach(t=>{e[t]&&(r[t]=e[t])})}),r}_getClassNames(){return"sc-tool-group"}_getToolClass(e){let t,r=this.context.tools;return t="descriptive"===this.props.style?Lu:Bu,r[e]||t}}class ju extends Fu{_getToolClass(e){return this.context.tools[e]||Lu}_getClassNames(){return"sc-menu-group"}}class Hu extends xu{didMount(){if(super.didMount(),!this.context.scrollPane)throw new Error("Requires scrollPane context");this.context.scrollPane.on("selection:positioned",this._onSelectionPositioned,this)}dispose(){super.dispose(),this.context.scrollPane.off(this)}render(e){let t=e("div").addClass("sc-overlay");return t.addClass("sm-hidden"),t.addClass("sm-theme-"+this.getTheme()),t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}show(e){this.el.removeClass("sm-hidden"),this._position(e)}hide(){this.el.addClass("sm-hidden")}_onSelectionPositioned(e){if(this.hasEnabledTools()){this.el.removeClass("sm-hidden");let t=this.el.htmlProp("offsetWidth"),r=e.selectionRect,n=r.width;this.el.css("top",r.top+r.height);let s=r.left+n/2-t/2;s=Math.max(s,0);let i=r.left+n+r.right-t;s=Math.min(s,i),this.el.css("left",s)}else this.el.addClass("sm-hidden")}getTheme(){return this.props.theme||"dark"}}class Uu extends Oh{didMount(){nh.getBrowserWindow().on("resize",this.onResize,this),this.props.scrollPane.on("scroll",this.onScroll,this),setTimeout(()=>{this.updatePositions()})}dispose(){nh.getBrowserWindow().off(this),this.props.scrollPane.off(this)}didUpdate(){this.updatePositions()}render(e){let t=e("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){let n=[];r(this.props.highlights,function(t,s){r(t,function(t){n.push(e("div").ref(t).addClass("se-highlight sm-"+s))})}),t.append(e("div").ref("highlights").addClass("se-highlights").append(n))}return t.append(e("div").ref("thumb").addClass("se-thumb")),t}updatePositions(){let e=this.props.scrollPane,t=e.getScrollableElement(),n=e.getContentHeight(),s=e.getHeight(),i=e.getScrollPosition(),o=e.getContentElement();this.factor=n/s,this.factor<=1?this.el.addClass("sm-hide-thumb"):this.el.removeClass("sm-hide-thumb"),this.refs.thumb.css({top:i/this.factor,height:s/this.factor}),this.props.highlights&&r(this.props.highlights,function(e){r(e,function(e){let r=t.find('*[data-id="'+e+'"]');if(!r)return;let n=Nu(r,o),s=n.top/this.factor,i=n.height/this.factor;i<Uu.overlayMinHeight&&(i=Uu.overlayMinHeight),this.refs[e]?this.refs[e].css({top:s,height:i}):console.warn("no ref found for highlight",e)}.bind(this))}.bind(this))}getScrollableElement(){return this.props.scrollPane.getScrollableElement()}onResize(){this.rerender()}onScroll(){this.updatePositions()}onMouseDown(e){e.stopPropagation(),e.preventDefault(),this._mouseDown=!0;let t=nh.getBrowserWindow();t.on("mousemove",this.onMouseMove,this),t.on("mouseup",this.onMouseUp,this);let r=this.el.getOffset().top,n=e.pageY-r,s=this.refs.thumb.el;e.target!==s.getNativeElement()?(this.offset=s.height/2,this.onMouseMove(e)):this.offset=n-s.getPosition().top}onMouseUp(){this._mouseDown=!1;let e=nh.getBrowserWindow();e.off("mousemove",this.onMouseMove,this),e.off("mouseup",this.onMouseUp,this)}onMouseMove(e){if(this._mouseDown){let t=this.props.scrollPane.getScrollableElement(),r=this.el.getOffset().top,n=(e.pageY-r-this.offset)*this.factor;t.setProperty("scrollTop",n)}}}function zu(e,t){let r=t.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top;return{left:n,right:r.width-n,top:s,bottom:r.height-s}}Uu.overlayMinHeight=2;class Vu extends Oh{getChildContext(){return{scrollPane:this}}didMount(){w.inBrowser&&(this.windowEl=nh.wrapNativeElement(window),this.windowEl.on("resize",this.onSelectionPositioned,this))}dispose(){this.windowEl&&this.windowEl.off(this)}getName(){return this.props.name}onSelectionPositioned(){let e=this._getContentRect(),t=this._getSelectionRect();if(!t)return;let r={contentRect:e,selectionRect:t};this._emitSelectionPositioned(r),this._scrollSelectionIntoView(t)}_emitSelectionPositioned(e){this.emit("selection:positioned",e),this.emit("dom-selection:rendered",e)}_onContextMenu(e){e.preventDefault();let t=this._getMouseBounds(e);this.emit("context-menu:opened",{mouseBounds:t})}_scrollSelectionIntoView(e){let t=this.getScrollPosition(),r=t+this.getHeight(),n=e.top,s=e.top+e.height;(n<t&&s<t||n>r&&s>r)&&this.setScrollPosition(n)}getHeight(){throw new Error("Abstract method")}getContentHeight(){throw new Error("Abstract method")}getContentElement(){throw new Error("Abstract method")}getScrollableElement(){throw new Error("Abstract method")}getScrollPosition(){throw new Error("Abstract method")}setScrollPosition(){throw new Error("Abstract method")}getPanelOffsetForElement(e){throw new Error("Abstract method")}scrollTo(e,t){throw new Error("Abstract method")}_getContentRect(){return this.getContentElement().getNativeElement().getBoundingClientRect()}_getSelectionRect(){return Yd(this._getContentRect())}_getMouseBounds(e){return zu(e,this.getContentElement().getNativeElement())}}class Gu extends Vu{didMount(){super.didMount(),this.refs.scrollbar&&this.props.highlights&&this.props.highlights.on("highlights:updated",this.onHighlightsUpdated,this),this.refs.scrollbar&&(w.inBrowser&&(this.domObserver=new window.MutationObserver(this._onContentChanged.bind(this)),this.domObserver.observe(this.el.getNativeElement(),{subtree:!0,attributes:!0,characterData:!0,childList:!0})),this.context.editorSession.onPosition(this._onPosition,this))}dispose(){super.dispose(),this.props.highlights&&this.props.highlights.off(this),this.context.editorSession.off(this),this.context.dragManager.off(this),this.domObserver&&this.domObserver.disconnect()}render(e){let t=e("div").addClass("sc-scroll-pane");return w.isFF&&t.addClass("sm-firefox"),this.props.noStyle||t.addClass("sm-default-style"),"substance"===this.props.scrollbarType&&(t.addClass("sm-substance-scrollbar"),t.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),t.append(e(Uu,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),t.append(e("div").ref("scanline").addClass("se-scanline"))),t.append(e("div").ref("scrollable").addClass("se-scrollable").append(this.renderContent(e)).on("scroll",this.onScroll)),t}renderContent(e){let t=e("div").ref("content").addClass("se-content");return t.append(this.props.children),"custom"===this.props.contextMenu&&t.on("contextmenu",this._onContextMenu),t}_onContentChanged(){this._contentChanged=!0}_onPosition(){this.refs.scrollbar&&this._contentChanged&&(this._contentChanged=!1,this._updateScrollbar())}_updateScrollbar(){this.refs.scrollbar&&this.refs.scrollbar.updatePositions()}onHighlightsUpdated(e){this.refs.scrollbar.extendProps({highlights:e})}onScroll(){let e=this.getScrollPosition(),t=this.refs.scrollable;this.props.onScroll&&this.props.onScroll(e,t),this.props.tocProvider&&this.props.tocProvider.markActiveEntry(this),this.emit("scroll",e,t)}getHeight(){return this.getScrollableElement().height}getContentHeight(){return this.refs.content.el.getNativeElement().scrollHeight}getContentElement(){return this.refs.content.el}getScrollableElement(){return this.refs.scrollable.el}getScrollPosition(){return this.getScrollableElement().getProperty("scrollTop")}setScrollPosition(e){this.getScrollableElement().setProperty("scrollTop",e)}getPanelOffsetForElement(e){return Nu(e,this.refs.content.el).top}scrollTo(e,t){let r=this.getScrollableElement(),n=r.find(e);if(n){const e=this.getPanelOffsetForElement(n);let s=!0;if(t){const t=r.height,n=r.getProperty("scrollTop");s=e<n||n+t<e}s&&this.setScrollPosition(e)}else console.warn(`No match found for selector '${e}' in scrollable container`)}onSelectionPositioned(...e){super.onSelectionPositioned(...e),this._updateScrollbar()}_onContextMenu(e){super._onContextMenu(e),this._updateScrollbar()}}class Ju extends xu{render(e){let t=e("div").addClass("sc-toolbar");return t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}getTheme(){return this.props.theme||"light"}}class Ku extends Fu{willReceiveProps(){this.setState({showChoices:!1})}render(e){let t=this.getComponent("button"),r=this._getCommandStates(),n=e("div").addClass("sc-tool-dropdown");n.addClass("sm-"+this.props.name);const s=this._getToggleName(r)||this.props.name;if(this.props.showDisabled||this.hasEnabledTools(r)){let i;if("minimal"===this.props.style)i=e(t,{icon:s,dropdown:!0,active:this.state.showChoices,theme:this.props.theme}).on("click",this._toggleChoices);else{if("descriptive"!==this.props.style)throw new Error("Style "+this.props.style+" not supported");i=e(t,{label:s,commandState:r[s],dropdown:!0,active:this.state.showChoices,theme:this.props.theme}).on("click",this._toggleChoices)}n.append(i),this.state.showChoices?n.append(e("div").addClass("se-choices").append(e(Ru,{commandStates:r,items:this._getMenuItems(r)}))):"minimal"!==this.props.style&&s===this.props.name||n.append(this._renderToolTip(e))}return n}_renderToolTip(e){let t=this.context.labelProvider;return e(qu,{text:t.getLabel(this.props.name)})}_getToggleName(e){return this._getActiveCommandName(e)}_getMenuItems(e){const t=this.props.showDisabled;let n=[];return r(e,(e,r)=>{(t||this.isToolEnabled(r,e))&&n.push({command:r})}),n}_getActiveCommandName(e){let t;return r(e,(e,r)=>{e.active&&!t&&(t=r)}),t}_toggleChoices(){this.setState({showChoices:!this.state.showChoices})}}class $u extends Fu{_getClassNames(){return"sc-tool-prompt"}}class Xu extends Oh{render(e){return e("div").addClass("sc-tool-separator")}hasEnabledTools(){return!1}}class Wu extends xu{render(e){let t=e("div").addClass("sc-workflow-pane");return t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}getTheme(){return this.props.theme||"light"}}function Yu(e,t){!function e(t,r,n){r(t,n);if(t.getChildCount()>0){let s=t.getChildNodeIterator();for(;s.hasNext();)e(s.next(),r,n+1)}}(e,t,0)}var Zu=Object.freeze({findParentDOMElement:function(e){for(;e;){let t=nh.unwrap(e);if(t)return t;e=e.parentNode}},findParent:function(e,t){for(;e;){if(e.is(t))return e;e=e.getParent()}},stop:function(e){e.stopPropagation()},stopAndPrevent:function(e){e.stopPropagation(),e.preventDefault()},walk:Yu,isRightButton:function(e){let t=!1;return"which"in e?t=3===e.which:"button"in e&&(t=2===e.button),t},getBoundingRect:function(e){let t=e.getNativeElement().getBoundingClientRect();return{top:t.top,left:t.left,height:t.height,width:t.width}},getBoundingRectForRects:function(...e){let t,r,n,s;if(e.length>0){let i=e[0];t=i.top,r=i.left,n=t+i.height,s=r+i.width;for(let i=1;i<e.length;i++){let o=e[i];t=Math.min(t,o.top),r=Math.min(r,o.left),n=Math.max(n,o.top+o.height),s=Math.max(s,o.left+o.width)}}return{top:t,left:r,right:s,bottom:n,height:n-t,width:s-r}},isXInside:function(e,t){return e>=t.left&&e<=t.left+t.width},isYInside:function(e,t){return e>=t.top&&e<=t.top+t.height}});class Qu{}class ep{get(e){return arguments.length>1&&(e=Array.prototype.slice(arguments,0)),E(e)&&(e=[e]),Ut(this,e)}getAll(e){if(arguments.length>1&&(e=Array.prototype.slice(arguments,0)),E(e)&&(e=[e]),!_(e))throw new Error("Illegal argument for TreeIndex.get()");var t=Ut(this,e);return this._collectValues(t)}set(e,t){E(e)&&(e=[e]),Es(this,e,t,function(e){if(!e)return new Qu})}delete(e){if(E(e))delete this[e];else if(1===e.length)delete this[e[0]];else{var t=e[e.length-1],r=Ut(this,e=e.slice(0,-1));r&&delete r[t]}}clear(){for(var e in this)this.hasOwnProperty(e)&&delete this[e]}traverse(e){this._traverse(this,[],e)}forEach(...e){this.traverse(...e)}_traverse(e,t,r){var n;for(n in e)if(e.hasOwnProperty(n)){var s=e[n],i=t.concat([n]);s instanceof Qu?this._traverse(s,i,r):r(s,i)}}_collectValues(e){var t={};return this._traverse(e,[],function(e,r){var n=r[r.length-1];t[n]=e}),t}}ep.Arrays=class extends ep{contains(e){let t=super.get(e);return Boolean(t)}get(e){let t=super.get(e);return t instanceof Qu&&(t=t.__values__||[]),t}set(e,t){super.get(e).__values__=t}add(e,t){if(E(e)&&(e=[e]),!_(e))throw new Error("Illegal arguments.");var r;Es(this,e.concat(["__values__","__dummy__"]),void 0,function(e,t){return"__values__"===t?(e||(e=[]),r=e):e||(e=new Qu),e}),delete r.__dummy__,r.push(t)}remove(e,t){var r=Ut(this,e);r instanceof Qu&&(1===arguments.length?delete r.__values__:mu(r.__values__,t))}_collectValues(e){var t=[];return this._traverse(e,[],function(e){t.push(e)}),t=Array.prototype.concat.apply([],t)}};class tp extends Sd{constructor(){super(),this.byPath=new ep,this.byType=new ep}select(e){return e.isPropertyAnnotation()||e.isInlineNode()}clear(){this.byPath.clear(),this.byType.clear()}get(e,t,r,n){var s;return s=g(s=E(e)||1===e.length?this.byPath.getAll(e)||{}:this.byPath.get(e)),C(t)&&(s=vd(s,tp.filterByRange(t,r))),n&&(s=vd(s,Sd.filterByType(n))),s}create(e){const t=e.start.path;this.byType.set([e.type,e.id],e),t&&t.length>0&&this.byPath.set(e.start.path.concat([e.id]),e)}delete(e){this._delete(e.type,e.id,e.start.path)}_delete(e,t,r){this.byType.delete([e,t]),r&&r.length>0&&this.byPath.delete(r.concat([t]))}update(e,t,r,n){this.select(e)&&"start"===t[1]&&"path"===t[2]&&(this._delete(e.type,e.id,n),this.create(e))}}tp.filterByRange=function(e,t){return function(r){var n=r.start.offset,s=r.end.offset>=e;return C(t)&&(s=s&&n<=t),s}};class rp extends wd{static isBlock(){return!0}}function np(e,t){if(!t)throw new Error("'selection' is mandatory.");let n=null;return t.isNull()||t.isCollapsed()||(t.isPropertySelection()?n=function(e,t){let n=t.start.path,s=t.start.offset,i=t.end.offset,o=e.get(n),a=e.createSnippet(),l=a.getContainer();return a.create({type:e.schema.getDefaultTextType(),id:qd,content:o.substring(s,i)}),l.show(qd),r(e.getIndex("annotations").get(n,s,i),function(e){let t=v(e.toJSON()),r=[qd,"content"];t.start={path:r,offset:Math.max(s,e.start.offset)-s},t.end={path:r,offset:Math.min(i,e.end.offset)-s},a.create(t)}),a}(e,t):t.isContainerSelection()?n=function(e,t){let r=e.createSnippet(),n=r.getContainer(),s=t.getNodeIds(),i=s.length;if(0===i)return r;let o=t.start,a=t.end,l=!1,c=!1,h={};for(let t=0;t<i;t++){let d=s[t],u=e.get(d);0===t&&Oi(e,o)?l=!0:t===i-1&&Di(e,a)?c=!0:h[d]||(Od(u).forEach(e=>{let t=r.create(e);h[t.id]=!0}),n.show(d))}if(!l){let e=r.get(o.getNodeId()).getContainerRoot();e.isText()?Pd(r,null,o):e.isList()&&kd(r,e,null,o)}if(!c){let e=r.get(a.getNodeId()).getContainerRoot();e.isText()?Pd(r,a,null):e.isList()&&kd(r,e,a,null)}return r}(e,t):t.isNodeSelection()?n=function(e,t){let r=e.createSnippet(),n=r.getContainer(),s=t.getNodeId(),i=e.get(s);return Od(i).forEach(e=>{r.create(e)}),n.show(i.id),r}(e,t):console.error("Copy is not yet supported for selection type.")),n}function sp(e,t,r,n){if(n[r])throw new Error("FIXME: dont call me twice");const s=e.get(r,"strict");let i,o=s.id;t.contains(s.id)&&(i=d(s.type),s.id=i),n[r]=s.id;const a=e.getIndex("annotations"),l=s.getSchema();let c=[];for(let r of l){const l=r.name;if("id"!==l&&"type"!==l)if(r.isReference()&&r.isOwned()||"file"===r.type){let i=s[r.name];if(r.isArray())ip(e,t,i,n);else{let r=i;n[r]||(s[l]=sp(e,t,r,n))}}else if(r.isText()){let e=a.get([o,r.name]);for(let t=0;t<e.length;t++){let r=e[t];r.start.path[0]===o&&i&&(r.start.path[0]=i),r.end.path[0]===o&&i&&(r.end.path[0]=i),c.push(r)}}}t.create(s);for(let r=0;r<c.length;r++)sp(e,t,c[r].id,n);return s.id}function ip(e,t,r,n){for(let s=0;s<r.length;s++){let i=r[s];if(_(i))ip(e,t,i,n);else{let o=i;o&&!n[o]&&(r[s]=sp(e,t,o,n))}}}function op(e,t){let r=e.selection;if(!r||r.isNull())throw new Error("Can not paste without selection.");if(r.isCustomSelection())throw new Error("Paste not implemented for custom selection.");(t=t||{}).text=t.text||"";let n=t.doc,s=Boolean(r.containerId);if(r.isCollapsed()||e.deleteSelection(),!n){if(!s)return void e.insertText(t.text);n=function(e,t){let r,n=t.text.split(/\s*\n\s*\n/),s=e.getDocument().newInstance(),i=s.getSchema().getDefaultTextType(),o=s.create({type:"@container",id:Rd,nodes:[]});if(1===n.length)r=s.create({id:qd,type:i,content:n[0]}),o.show(r.id);else for(let e=0;e<n.length;e++)r=s.create({id:d(i),type:i,content:n[e]}),o.show(r.id);return s}(e,t)}let i=n.get(Rd),o=i.getLength();if(0===o)return;let a=i.getChildAt(0);return s?(a.isText()&&(ap(e,n),i.hideAt(0),o--),o>0&&function(e,t){let r,n=e.selection,s=n.containerId,i=e.get(s);if(n.isPropertySelection()){let t=n.start.path,s=n.start.getNodeId(),o=i.getPosition(s,"strict"),a=e.get(t);0===a.length?(r=o,i.hide(s),Dd(e,e.get(s))):a.length===n.start.offset?r=o+1:(e.break(),r=o+1)}else if(n.isNodeSelection()){let e=i.getPosition(n.getNodeId(),"strict");if(n.isBefore())r=e;else{if(!n.isAfter())throw new Error("Illegal state: the selection should be collapsed.");r=e+1}}let o=[],a={},l=t.get(Rd).nodes.map(e=>t.get(e)),c=e.getProperty(i.getContentPath()).targetTypes;c&&c.length>0&&(l=l.filter(e=>c.indexOf(e.type)>=0));for(let t of l){let n=sp(t.getDocument(),e,t.id,a);t=e.get(n),i.showAt(r++,n),o.push(t)}if(o.length>0){let t=wi(o);Mi(e,t,s,"after")}}(e,n)):1===o?a.isText()&&ap(e,n):ap(e,n=function(e,t){let r=e.selection.start.path,n=e.createSnippet(),s=n.getSchema().getDefaultTextType(),i=t.get("snippet").getContent(),o=[],a=0,l=[];for(let e of i){let n=t.get(e);if(n.isText()){let e=n.getText();o.length>0&&(o.push(" "),a+=1);let t=g(n.getAnnotations(),e=>{let t=e.toJSON();return t.start.path=r.slice(0),t.start.offset+=a,t.end.offset+=a,t});o.push(e),l=l.concat(t),a+=e.length}}return n.create({id:qd,type:s,content:o.join("")}),l.forEach(e=>n.create(e)),n.getContainer().show(qd),n}(e,n)),t}function ap(e,t){let r=e.selection;const n=t.get(Rd).nodes[0],s=t.get(n).getPath(),i=t.get(s),o=t.getIndex("annotations").get(s);let a=r.start.path,l=r.start.offset;e.insertText(i);let c=e.getProperty(a);if(c.isText()){let t=g(o),r=c.targetTypes;r&&(t=t.filter(e=>r.indexOf(e.type)>=0));for(let r of t){let t=r.toJSON();t.start.path=a.slice(0),t.start.offset+=l,t.end.offset+=l,e.get(t.id)&&(t.id=d(t.type)),e.create(t)}}}class lp{annotate(e,t){let r=e.selection,n=e.getSchema().getNodeClass(t.type);if(!n)throw new Error("Unknown annotation type",t);let s={start:r.start,end:r.end,containerId:r.containerId};if(r.isPropertySelection()){if(!n.isAnnotation())throw new Error("Annotation can not be created for a selection.")}else r.isContainerSelection()&&n.isPropertyAnnotation()&&console.warn("NOT SUPPORTED YET: creating property annotations for a non collapsed container selection.");return Object.assign(s,t),e.create(s)}break(e){let t=e.selection;if(t.isNodeSelection()){let r=t.containerId,n=e.get(r),s=t.getNodeId(),i=n.getPosition(s,"strict"),o=this.createTextNode(e,n);t.isBefore()?n.showAt(i,o.id):(n.showAt(i+1,o.id),Mi(e,o,r,"before"))}else if(t.isCustomSelection());else if(t.isCollapsed()||t.isPropertySelection()){let r=t.containerId;if(t.isCollapsed()||(this._deletePropertySelection(e,t),e.setSelection(t.collapse("left"))),r){let n=e.get(r),s=t.start.path[0],i=e.get(s);this._breakNode(e,i,t.start,n)}}else if(t.isContainerSelection()){let r=t.start,n=t.containerId,s=e.get(n),i=r.path[0],o=s.getPosition(i,"strict");this._deleteContainerSelection(e,t,{noMerge:!0}),Mi(e,s.getNodeAt(o+1),n,"before")}}createTextNode(e,t,r){return e.createDefaultTextNode(r)}createListNode(e,t,r={}){return e.create({type:"list",items:[],listType:r.listType||"bullet"})}delete(e,t){let r=e.selection;if(r.isNodeSelection())this._deleteNodeSelection(e,r,t);else if(r.isCustomSelection());else if(r.isCollapsed()){let n=r.start.path,s=e.get(n[0]),i=e.get(n),o=r.start.offset;if(r.containerId&&(0===o&&"left"===t||o===i.length&&"right"===t)){let n=s.getContainerRoot();if(n.isList()&&0===o&&"left"===t)return this.toggleList(e);{let s=e.get(r.containerId);this._merge(e,n,r.start,t,s)}}else{if(0===o&&"left"===t||o===i.length&&"right"===t)return;let s="left"===t?o-1:o;Pd(e,{path:n,offset:s},{path:n,offset:s+1}),e.setSelection({type:"property",path:n,startOffset:s,containerId:r.containerId})}}else r.isPropertySelection()?(Pd(e,r.start,r.end),e.setSelection(r.collapse("left"))):r.isContainerSelection()?this._deleteContainerSelection(e,r):console.warn("Unsupported case: tx.delete(%)",t,r)}_deleteNodeSelection(e,t,r){let n=t.getNodeId(),s=e.get(t.containerId),i=s.getPosition(n,"strict");if(t.isFull()||t.isBefore()&&"right"===r||t.isAfter()&&"left"===r){s.hideAt(i),Dd(e,e.get(n));let t=this.createTextNode(e,s);s.showAt(i,t.id),e.setSelection({type:"property",path:t.getPath(),startOffset:0,containerId:s.id})}else if(t.isBefore()&&"left"===r){if(i>0){let t=s.getNodeAt(i-1);t.isText()?(e.setSelection({type:"property",path:t.getPath(),startOffset:t.getLength()}),this.delete(e,r)):e.setSelection({type:"node",nodeId:t.id,containerId:s.id})}}else if(t.isAfter()&&"right"===r){if(i<s.getLength()-1){let t=s.getNodeAt(i+1);t.isText()?(e.setSelection({type:"property",path:t.getPath(),startOffset:0}),this.delete(e,r)):e.setSelection({type:"node",nodeId:t.id,containerId:s.id})}}else console.warn("Unsupported case: delete(%s)",r,t)}_deletePropertySelection(e,t){let r=t.start.path,n=t.start.offset,s=t.end.offset;e.update(r,{type:"delete",start:n,end:s}),xd.deletedText(e,r,n,s)}_deleteContainerSelection(e,t,r={}){let n=t.containerId,s=e.get(n),i=t.start,o=t.end,a=i.getNodeId(),l=o.getNodeId(),c=s.getPosition(a,"strict"),h=s.getPosition(l,"strict");if(c===h){let r=e.get(a).getContainerRoot();if(r.isText())Pd(e,i,o);else{if(!r.isList())throw new Error("Not supported yet.");kd(e,r,i,o)}return void e.setSelection(t.collapse("left"))}let d=e.get(i.getNodeId()),u=e.get(o.getNodeId()),p=Pi(e,d,i,null),f=Pi(e,u,null,o);if(f)s.hideAt(h),Dd(e,u);else{let t=u.getContainerRoot();t.isText()?Pd(e,null,o):t.isList()&&kd(e,t,null,o)}for(let t=h-1;t>c;t--){let r=s.getNodeIdAt(t);s.hideAt(t),Dd(e,e.get(r))}if(p)s.hideAt(c),Dd(e,d);else{let t=d.getContainerRoot();t.isText()?Pd(e,i,null):t.isList()&&kd(e,t,i,null)}if(p&&f){let t=this.createTextNode(e,s);s.showAt(c,t.id),e.setSelection({type:"property",path:t.getPath(),startOffset:0,containerId:n})}else p||f?p?Mi(e,u,s.id,"before"):Mi(e,d,s.id,"after"):(r.noMerge||this._merge(e,d,t.start,"right",s),e.setSelection(t.collapse("left")))}insertInlineNode(e,t){let r=e.selection;this.insertText(e,"\ufeff"),r=e.selection;let n=e.selection.end.offset,s=n-"\ufeff".length;return t=Object.assign({},t,{start:{path:r.path,offset:s},end:{path:r.path,offset:n}}),e.create(t)}insertBlockNode(e,t){let r,n=e.selection;if(r=t._isNode&&e.get(t.id)?e.get(t.id):e.create(t),n.isNodeSelection()){let t=n.containerId,s=e.get(t),i=n.getNodeId(),o=s.getPosition(i,"strict");n.isBefore()?s.showAt(o,r.id):n.isAfter()?(s.showAt(o+1,r.id),e.setSelection({type:"node",containerId:t,nodeId:r.id,mode:"after"})):(s.hideAt(o),Dd(e,e.get(i)),s.showAt(o,r.id),e.setSelection({type:"node",containerId:t,nodeId:r.id,mode:"after"}))}else if(n.isPropertySelection()){if(!n.containerId)throw new Error("insertBlockNode can only be used within a container.");let t=e.get(n.containerId);n.isCollapsed()||(this._deletePropertySelection(e,n),e.setSelection(n.collapse("left")));let s=e.get(n.path[0]);if(!s)throw new Error("Invalid selection.");let i=t.getPosition(s.id,"strict");if(s.isText()){let o=s.getText();0===o.length?(t.hideAt(i),Dd(e,s),t.showAt(i,r.id),Mi(e,r,t.id,"after")):0===n.start.offset?t.showAt(i,r.id):n.start.offset===o.length?(t.showAt(i+1,r.id),Mi(e,r,t.id,"before")):(this.break(e),t.showAt(i+1,r.id),Mi(e,r,t.id,"after"))}else console.error("Not supported: insertBlockNode() on a custom node")}else if(n.isContainerSelection()){if(n.isCollapsed()){let t=n.start;if(t.isPropertyCoordinate())e.setSelection({type:"property",path:t.path,startOffset:t.offset,containerId:n.containerId});else{if(!t.isNodeCoordinate())throw new Error("Unsupported selection for insertBlockNode");e.setSelection({type:"node",containerId:n.containerId,nodeId:t.path[0],mode:0===t.offset?"before":"after"})}return this.insertBlockNode(e,r)}return this.break(e),this.insertBlockNode(e,r)}return r}insertText(e,t){let r=e.selection;if(r.isNodeSelection()){let n=r.containerId,s=e.get(n),i=r.getNodeId(),o=s.getPosition(i,"strict"),a=this.createTextNode(e,s,t);r.isBefore()?s.showAt(o,a):r.isAfter()?s.showAt(o+1,a):(s.hide(i),Dd(e,e.get(i)),s.showAt(o,a)),Mi(e,a,r.containerId,"after")}else r.isCustomSelection()||(r.isCollapsed()||r.isPropertySelection()?this._insertText(e,r,t):r.isContainerSelection()&&(this._deleteContainerSelection(e,r),this.insertText(e,t)))}paste(e,t){if(t)if(E(t))op(e,{text:t});else{if(!t._isDocument)throw new Error("Illegal content for paste.");op(e,{doc:t})}}switchTextType(e,t){let r=e.selection;if(!r.isPropertySelection())throw new Error("Selection must be a PropertySelection.");let n=r.containerId;if(!n)throw new Error("Selection must be within a container.");let s=r.path,i=s[0],o=e.get(i);if(!o.isInstanceOf("text"))throw new Error("Trying to use switchTextType on a non text node.");const a=d(t.type),l=o.getPath();console.assert(2===l.length,"Currently we assume that TextNodes store the plain-text on the first level");const c=l[1];let h=[a,c],u=Object.assign({id:a,type:t.type,direction:o.direction},t);u[c]=o.getText();let p=e.create(u);xd.transferAnnotations(e,s,0,h,0);let f=e.get(r.containerId),g=f.getPosition(i,"strict");return f.hide(i),Dd(e,o),f.showAt(g,p.id),e.setSelection({type:"property",path:h,startOffset:r.start.offset,endOffset:r.end.offset,containerId:n}),p}toggleList(e,t){let r=e.selection,n=e.get(r.containerId);if(!n)throw new Error("Selection must be within a container.");if(r.isPropertySelection()){let s=r.start.path[0],i=e.get(s).getContainerRoot(),o=n.getPosition(i.id,"strict");if(i.isText()){n.hideAt(o);let s=this.createListNode(e,n,t),a=s.createListItem(i.getText());xd.transferAnnotations(e,i.getPath(),0,a.getPath(),0),s.appendItem(a),Dd(e,i),n.showAt(o,s.id),e.setSelection({type:"property",path:a.getPath(),startOffset:r.start.offset,containerId:r.containerId})}else if(i.isList()){let t=r.start.path[0],s=e.get(t),a=i.getItemPosition(s),l=this.createTextNode(e,n,s.getText());if(xd.transferAnnotations(e,s.getPath(),0,l.getPath(),0),i.removeItemAt(a),i.isEmpty())n.hideAt(o),Dd(e,i),n.showAt(o,l.id);else if(0===a)n.showAt(o,l.id);else if(i.getLength()<=a)n.showAt(o+1,l.id);else{let t=[];const r=i.getItems();for(let e=r.length-1;e>=a;e--)t.unshift(r[e]),i.removeItemAt(e);let s=this.createListNode(e,n,i);for(let e=0;e<t.length;e++)s.appendItem(t[e]);n.showAt(o+1,l.id),n.showAt(o+2,s.id)}e.setSelection({type:"property",path:l.getPath(),startOffset:r.start.offset,containerId:r.containerId})}}else r.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}indent(e){let t=e.selection;if(t.isPropertySelection()){let r=t.start.getNodeId(),n=e.get(r).getContainerRoot();if(n.isList()){let r=t.start.path[0],s=e.get(r),i=s.getLevel();s&&i<3&&(s.setLevel(s.level+1),e.set([n.id,"_itemsChanged"],!0))}}else t.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}dedent(e){let t=e.selection;if(t.isPropertySelection()){let r=t.start.getNodeId(),n=e.get(r).getContainerRoot();if(n.isList()){let r=t.start.path[0],s=e.get(r),i=s.getLevel();s&&i>1&&(s.setLevel(s.level-1),e.set([n.id,"_itemsChanged"],!0))}}else t.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}_insertText(e,t,r){let n=t.start,s=t.end;if(!Ci(n.path,s.path))throw new Error("Unsupported state: range should be on one property");let i=n.path,o=n.offset,a=s.offset,l=!t.isCollapsed(),c=r.length;l&&e.update(i,{type:"delete",start:o,end:a}),e.update(i,{type:"insert",start:o,text:r}),e.getAnnotations(i).forEach(function(t){let r=t.start.offset,n=t.end.offset;n<o||(r>=a?(e.update([t.id,"start"],{type:"shift",value:o-a+c}),e.update([t.id,"end"],{type:"shift",value:o-a+c})):r>=o&&n<a||t.isInlineNode()&&r>=o&&n<=a?e.delete(t.id):r>=o&&n>=a?((r>o||!l)&&e.update([t.id,"start"],{type:"shift",value:o-r+c}),e.update([t.id,"end"],{type:"shift",value:o-a+c})):r<o&&n<a?e.update([t.id,"end"],{type:"shift",value:o-n+c}):(n!==o||t.constructor.autoExpandRight)&&(r<o&&n>=a?t.isInlineNode()||e.update([t.id,"end"],{type:"shift",value:o-a+c}):console.warn("TODO: handle annotation update case.")))});let h=o+r.length;e.setSelection({type:"property",path:n.path,startOffset:h,containerId:t.containerId,surfaceId:t.surfaceId})}_breakNode(e,t,r,n){(t=t.getContainerRoot()).isText()?this._breakTextNode(e,t,r,n):t.isList()?this._breakListNode(e,t,r,n):console.error("FIXME: _breakNode() not supported for type",t.type)}_breakTextNode(e,t,r,n){let s=r.path,i=r.offset,o=n.getPosition(t.id,"strict"),a=t.getText();if(0===i){let r=e.create({type:t.type,content:""});n.showAt(o,r.id),e.setSelection({type:"property",path:s,startOffset:0,containerId:n.id})}else{const r=t.getPath()[1],l=d(t.type);let c=t.toJSON();c.id=l,c[r]=a.substring(i),i===a.length&&(c.type=e.getSchema().getDefaultTextType());let h=e.create(c);i<a.length&&(xd.transferAnnotations(e,s,i,h.getPath(),0),e.update(s,{type:"delete",start:i,end:a.length})),n.showAt(o+1,h.id),e.setSelection({type:"property",path:h.getPath(),startOffset:0,containerId:n.id})}}_breakListNode(e,t,r,n){let s=r.path,i=r.offset,o=e.get(s[0]),a=t.length,l=t.getItemPosition(o),c=o.getText(),h=o.getPath()[1],d=o.toJSON();if(delete d.id,0===i)if(c){d[h]="";let r=e.create(d);t.insertItemAt(l,r),e.setSelection({type:"property",path:o.getPath(),startOffset:0})}else{let r=n.getPosition(t.id,"strict"),s=this.createTextNode(e,n);if(a<2)n.hide(t.id),Dd(e,t),n.showAt(r,s.id);else if(0===l)t.removeItem(o),Dd(e,o),n.showAt(r,s.id);else if(l>=a-1)t.removeItem(o),Dd(e,o),n.showAt(r+1,s.id);else{let i=[];const o=t.getItems().slice();for(let e=a-1;e>l;e--)i.unshift(o[e]),t.removeItem(o[e]);t.removeItem(o[l]);let c=this.createListNode(e,n,t);for(let e=0;e<i.length;e++)c.appendItem(i[e]);n.showAt(r+1,s.id),n.showAt(r+2,c.id)}e.setSelection({type:"property",path:s.getPath(),startOffset:0})}else{d[h]=c.substring(i);let r=e.create(d);i<c.length&&(xd.transferAnnotations(e,s,i,r.getPath(),0),e.update(s,{type:"delete",start:i,end:c.length})),t.insertItemAt(l+1,r),e.setSelection({type:"property",path:r.getPath(),startOffset:0})}}_merge(e,t,r,n,s){if(t.isList()){let i=t,o=r.path[0],a=e.get(o),l=i.getItemPosition(a);if("left"===n&&l>0||"right"===n&&l<i.items.length-1){l="left"===n?l-1:l;let t=i.getItemAt(l),r=t.getLength();return Md(e,i.id,l),void e.setSelection({type:"property",path:t.getPath(),startOffset:r,containerId:s.id})}}let i=s.getPosition(t,"strict");"left"===n&&i>0?this._mergeNodes(e,s,i-1,n):"right"===n&&i<s.getLength()-1&&this._mergeNodes(e,s,i,n)}_mergeNodes(e,t,r,n){let s=t.getChildAt(r),i=t.getChildAt(r+1);if(s.isText()){if(s.isEmpty())return t.hide(s.id),Dd(e,s),void Mi(e,i,t.id,"before");let r=s,o=r.getPath(),a=r.getLength();if(i.isText()){let r=i,n=r.getPath();t.hide(r.id),e.update(o,{type:"insert",start:a,text:r.getText()}),xd.transferAnnotations(e,n,0,o,a),Dd(e,r),e.setSelection({type:"property",path:o,startOffset:a,containerId:t.id})}else if(i.isList()){let r=i;if(!i.isEmpty()){let t=r.getFirstItem(),n=t.getPath();r.removeItemAt(0),e.update(o,{type:"insert",start:a,text:t.getText()}),xd.transferAnnotations(e,n,0,o,a),Dd(e,t)}r.isEmpty()&&(t.hide(r.id),Dd(e,r)),e.setSelection({type:"property",path:o,startOffset:a,containerId:t.id})}else Li(e,"left"===n?s.id:i.id,t.id)}else if(s.isList())if(i.isText()){let n=s.getLastItem(),o=n.getPath(),a=n.getLength(),l=t.length>r+2?t.getChildAt(r+2):null;if(0===i.getLength())t.hide(i.id),Dd(e,i);else{let r=i,n=r.getPath();t.hide(r.id),e.update(o,{type:"insert",start:a,text:r.getText()}),xd.transferAnnotations(e,n,0,o,a),Dd(e,r)}l&&l.type===s.type&&this._mergeTwoLists(e,t,s,l),e.setSelection({type:"property",path:n.getPath(),startOffset:a,containerId:t.id})}else if(i.isList()){if("right"!==n)throw new Error("Illegal state");let r=s.getLastItem();this._mergeTwoLists(e,t,s,i),e.setSelection({type:"property",path:r.getPath(),startOffset:r.getLength(),containerId:t.id})}else Li(e,"left"===n?s.id:i.id,t.id);else i.isText()&&i.isEmpty()?(t.hide(i.id),Dd(e,i),Mi(e,s,t.id,"after")):Li(e,"left"===n?s.id:i.id,t.id)}_mergeTwoLists(e,t,r,n){t.hide(n.id);let s=n.getItems().slice();for(let e=0;e<s.length;e++)n.removeItemAt(0),r.appendItem(s[e]);Dd(e,n)}}class cp{constructor(e,t={}){this._document=e,this._selection=null,this._impl=t.editing||new lp,this._direction=null}dispose(){}getDocument(){return this._document}get(...e){return this._document.get(...e)}getProperty(...e){return this._document.getProperty(...e)}contains(e){return this._document.contains(e)}create(e){return this._document.create(e)}createDefaultTextNode(e){return this._document.createDefaultTextNode(e,this._direction)}delete(e){return this._document.delete(e)}set(e,t){return this._document.set(e,t)}update(e,t){return this._document.update(e,t)}updateNode(e,t){return this._document.updateNode(e,t)}createSelection(e){return e=Bi(e,this._selection),this._document.createSelection(e)}setSelection(e){return e?m(e)?e=this.createSelection(e):e.isNull()||(e=Bi(e,this._selection)):e=bi.nullSelection,this._selection=e,e}getSelection(){return this._selection}get selection(){return this._selection}set selection(e){this.setSelection(e)}get textDirection(){return this._direction}set textDirection(e){this._direction=e}annotate(e){const t=this._selection;if(t&&(t.isPropertySelection()||t.isContainerSelection()))return this._impl.annotate(this,e)}break(){this._selection&&!this._selection.isNull()&&this._impl.break(this)}copySelection(){const e=this._selection;if(e&&!e.isNull()&&!e.isCollapsed())return np(this.getDocument(),this._selection)}deleteSelection(e){const t=this._selection;!t||t.isNull()||t.isCollapsed()||this._impl.delete(this,"right",e)}deleteCharacter(e){const t=this._selection;!t||t.isNull()||(t.isCollapsed()?this._impl.delete(this,e):this.deleteSelection())}insertText(e){const t=this._selection;t&&!t.isNull()&&this._impl.insertText(this,e)}insertInlineNode(e){const t=this._selection;if(t&&!t.isNull()&&t.isPropertySelection())return this._impl.insertInlineNode(this,e)}insertBlockNode(e){const t=this._selection;if(t&&!t.isNull())return this._impl.insertBlockNode(this,e)}paste(e){const t=this._selection;if(t&&!t.isNull()&&!t.isCustomSelection())return this._impl.paste(this,e)}switchTextType(e){const t=this._selection;if(t&&!t.isNull())return this._impl.switchTextType(this,e)}toggleList(e){const t=this._selection;if(t&&!t.isNull())return this._impl.toggleList(this,e)}indent(){const e=this._selection;if(e&&!e.isNull())return this._impl.indent(this)}dedent(){const e=this._selection;if(e&&!e.isNull())return this._impl.dedent(this)}getIndex(...e){return this._document.getIndex(...e)}getAnnotations(...e){return this._document.getAnnotations(...e)}getSchema(){return this._document.getSchema()}createSnippet(){return this._document.createSnippet()}}class hp extends cp{constructor(e){super(e.clone())}generateChange(){const e=this.getDocument(),t=e._ops.slice();e._ops.length=0;let r=new ji(t,{},{});return r._extractInformation(e),r}}function dp(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}class up{constructor(e,t){if(this.context=t||{},!e.converters)throw new Error("config.converters is mandatory");if(e.converters._isRegistry?this.converters=e.converters:(this.converters=new od,e.converters.forEach(function(e){let t=no(e)?new e:e;t.type?this.converters.add(t.type,t):console.error("Converter must provide the type of the associated node.",t)}.bind(this))),this.state={doc:null},this.config=e,this._elementFactory=e.elementFactory,!this._elementFactory)throw new Error("'elementFactory' is mandatory");this.$$=this.createElement.bind(this)}exportDocument(e){return this.convertDocument(e)}convertDocument(e){throw new Error("This method is abstract")}convertContainer(e){if(!e)throw new Error("Illegal arguments: container is mandatory.");const t=e.getDocument();this.state.doc=t;let r=[];return e.getContent().forEach(e=>{const n=t.get(e),s=this.convertNode(n);r.push(s)}),r}convertNode(e){E(e)?e=this.state.doc.get(e):this.state.doc=e.getDocument();var t,r=this.getNodeConverter(e);return!e.isPropertyAnnotation()||r&&r.export?(r||(r=this.getDefaultBlockConverter()),(t=r.tagName?this.$$(r.tagName):this.$$("div")).attr(this.config.idAttribute,e.id),t=r.export?r.export(e,t,this)||t:this.getDefaultBlockConverter().export(e,t,this)||t):this._convertPropertyAnnotation(e)}convertProperty(e,t,r){return this.initialize(e,r),this.$$("div").append(this.annotatedText(t)).innerHTML}annotatedText(e){var t=this.state.doc,r=t.get(e),n=t.getIndex("annotations").get(e);return this._annotatedText(r,n)}getNodeConverter(e){return this.converters.get(e.type)}getDefaultBlockConverter(){throw new Error("This method is abstract.")}getDefaultPropertyAnnotationConverter(){throw new Error("This method is abstract.")}getDocument(){return this.state.doc}createElement(e){return this._elementFactory.createElement(e)}_annotatedText(e,t){var r=this,n=new Hh;n.onText=function(e,t){t&&(r.config.ENCODE_ENTITIES_IN_TEXT&&(t=dp(t)),e.children.push(t))},n.onEnter=function(e){return{annotation:e.node,children:[]}},n.onExit=function(e,t,n){var s,i=t.annotation,o=r.getNodeConverter(i);if(o||(o=r.getDefaultPropertyAnnotationConverter()),(s=o.tagName?this.$$(o.tagName):this.$$("span")).attr(this.config.idAttribute,i.id),i.isInlineNode())s=o.export?o.export(i,s,r)||s:this.convertNode(i)||s;else{if(!i.isAnnotation())throw new Error("Illegal element type: only inline nodes and annotations are allowed within a TextNode");if(o.export&&(s=o.export(i,s,r)||s).children.length)throw new Error("A converter for an annotation type must not convert children. The content of an annotation is owned by their TextNode.");s.append(t.children)}n.children.push(s)}.bind(this);var s={children:[]};return n.start(s,e,t),s.children}_convertPropertyAnnotation(e){return this.$$("div").append(this.annotatedText(e.path)).find("["+this.config.idAttribute+'="'+e.id+'"]')}}class pp extends up{constructor(e,t){super(function(e){(e=Object.assign({idAttribute:"data-id"},e)).elementFactory||(e.elementFactory=nh.createDocument("html"));return e}(e),t)}exportDocument(e){let t=nh.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(e,t)}getDefaultBlockConverter(){return gp}getDefaultPropertyAnnotationConverter(){return fp}}const fp={tagName:"span",export:function(e,t){t.tagName="span",t.attr("data-type",e.type),r(e.toJSON(),function(e,r){"id"!==r&&"type"!==r&&(E(e)||C(e)||ch(e))&&t.attr("data-"+r,e)})}},gp={export:function(e,t,n){t.attr("data-type",e.type),r(e.toJSON(),function(r,s){if("id"!==s&&"type"!==s){var i=n.$$("div").attr("property",s);"string"===e.getPropertyType(s)&&r?i.append(n.annotatedText([e.id,s])):i.text(r),t.append(i)}})}};class mp{importDocument(e,t){if(!t.nodes)throw new Error("Invalid JSON format.");var n=e.getSchema();if(t.schema&&n.name!==t.schema.name)throw new Error("Incompatible schema.");var s=t.nodes;return e.import(function(e){r(s,function(t){e.get(t.id)&&e.delete(t.id),e.create(t)})}),e}exportDocument(e){var t={schema:{name:e.getSchema().name},nodes:{}};return r(e.getNodes(),function(e){e._isDocumentNode&&(t.nodes[e.id]=e.toJSON())}),t}}class _p extends pp{exportDocument(e){let t;this.state.doc=e;let r=this.convertDocument(e);t=1===r.length&&r[0].attr("data-id")===qd?r[0].innerHTML:r.map(function(e){return e.outerHTML}).join("");let n=new mp;return"<html><head>"+`<script id="substance-clipboard" type="application/json">${JSON.stringify(n.exportDocument(e))}<\/script>`+"</head><body>"+t+"</body></html>"}convertDocument(e){let t=e.get(Rd);if(!t)throw new Error('Illegal clipboard document: could not find container "'+Rd+'"');return this.convertContainer(t)}}function yp(){var e={};return function(t){return e.hasOwnProperty(t)||(e[t]=1),[t,"-",e[t]++].join("")}}const wp=/^\s+/g,bp=/\s+$/g,vp=/\s+/g,Cp=" ",Sp=/[\t\n\r]+/g,xp="​";class Ep{constructor(e,t){if(this.context=t||{},!e.schema)throw new Error('"config.schema" is mandatory');if(!e.converters)throw new Error('"config.converters" is mandatory');this.config=Object.assign({idAttribute:"id"},e),this.schema=e.schema,this.converters=e.converters,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[],this.state=new Ep.State,this._initialize()}_initialize(){const e=this.schema,t=e.getDefaultTextType(),r=this.converters;for(let n=0;n<r.length;n++){let s;if("function"==typeof r[n]){s=new(0,r[n])}else s=r[n];if(!s.type)throw new Error("Converter must provide the type of the associated node.");if(!s.matchElement&&!s.tagName)throw new Error("Converter must provide a matchElement function or a tagName property.");s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));const i=e.getNodeClass(s.type);if(!i)throw new Error("No node type defined for converter");this._defaultBlockConverter||t!==s.type||(this._defaultBlockConverter=s),this._allConverters.push(s),i.isPropertyAnnotation()||i.isInlineNode()?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s)}}dispose(){this.state.doc&&this.state.doc.dispose()}reset(){this.state.doc&&this.state.doc.dispose(),this.state.reset(),this.state.doc=this._createDocument()}getDocument(){return this.state.doc}convertContainer(e,t){this.state.doc||this.reset();const r=this.state,n=new so(e),s=[];for(;n.hasNext();){const e=n.next();let t;const i=this._getConverterForElement(e,"block");if(i){r.pushContext(e.tagName,i);let n=this._createNodeData(e,i.type);n=i.import(e,n,this)||n,t=this._createNode(n),r.popContext().annos.forEach(e=>{this._createNode(e)})}else{if(e.isCommentNode())continue;if(e.isTextNode()&&/^\s*$/.exec(e.textContent))continue;n.back(),t=this._wrapInlineElementsIntoBlockElement(n)}t&&s.push(t.id)}return this._createNode({type:"@container",id:t,nodes:s})}convertElement(e){this.state.doc||this.reset();let t,r,n=!this.state.isConverting;n&&(this.state.isConverting=!0);const s=this._getConverterForElement(e);if(!s)throw new Error("No converter found for "+e.tagName);{const n=this.schema.getNodeClass(s.type);t=this._createNodeData(e,s.type),this.state.pushContext(e.tagName,s),t=n.isInlineNode()?this._convertInlineNode(e,t,s):n.isPropertyAnnotation()?this._convertPropertyAnnotation(e,t):s.import(e,t,this)||t,r=this.state.popContext().annos}const i=this._createNode(t);return r.forEach(e=>{this._createNode(e)}),this.config["stand-alone"]&&n&&(this.state.isConverting=!1,this.reset()),i}annotatedText(e,t,r={}){if(!t)throw new Error("path is mandatory");const n=this.state,s=wi(n.contexts);if(!s)throw new Error("This should be called from within an element converter.");const i=n.preserveWhitespace;r.preserveWhitespace&&(n.preserveWhitespace=!0),n.stack.push({path:t,offset:0,text:"",annos:[]}),this.state.lastChar="";const o=this.getChildNodeIterator(e),a=this._annotatedText(o),l=n.stack.pop();return s.annos=s.annos.concat(l.annos),n.preserveWhitespace=i,a}plainText(e){var t=this.state,r=e.textContent;if(t.stack.length>0){var n=wi(t.stack);n.offset+=r.length,n.text+=n.text.concat(r)}return r}_customText(e){var t=this.state;if(t.stack.length>0){var r=wi(t.stack);r.offset+=e.length,r.text+=r.text.concat(e)}return e}nextId(e){return this.state.uuid(e)}_getNextId(e,t){let r=this.nextId(t);for(;this.state.ids[r]||e.find("#"+r);)r=this.nextId(t);return r}_getIdForElement(e,t){let r=e.getAttribute(this.config.idAttribute);return r&&!this.state.ids[r]?r:this._getNextId(e.getOwnerDocument(),t)}_createDocument(){const e=this.config.schema;return new(e.getDocumentClass())(e)}_convertPropertyAnnotation(e,t){const r=[t.id,"_content"];return t._content=this.annotatedText(e,r),t.start={path:r,offset:0},t.end={offset:t._content.length},t}_convertInlineNode(e,t,r){const n=[t.id,"_content"];return r.import&&(t=r.import(e,t,this)||t),t._content="$",t.start={path:n,offset:0},t.end={offset:1},t}_createNodeData(e,t){if(!t)throw new Error("type is mandatory.");let r={type:t,id:this._getIdForElement(e,t)};return this.state.ids[r.id]=!0,r}_createNode(e){let t=this.state.doc,r=t.get(e.id);return r&&t.delete(r.id),t.create(e)}getChildNodeIterator(e){return e.getChildNodeIterator()}_defaultElementMatcher(e){return e.is(this.tagName)}_annotatedText(e){const t=this.state,r=wi(t.stack);if(!r)throw new Error("Illegal state: context is null.");for(;e.hasNext();){var n=e.next(),s="";if(n.isTextNode())(s=this._prepareText(n.textContent)).length&&(r.text=r.text.concat(s),r.offset+=s.length);else{if(n.isCommentNode())continue;if(n.isElementNode()){const e=this._getConverterForElement(n,"inline");if(!e){this.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",n.outerHTML);const e=this.getChildNodeIterator(n);this._annotatedText(e);continue}var i=r.offset;const s=e.type,o=this.schema.getNodeClass(s);if(!o)throw new Error(`No Node class registered for type ${s}.`);let a=this._createNodeData(n,s),l={path:r.path,offset:i,text:"",annos:[]};if(t.stack.push(l),e.import&&(t.pushContext(n.tagName,e),a=e.import(n,a,this)||a,t.popContext()),o.isInlineNode())this._customText(xp),t.lastChar="";else{const e=this.getChildNodeIterator(n);this._annotatedText(e)}t.stack.pop(),r.offset=l.offset,r.text=r.text.concat(l.text);const c=r.offset;a.start={path:r.path.slice(0),offset:i},a.end={offset:c};let h=wi(t.stack);h.annos=h.annos.concat(l.annos,a)}else console.warn("Unknown element type. Taking plain text.",n.outerHTML),s=this._prepareText(n.textContent),r.text=r.text.concat(s),r.offset+=s.length}}return r.text}_getConverterForElement(e,t){var r;if("block"===t){if(!e.tagName)return null;r=this._blockConverters}else r="inline"===t?this._propertyAnnotationConverters:this._allConverters;for(var n=null,s=0;s<r.length;s++)if(this._converterCanBeApplied(r[s],e)){n=r[s];break}return n}_converterCanBeApplied(e,t){return e.matchElement(t,this)}_wrapInlineElementsIntoBlockElement(e){if(!e.hasNext())return;const t=this._defaultBlockConverter;if(!t)throw new Error("Wrapping inline elements automatically is not supported in this schema.");let r=e.peek().getOwnerDocument(),n=r.createElement("wrapper");for(;e.hasNext();){const t=e.next();if(this._getConverterForElement(t,"block")){e.back();break}n.append(t.clone())}const s=this.schema.getDefaultTextType();let i={type:s,id:this._getNextId(r,s)};this.state.pushContext("wrapper",t),i=t.import(n,i,this)||i;let o=this.state.popContext().annos;const a=this._createNode(i);return o.forEach(e=>{this._createNode(e)}),a}_prepareText(e){const t=this.state;if(t.preserveWhitespace)return e;var r=Cp;return e=e.replace(Sp,""),e=(e=t.lastChar===Cp?e.replace(wp,""):e.replace(wp,r)).replace(bp,r),(this.config.REMOVE_INNER_WS||t.removeInnerWhitespace)&&(e=e.replace(vp,Cp)),t.lastChar=e[e.length-1]||t.lastChar,e}_trimTextContent(e){var t,r,n=e.getChildNodes(),s=n[0],i=wi(n);return s&&s.isTextNode()&&(t=s.textContent,r=this._trimLeft(t),s.textContent=r),i&&i.isTextNode()&&(t=i.textContent,r=this._trimRight(t),i.textContent=r),e}_trimLeft(e){return e.replace(wp,"")}_trimRight(e){return e.replace(bp,"")}}Ep.State=class{constructor(){this.reset()}reset(){this.preserveWhitespace=!1,this.nodes=[],this.annotations=[],this.containerId=null,this.container=[],this.ids={},this.contexts=[],this.stack=[],this.lastChar="",this.skipTypes={},this.ignoreAnnotations=!1,this.isConverting=!1,this.uuid=yp()}pushContext(e,t){this.contexts.push({tagName:e,converter:t,annos:[]})}popContext(){return this.contexts.pop()}getCurrentContext(){return wi(this.contexts)}},Ep.INVISIBLE_CHARACTER=xp;class Np extends Ep{constructor(e){super(Object.assign({idAttribute:"data-id"},e)),this._el=nh.parseHTML("<html></html>")}importDocument(e){this.reset();var t=nh.parseHTML(e);return this.convertDocument(t),this.state.doc}convertDocument(e){throw new Error("This method is abstract")}}const Tp=["a","b","big","i","small","tt","abbr","acronym","cite","code","dfn","em","kbd","strong","samp","time","var","bdo","br","img","map","object","q","script","span","sub","sup","button","input","label","select","textarea"].reduce((e,t)=>(e[t]=!0,e),{});class Ip extends Np{constructor(e){super(function(e){let t=(e=Object.assign({},e)).schema.getDefaultTextType();t&&(e.converters=e.converters.concat([{type:t,matchElement:function(e){return e.is("div")},import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])}}]));return e}(e)),this.IGNORE_DEFAULT_WARNINGS=!0,Object.assign(e,{trimWhitespaces:!0,REMOVE_INNER_WS:!0}),this.editorOptions=e.editorOptions}importDocument(e){if(w.isWindows){let t=/<!--StartFragment-->(.*)<!--EndFragment-->/.exec(e);t&&(e=t[1])}if(e.search(/script id=.substance-clipboard./)>=0){let t=nh.parseHTML(e).find("#substance-clipboard");if(t){let e=t.textContent;try{return this.importFromJSON(e)}finally{}}}if(this.editorOptions&&this.editorOptions.forcePlainTextPaste)return null;let t=nh.parseHTML(e),r=t.find('meta[name="generator"]'),n=t.find("html").getAttribute("xmlns:w");if(r){r.getAttribute("content").indexOf("LibreOffice")>-1&&(this._isLibreOffice=!0)}else if(n){if(n.indexOf("office:word")>-1){this._isMicrosoftWord=!0;let r=/<!--StartFragment-->([\s\S]*)<!--EndFragment-->/.exec(e);r&&(t=nh.parseHTML(r[1]))}}else e.indexOf("docs-internal-guid")>-1&&(this._isGoogleDoc=!0);let s=t.find("body");if(!(s=this._sanitizeBody(s)))return console.warn("Invalid HTML."),null;return this._wrapIntoParagraph(s),this.reset(),this.convertBody(s),this.state.doc}_sanitizeBody(e){if(e.findAll("meta").forEach(e=>e.remove()),this._isLibreOffice||this._isMicrosoftWord){let t=e.getInnerHTML();e.setInnerHTML(t.replace(/\r\n|\r|\n/g," "))}else this._isGoogleDoc&&(e=this._fixupGoogleDocsBody(e));return e}_fixupGoogleDocsBody(e){if(!e)return;let t=e.find("b");t&&/^docs-internal/.exec(t.id)&&(e=t),e.findAll("span").forEach(e=>{let t=[];"700"===e.getStyle("font-weight")&&t.push("b"),"italic"===e.getStyle("font-style")&&t.push("i"),"super"===e.getStyle("vertical-align")&&t.push("sup"),"sub"===e.getStyle("vertical-align")&&t.push("sub"),e.removeAttribute("style"),function r(n,s){if(t.length>0){let i=n.createElement(t[0]);1===t.length&&i.append(e.textContent),s?n.replaceChild(e,i):n.appendChild(i),t.shift(),r(i)}}(e.getParent(),!0)});return["b","i","sup","sub"].forEach(t=>{e.findAll(t).forEach(e=>{let r=e.getPreviousSibling();if(r&&e.tagName===r.tagName){let n=e.getParent(),s=n.createElement(t);s.setInnerHTML(r.getInnerHTML()+e.getInnerHTML()),n.replaceChild(e,s),n.removeChild(r)}if(r&&r.tagName&&e.getChildCount()>0&&e.getChildAt(0).tagName===r.tagName){let n=e.getParent(),s=e.getChildAt(0),i=n.createElement(r.tagName),o=i.createElement(t);o.setTextContent(s.textContent),i.appendChild(o),n.replaceChild(e,i)}})}),e}_wrapIntoParagraph(e){let t=e.getChildNodes(),r=!1;for(let e=0;e<t.length;e++){const n=t[e];if(n.isTextNode()){if(!/^\s+$/.exec(n.textContent)){r=!0;break}}else if(Tp[n.tagName]){r=!0;break}}if(r){let r=e.createElement("p");r.append(t),e.append(r)}}importFromJSON(e){this.reset();let t=this.getDocument(),r=JSON.parse(e);return(new mp).importDocument(t,r),t}convertBody(e){this.convertContainer(e.childNodes,Rd)}_createDocument(){return super._createDocument().createSnippet()}}class Ap extends Sd{constructor(){super(),this.byId=new ep}select(e){return e.isContainerAnnotation()}clear(){this.byId.clear()}get(e,t){var r=g(this.byId.get(e));return E(t)&&(r=vd(r,Sd.filterByType)),r}create(e){this.byId.set([e.containerId,e.id],e)}delete(e){this.byId.delete([e.containerId,e.id])}update(e,t,r,n){}}class Dp extends l{constructor(e,t){if(super(),!e)throw new Error("schema is mandatory");if(!t)throw new Error("nodeFactory is mandatory");this.schema=e,this.nodeFactory=t,this.nodes={},this.indexes={},this.__QUEUE_INDEXING__=!1,this.queue=[]}contains(e){return Boolean(this.nodes[e])}get(e,t){let r=this._get(e);if(t&&void 0===r)throw E(e)?new Error("Could not find node with id '"+e+"'."):this.contains(e[0])?new Error("Property for path '"+e+"' us undefined."):new Error("Could not find node with id '"+e[0]+"'.");return r}_get(e){if(!e)return;let t;if(E(e))t=this.nodes[e];else if(1===e.length)t=this.nodes[e[0]];else if(e.length>1){let r=this.nodes[e[0]];for(let t=1;t<e.length-1;t++){if(!r)return;r=r[e[t]]}if(!r)return;t=r[e[e.length-1]]}return t}getNodes(){return this.nodes}create(e){var t=this.nodeFactory.create(e.type,e);if(!t)throw new Error("Illegal argument: could not create node for data:",e);if(this.contains(t.id))throw new Error("Node already exists: "+t.id);if(!t.id||!t.type)throw new Error("Node id and type are mandatory.");this.nodes[t.id]=t;var r={type:"create",node:t};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),t}delete(e){var t=this.nodes[e];if(t){t.dispose(),delete this.nodes[e];var r={type:"delete",node:t};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),t}}set(e,t){let r=this.get(e[0]),n=this._set(e,t);var s={type:"set",node:r,path:e,newValue:t,oldValue:n};return this.__QUEUE_INDEXING__?this.queue.push(s):this._updateIndexes(s),n}_set(e,t){return function(e,t,r){let n=e,s=t.length;for(let e=0;e<s-1;e++)if(!(n=n[t[e]]))throw new Error("Can not set value.");let i=n[t[s-1]];return n[t[s-1]]=r,i}(this.nodes,e,t)}update(e,t){var r=this.getRealPath(e);if(!r)return void console.error("Could not resolve path",e);let n,s=this.get(r[0]),i=this._get(r);if(t.isOperation)n=t.apply(i);else if(t=this._normalizeDiff(i,t),E(i))switch(t.type){case"delete":n=i.split("").splice(t.start,t.end-t.start).join("");break;case"insert":n=[i.substring(0,t.start),t.text,i.substring(t.start)].join("");break;default:throw new Error("Unknown diff type")}else if(_(i))switch(n=i.slice(0),t.type){case"delete":n.splice(t.pos,1);break;case"insert":n.splice(t.pos,0,t.value);break;default:throw new Error("Unknown diff type")}else{if(!i._isCoordinate)throw new Error("Diff is not supported:",JSON.stringify(t));switch(t.type){case"shift":(n=i={path:i.path,offset:i.offset}).offset+=t.value;break;default:throw new Error("Unknown diff type")}}this._set(r,n);var o={type:"update",node:s,path:r,newValue:n,oldValue:i};return this.__QUEUE_INDEXING__?this.queue.push(o):this._updateIndexes(o),i}_normalizeDiff(e,t){return E(e)?t.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", start:s, end: e}) instead'),t={type:"delete",start:t.delete.start,end:t.delete.end}):t.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", start:s, text: t}) instead'),t={type:"insert",start:t.insert.offset,text:t.insert.value}):_(e)?t.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", pos:1}) instead'),t={type:"delete",pos:t.delete.offset}):t.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", pos:1, value: "foo"}) instead'),t={type:"insert",pos:t.insert.offset,value:t.insert.value}):e._isCoordinate&&t.hasOwnProperty("shift")&&(console.warn('DEPRECATED: use doc.update(path, {type:"shift", value:2}) instead'),t={type:"shift",value:t.shift}),t}toJSON(){let e={};return r(this.nodes,t=>{e[t.id]=t.toJSON()}),{schema:[this.schema.id,this.schema.version],nodes:e}}reset(){this.clear()}clear(){this.nodes={},r(this.indexes,e=>e.clear())}addIndex(e,t){return this.indexes[e]&&console.error("Index with name %s already exists.",e),t.reset(this),this.indexes[e]=t,t}getIndex(e){return this.indexes[e]}_updateIndexes(e){e&&!this.__QUEUE_INDEXING__&&r(this.indexes,function(t){t.select(e.node)&&(t[e.type]||console.error("Contract: every NodeIndex must implement "+e.type),t[e.type](e.node,e.path,e.newValue,e.oldValue))})}_stopIndexing(){this.__QUEUE_INDEXING__=!0}_startIndexing(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var e=this.queue.shift();this._updateIndexes(e)}}}class Op{constructor(e,t){this.fileNode=e,this.context=t,e.setProxy(this)}get id(){return this.fileNode.id}triggerUpdate(){let e=this.fileNode.id;this.context.editorSession.transaction(t=>{t.set([e,"__changed__"],"")},{history:!1})}getUrl(){return""}sync(){return Promise.reject(new Error("sync method not implemented"))}}Op.match=function(e,t){return!1};class Pp extends Op{constructor(e,t){super(e,t),this.file=e.sourceFile,this.file&&(this._fileUrl=URL.createObjectURL(this.file)),this.url=e.url}getUrl(){return this.url?this.url:this._fileUrl?this._fileUrl:""}sync(){return this.url||(console.info("Simulating file upload. Creating blob url instead.",this._fileUrl),this.url=this._fileUrl),Promise.resolve()}}class kp extends Cd{constructor(e){super(),this._property=e||"id",this.index=new ep}get(e){return this.index.get(e)||{}}getAll(e){return this.index.getAll(e)}clear(){this.index.clear()}select(e){return!0}create(e){var t=e[this._property];_(t)||(t=[t]),r(t,function(t){this.index.set([t,e.id],e)}.bind(this))}delete(e){var t=e[this._property];_(t)||(t=[t]),r(t,function(t){this.index.delete([t,e.id])}.bind(this))}update(e,t,n,s){if(this.select(e)&&t[1]===this._property){var i=s;_(i)||(i=[i]),r(i,function(t){this.index.delete([t,e.id])}.bind(this)),_(i=n)||(i=[i]),r(i,function(t){this.index.set([t,e.id],e)}.bind(this))}}set(e,t,r,n){this.update(e,t,r,n)}_initialize(e){r(e.getNodes(),function(e){this.select(e)&&this.create(e)}.bind(this))}}class Mp extends Dp{create(e){e._isNode&&(e=e.toJSON());let t=ni.Create([e.id],e);return this.apply(t),t}delete(e){var t=null,r=this.get(e);if(r){var n=r.toJSON();t=ni.Delete([e],n),this.apply(t)}return t}update(e,t){var r=this._getDiffOp(e,t),n=ni.Update(e,r);return this.apply(n),n}set(e,t){var r=this.get(e),n=ni.Set(e,r,t);return this.apply(n),n}apply(e){if(e.type!==ni.NOP){if(e.type===ni.CREATE)super.create(v(e.val));else if(e.type===ni.DELETE)super.delete(e.val.id);else if(e.type===ni.UPDATE){var t=this.get(e.path),r=e.diff;if("array"===e.propertyType)r._isArrayOperation||(r=Ks.fromJSON(r)),r.apply(t);else if("string"===e.propertyType){r._isTextOperation||(r=Us.fromJSON(r));var n=r.apply(t);super.set(e.path,n)}else{if("coordinate"!==e.propertyType)throw new Error("Unsupported type for operational update.");r._isCoordinateOperation||(r=Ys.fromJSON(r)),r.apply(t)}}else{if(e.type!==ni.SET)throw new Error("Illegal state.");super.set(e.path,e.val)}this.emit("operation:applied",e,this)}}_getDiffOp(e,t){var r=null;if(t.isOperation)r=t;else{var n=this.get(e);if(t=this._normalizeDiff(n,t),null===n||void 0===n)throw new Error("Property has not been initialized: "+JSON.stringify(e));if(E(n))switch(t.type){case"delete":r=Us.Delete(t.start,n.substring(t.start,t.end));break;case"insert":r=Us.Insert(t.start,t.text);break;default:throw new Error("Unknown diff type")}else if(_(n))switch(t.type){case"delete":r=Ks.Delete(t.pos,n[t.pos]);break;case"insert":r=Ks.Insert(t.pos,t.value);break;default:throw new Error("Unknown diff type")}else if(n._isCoordinate)switch(t.type){case"shift":r=Ys.Shift(t.value);break;default:throw new Error("Unknown diff type")}}if(!r)throw new Error("Unsupported diff: "+JSON.stringify(t));return r}}class Lp{constructor(e){this.doc=e}create(e,t){var r=this.doc.schema.getNodeClass(e);if(!r)throw new Error("No node registered by that name: "+e);return new r(this.doc,t)}}class Rp{constructor(e){this.doc=e,this.parents={},e.data.on("operation:applied",this._onOperationApplied,this)}_onOperationApplied(e){let t,r,n=this.doc.get(e.path[0]);switch(n&&(r=(t=n.getSchema()).hasOwnedProperties()),e.type){case"create":r&&t.getOwnedProperties().forEach(e=>{let t=n[e.name];t&&this._setParent(n,t),this._setRegisteredParent(n)});break;case"update":if(r){let r=e.path[1];if(t.isOwned(r)){let t=e.diff;t.isDelete()?this._setParent(null,t.getValue()):this._setParent(n,t.getValue())}}break;case"set":if(r){let r=e.path[1];if(t.isOwned(r)){let t=e.getOldValue(),r=e.getValue();this._setParent(null,t),this._setParent(n,r)}}}}_setParent(e,t){t&&(_(t)?t.forEach(t=>this.__setParent(e,t)):this.__setParent(e,t))}__setParent(e,t){this.parents[t]=e;let r=this.doc.get(t);r&&r.setParent(e)}_setRegisteredParent(e){let t=this.parents[e.id];t&&e.setParent(t)}}Rp.register=function(e){return new Rp(e)};const qp=new mp;class Bp extends l{constructor(e,...t){if(super(),this.schema=e,!e)throw new Error("A document needs a schema for reflection.");this._ops=[],this._initialize(...t)}_initialize(){this.__id__=d(),this.nodeFactory=new Lp(this),this.data=new Mp(this.schema,this.nodeFactory),this.addIndex("type",new kp("type")),this.addIndex("annotations",new tp),this.addIndex("container-annotations",new Ap),Rp.register(this)}dispose(){this.off(),this.data.off()}get id(){return this.__id__}getSchema(){return this.schema}contains(e){return this.data.contains(e)}get(e,t){return this.data.get(e,t)}getNodes(){return this.data.getNodes()}getAnnotations(e){return this.getIndex("annotations").get(e)}getProperty(e){if(2!==e.length)throw new Error("path must have length=2");let[t,r]=e,n=this.get(t);if(n)return n.getSchema().getProperty(r);throw new Error("Invalid path.")}import(e){try{this.data._stopIndexing(),e(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}}create(e){if(e.id||(e.id=d(e.type)),!e.type)throw new Error("No node type provided");const t=this._create(e);if(t)return this._ops.push(t),this._isTransactionDocument||this._emitChange(t),this.get(e.id)}createDefaultTextNode(e,t){return this.create({type:this.getSchema().getDefaultTextType(),content:e||"",direction:t})}delete(e){const t=this.get(e),r=this._delete(e);return r&&(this._ops.push(r),this._isTransactionDocument||this._emitChange(r)),t}set(e,t){const r=this.get(e),n=this._set(e,t);return n&&(this._ops.push(n),this._isTransactionDocument||this._emitChange(n)),r}update(e,t){const r=this._update(e,t);return r&&(this._ops.push(r),this._isTransactionDocument||this._emitChange(r)),r}updateNode(e,t){let n=this.get(e);r(t,(r,s)=>{S(n[s],t[s])||this.set([e,s],r)})}addIndex(e,t){return this.data.addIndex(e,t)}getIndex(e){return this.data.getIndex(e)}createSelection(e){let t;if(x(e))return bi.nullSelection;if(1!==arguments.length||!m(e))throw new Error("Illegal argument: call createSelection({ type: ... }");switch(e.type){case"property":{x(e.endOffset)&&(e.endOffset=e.startOffset),e.hasOwnProperty("reverse")||e.startOffset>e.endOffset&&([e.startOffset,e.endOffset]=[e.endOffset,e.startOffset],e.reverse=!e.reverse);let r=this.get(e.path,"strict");if(e.startOffset<0||e.startOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given startOffset is "+e.startOffset);if(e.endOffset<0||e.endOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given endOffset is "+e.endOffset);t=new xi(e);break}case"container":{let r=this.get(e.containerId,"strict");if(!r)throw new Error('Can not create ContainerSelection: container "'+e.containerId+'" does not exist.');let n=this._normalizeCoor({path:e.startPath,offset:e.startOffset}),s=this._normalizeCoor({path:e.endPath,offset:e.endOffset}),i=r.getAddress(n),o=r.getAddress(s);if(!i)throw new Error("Invalid arguments for ContainerSelection: ",n.toString());if(!o)throw new Error("Invalid arguments for ContainerSelection: ",s.toString());e.hasOwnProperty("reverse")||o.isBefore(i,"strict")&&([n,s]=[s,n],e.reverse=!0),t=new Ei(r.id,n.path,n.offset,s.path,s.offset,e.reverse,e.surfaceId);break}case"node":t=Ri({doc:this,nodeId:e.nodeId,mode:e.mode,containerId:e.containerId,reverse:e.reverse,surfaceId:e.surfaceId});break;case"custom":t=Ii.fromJSON(e);break;default:throw new Error("Illegal selection type",e)}return t.isNull()||t.attach(this),t}newInstance(){return new(0,this.constructor)(this.schema)}createSnippet(){var e=this.newInstance(),t=e.create({type:"@container",id:Rd});return e.getContainer=function(){return t},e}createFromDocument(e){this.clear();let t=Object.values(e.getNodes()),r={},n=new Set;return t.forEach(e=>{n.has(e)||this._computeDependencyLevel(e,r,n)}),t.sort((e,t)=>r[t.id]-r[e.id]),t.forEach(e=>this.create(e)),this}_computeDependencyLevel(e,t,r){if(!e)throw new Error("node was nil");if(r.has(e))throw new Error("Cyclic node dependency");r.add(e);let n=0;if(e.isAnnotation()||e.isInlineNode())n=-1;else{let s=e.getParent();if(s){let e;n=(e=t.hasOwnProperty(s.id)?t[s.id]:this._computeDependencyLevel(s,t,r))+1}}return t[e.id]=n,n}toJSON(){return qp.exportDocument(this)}clone(){let e=this.newInstance();return e.createFromDocument(this),e}clear(){this.data.clear(),this._ops.length=0}createEditingInterface(){return new cp(this)}invert(e){return e.invert()}_apply(e){r(e.ops,e=>{this._applyOp(e)}),e._extractInformation(this)}_applyOp(e){this.data.apply(e),this.emit("operation:applied",e)}_create(e){return this.data.create(e)}_delete(e){return this.data.delete(e)}_set(e,t){return this.data.set(e,t)}_update(e,t){return this.data.update(e,t)}_emitChange(e){const t=new ji([e],{},{});t._extractInformation(this),this._notifyChangeListeners(t,{hidden:!0})}_notifyChangeListeners(e,t){t=t||{},this.emit("document:changed",e,t,this)}_createSelectionFromRange(e){if(!e)return bi.nullSelection;return S(e.start.path,e.end.path)?e.start.isNodeCoordinate()?new Ti(e.containerId,e.start.getNodeId(),"full",e.reverse,e.surfaceId):this.createSelection({type:"property",path:e.start.path,startOffset:e.start.offset,endOffset:e.end.offset,reverse:e.reverse,containerId:e.containerId,surfaceId:e.surfaceId}):this.createSelection({type:"container",startPath:e.start.path,startOffset:e.start.offset,endPath:e.end.path,endOffset:e.end.offset,reverse:e.reverse,containerId:e.containerId,surfaceId:e.surfaceId})}_normalizeCoor({path:e,offset:t}){if(1===e.length){let r=this.get(e[0]).getContainerRoot();if(r.isText())return new Si(r.getPath(),0===t?0:r.getLength());if(r.isList()){if(0===t){let e=r.getItemAt(0);return new Si(e.getPath(),0)}{let e=this.get(wi(r.items));return new Si(e.getPath(),e.getLength())}}}return new Si(e,t)}get _isDocument(){return!0}}class Fp extends wd{getUrl(){return this.proxy?this.proxy.getUrl():(console.warn("No file proxy attached to ",this.id),"")}setProxy(e){this.proxy=e}get _isFileNode(){return!0}static get _isFileNode(){return!0}}Fp.schema={type:"file",url:{type:"string",optional:!0},fileType:{type:"string",optional:!0},mimeType:{type:"string",optional:!0},sourceFile:{type:"object",optional:!0}};const jp="This method is abstract!";function Hp(e){return class extends e{createListItem(e){throw new Error(jp)}getItems(){throw new Error(jp)}getItemsPath(){throw new Error(jp)}insertItemAt(e,t){throw new Error(jp)}removeItemAt(e){throw new Error(jp)}getItemAt(e){return this.getItems()[e]}getItemPosition(e){return this.getItems().indexOf(e)}getLength(){return this.getItems().length}getFirstItem(){return this.getItemAt(0)}getLastItem(){return this.getItemAt(this.getLength()-1)}appendItem(e){this.insertItemAt(this.items.length,e)}removeItem(e){const t=this.getItemPosition(e);t>=0&&this.removeItemAt(t)}isEmpty(){return 0===this.getLength()}get length(){return this.getLength()}getListType(e){let t=e-1;return this._getListTypes()[t]||"bullet"}setListType(e,t){let r=e-1,n=this._getListTypes();if(n.length<e)for(let e=0;e<r;e++)n[e]||(n[e]="bullet");n[r]=t,this._setListTypes(n)}_getListTypes(){let e=this.getListTypeString();return e?e.split(",").map(e=>e.trim()):[]}_setListTypes(e){_(e)&&(e=e.join(",")),this.getListTypeString()!==e&&this.setListTypeString(e)}static isList(){return!0}}}function Up(e){return class extends e{getTextPath(){return console.warn("DEPRECATED: use node.getPath()"),this.getPath()}getText(){return this.content}isEmpty(){return!this.getText()}getLength(){return this.getText().length}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.getPath())}}}class zp extends(Up(wd)){getPath(){return[this.id,"content"]}getText(){return this.content}static isText(){return!0}}zp.schema={type:"text",content:"text",direction:{type:"string",optional:!0},textAlign:{type:"string",default:"left"}};class Vp extends zp{static isBlock(){return!0}}const Gp={tagName:"annotation",export:function(e,t){t.attr("type",e.type),r(e.toJSON(),function(e,r){"id"!==r&&"type"!==r&&(E(e)||C(e)||ch(e))&&t.attr(r,e)})}},Jp={tagName:"block",export:function(e,t,n){t.attr("type",e.type),r(e.toJSON(),function(r,s){if("id"===s||"type"===s)return;const i=n.$$(s);"string"===e.getPropertyType(s)?i.append(n.annotatedText([e.id,s])):i.text(r),t.append(i)})}};class Kp{constructor(e){let t=e.getSchema(),r=e.getConverterRegistry(),n=[];r&&r.contains("html")&&(n=r.get("html").values()||[]),this._config={schema:t,DocumentClass:t.getDocumentClass(),converters:n,editorOptions:e.getEditorOptions()}}onCopy(e){let t=this._copy();oh._clipboardData=e.clipboardData,e.clipboardData&&t.doc&&(e.preventDefault(),e.clipboardData.setData("text/plain",t.text),e.clipboardData.setData("text/html",t.html))}onCut(e){e.preventDefault(),this.onCopy(e),this._cut()}onPaste(e){let t,r,n=e.clipboardData,s={};for(let e=0;e<n.types.length;e++)s[n.types[e]]=!0;e.preventDefault(),e.stopPropagation(),s["text/plain"]&&(t=n.getData("text/plain")),s["text/html"]&&(r=n.getData("text/html")),oh.clipboardData={text:t,html:r},r&&this._pasteHtml(r,t)||this._pastePlainText(t)}_getImporter(){return new Ip(this._config)}_getExporter(){return new _p(this._config)}_copy(){throw new Error("This method is abstract.")}_cut(){throw new Error("This method is abstract.")}_pastePlainText(e){throw new Error("This method is abstract.")}_pasteHtml(e,t){throw new Error("This method is abstract.")}}class $p{constructor(e){if(this.config=e||{},this.name=this.config.name,!this.name)throw new Error("'name' is required")}get isAsync(){return!1}getName(){return this.name}getCommandState(e,t){throw new Error("Command.getCommandState() is abstract.")}execute(e,t){throw new Error("Command.execute() is abstract.")}isAnnotationCommand(){return!1}isInsertCommand(){return!1}isSwitchTypeCommand(){return!1}getParams(e){return new hu(e)}get _isCommand(){return!0}}$p.DISABLED=Object.freeze({disabled:!0,active:!1});class Xp extends $p{constructor(e){if(super(e),!this.config.nodeType)throw new Error("'nodeType' is required")}getAnnotationType(){return this.config.nodeType}getType(){return this.getAnnotationType()}getAnnotationData(){return{}}isDisabled(e,t){let r=t.selectionState;return!!(t.editorSession.isBlurred()||!e||e.isNull()||!e.isAttached()||e.isCustomSelection()||e.isNodeSelection()||e.isContainerSelection()||r.isInlineNodeSelection)}showInContext(e){return!e.isCollapsed()}canCreate(e,t){if(t.isCollapsed())return!1;if(0===e.length)return!0;for(let r of e)if(t.overlaps(r.getSelection(),"strict"))return!1;return!0}canFuse(e,t){return e.length>=2&&!t.isCollapsed()}canDelete(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return t.isInsideOf(r)}canExpand(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return t.overlaps(r,"strict")&&!t.isInsideOf(r)}canTruncate(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return(t.isLeftAlignedWith(r)||t.isRightAlignedWith(r))&&!t.contains(r)&&!t.isCollapsed()}getCommandState(e,t){const r=e.selection;if(this.isDisabled(r,e,t))return{disabled:!0};let n=this._getAnnotationsForSelection(e),s={disabled:!1,active:!1,mode:null};return this.canCreate(n,r)?s.mode="create":this.canFuse(n,r)?s.mode="fuse":this.canTruncate(n,r)?(s.active=!0,s.mode="truncate"):this.canExpand(n,r)?s.mode="expand":this.canDelete(n,r)?(s.active=!0,s.mode="delete"):s.disabled=!0,s.showInContext=this.showInContext(r,e,t),s}execute(e,t){let r=e.commandState;if(r.disabled)return!1;switch(r.mode){case"create":return this.executeCreate(e,t);case"fuse":return this.executeFuse(e,t);case"truncate":return this.executeTruncate(e,t);case"expand":return this.executeExpand(e,t);case"delete":return this.executeDelete(e,t);default:return console.warn("Command.execute(): unknown mode",r.mode),!1}}executeCreate(e,t){const r=e.editorSession,n=this._getAnnotationsForSelection(e,t);this._checkPrecondition(e,n,this.canCreate);let s,i=this.getAnnotationData();return i.type=this.getAnnotationType(),r.transaction(e=>{s=e.annotate(i)}),{mode:"create",anno:s}}executeFuse(e){let t=this._getAnnotationsForSelection(e);return this._checkPrecondition(e,t,this.canFuse),this._applyTransform(e,e=>{xd.fuseAnnotation(e,t)}),{mode:"fuse",anno:t[0]}}executeTruncate(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canTruncate),this._applyTransform(e,t=>{xd.truncateAnnotation(t,r,e.selection)}),{mode:"truncate",anno:r}}executeExpand(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canExpand),this._applyTransform(e,t=>{xd.expandAnnotation(t,r,e.selection)}),{mode:"expand",anno:r}}executeDelete(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canDelete),this._applyTransform(e,e=>e.delete(r.id)),{mode:"delete",annoId:r.id}}isAnnotationCommand(){return!0}_checkPrecondition(e,t,r){let n=e.selection;if(!r.call(this,t,n))throw new Error("AnnotationCommand: can't execute command for selection "+n.toString())}_getAnnotationsForSelection(e){return e.selectionState.annosByType[this.getAnnotationType()]||[]}_applyTransform(e,t){const r=e.editorSession,n=e.selection;if(n.isNull())return;let s;return r.setSelection(n),r.transaction(function(r){let n=t(r,e);n&&(s=n.result)}),s}}class Wp extends Oh{didMount(){this.props.node.on("highlighted",this.onHighlightedChanged,this)}dispose(){this.props.node.off(this)}render(e){let t=e(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&t.addClass("sm-highlighted"),t.append(this.props.children),t}getClassNames(){return"sc-"+this.props.node.type}onHighlightedChanged(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")}getTagName(){return"span"}}class Yp extends Oh{didMount(){this.context.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]})}dispose(){this.context.editorSession.off(this)}render(e){return e(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames())}getTagName(){return"div"}getClassNames(){return""}rerender(...e){this.props.node.isDisposed()||super.rerender(...e)}}class Zp extends Oh{render(e){let t=e("button").addClass("sc-button");return this.props.icon&&t.append(this.renderIcon(e)),this.props.label&&t.append(this.renderLabel(e)),this.props.dropdown&&t.append(this.renderDropdownIcon(e)),this.props.active&&t.addClass("sm-active"),this.props.theme&&t.addClass("sm-theme-"+this.props.theme),this.props.disabled?t.attr("tabindex",-1).attr("disabled",!0):t.attr("tabindex",1),t.append(this.props.children),t}renderIcon(e){return this.context.iconProvider.renderIcon(e,this.props.icon)}renderDropdownIcon(e){let t=this.context.iconProvider.renderIcon(e,"dropdown");return t.addClass("se-dropdown"),t}renderLabel(e){return e("span").addClass("se-label").append(this.getLabel(this.props.label))}getLabel(e){return this.context.labelProvider.getLabel(e,this.props.commandState)}}class Qp extends Kp{constructor(e,t){super(e),this.editorSession=t}_copy(){let e=this.getEditorSession(),t=e.getSelection(),r=e.getDocument(),n=null,s="",i="",o=this._getExporter();return t.isCollapsed()||(s=Id(r,t)||"",n=np(r,t),i=o.exportDocument(n)),{doc:n,html:i,text:s}}_cut(){this.getEditorSession().transaction(e=>{e.deleteSelection()})}_pastePlainText(e){this.getEditorSession().transaction(t=>{t.paste(e)},{action:"paste"})}_pasteHtml(e,t){let r=this._getImporter().importDocument(e)||t;if(r){this.getEditorSession().transaction(e=>{e.paste(r)},{action:"paste"})}return!0}getEditorSession(){return this.editorSession}}function ef(e,t){return!!E(e)&&(e.startsWith?e.startsWith(t):(E(t)||(t=String(t)),e.slice(0,t.length)===t))}class tf extends Oh{render(e){return e("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.properties,null,2))}}const rf=w.isFF?1:0;class nf extends Oh{constructor(...e){super(...e),this._initialize()}_initialize(){if(!this.getEditorSession())throw new Error("editorSession is mandatory");if(this.name=this.props.name,!this.name)throw new Error("Surface must have a name.");if(this.name.indexOf("/")>-1)throw new Error("Surface.name must not contain '/'");this._surfaceId=nf.createSurfaceId(this),this.clipboard=this.context.clipboard||this._initializeClipboard(),this.domSelection=this.context.domSelection||this._initializeDOMSelection(),this._state={skipNextFocusEvent:!1}}_initializeClipboard(){return new Qp(this.getConfigurator(),this.getEditorSession())}_initializeDOMSelection(){return new td(this)}getChildContext(){return{surface:this,parentSurfaceId:this.getId(),doc:this.getDocument(),isolatedNodeComponent:null}}didMount(){this.getEditorSession().onRender("selection",this._onSelectionChanged,this);const e=this.getSurfaceManager();e&&e.registerSurface(this);const t=this.getGlobalEventHandler();t&&t.addEventListener("keydown",this._muteNativeHandlers,this)}dispose(){this.getEditorSession().off(this);const e=this.getSurfaceManager();e&&e.unregisterSurface(this);const t=this.getGlobalEventHandler();t&&t.removeEventListener("keydown",this._muteNativeHandlers)}didUpdate(){this._updateContentEditableState()}render(e){let t=e(this.props.tagName||"div").addClass("sc-surface").attr("tabindex",2).attr("data-surface-id",this.id);return this.isDisabled()||(this.isEditable()&&(t.on("keydown",this.onKeyDown),w.isIE||(t.on("compositionstart",this.onCompositionStart),t.on("compositionend",this.onCompositionEnd)),w.inBrowser&&window.TextEvent&&!w.isIE?t.on("textInput",this.onTextInput):t.on("keypress",this.onTextInputShim),t.on("paste",this._onPaste),t.on("cut",this._onCut)),this.isReadonly()||(t.on("mousedown",this.onMouseDown),t.on("contextmenu",this.onContextMenu),t.on("focus",this.onNativeFocus),t.on("blur",this.onNativeBlur)),t.on("copy",this._onCopy)),t}getName(){return this.name}getId(){return this._surfaceId}getSurfaceId(){return this._surfaceId}isDisabled(){return this.props.disabled}isEditable(){return"full"===this.props.editing||void 0===this.props.editing}isSelectable(){return"selection"===this.props.editing||"full"===this.props.editing}isReadonly(){return"readonly"===this.props.editing}getElement(){return this.el}getDocument(){return this.getEditorSession().getDocument()}getComponentRegistry(){return this.context.componentRegistry}getConfigurator(){return this.context.configurator}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}getGlobalEventHandler(){return this.context.globalEventHandler}getKeyboardManager(){return this.context.keyboardManager}isEnabled(){return!this.state.disabled}isContainerEditor(){return!1}isCustomEditor(){return!1}hasNativeSpellcheck(){return"native"===this.props.spellcheck}getContainerId(){return null}focus(){this.getEditorSession().getSelection().surfaceId!==this.getId()&&this.selectFirst()}blur(){const e=this.getEditorSession();e.getSelection().surfaceId===this.getId()&&e.setSelection(null)}selectFirst(){throw new Error("This method is abstract.")}rerenderDOMSelection(){if(!this.isDisabled()&&w.inBrowser){let e=this.getEditorSession().getSelection();if(e.surfaceId===this.getId()){this.domSelection.setSelection(e);const t=this.context.scrollPane;t&&t.onSelectionPositioned&&(console.error("DEPRECATED: you should manage the scrollPane yourself"),t.onSelectionPositioned())}}}getDomNodeForId(e){return this.el.getNativeElement().querySelector('*[data-id="'+e+'"]')}onKeyDown(e){if(!this._shouldConsumeEvent(e))return;if("Dead"===e.key)return;if(!this.getKeyboardManager().onKeydown(e))switch(e.keyCode){case $h.LEFT:case $h.RIGHT:return this._handleLeftOrRightArrowKey(e);case $h.UP:case $h.DOWN:return this._handleUpOrDownArrowKey(e);case $h.HOME:case $h.END:return this._handleHomeOrEndKey(e);case $h.PAGEUP:case $h.PAGEDOWN:return this._handlePageUpOrDownKey(e);case $h.ENTER:return this._handleEnterKey(e);case $h.TAB:return this._handleTabKey(e);case $h.BACKSPACE:case $h.DELETE:return this._handleDeleteKey(e);case $h.ESCAPE:return this._handleEscapeKey(e);case $h.SPACE:return this._handleSpaceKey(e)}}onTextInput(e){if(!this._shouldConsumeEvent(e))return;if(e.preventDefault(),e.stopPropagation(),!e.data)return;let t=e.data;const r=this.getKeyboardManager();if(!r||!r.onTextInput(t)){this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}}onCompositionStart(e){if(this._shouldConsumeEvent(e)&&e.data){const t=this.getEditorSession();let r=e.data.length,n=t.getSelection();if(n.isPropertySelection()&&n.isCollapsed()){let e=n.start.offset;t.setSelection(n.createWithNewRange(e-r,e))}}}onCompositionEnd(e){if(this._shouldConsumeEvent(e)&&w.isFF){if(e.preventDefault(),e.stopPropagation(),!e.data)return;this._delayed(()=>{let t=e.data;const r=this.getKeyboardManager();if(!r||!r.onTextInput(t)){this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}})}}onTextInputShim(e){if(!this._shouldConsumeEvent(e))return;if(0===e.which||0===e.charCode||e.keyCode===$h.TAB||e.keyCode===$h.ESCAPE||Boolean(e.metaKey)||Boolean(e.ctrlKey)^Boolean(e.altKey))return;let t=String.fromCharCode(e.which);e.shiftKey||(t=t.toLowerCase()),e.preventDefault(),e.stopPropagation();const r=this.getKeyboardManager();r&&r.onTextInput(t)||t.length>0&&this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}onMouseDown(e){if(!this._shouldConsumeEvent(e))return!1;if(!e.__reserved__&&(e.__reserved__=this,this.isEditable()&&this.el.setAttribute("contenteditable",!0),0===e.button)){if(!(w.isIE&&w.version<12)&&e.detail>=3){let t=this.getEditorSession().getSelection();if(t.isPropertySelection())return this._selectProperty(t.path),e.preventDefault(),void e.stopPropagation();if(t.isContainerSelection())return this._selectProperty(t.startPath),e.preventDefault(),void e.stopPropagation()}if(this._state.skipNextFocusEvent=!0,w.inBrowser){nh.wrapNativeElement(window.document).on("mouseup",this.onMouseUp,this,{once:!0})}}}onMouseUp(e){e.stopPropagation(),this._delayed(()=>{let e=this.domSelection.getSelection();this._setSelection(e)})}onContextMenu(e){if(!this._shouldConsumeEvent(e))return;let t=this.domSelection.getSelection();this._setSelection(t)}onNativeBlur(){this._state.hasNativeFocus=!1}onNativeFocus(){this._state.hasNativeFocus=!0}_onCopy(e){this.clipboard.onCopy(e)}_onCut(e){this.clipboard.onCut(e)}_onPaste(e){this.clipboard.onPaste(e)}_onSelectionChanged(e){let t=this._deriveModeFromSelection(e);this.state.mode!==t&&this.extendState({mode:t})}_deriveModeFromSelection(e){if(!e)return null;let t,r=e.surfaceId,n=this.getId();return ef(r,n)&&(t=r.length===n.length?"focused":"co-focused"),t}_updateContentEditableState(){let e=this.isEditable()&&!this.props.disabled;e&&"co-focused"===this.state.mode&&(e=function(e,t){if(t){let r=e.getSelection(),n=t.getSurface(r.surfaceId);if(n){let e=n.context.isolatedNodeComponent;if(e)return e.isOpen()}}}(this.getEditorSession(),this.getSurfaceManager())),e?this.el.setAttribute("contenteditable",!0):this.el.removeAttribute("contenteditable")}_blur(){this.el&&this.el.blur()}_focus(){this.isDisabled()||(w.isFF&&(this.domSelection.clear(),this.el.getNativeElement().blur()),this._focusElement())}_focusElement(){this._state.hasNativeFocus=!0,this.el&&!w.isWebkit&&(this._state.skipNextFocusEvent=!0,this.el.focus({preventScroll:!0}),this._state.skipNextFocusEvent=!1)}_handleLeftOrRightArrowKey(e){e.stopPropagation();let t=e.keyCode===$h.LEFT?"left":"right";this._delayed(()=>{this._updateModelSelection({direction:t})})}_handleUpOrDownArrowKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===$h.UP?"left":"right"};this._updateModelSelection(t)})}_handleHomeOrEndKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===$h.HOME?"left":"right"};this._updateModelSelection(t)})}_handlePageUpOrDownKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===$h.PAGEUP?"left":"right"};this._updateModelSelection(t)})}_handleSpaceKey(e){e.stopPropagation(),e.preventDefault();const t=this.getKeyboardManager();if(!t||!t.onTextInput(" ")){this.getEditorSession().transaction(e=>{e.insertText(" ")},{action:"type"})}}_handleTabKey(e){e.stopPropagation(),this.el.emit("tab",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code}),!1===this.props.handleTab?e.preventDefault():this.__handleTab(e)}__handleTab(){this._delayed(()=>{this._updateModelSelection()})}_handleEnterKey(e){e.preventDefault(),e.stopPropagation(),this.getEditorSession().transaction(e=>{e.break()},{action:"break"})}_handleEscapeKey(){}_handleDeleteKey(e){e.preventDefault(),e.stopPropagation();let t=e.keyCode===$h.BACKSPACE?"left":"right";this.getEditorSession().transaction(e=>{e.deleteCharacter(t)},{action:"delete"})}_hasNativeFocus(){return Boolean(this._state.hasNativeFocus)}_setSelection(e){!e.isNull()&&e.surfaceId===this.id&&w.isFF&&this._focusElement(),this.getEditorSession().setSelection(e)}_updateModelSelection(e){let t=this.domSelection.getSelection(e);this._setSelection(t)}_selectProperty(e){let t=this.getDocument(),r=t.get(e);this._setSelection(t.createSelection({type:"property",path:e,startOffset:0,endOffset:r.length}))}_renderNode(e,t){let r=this.getDocument().get(t),n=this.getComponent(r.type,!0);return n||(console.error("Could not resolve a component for type: "+r.type),n=tf),e(n,this._getNodeProps(r))}_getNodeProps(e){return{node:e,placeholder:this.props.placeholder,disabled:this.props.disabled}}_shouldConsumeEvent(e){let t=Oh.unwrap(e.target);return t&&(t===this||t.context.surface===this)}getSelectionFromEvent(e){let t=Xd(e),r=this.domSelection.getSelectionForDOMRange(t);return r.surfaceId=this.getId(),r}setSelectionFromEvent(e){let t=this.getSelectionFromEvent(e);t?(this._state.skipNextFocusEvent=!0,this._setSelection(t)):console.error("Could not create a selection from event.")}get id(){return this._surfaceId}_delayed(e){w.inBrowser&&window.setTimeout(e,rf)}_muteNativeHandlers(e){let t;t=w.isMac?["META+66","META+73","META+85"]:["CTRL+66","CTRL+73","CTRL+85"];const r=cu(e);t.indexOf(r)>-1&&e.preventDefault()}}nf.prototype._isSurface=!0,nf.createSurfaceId=function(e){let t=e.context.parentSurfaceId;return t?t+"/"+e.name:e.name};class sf extends nf{constructor(e,t,r){if(t.containerId=t.containerId||t.node.id,t.name=t.name||t.containerId||t.node.id,super(e,t,r),this.containerId=this.props.containerId,!E(this.containerId))throw new Error("Property 'containerId' is mandatory.");let n=this.getDocument();if(this.container=n.get(this.containerId),!this.container)throw new Error("Container with id "+this.containerId+" does not exist.");this._deriveInternalState(this.props)}shouldRerender(e){return e.disabled!==this.props.disabled}willReceiveProps(e){super.willReceiveProps.apply(this,arguments),this._deriveInternalState(e)}didMount(){super.didMount.apply(this,arguments),this.getEditorSession().onUpdate("document",this._onContainerChanged,this,{path:this.container.getContentPath()}),this._attachPlaceholder()}dispose(){super.dispose.apply(this,arguments),this.getEditorSession().off(this)}render(e){let t=super.render(e),r=this.getDocument(),n=this.getContainerId(),s=r.get(n);return s||console.warn("No container node found for ",n),t.addClass("sc-container-editor container-node "+n).attr("data-id",n),t.attr("spellcheck","native"===this.props.spellcheck),s.getNodes().forEach(function(r,n){t.append(this._renderNode(e,r,n))}.bind(this)),this.props.disabled||this.isEmpty()||(t.addClass("sm-enabled"),t.setAttribute("contenteditable",!0)),t}selectFirst(){const e=this.getContainer();if(e.getLength()>0){Mi(this.getEditorSession(),e.getChildAt(0),e.id,"before")}}_renderNode(e,t,r){if(!t)throw new Error("Illegal argument");return e(this._getNodeComponentClass(t),this._getNodeProps(t)).ref(t.id)}_getNodeComponentClass(e){let t=this.getComponent(e.type);return e.isText()||t.prototype._isCustomNodeComponent||t.prototype._isIsolatedNodeComponent?t:this.getComponent("isolated-node")}_deriveInternalState(e){let t=this._state;!e.hasOwnProperty("enabled")||e.enabled?t.enabled=!0:t.enabled=!1}_selectNextIsolatedNode(e){let t=this.getEditorSession().getSelectionState(),r="left"===e?t.previousNode:t.nextNode,n=!r.isText()&&!r.isList();return!(!r||!n)&&(!!("left"===e&&t.isFirst||"right"===e&&t.isLast)&&(this.getEditorSession().setSelection({type:"node",nodeId:r.id,containerId:t.container.id,surfaceId:this.id}),!0))}_handleLeftOrRightArrowKey(e){e.stopPropagation();const t=this.getDocument(),r=this.getEditorSession().getSelection(),n=e.keyCode===$h.LEFT,s=!n,i=n?"left":"right";if(r&&!r.isNull()){const o=t.get(r.containerId,"strict");if(r.isNodeSelection()){let i=o.getPosition(t.get(r.getNodeId()));if(n&&0===i||s&&i===o.length-1)return void e.preventDefault()}r.isNodeSelection()&&!e.shiftKey&&this.domSelection.collapse(i)}this._delayed(()=>{this._updateModelSelection({direction:i})})}_handleUpOrDownArrowKey(e){e.stopPropagation();const t=this.getDocument(),r=this.getEditorSession().getSelection(),n=e.keyCode===$h.UP,s=!n,i=n?"left":"right";if(r&&!r.isNull()){const i=t.get(r.containerId,"strict");if(r.isNodeSelection()){let o=i.getPosition(t.get(r.getNodeId()));if(n&&0===o||s&&o===i.length-1)return void e.preventDefault();let a=this.getEditorSession();if(!e.shiftKey){if(e.preventDefault(),n){return void Mi(a,i.getChildAt(o-1),r.containerId,"after")}return void Mi(a,i.getChildAt(o+1),r.containerId,"before")}}}this._delayed(()=>{this._updateModelSelection({direction:i})})}_handleTabKey(e){const t=this.getEditorSession(),r=t.getSelection();if(r.isNodeSelection()&&r.isFull()){const n=this.refs[r.getNodeId()];if(n&&qi(t,n))return e.preventDefault(),void e.stopPropagation()}super._handleTabKey(e)}__handleTab(e){e.preventDefault(),e.shiftKey?this.getEditorSession().transaction(e=>{e.dedent()},{action:"dedent"}):this.getEditorSession().transaction(e=>{e.indent()},{action:"indent"})}isContainerEditor(){return!0}getContainerId(){return this.containerId}getContainer(){return this.getDocument().get(this.getContainerId())}isEmpty(){let e=this.getContainer();return e&&0===e.length}_attachPlaceholder(){let e=this.childNodes[0];this.placeholderNode&&this.placeholderNode.extendProps({placeholder:void 0}),1===this.childNodes.length&&this.props.placeholder&&(e.extendProps({placeholder:this.props.placeholder}),this.placeholderNode=e)}isEditable(){return super.isEditable.call(this)&&!this.isEmpty()}_onContainerChanged(e){let t=this.getDocument(),r=gh.createContext(this).$$,n=this.getContainer().getContentPath();for(let s=0;s<e.ops.length;s++){let i=e.ops[s];if("update"===i.type&&i.path[0]===n[0]){let e=i.diff;if("insert"===e.type){let n,s=e.getValue(),i=t.get(s);n=i?this._renderNode(r,i):r("div"),this.insertAt(e.getOffset(),n)}else"delete"===e.type&&this.removeAt(e.getOffset())}}this._attachPlaceholder()}get _isContainerEditor(){return!0}}class of extends $p{constructor(...e){if(super(...e),!this.config.nodeType)throw new Error("Every AnnotationCommand must have a nodeType")}getCommandState(e,t){let r=e.selection,n={disabled:!0,active:!1},s=this._getAnnotationsForSelection(e);return s.length>0&&s.forEach(e=>{e.getSelection().equals(r)&&(n.disabled=!1,n.nodeId=e.id)}),n}execute(e,t){}_getAnnotationsForSelection(e){return e.selectionState.annosByType[this.config.nodeType]||[]}}class af extends of{getCommandState(e,t){let r=e.selection,n=this._getAnnotationsForSelection(e),s={disabled:!0};return 1===n.length&&r.isPropertySelection()&&r.isCollapsed()&&(s.disabled=!1,s.showInContext=!0,s.nodeId=n[0].id),s}}class lf extends $p{constructor(e){super(e),this.config.nodeType||console.error("'config.nodeType' should be provided for InsertNodeCommand")}getType(){return this.config.nodeType}getCommandState(e,t){let r=e.selection,n={disabled:!0,active:!1};return r&&!r.isNull()&&!r.isCustomSelection()&&r.containerId&&(n.disabled=!1),n.showInContext=this.showInContext(r,e,t),n}showInContext(e,t,r){let n=t.editorSession.getSelectionState();return e.isCollapsed()&&n.isFirst&&n.isLast}isInsertCommand(){return!0}execute(e,t){if(e.commandState.disabled)return;e.editorSession.transaction(r=>{let n=this.createNodeData(r,e,t),s=r.insertBlockNode(n);this.setSelection(r,s)})}createNodeData(e,t,r){const n=t.type;if(!n)throw new Error("'type' is mandatory");const s=t.editorSession.getDocument().getSchema().getNodeSchema(n);let i={type:n};for(let e of s)i[e.name]=t[e.name];return i}setSelection(e,t){t.isText()&&(e.selection={type:"property",path:t.getPath(),startOffset:0})}}class cf extends Xh{render(e){const t=this.props.node,r=this.ContentClass,n=this.state;let s=e("span");s.addClass(this.getClassNames()).addClass("sc-inline-node").addClass("sm-"+this.props.node.type).attr("data-id",t.id).attr("data-inline","1");let i=this.isDisabled();return n.mode?s.addClass("sm-"+n.mode):s.addClass("sm-not-selected"),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown),s.append(this.renderContent(e,t).ref("content").addClass("se-content")),i&&s.addClass("sm-disabled").attr("contenteditable",!1).on("click",this.onClick),s.attr("draggable",!0),s}isDisabled(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1}getClassNames(){return""}onClick(e){this._shouldConsumeEvent(e)&&this.selectNode()}selectNode(){const e=this.getEditorSession(),t=this.getParentSurface(),r=this.props.node;e.setSelection({type:"property",path:r.start.path,startOffset:r.start.offset,endOffset:r.end.offset,containerId:t.getContainerId(),surfaceId:t.id})}_getContentClass(){const e=this.props.node;let t;return(t=this.getComponent(e.type,!0))||(t=this.getComponent("unsupported-inline-node",!0)),t||(console.error(`No component registered for inline node '${e.type}'.`),t=hf),t}_deriveStateFromSelectionState(e,t){const r=this._getSurfaceForSelection(e,t),n=this.getParentSurface();if(!r)return null;if(r===n){const t=this.props.node;if(e.isPropertySelection()&&!e.isCollapsed()&&S(e.start.path,t.start.path)){const r=t.getSelection();if(r.equals(e))return{mode:"selected"};if(e.contains(r))return{mode:"co-selected"}}}let s=r.context.isolatedNodeComponent;return s?s===this?{mode:"focused"}:this._getIsolatedNodes(e,t).indexOf(this)>-1?{mode:"co-focused"}:null:null}get _isInlineNodeComponent(){return!0}}class hf extends Oh{render(e){const t=this.props.node;return e("span").text("???").attr("data-id",t.id).attr("data-type",t.type)}}class df extends l{constructor(...e){super(...e),this.__isStarted__=!1}start(){nh.getBrowserWindow().on("hashchange",this._onHashChange,this),this.__isStarted__=!0}readRoute(){return this.__isStarted__||this.start(),this.parseRoute(this.getRouteString())}writeRoute(e,t){t=t||{};let r=this.stringifyRoute(e);r?this._writeRoute(r,t):this.clearRoute(t)}dispose(){nh.getBrowserWindow().off(this)}parseRoute(e){return df.routeStringToObject(e)}stringifyRoute(e){return df.objectToRouteString(e)}getRouteString(){return window.location.hash.slice(1)}_writeRoute(e,t){this.__isSaving__=!0;try{t.replace?window.history.replaceState({},"","#"+e):window.history.pushState({},"","#"+e)}finally{this.__isSaving__=!1}}clearRoute(e){this._writeRoute("",e)}_onHashChange(){if(!this.__isSaving__)if(this.__isLoading__)console.error("FIXME: router is currently applying a route.");else{this.__isLoading__=!0;try{let e=this.getRouteString(),t=this.parseRoute(e);this.emit("route:changed",t)}finally{this.__isLoading__=!1}}}}df.objectToRouteString=function(e){let t=[];return r(e,function(e,r){t.push(r+"="+e)}),t.join(",")},df.routeStringToObject=function(e){let t={};return e?(e.split(",").forEach(function(e){let r=e.split("=");if(2!==r.length)throw new Error("Illegal route.");t[r[0].trim()]=r[1].trim()}),t):t};class uf extends $p{constructor(e){if(super(e),!e.spec)throw new Error("'config.spec' is mandatory");if(!e.spec.type)throw new Error("'config.spec.type' is mandatory")}getType(){return this.config.spec.type}getCommandState(e){const t=e.editorSession,r=t.getDocument(),n=e.selection,s=t.isBlurred();let i={disabled:!1};if(n.isPropertySelection()&&!s){let e=n.getPath(),t=r.get(e[0]);t&&t.isText()&&t.isBlock()?(i.active=Fn(t,this.config.spec),i.showInContext=0===n.start.offset&&0===n.end.offset):i.disabled=!0}else i.disabled=!0;return i}execute(e){e.editorSession.transaction(e=>e.switchTextType(this.config.spec))}isSwitchTypeCommand(){return!0}}class pf extends Yp{render(e){let t=super.render(e);t.addClass("sc-text-block");let r=this.props.node;return r.direction&&t.attr("dir",r.direction),r.textAlign&&t.addClass("sm-align-"+r.textAlign),t.append(e(Jh,{placeholder:this.props.placeholder,path:r.getPath(),direction:r.direction})),t}}class ff extends nf{constructor(e,t){if(t.name=t.name||t.path.join("."),super(e,t),!t.path)throw new Error("Property 'path' is mandatory.")}render(e){let t=super.render.apply(this,arguments);return t.addClass("sc-text-property-editor"),this.props.disabled||(t.addClass("sm-enabled"),t.attr("contenteditable",!0),t.attr("spellcheck","native"===this.props.spellcheck)),t.append(e(Jh,{doc:this.getDocument(),placeholder:this.props.placeholder,tagName:this.props.tagName||"div",path:this.props.path,markers:this.props.markers,withoutBreak:this.props.withoutBreak}).ref("property")),t}selectFirst(){this.editorSession.setSelection({type:"property",path:this.getPath(),startOffset:0,surfaceId:this.id})}getPath(){return this.props.path}_handleEnterKey(e){e.stopPropagation(),!1!==this.props.handleEnter&&this.props.multiLine||e.preventDefault(),this.el.emit("enter",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code})}_handleEscapeKey(e){this.el.emit("escape",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code})}get _isTextPropertyEditor(){return!0}}class gf extends Oh{render(e){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");let t=e("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?t.addClass("sm-horizontal"):t.addClass("sm-vertical");let r=this.props.children[0],n=this.props.children[1];return this.props.sizeB?(n.addClass("se-pane sm-sized"),n.css(this.getSizedStyle(this.props.sizeB)),r.addClass("se-pane sm-auto-fill")):(r.addClass("se-pane sm-sized"),r.css(this.getSizedStyle(this.props.sizeA)),n.addClass("se-pane sm-auto-fill")),t.append(r,n),t}getSizedStyle(e){return e&&"inherit"!==e?"horizontal"===this.props.splitType?{height:e}:{width:e}:{}}}class mf extends $p{getCommandState(e){return{disabled:!e.editorSession.canUndo(),active:!1}}execute(e){let t=e.editorSession;return t.canUndo()&&t.undo(),!0}}class _f extends $p{getCommandState(e){return{disabled:!e.editorSession.canRedo(),active:!1}}execute(e){let t=e.editorSession;return!!t.canRedo()&&(t.redo(),!0)}}class yf extends $p{getCommandState(e){let t=e.editorSession,r=t.isBlurred(),n=e.surface||t.getFocusedSurface(),s=t.getSelection();return{disabled:r||!s||s.isNull()||!n||!(n._isContainerEditor||n._isTextPropertyEditor)}}execute(e){let t=e.editorSession,r=t.getDocument(),n=e.surface||t.getFocusedSurface();if(n){let e;if(n._isContainerEditor){let r=n.getContainer(),s=r.getContent();if(0===s.length)return!1;let i=s[0],o=wi(s);e=t.createSelection({type:"container",startPath:[i],startOffset:0,endPath:[o],endOffset:1,containerId:r.id,surfaceId:n.id})}else if(n._isTextPropertyEditor){let s=n.getPath(),i=r.get(s);e=t.createSelection({type:"property",path:s,startOffset:0,endOffset:i.length,surfaceId:n.id})}return t.setSelection(e),!0}return!1}}var wf=Object.freeze({series:function e(t,r,n){t[n=n||0](function(s,...i){if(s)return r(s);n===t.length-1?r(s,...i):e(t,r,n+1)})}});const bf="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function vf(e){if(!C(e))throw new Error("Illegal argument.");let t="";for(;;){let r=e%bf.length;if(e=Math.floor(e/bf.length),t=bf[r]+t,e>0)e--;else if(0===e)break}return t}function Cf(e){var t=/^([A-Z]+)([1-9][0-9]*)$/.exec(e);return[parseInt(t[2],10)-1,Ef(t[1])]}const Sf="A".charCodeAt(0),xf=bf.length;function Ef(e){let t=0,r=0;for(let n=e.length-1;n>=0;n--){let s=e.charCodeAt(n)-Sf;if(s<0||s>=xf)throw new Error("Illegal column label: "+e);t+=Math.pow(xf,r)*(s+1),r++}return t-1}var Nf=Object.freeze({ALPHABET:bf,getColumnLabel:vf,getRowCol:Cf,getColumnIndex:Ef,getCellLabel:function(e,t){return vf(t)+(e+1)},getIndexesFromRange:function(e,t){let r,n,[s,i]=Cf(e);return t?([r,n]=Cf(t),s>r&&([s,r]=[r,s]),i>n&&([i,n]=[n,i])):[r,n]=[s,i],{startRow:s,startCol:i,endRow:r,endCol:n}},getRangeFromMatrix:function(e,t,r,n,s,i){if(!i){if(t===n&&r===s){let n=e[t];return n?n[r]:void 0}if(t===n){let n=e[t];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let i=t;i<=n;i++){let t=e[i];t&&s.push(t[r])}return s}}let o=[];for(var a=t;a<n+1;a++){let t=e[a];t&&o.push(t.slice(r,s+1))}return o}});function Tf(e){return e.reduce((e,t)=>(e[t]=!0,e),{})}function If(e,t){let r=[];for(let n=0;n<=t.length;n++){if(r[n]=[n],0===n)continue;let s=n-1;for(let i=0;i<=e.length;i++){if(r[0][i]=i,0===i)continue;let o=i-1;r[n][i]=t.charAt(s)===e.charAt(o)?r[s][o]:Math.min(r[s][o]+1,r[n][o]+1,r[s][i]+1)}}return r}function Af(e,t){return _(e)?e.concat(t):null}function Df(e,t){return _(e)?t:null}function Of(e,t){let r=e.getItems(),n=[t(s(1))];for(let e=0;e<r.length;e++){const i=r[e],o=i.getLevel();if(o<n.length)for(let e=n.length;e>o;e--)n.pop();else if(o>n.length)for(let e=n.length;e<o;e++){let r,i=n[e-1],o=i.getChildCount();0===o?(r=t("li"),i.append(r)):r=i.getChildAt(o-1);let a=t(s(e+1));r.append(a),n.push(a)}console.assert(o===n.length,"item.level should now be the same as stack.length"),wi(n).append(t(i))}for(let e=n.length;e>1;e--)n.pop();return n[0];function s(t){return"order"===e.getListType(t)?"ol":"ul"}}function Pf(e,t){return new Promise(function(n,s){var i=(e.method||"GET").toUpperCase(),o=e.url;if(["GET","POST","PUT","DELETE"].indexOf(i)<0)throw new Error("Parameter 'method' must be 'GET', 'POST', 'PUT', or 'DELETE'.");if(!o)throw new Error("Parameter 'url' is required.");var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)return function(){if(200===a.status){var e=a.responseText;t&&t(null,e),n(e)}else{console.error(a.statusText);let e=new Error(a.statusText);t&&t(e),s(e)}}()},a.open(i,o,!0),e.header&&r(e.header,function(e,t){a.setRequestHeader(t,e)}),e.data instanceof FormData?a.send(e.data):e.data?a.send(JSON.stringify(e.data)):a.send()})}function kf(e,t,r){for(let n=0;n<e;n++)t.call(r)}function Mf(e,t){return Bf(e,e._childNodes.length,t),e}function Lf(e,t){return e._childNodes.indexOf(t.id)}function Rf(e,t){const r=Lf(e,t);if(!(r>=0))throw new Error(`Node ${t.id} is not a child of ${e.id}`);return Ff(e,r),e}function qf(e,t,r){if(r){let n=Lf(e,r);if(n<0)throw new Error(`Node ${t.id} is not a child of ${e.id}`);Bf(e,n,t)}else Mf(e,t);return e}function Bf(e,t,r){const n=e._childNodes.length;if(!(t>=0&&t<=n))throw new Error("Index out of bounds.");e.getDocument().update([e.id,"_childNodes"],{type:"insert",pos:t,value:r.id});return e}function Ff(e,t){const r=e._childNodes.length;if(!(t>=0&&t<r))throw new Error("Index out of bounds.");e.getDocument().update([e.id,"_childNodes"],{type:"delete",pos:t});return e}function jf(e,t){let r=e._childNodes[t];if(r)return e.getDocument().get(r)}function Hf(e,t){let r;switch(t._elementType){case"text":r=function(e,t){const r=t.getAnnotations(),n=t.getText();let s=Uf(e,t);if(r&&r.length>0){let i=new Hh({onText:(e,t)=>{const r=e.node;(r.isText()||r.isAnnotation())&&e.el.append(t)},onEnter:t=>({el:Hf(e,t.node),node:t.node}),onExit:(e,t,r)=>{r.el.append(t.el)}});i.start({el:s,node:t},n,r)}else s.append(n);return s}(e,t);break;case"element":case"inline-element":case"container":r=function(e,t){let r=Uf(e,t);return r.append(t.getChildren().map(t=>Hf(e,t))),r}(e,t);break;case"anchor":case"annotation":r=Uf(e,t);break;case"external":r=nh.parseSnippet(t.xml,"xml");break;default:throw new Error("Invalid element type.")}return r}function Uf(e,t){let r=e.createElement(t.type);return r.attr("id",t.id),r.attr(t.attributes),r}function zf(e){const t=e.indexOf(":");return t>0?e.slice(t+1):e}const Vf=new class extends sa.DomUtils{isTag(){return!0}getChildren(e){return e.getChildren?e.getChildren():[]}getAttributeValue(e,t){if(e.getAttribute)return e.getAttribute(t)}getAttributes(e){return e.hasOwnProperty("attributes")?["id",e.id].concat(g(e.attributes,(e,t)=>[t,e])):["id",e.id]}hasAttrib(e,t){return"id"===t||!!e.hasOwnProperty("attributes")&&e.attributes.hasOwnProperty(t)}getName(e){return e.type}getNameWithoutNS(e){return zf(this.getName(e))}getText(e){return"text"===e._elementType?e.getText():""}};class Gf extends wd{_initialize(e,t){t.attributes&&delete t.attributes.id,super._initialize(e,t)}toXML(){return e=this,Hf(nh.createDocument("xml"),e);var e}findChild(e){const t=this.getChildren();for(let r=0;r<t.length;r++){const n=t[r];if(n.type===e)return n}}find(e){return Ea.selectOne(e,this,{xmlMode:!0,adapter:Vf})}findAll(e){return Ea.selectAll(e,this,{xmlMode:!0,adapter:Vf})}isContainer(){return!1}isBlock(){const e=this.parentNode;return e&&e.isContainer()}get children(){return this.getChildren()}getChildren(){return this.getChildNodes()}getChildNodes(){return this._childNodes?Ld(this.getDocument(),this._childNodes):[]}getChildCount(){return this._childNodes?this._childNodes.length:0}getChildPosition(e){return e&&this._childNodes?this._childNodes.indexOf(e.id):-1}getChildNodeIterator(){return new so(this.getChildNodes())}getFirstChild(){if(this._childNodes)return this.getDocument().get(this._childNodes[0])}getLastChild(){if(this._childNodes)return this.getDocument().get(wi(this._childNodes))}getParent(){return this.parentNode}setParent(e){this.parentNode=e}get tagName(){return this.type}get parent(){return this.parentNode}setAttribute(e,t){if("id"===e)throw new Error("'id' is read-only and can not be changed");return this.getDocument().set([this.id,"attributes",e],t),this}getAttribute(e){return"id"===e?this.id:this.attributes[e]}removeAttribute(e){return this.attributes.hasOwnProperty(e)&&(this.getDocument().set([this.id,"attributes",e],void 0),delete this.attributes[e]),this}getAttributes(){return y(this.attributes)}getElementSchema(){return this.getDocument().getElementSchema(this.type)}serialize(){return this.toXML()}isTextNode(){return!1}isElementNode(){return!1}getInnerXML(){return(e=this)._childNodes?e.getChildNodes().map(e=>e.toXML().serialize()).join(""):e.isText()?e.toXML().getInnerXML():"";var e}get _isXMLNode(){return!0}}Gf.prototype.attr=lo.prototype.attr,Gf.schema={attributes:{type:"object",default:{}}};class Jf extends Gf{get parentNode(){const e=this.coor.start.path;return this.getDocument().get(e[0])}}Jf.prototype._elementType="anchor",Jf.type="anchor",Jf.schema={coor:{type:"coordinate",optional:!0}};class Kf extends(Hd(Gf)){get parentNode(){const e=this.start.path;return this.getDocument().get(e[0])}static isPropertyAnnotation(){return!0}get _elementType(){return"annotation"}}Kf.schema={type:"@annotation"};class $f extends Gf{appendChild(e){return Mf(this,e)}removeChild(e){return Rf(this,e)}insertBefore(e,t){return qf(this,e,t)}insertAt(e,t){return Bf(this,e,t)}removeAt(e){return Ff(this,e)}getChildAt(e){return jf(this,e)}isElementNode(){return!0}append(){return lo.prototype.append.apply(this,arguments)}replaceChild(e,t){return function(e,t,r){const n=Lf(e,t);if(!(n>=0))throw new Error(`Node ${t.id} is not a child of ${e.id}`);return Ff(e,n),Bf(e,n,r),e}(this,e,t)}get _elementType(){return"element"}static isBlock(){return!0}}$f.schema={type:"element",_childNodes:{type:["array","id"],default:[],owned:!0}};class Xf extends(Fd($f)){getContentPath(){return[this.id,"_childNodes"]}getContent(){return this._childNodes}isContainer(){return!0}appendChild(e){super.show(e.id)}get _elementType(){return"container"}static isBlock(){return!0}}Xf.schema={type:"container"};class Wf{constructor(e){this.doc=e,this.parents={},e.data.on("operation:applied",this._onOperationApplied,this)}_onOperationApplied(e){const t=this.doc,r=this.parents;let n=t.get(e.path[0]);switch(e.type){case"create":n._childNodes&&s(n,n._childNodes),function(e){let t=r[e.id];t&&(e.parentNode=t)}(n);break;case"update":{let t=e.diff;"_childNodes"===e.path[1]&&(t.isInsert()?s(n,t.getValue()):t.isDelete()&&s(null,t.getValue()));break}case"set":"_childNodes"===e.path[1]&&(s(null,e.getOldValue()),s(n,e.getValue()))}function s(e,n){function s(n){r[n]=e;let s=t.get(n);s&&(s.parentNode=e)}n&&(_(n)?n.forEach(s):s(n))}}static register(e){return new Wf(e)}}class Yf extends cp{find(e){return this.getDocument().find(e)}findAll(e){return this.getDocument().findAll(e)}createElement(...e){return this.getDocument().createElement(...e)}}class Zf extends Bp{_initialize(){this.nodeFactory=new Lp(this),this.data=new Mp(this.schema,this.nodeFactory),this.addIndex("type",new kp("type")),this.addIndex("annotations",new tp),Wf.register(this)}toXML(){let e=nh.createDocument("xml");e.setDoctype(...this.getDocTypeParams());let t=this.getRootNode().toXML();return e.append(t),e}getDocTypeParams(){throw new Error("This method is abstract")}getXMLSchema(){throw new Error("This method is abstract")}getRootNode(){throw new Error("This method is abstract")}getDocTypeAsString(){return new Error("This method is abstract")}createEditingInterface(){return new Yf(this)}find(e){return this.getRootNode().find(e)}findAll(e){return this.getRootNode().findAll(e)}createElement(e,t){return this.create(Object.assign({id:d(e),type:e},t))}getElementSchema(e){return this.getXMLSchema().getElementSchema(e)}_validateChange(e){let t={},r=[];e.ops.forEach(e=>{switch(e.type){case"delete":r.push(e.val.id);break;case"create":t[e.val.id]=!0;break;default:e.path&&(t[e.path[0]]=!0)}}),r.forEach(e=>delete t[e]);const n=this.getXMLSchema();let s=[];return Object.keys(t).forEach(e=>{let t=this.get(e);if(t&&t._isXMLNode){let e=n.validateElement(t);e.ok||(s=s.concat(e.errors))}}),{ok:0===s.length,errors:s}}_apply(e){if(!e.ops)return;let t={},r={},n={};const s=this;function i(e,t){let r=n[e];return r||(r=n[e]={ops:[]}),t&&r.ops.push(t),r}e.ops.forEach(e=>{switch(e.type){case"create":t[e.path[0]]=e.val;break;case"delete":{let t=this.get(e.path[0]);r[t.id]=t;break}case"update":case"set":n[e.path]=!0,i(this.get(e.path[0]).id,e);break}!function(e){switch(e.type){case"create":case"delete":{const t=e.val;if(t.hasOwnProperty("start")){n[t.start.path]=!0;let r=s.get(t.start.path[0]);r&&i(r.id,e)}if(t.hasOwnProperty("end")){n[t.end.path]=!0;let r=s.get(t.start.path[0]);r&&i(r.id,e)}break}case"update":case"set":{let t=s.get(e.path[0]);if(t)if(t.isPropertyAnnotation()){n[t.start.path]=!0;let r=s.get(t.start.path[0]);r&&i(r.id,e)}else t.isContainerAnnotation();break}}}(e),this._applyOp(e)}),Object.keys(r).forEach(e=>{delete n[e]}),e.created=t,e.updated=n,e.deleted=r,e._extracted=!0}}Zf.prototype._isXMLDocument=!0;const Qf="START",eg="END",tg="EPSILON";class rg{constructor(e){e&&0!==Object.keys(e).length||(e={START:{EPSILON:eg}}),this.transitions=e}consume(e,t){const r=this.transitions;if(!r[e])return-1;let n=r[e][t];if(void 0!==n)return n;for(;void 0!==r[e][tg];){if((e=r[e][tg])===eg)return-1;if(void 0!==(n=r[e][t]))return n}return-1}canConsume(e,t){return-1!==this.consume(e,t)}isFinished(e){const t=this.transitions;if("END"===e)return!0;if(!t[e])return!1;for(;void 0!==t[e][tg];)if("END"===(e=t[e][tg]))return!0;return!1}_tokensByPath(){const e=[],t=this.transitions;if(!t)return[];let n={};r(t[Qf],(e,t)=>{n[e]||(n[e]=[]),n[e].push(t)});let s={START:!0,END:!0};return r(n,(r,n)=>{let i={};r.forEach(e=>{e!==tg&&(i[e]=!0)});let o=[n];for(;o.length>0;){let e=o.pop();if(n===eg)continue;s[e]=!0;let r=t[e];if(!r)throw new Error(`Internal Error: no transition from state ${e}`);let a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],n=r[t];s[n]||o.push(n),t!==tg&&(i[t]=!0)}}let a=Object.keys(i);a.length>0&&e.push(a)}),e}}function ng(e){return Boolean(/^\s*$/.exec(e.textContent))}rg.START=Qf,rg.END=eg,rg.EPSILON=tg,rg.TEXT="TEXT";const{TEXT:sg}=rg;class ig{constructor(e,t,r){this.el=e,this.it=t,this.expr=r,this.state=r.getInitialState(),this._oldStates=[]}hasNext(){return this.it.hasNext()}next(){const e=this.state,t=this.expr;let r,n=this.it.next(),s=v(this.state);if(n.isTextNode()?r=t.consume(e,sg):n.isElementNode()&&(r=t.consume(e,n.tagName)),r)return this._oldStates.push(s),n;if(n.isTextNode())ng(n)||console.error(`TEXT is invalid within <${t.name}>. Skipping.`,n.textContent);else if(n.isElementNode()){let t=wi(e.errors);console.error(t.msg,this.el.getNativeElement())}return this.state=s,n.createComment(n.outerHTML)}back(){return this.it.back(),this.state=this._oldStates.pop(),this}peek(){return this.it.peek()}}class og extends Ep{constructor(e,t){super(function(e){const t=e.schema,r=e.xmlSchema||t.xmlSchema;return{schema:t,xmlSchema:r,converters:e.converters,idAttribute:e.idAttribute||r.getIdAttribute()}}(e),t),this.xmlSchema=e.xmlSchema||e.schema.xmlSchema}importDocument(e){this.reset();const t=this.state.doc;E(e)&&(e=nh.parseXML(e));const r=this.xmlSchema.getStartElement();let n;if(!(n=e.is(r)?e:e.find(r)))throw new Error(`Could not find <${r}> element.`);return t.root=this.convertElement(n),this.state.doc}_initialize(){const e=this.schema,t=e.getDefaultTextType(),r=this.converters;this._allConverters=[],this._propertyAnnotationConverters=[],this._blockConverters=[];for(let n=0;n<r.length;n++){let s;if("function"==typeof r[n]){s=new(0,r[n])}else s=r[n];if(!s.type)throw new Error("Converter must provide the type of the associated node.");if(!s.matchElement&&!s.tagName)throw new Error("Converter must provide a matchElement function or a tagName property.");s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));const i=e.getNodeClass(s.type);if(!i)throw new Error("No node type defined for converter");this._defaultBlockConverter||t!==s.type||(this._defaultBlockConverter=s),i.isAnnotation()||i.isInlineNode()?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s)}this._allConverters=this._blockConverters.concat(this._propertyAnnotationConverters)}_createNodeData(e,t){let r=super._createNodeData(e,t),n={};return e.getAttributes().forEach((e,t)=>{n[t]=e}),r.attributes=n,r}getChildNodeIterator(e){let t=this.xmlSchema.getElementSchema(e.tagName),r=e.getChildNodeIterator();return t?new ig(e,r,t.expr):r}_convertPropertyAnnotation(){throw new Error("stand-alone annotations are not supported.")}_convertInlineNode(e,t,r){return r.import&&(t=r.import(e,t,this)||t),t.start={path:[],offset:0},t.end={offset:0},t}}class ag{constructor(e){this.type=e,this.tagName=zf(e),this.tagNameNS=e}matchElement(e){return e.tagName===this.tagNameNS}export(e,t){t.tagName=this.tagNameNS,t.attr(e.attributes)}}class lg extends ag{import(e,t,r){let n=r.getChildNodeIterator(e),s=[];for(;n.hasNext();){const e=n.next();if(e.isElementNode()){let t=r.convertElement(e);s.push(t.id)}}t._childNodes=s}export(e,t,r){t.tagName=this.tagNameNS,t.attr(e.attributes),e.getChildren().forEach(e=>{let n=r.convertNode(e);t.appendChild(n)})}}class cg extends Gf{get _elementType(){return"external"}static isBlock(){return!0}}cg.schema={type:"external",xml:{type:"string",default:""}};class hg extends ag{import(e,t){t.xml=e.innerHTML}export(e,t){t.tagName=this.tagNameNS,t.setAttributes(e.attributes),t.innerHTML=e.xml}}class dg extends(Hd(Gf)){get parentNode(){const e=this.start.path;if(e[0]){return this.getDocument().get(e[0])}return this._parentNode}set parentNode(e){if(this.start.path[0])throw new Error("parent of inline-element is implicitly given");this._parentNode=e}getChildAt(e){return jf(this,e)}appendChild(e){return Mf(this,e)}removeChild(e){return Rf(this,e)}insertBefore(e,t){return qf(this,e,t)}insertAt(e,t){return Bf(this,e,t)}removeAt(e){return Ff(this,e)}getInnerXML(){return this.getChildren().map(e=>e.toXML().outerHTML).join("")}static isInlineNode(){return!0}get _elementType(){return"inline-element"}get _isInlineNode(){return!0}}dg.schema={type:"inline-element",_childNodes:{type:["array","id"],default:[],owned:!0}};const ug=rg.START,pg=rg.END,fg=rg.EPSILON;class gg{constructor(e){this.transitions=e}addTransition(e,t,r){return this.transitions||(this.transitions={}),_(r)||(r=[r]),r.forEach(r=>mg(this.transitions,e,t,r)),this}append(e){if(this.transitions&&e.transitions){let t=v(this.transitions),n=v(e.transitions),s=Boolean(t[ug][fg]),i=Boolean(n[ug][fg]);s&&delete t[ug][fg];let o=d();r(t,e=>{r(e,(t,r)=>{t===pg&&(e[r]=o)})}),s&&r(n[ug],(e,r)=>{mg(t,ug,e,r)}),n[o]=n[ug],r(n,e=>{r(e,(t,r)=>{t===ug&&(e[r]=o)})}),delete n[ug],r(n,(e,n)=>{r(e,(e,r)=>{mg(t,n,e,r)})}),s&&i&&mg(t,ug,pg,fg),this.transitions=t}else e.transitions&&(this.transitions=v(e.transitions));return this}merge(e){if(this.transitions&&e.transitions){let t=this.transitions;r(e.transitions,(e,n)=>{r(e,(e,r)=>{mg(t,n,e,r)})})}else e.transitions&&(this.transitions=v(e.transitions));return this}optional(){let e=new gg(v(this.transitions));return this.transitions&&e.addTransition(ug,pg,fg),e}kleene(){return this.plus().optional()}plus(){let e;if(this.transitions){let t=v(this.transitions);const n=Boolean(t[ug][fg]);delete t[ug][fg];let s=d();r(t,e=>{r(e,(t,r)=>{t===pg&&(e[r]=s)})}),mg(t,s,pg,fg),r(t[ug],(e,r)=>{mg(t,s,e,r)}),n&&mg(t,ug,pg,fg),e=new gg(t)}else e=new gg(v(this.transitions));return e}toJSON(){return v(this.transitions)}copy(){let e=v(this.transitions);if(this.transitions){let t=Object.keys(e),n={START:ug,END:pg};t.forEach(e=>{e!==ug&&e!==pg&&(n[e]=d())}),r(e,(t,s)=>{s!==ug&&s!==pg&&(e[n[s]]=t,delete e[s]),r(t,(e,r)=>{e!==ug&&e!==pg&&(t[r]=n[e])})})}return new gg(e)}}function mg(e,t,r,n){let s=e[t];if(s||(e[t]=s={}),n===fg&&t===ug&&r!==pg)throw new Error("The only EPSILON transition from START must be START->END");s[n]&&s[n]!==r?console.error("Token %s already used. Ignoring this transition.",n):s[n]=r}gg.singleToken=function(e){let t=new gg;return t.addTransition(ug,pg,e),t};const{START:_g,END:yg,TEXT:wg,EPSILON:bg}=rg;class vg{constructor(e,t){this.name=e,this.root=t,this._initialize()}_initialize(){this._compile()}toString(){return this.root.toString()}copy(){return this.root.copy()}toJSON(){return{name:this.name,content:this.root.toJSON()}}isAllowed(e){return Boolean(this._allowedChildren[e])}_normalize(){this.root._normalize()}_compile(){this.root._compile()}_describeError(e,t){let r=[];return t!==wg?this.isAllowed(t)?r.push(`<${t}> is not allowed at the current position in <${this.name}>.\n${this.toString()}`):r.push(`<${t}> is not valid in <${this.name}>\nSchema: ${this.toString()}`):r.push(`TEXT is not allowed at the current position: ${e.trace.join(",")}\n${this.toString()}`),r.join("")}}function Cg(e,t){return t instanceof Ag?new Eg(e,t):new Sg(e,t)}vg.fromJSON=function(e){return Cg(e.name,kg(e.content))};class Sg extends vg{getInitialState(){return{dfaState:_g,errors:[],trace:[]}}canConsume(e,t){return this.dfa.canConsume(e.dfaState,t)}consume(e,t){const r=this.dfa;let n=e.dfaState,s=r.consume(n,t);return e.dfaState=s,-1===s?(e.errors.push({msg:this._describeError(e,t),el:e.el}),!1):(e.trace.push(t),!0)}isFinished(e){return this.dfa.isFinished(e.dfaState)}_initialize(){super._initialize(),this._computeAllowedChildren()}_compile(){super._compile(),this.dfa=new rg(this.root.dfa.transitions)}_computeAllowedChildren(){this._allowedChildren=xg(this.dfa)}_findInsertPos(e,t,r){const n=this.root;return n instanceof Ig?this._findInsertPosInSequence(e,t,r):n instanceof Pg||n instanceof Og?"first"===r?0:e.childNodes.length:void 0}_isValid(e){let t=this.getInitialState();for(let r=0;r<e.length;r++){const n=e[r];if(n&&!this.consume(t,n))return!1}return this.isFinished(t)}_findInsertPosInSequence(e,t,r){const n=[];e.getChildNodes().forEach(e=>{const t=e.tagName;t?n.push(t):e._isDOMElement&&e.isTextNode()&&!ng(e)?n.push(wg):n.push(null)});const s=n.length,i=this;function o(e){let r=n.slice(0);return r.splice(e,0,t),i._isValid(r)}if("first"===r){for(let e=0;e<=s;e++)if(o(e))return e}else for(let e=s;e>=0;e--)if(o(e))return e;return-1}}function xg(e){const t={};return e.transitions&&r(e.transitions,e=>{Object.keys(e).forEach(e=>{e!==bg&&(t[e]=!0)})}),t}class Eg extends vg{getInitialState(){const e=this.dfas,t=new Array(e.length);return t.fill(_g),{dfaStates:t,errors:[],trace:[],lastDFA:0}}canConsume(e,t){return this._findNextDFA(e,t)>=0}consume(e,t){const r=this._findNextDFA(e,t);if(r<0)return e.errors.push({msg:this._describeError(e,t)}),!1;{const n=this.dfas[r],s=e.dfaStates[r],i=n.consume(s,t);return e.dfaStates[r]=i,e.trace.push(t),!0}}isFinished(e){const t=this.dfas;for(let r=0;r<t.length;r++){const n=t[r],s=e.dfaStates[r];if(!n.isFinished(s))return!1}return!0}_initialize(){super._initialize(),this._computeAllowedChildren()}_compile(){super._compile(),this.blocks=this.root.blocks,this.dfas=this.blocks.map(e=>new rg(e.dfa.transitions))}_computeAllowedChildren(){this._allowedChildren=Object.assign(...this.blocks.map(e=>xg(e.dfa)))}_findNextDFA(e,t){console.assert(e.dfaStates.length===this.dfas.length);const r=this.dfas;for(let n=0;n<e.dfaStates.length;n++){const s=r[n],i=e.dfaStates[n];if(s.canConsume(i,t))return n}return-1}_findInsertPos(e,t,r){return e.childNodes.length}}class Ng{constructor(e){this.name=e}toString(){return this.name}toJSON(){return this.name}copy(){return new Ng(this.name)}_normalize(){}_compile(){this.dfa=gg.singleToken(this.name)}}Ng.fromJSON=function(e){return new Ng(e)};class Tg{constructor(e){this.blocks=e}copy(){return new Tg(this.blocks.map(e=>e.copy()))}toJSON(){return{type:"|",blocks:this.blocks.map(e=>e.toJSON())}}_normalize(){const e=this.blocks;for(let t=e.length-1;t>=0;t--){let r=e[t];r._normalize(),r instanceof Tg&&e.splice(t,1,...r.blocks)}}_compile(){let e=new gg;return this.blocks.forEach(t=>{if(t instanceof Ng)e.addTransition(_g,yg,t.name);else{if(t instanceof Ag)throw new Error("Nested interleave blocks are not supported.");t.dfa||t._compile(),e.merge(t.dfa)}}),this.dfa=e,e}toString(){return"("+this.blocks.map(e=>e.toString()).join("|")+")"}}Tg.fromJSON=function(e){return new Tg(e.blocks.map(e=>kg(e)))};class Ig{constructor(e){this.blocks=e}copy(){return new Ig(this.blocks.map(e=>e.copy()))}toJSON(){return{type:",",blocks:this.blocks.map(e=>e.toJSON())}}_compile(){let e=new gg;return this.blocks.forEach(t=>{if(t instanceof Ng)e.append(gg.singleToken(t.name));else{if(t instanceof Ag)throw new Error("Nested interleave blocks are not supported.");t.dfa||t._compile(),e.append(t.dfa)}}),this.dfa=e,e}_normalize(){const e=this.blocks;for(let t=e.length-1;t>=0;t--){let r=e[t];r._normalize(),r instanceof Ig&&e.splice(t,1,...r.blocks)}}toString(){return"("+this.blocks.map(e=>e.toString()).join(",")+")"}}Ig.fromJSON=function(e){return new Ig(e.blocks.map(e=>kg(e)))};class Ag{constructor(e){this.blocks=e}copy(){return new Ag(this.blocks.map(e=>e.copy()))}toString(){return"("+this.blocks.map(e=>e.toString()).join(", ")+")[unordered]"}toJSON(){return{type:"~",blocks:this.blocks.map(e=>e.toJSON())}}_normalize(){}_compile(){this.blocks.forEach(e=>e._compile())}}Ag.fromJSON=function(e){return new Ag(e.blocks.map(e=>kg(e)))};class Dg{constructor(e){this.block=e}copy(){return new Dg(this.block.copy())}toJSON(){return{type:"?",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof Ag)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.optional(),this.dfa}_normalize(){const e=this.block;e._normalize(),e instanceof Dg?this.block=e.block:e instanceof Og&&console.error("FIXME -  <optional> is useless here",this.toString())}toString(){return this.block.toString()+"?"}}Dg.fromJSON=function(e){return new Dg(kg(e.block))};class Og{constructor(e){this.block=e}copy(){return new Og(this.block.copy())}toJSON(){return{type:"*",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof Ag)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.kleene(),this.dfa}_normalize(){const e=this.block;if(e._normalize(),e instanceof Dg||e instanceof Og)this.block=e.block;else if(e instanceof Pg)throw new Error("This does not make sense:"+this.toString())}toString(){return this.block.toString()+"*"}}Og.fromJSON=function(e){return new Og(kg(e.block))};class Pg{constructor(e){this.block=e}copy(){return new Pg(this.block.copy())}toJSON(){return{type:"+",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof Ag)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.plus(),this.dfa}_normalize(){const e=this.block;if(e._normalize(),e instanceof Dg||e instanceof Og)throw new Error("This does not make sense:"+this.toString());e instanceof Pg&&(this.block=e.block)}toString(){return this.block.toString()+"+"}}function kg(e){switch(e.type){case",":return Ig.fromJSON(e);case"~":return Ag.fromJSON(e);case"|":return Tg.fromJSON(e);case"?":return Dg.fromJSON(e);case"+":return Pg.fromJSON(e);case"*":return Og.fromJSON(e);default:if(E(e))return new Ng(e);throw new Error("Unsupported data.")}}Pg.fromJSON=function(e){return new Pg(kg(e.block))};const{TEXT:Mg}=rg;class Lg{constructor(e,t){if(!e[t])throw new Error("startElement must be a valid element.");this._elementSchemas={},this.startElement=t,r(e,(e,t)=>{this._elementSchemas[t]=new Rg(e.name,e.type,e.attributes,e.expr)})}getIdAttribute(){return"id"}getTagNames(){return Object.keys(this._elementSchemas)}getElementSchema(e){return this._elementSchemas[e]}getStartElement(){return this.startElement}toJSON(){let e={start:this.getStartElement(),elements:{}};return r(this._elementSchemas,(t,r)=>{e.elements[r]=t.toJSON()}),e}toMD(){let e=[],t=Object.keys(this._elementSchemas);return t.sort(),t.forEach(t=>{let r=this._elementSchemas[t];e.push(`# <${r.name}>`),e.push(""),e.push(`type: ${r.type}`),e.push("attributes: "+g(r.attributes,(e,t)=>t).join(", ")),e.push("children:"),e.push("  "+r.expr.toString()),e.push("")}),e.join("\n")}validateElement(e){let t=e.tagName;return function(e,t){let r=[],n=!0;{const e={ok:!0};e.ok||(r=r.concat(e.errors),n=!1)}if("external"===e.type||"not-implemented"===e.type);else{let s;(s=t._isXMLTextElement?qg(e,t.toXML()):qg(e,t)).ok||(r=r.concat(s.errors),n=!1)}return{errors:r,ok:n}}(this.getElementSchema(t),e)}}Lg.fromJSON=function(e){let t={};return r(e.elements,e=>{let r=Rg.fromJSON(e);t[r.name]=r}),new Lg(t,e.start)};class Rg{constructor(e,t,r,n){if(this.name=e,this.type=t,this.attributes=r,this.expr=n,!e)throw new Error("'name' is mandatory");if(!t)throw new Error("'type' is mandatory");if(!r)throw new Error("'attributes' is mandatory");if(!n)throw new Error("'expr' is mandatory")}toJSON(){return{name:this.name,type:this.type,attributes:this.attributes,elements:this.expr.toJSON()}}isAllowed(e){return this.expr.isAllowed(e)}isTextAllowed(){return this.expr.isAllowed(Mg)}printStructure(){return`${this.name} ::= ${this.expr.toString()}`}findFirstValidPos(e,t){return this.expr._findInsertPos(e,t,"first")}findLastValidPos(e,t){return this.expr._findInsertPos(e,t,"last")}}function qg(e,t){if("external"===e.type||"not-implemented"===e.type)return!0;const r=e.expr,n=r.getInitialState(),s=t.getChildNodeIterator();let i=!0;for(;i&&s.hasNext();){const t=s.next();let o;if(t.isTextNode()){if("text"!==e.type&&ng(t))continue;o=Mg}else{if(!t.isElementNode())continue;o=t.tagName}r.consume(n,o)||(i=!1)}return n.errors.length>0&&n.errors.forEach(e=>{e.el=t}),i&&!r.isFinished(n)&&(n.errors.push({msg:`<${t.tagName}> is incomplete.\nSchema: ${r.toString()}`,el:t}),i=!1),i&&(n.ok=!0),n}Rg.fromJSON=function(e){return new Rg(e.name,e.type,e.attributes,vg.fromJSON(e.elements))};class Bg extends(Up(Gf)){getPath(){return[this.id,"content"]}getText(){return this.content}getChildren(){const e=this.getAnnotations();return e.sort(Fg),e}setText(e){const t=this.getDocument(),r=this.getPath(),n=this.getText();return n.length>0&&t.update(r,{type:"delete",start:0,end:n.length}),t.update(r,{type:"insert",start:0,text:e}),this}getTextContent(){return this.getText()}setTextContent(e){return this.setText(e)}get textContent(){return this.getText()}set textContent(e){this.setText(e)}appendChild(e){throw new Error("This is not implemented yet.")}removeChild(e){throw new Error("This is not implemented yet.")}isElementNode(){return!0}text(){return lo.prototype.text.apply(this,arguments)}get _isXMLTextElement(){return!0}get _elementType(){return"text"}static isText(){return!0}static isBlock(){return!0}}function Fg(e,t){return e.start.offset-t.start.offset}Bg.schema={type:"text",content:"text"};class jg extends ag{import(e,t,r){t.content=r.annotatedText(e,[t.id,"content"],{preserveWhitespace:!0})}export(e,t,r){t.tagName=this.tagNameNS,t.attr(e.attributes),t.append(r.annotatedText([e.id,"content"]))}}const{TEXT:Hg}=rg;function Ug(e){r(e,e=>{Object.assign(e,{children:{},parents:{},siblings:{},usedInlineBy:{},usedStructuredBy:{}})}),r(e,t=>{!function(e,t){const r=e.expr,n=e.name;if(!r)return;let s=[];r instanceof Sg?r.dfa&&(s=r.dfa._tokensByPath()):r instanceof Eg&&r.dfas.forEach(e=>{e&&(s=s.concat(e._tokensByPath()))});0===s.length&&"implicit"===e.type&&(e.type="element");let i=!1,o=!1;s.forEach(r=>{let s=r.indexOf(Hg)>=0,a=!s&&r.length>0;s&&(i=!0),a&&(o=!0),r.forEach(i=>{const o=t[i];o&&(o.parents[n]=!0,e.children[i]=!0,e.siblings[n]=r,a&&(o.usedStructuredBy[n]=!0),s&&(o.usedInlineBy[n]=!0))})}),o&&(e.isStructured=!0);i&&(e.isText=!0);"implicit"===e.type&&(e.type=i?"text":"element")}(t,e)})}function zg(e){const t=[];return Xg(e)&&t.push(`[1]: text element <${e.name}> is used inline by ${Wg(e).join(",")}`),e.isText||t.push(`[4]: text element <${e.name}> does not allow text content`),e.isStructured&&t.push(`[5]: text element <${e.name}> must not allow structured content`),t}function Vg(e){const t=[];return Xg(e)&&t.push(`[2]: element <${e.name}> is used inline by ${Wg(e).join(",")}`),e.isText&&t.push(`[6]: element <${e.name}> must not allow text content`),t}function Gg(e){const t=[];return Yg(e)&&t.push(`[2.2]: hybrid element <${e.name}> is used inline by ${Wg(e).join(",")}`),e.isText&&e.isStructured||t.push(`[7]: hybrid element <${e.name}> must allow text and structured content`),t}function Jg(e){const t=[];return Yg(e)||t.push(`[3]: annotation <${e.name}> is used in structured content by ${Zg(e).join(",")}`),e.isText||t.push(`[8]: annotation <${e.name}> does not allow text content`),t}function Kg(e){const t=[];return Yg(e)||t.push(`[3]: inline-element <${e.name}> is used in structured content by ${Zg(e).join(",")}`),t}function $g(e){const t=[];return Yg(e)||t.push(`[3]: anchor <${e.name}> is used in structured content by ${Zg(e).join(",")}`),t}function Xg(e){let t=e.usedInlineBy||{};return Object.keys(t).length>0}function Wg(e){let t=e.usedInlineBy||{};return Object.keys(t)}function Yg(e){return 0===Zg(e).length}function Zg(e){let t=e.usedInlineBy||{};return Object.keys(e.parents).filter(e=>!t[e])}function Qg(e,t,r){for(let n=0;n<t.length;n++){let s=t[n]+"/"+r;if(e.existsSync(s))return s}}function em(e,t,r){let n=r.findAll("include");return 0!==n.length&&(n.forEach(r=>{const n=r.parentNode,s=r.attr("href"),i=Qg(e,t,s);if(!i)throw new Error(`Could not find ${s}`);const o=e.readFileSync(i,"utf8"),a=nh.parseXML(o,"full-doc").find("grammar");if(!a)throw new Error("No grammar element found");a.children.forEach(e=>{n.insertBefore(e,r)}),r.remove()}),!0)}function tm(e,t,r){_(t)||(t=[t]);let n=Qg(e,t,r),s=e.readFileSync(n,"utf8");const i=nh.parseXML(s,"full-doc");for(;em(e,t,i););return i}const rm=rg.TEXT;function nm(e,t,r,n={}){switch(t.tagName){case"element":return[e.createElement("element").attr("name",t.attr("name"))];case"ref":return function(e,t,r,n={}){const s=t.attr("name");if(n[s])throw new Error("Cyclic references are not supported.");n[s]=!0;const i=r[s];if(!i)throw new Error(`Unknown definition ${s}`);let o=[];return i.children.forEach(t=>{let s=nm(e,t,r,n);o=o.concat(s)}),delete n[s],o}(e,t,r,n);case"empty":case"notAllowed":return[];default:{let s=t.clone(!1);return t.children.forEach(t=>{s.append(nm(e,t,r,n))}),[s]}}}function sm(e,t){if(!e)return new Ig([]);let r=im(e.children,t);return 1===r.length?r[0]:new Ig(r)}function im(e,t){const r=[];for(var n=0;n<e.length;n++){const s=e[n];switch(s.tagName){case"attribute":case"empty":case"notAllowed":break;case"element":{const e=s.attr("name");r.push(new Ng(e));break}case"text":r.push(new Ng(rm));break;case"ref":{const e=lm(s,t);r.push(e);break}case"group":r.push(om(s,t));break;case"choice":{const e=am(s,t);r.push(e);break}case"optional":{const e=new Dg(sm(s,t));r.push(e);break}case"oneOrMore":{const e=new Pg(sm(s,t));r.push(e);break}case"zeroOrMore":{const e=new Og(sm(s,t));r.push(e);break}case"interleave":{const e=new Ag(im(s.children,t));r.push(e);break}default:throw new Error("Not supported yet: "+s.tagName)}}return r}function om(e,t){if(e.expr)return e.expr.copy();const r=im(e.children,t);return e.expr=new Ig(r),e.expr}function am(e,t){if(e.expr)return e.expr.copy();let r=im(e.children,t);return e.expr=new Tg(r),e.expr}function lm(e,t){const r=e.attr("name"),n=t.defs[r];if(!n)throw new Error(`Illegal ref: ${r} is not defined.`);if(n.expr)return n.expr.copy();if(t._visiting[r])throw new Error("Cyclic references are not supported yet");t._visiting[r]=!0;const s=sm(n,t);return n.expr=s,delete t._visiting[r],n.expr}function cm(e){return{name:e.attr("name")}}const hm=["id","type","attributes","_childNodes","_content"];const dm=Object.freeze({disabled:!0});var um={name:"button",configure:function(e){e.addComponent("button",Zp),e.addIcon("dropdown",{fontawesome:"fa-angle-down"})},Button:Zp},pm={name:"context-menu",configure:function(e){e.addComponent("context-menu",Eu)}};class fm extends Oh{render(e){let t=this._getDocumentValue(),r=e("input").attr({value:t,type:this.props.type,placeholder:this.props.placeholder}).addClass("sc-input").val(t).on("keydown",this._onKeydown);return this.props.path&&r.on("change",this._onChange),this.props.centered&&r.addClass("sm-centered"),r}_onChange(){let e=this.context.editorSession,t=this.props.path,r=this.el.val(),n=this._getDocumentValue();r!==n&&(e.transaction(function(e){e.set(t,r)}),this.props.retainFocus&&this.el.getNativeElement().focus())}_getDocumentValue(){if(this.props.val)return this.props.val;{let e=this.context.editorSession,t=this.props.path;return e.getDocument().get(t)}}_onKeydown(e){e.keyCode===$h.ESCAPE&&(e.stopPropagation(),e.preventDefault(),this.el.val(this._getDocumentValue()))}}var gm={name:"input",configure:function(e){e.addComponent("input",fm)},Input:fm};class mm extends Oh{render(e){let t=e("div").addClass("sc-modal");return t.on("click",this._closeModal),this.props.width&&t.addClass("sm-width-"+this.props.width),t.append(e("div").addClass("se-body").append(this.props.children)),t}_closeModal(e){e.target.classList.contains("sc-modal")&&this.send("closeModal")}}var _m={name:"modal",configure:function(e){e.addComponent("modal",mm)},Modal:mm},ym={name:"overlay",configure:function(e){e.addComponent("overlay",Hu)}},wm={name:"dropzones",configure:function(e){e.addComponent("dropzones",Iu)},Dropzones:Iu},bm={name:"scrollbar",configure:function(e){e.addComponent("scrollbar",Uu)},Scrollbar:Uu},vm={name:"scroll-pane",configure:function(e){e.addComponent("scroll-pane",Gu)},ScrollPane:Gu};class Cm extends Vu{getChildContext(){return{scrollPane:this}}getName(){return"body"}render(e){let t=e("div");return"custom"===this.props.contextMenu&&t.on("contextmenu",this._onContextMenu),t.append(this.props.children),t}getHeight(){return w.inBrowser?window.innerHeight:0}getContentHeight(){return w.inBrowser?document.body.scrollHeight:0}getContentElement(){return w.inBrowser?nh.wrapNativeElement(window.document.body):null}getScrollableElement(){return w.inBrowser?document.body:null}getScrollPosition(){return w.inBrowser?document.body.scrollTop:0}setScrollPosition(e){w.inBrowser&&(document.body.scrollTop=e)}getPanelOffsetForElement(e){console.warn("TODO: implement")}scrollTo(e,t){console.warn("TODO: implement")}}var Sm={name:"body-scroll-pane",configure:function(e){e.addComponent("body-scroll-pane",Cm)},BodyScrollPane:Cm},xm={name:"split-pane",configure:function(e){e.addComponent("split-pane",gf)},SplitPane:gf};class Em extends Oh{render(e){let t=e("div").addClass("sc-tabbed-pane"),n=e("div").addClass("se-tabs");return r(this.props.tabs,function(t){let r=e("a").addClass("se-tab").attr({href:"#","data-id":t.id}).on("click",this.onTabClicked);t.id===this.props.activeTab&&r.addClass("sm-active"),r.append(e("span").addClass("label").append(t.name)),n.append(r)}.bind(this)),t.append(n),t.append(e("div").addClass("se-tab-content").ref("tabContent").append(this.props.children)),t}onTabClicked(e){e.preventDefault();let t=e.currentTarget.dataset.id;this.send("switchTab",t)}}var Nm={name:"tabbed-pane",configure:function(e){e.addComponent("tabbed-pane",Em)},TabbedPane:Em},Tm={name:"file",configure:function(e){e.addNode(Fp)}},Im={name:"tool-panel",configure(e){e.addComponent("tool-panel",xu),e.addComponent("tool-dropdown",Ku),e.addComponent("tool-group",Fu),e.addComponent("menu-group",ju),e.addComponent("tool-prompt",$u),e.addComponent("tool-separator",Xu)}},Am={name:"base",configure:function(e){e.import(Tm),e.import(vm),e.import(Sm),e.import(xm),e.import(Nm),e.import(bm),e.import(_m),e.import(gm),e.import(um),e.import(pm),e.import(ym),e.import(wm),e.import(Im),e.addCommand("undo",mf,{commandGroup:"undo-redo"}),e.addCommand("redo",_f,{commandGroup:"undo-redo"}),e.addCommand("select-all",yf,{commandGroup:"selection"}),e.addIcon("insert",{fontawesome:"fa-plus"}),e.addIcon("undo",{fontawesome:"fa-undo"}),e.addIcon("redo",{fontawesome:"fa-repeat"}),e.addIcon("edit",{fontawesome:"fa-cog"}),e.addIcon("delete",{fontawesome:"fa-times"}),e.addIcon("expand",{fontawesome:"fa-arrows-h"}),e.addIcon("truncate",{fontawesome:"fa-arrows-h"}),e.addLabel("undo",{en:"Undo",de:"Rückgängig"}),e.addLabel("redo",{en:"Redo",de:"Wiederherstellen"}),e.addLabel("select-all",{en:"Select All",de:"Alles Auswählen"}),e.addLabel("text-types",{en:"Text Type",de:"Texttyp"}),e.addLabel("container-selection",{en:"Container",de:"Container"}),e.addLabel("@container",{en:"Container",de:"Container"}),e.addLabel("insert",{en:"Insert",de:"Einfügen"}),e.addLabel("insert-container",{en:"Insert Container",de:"Container einfügen"}),e.addComponent("isolated-node",Zh),e.addComponent("inline-node",cf),e.addComponent("annotation",Wp),e.addKeyboardShortcut("CommandOrControl+Z",{command:"undo"}),e.addKeyboardShortcut("CommandOrControl+Shift+Z",{command:"redo"}),e.addKeyboardShortcut("CommandOrControl+A",{command:"select-all"})},UndoCommand:mf,RedoCommand:_f,SelectAllCommand:yf};class Dm extends Vp{}Dm.type="blockquote";class Om extends pf{render(e){return super.render.call(this,e).addClass("sc-blockquote")}}var Pm={type:"blockquote",tagName:"blockquote",import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.append(r.annotatedText([e.id,"content"]))}},km={name:"blockquote",configure:function(e){e.addNode(Dm),e.addComponent(Dm.type,Om),e.addConverter("html",Pm),e.addConverter("xml",Pm),e.addCommand("blockquote",uf,{spec:{type:"blockquote"},commandGroup:"text-types"}),e.addIcon("blockquote",{fontawesome:"fa-quote-right"}),e.addLabel("blockquote",{en:"Blockquote",de:"Blockzitat"}),e.addKeyboardShortcut("CommandOrControl+Alt+B",{command:"blockquote"})},Blockquote:Dm,BlockquoteComponent:Om,BlockquoteHTMLConverter:Pm};class Mm extends Ud{}Mm.type="code";var Lm={type:"code",tagName:"code"},Rm={name:"code",configure:function(e){e.addNode(Mm),e.addConverter("html",Lm),e.addConverter("xml",Lm),e.addComponent("code",Wp),e.addCommand("code",Xp,{nodeType:Mm.type,commandGroup:"annotations"}),e.addIcon("code",{fontawesome:"fa-code"}),e.addLabel("code",{en:"Code",de:"Code"})},Code:Mm,CodeHTMLConverter:Lm};class qm extends Vp{}qm.type="codeblock";class Bm extends pf{render(e){return super.render.call(this,e).addClass("sc-codeblock")}}var Fm={type:"codeblock",tagName:"pre",import:function(e,t,r){let n=e.find("code");n&&(t.content=r.annotatedText(n,[t.id,"content"],{preserveWhitespace:!0}))},export:function(e,t,r){let n=r.$$;t.append(n("code").append(r.annotatedText([e.id,"content"])))}},jm={name:"codeblock",configure:function(e){e.addNode(qm),e.addComponent("codeblock",Bm),e.addConverter("html",Fm),e.addConverter("xml",Fm),e.addCommand("codeblock",uf,{spec:{type:"codeblock"},commandGroup:"text-types"}),e.addIcon("codeblock",{fontawesome:"fa-quote-right"}),e.addLabel("codeblock",{en:"Codeblock",de:"Codeblock"}),e.addKeyboardShortcut("CommandOrControl+Alt+C",{command:"codeblock"})},Codeblock:qm,CodeblockComponent:Bm,CodeblockHTMLConverter:Fm};class Hm extends Ud{}Hm.type="emphasis",Hm.fragmentation=Hh.ANY;var Um={type:"emphasis",tagName:"em",matchElement:function(e){return e.is("em, i")}};class zm extends Wp{getTagName(){return"em"}}var Vm={name:"emphasis",configure:function(e){e.addNode(Hm),e.addConverter("html",Um),e.addConverter("xml",Um),e.addComponent("emphasis",zm),e.addCommand("emphasis",Xp,{nodeType:Hm.type,commandGroup:"annotations"}),e.addIcon("emphasis",{fontawesome:"fa-italic"}),e.addLabel("emphasis",{en:"Emphasis",de:"Betonung"}),e.addKeyboardShortcut("CommandOrControl+I",{command:"emphasis"})},Emphasis:Hm,EmphasisComponent:zm,EmphasisHTMLConverter:Um};class Gm extends $p{getCommandState({editorSession:e}){let t=e.getManager("find-and-replace");if(t){return t.getCommandState()}return{disabled:!0}}execute(){}}class Jm extends $p{getCommandState({editorSession:e}){return e.getManager("find-and-replace")?{disabled:!1}:{disabled:!0}}execute({editorSession:e}){let t=e.getManager("find-and-replace");e.getFocusedSurface()&&t.enable()}}class Km extends $p{getCommandState({editorSession:e}){let t=e.getManager("find-and-replace");if(t){return{disabled:t.getCommandState().disabled}}return{disabled:!0}}execute({editorSession:e}){let t=e.getManager("find-and-replace");t.getCommandState().disabled||t.disable()}}class $m extends Jm{execute({editorSession:e}){e.getManager("find-and-replace").findNext()}}class Xm extends Gm{execute({editorSession:e}){e.getManager("find-and-replace").findPrevious()}}class Wm extends Gm{execute({editorSession:e}){e.getManager("find-and-replace").replaceNext()}}class Ym extends Gm{execute({editorSession:e}){e.getManager("find-and-replace").replaceAll()}}class Zm extends Bu{didMount(){this.context.editorSession.onPosition(this._onPosition,this)}dispose(){this.context.editorSession.off(this)}_onPosition(){let e=this.context.editorSession.getManager("find-and-replace");e._requestLookupMatch&&(this._scrollToSelectedMatch(),e._requestLookupMatch=!1),e._requestFocusSearchString&&setTimeout(()=>{this.refs.findString.el.focus(),this.refs.findString.el.select(),e._requestFocusSearchString=!1},0)}render(e){let t=this.props.commandState,r=e("div").addClass("sc-find-and-replace-tool");return r.append(this._renderStatusDescription(e),e("div").addClass("se-section").append(e("div").addClass("se-section-item se-find-input").addClass("sm-flex").append(e("input").ref("findString").attr("type","text").attr("placeholder","Find in body").attr("tabindex",500).val(t.findString).on("input",Xe(this._startFind,300)).on("keypress",this._triggerFindNext).on("focus",this._onFocus).on("blur",this._onBlur),this._renderStatusCounter(e)),e("div").addClass("se-section-item se-replace-input").append(e("button").append("Find").attr("tabindex",502).on("click",this._findNext)),e("div").addClass("se-section-item")),e("div").addClass("se-section").append(e("div").addClass("se-section-item").addClass("sm-flex").append(e("input").ref("replaceString").val(t.replaceString).attr("type","text").attr("tabindex",501).attr("placeholder","Replace in body").on("focus",this._onFocus).on("blur",this._onBlur).on("input",this._setReplaceString).on("keypress",this._triggerReplace)),e("div").addClass("se-section-item").append(e("button").append("Replace").attr("tabindex",503).on("click",this._replaceNext)),e("div").addClass("se-section-item").append(e("button").append("Replace All").attr("tabindex",504).on("click",this._replaceAll)))),r}_renderStatusDescription(e){let t=this.props.commandState,r=e("div").addClass("se-status").append(e("div").addClass("se-status-title").append(this.getLabel("find-and-replace-title")));return t.totalMatches>0?r.append(e("div").addClass("se-status-description").append(t.totalMatches," results found for ",'"'+t.findString+'"')):""!==t.findString?r.append(e("div").addClass("se-status-description").append("No results found for ",'"'+t.findString+'"')):r.append(e("div").addClass("se-status-description").append("Close this panel with ESC key")),r}_onFocus(){let e=this.context.editorSession;e.setBlurred(!0),e.startFlow()}_onBlur(){this.context.editorSession.setBlurred(!1)}_renderStatusCounter(e){let t,r=this.props.commandState;return r.totalMatches>0&&(t=e("span").addClass("se-status-counter").append([r.selectedMatch,r.totalMatches].join(" of "))),t}_findNext(){this.context.editorSession.getManager("find-and-replace").findNext()}_replaceNext(){this.context.editorSession.getManager("find-and-replace").replaceNext()}_replaceAll(){this.context.editorSession.getManager("find-and-replace").replaceAll()}findStringHasChanged(){let e=this.refs.findString.val(),t=this._previousFindString;return this._previousFindString=e,e!==t}_startFind(){let e=this.context.editorSession,t=this.refs.findString.val();e.getManager("find-and-replace").startFind(t)}_scrollToSelectedMatch(){this.context.editorSession.getFocusedSurface().context.scrollPane.scrollTo(".sc-selected-match","onlyIfNotVisible")}_triggerFindNext(e){13===e.keyCode&&this._findNext()}_triggerReplace(e){13===e.keyCode&&this._replaceNext()}_setReplaceString(){let e=this.refs.replaceString.val();this.context.editorSession.getManager("find-and-replace").setReplaceString(e)}}class Qm{constructor(e){if(!e.editorSession)throw new Error("EditorSession required.");this.editorSession=e.editorSession,this.editorSession.onRender("document",this._onDocumentChanged,this),this.doc=this.editorSession.getDocument(),this.context=Object.assign({},e,{doc:this.doc}),this._state={disabled:!0,findString:"",replaceString:"",matches:[],selectedMatch:void 0},this._requestLookupMatch=!1,this._requestFocusSearchString=!1}dispose(){this.editorSession.off(this)}_resetState(){this._state.disabled=!0,this._state.matches=[],this._state.selectedMatch=void 0}getCommandState(){let e=this._state;return{disabled:e.disabled,findString:e.findString,replaceString:e.replaceString,totalMatches:e.matches.length,selectedMatch:e.selectedMatch+1}}enable(){this._state.disabled=!1,this._requestFocusSearchString=!0,this.startFind(this._state.findString)}disable(){this._state.disabled=!0,this._resetState(),this._propagateUpdate()}_onDocumentChanged(){this._state.disabled||(this._computeMatches(),this._state.selectedMatch=0,this._updateMarkers())}startFind(e){this._state.findString=e,this._computeMatches();let t=this._getClosestMatch();this._state.selectedMatch=t>0?t:0,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate()}setReplaceString(e){this._state.replaceString=e}findNext(){let e=this._state.selectedMatch,t=this._state.matches.length;0!==t&&(this._state.selectedMatch=(e+1)%t,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}findPrevious(){let e=this._state.selectedMatch,t=this._state.matches.length;0!==t&&(this._state.selectedMatch=e>0?e-1:t-1,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}_setSelection(){let e=this._state.matches[this._state.selectedMatch];if(!e)return;let t=e.getSelection();this.editorSession.setSelection(t,"skipFlow")}replaceNext(){let e=this._state.selectedMatch,t=this._state.matches[e],r=this._state.matches.length;void 0!==t&&(this.editorSession.transaction((e,r)=>(e.setSelection(t.getSelection()),e.insertText(this._state.replaceString),r)),this._computeMatches(),e+1<r&&(this._state.selectedMatch=e),this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}replaceAll(){let e=this._state.matches.reverse();this.editorSession.transaction((t,r)=>(e.forEach(e=>{t.setSelection(e.getSelection()),t.insertText(this._state.replaceString)}),r)),this._computeMatches()}_getClosestMatch(){let e=this.editorSession.getDocument(),t=Object.keys(e.getNodes()),r=this.editorSession.getSelection(),n=0;if(!r.isNull()){let e=r.start.offset,s=r.start.path[0],i=t.indexOf(s);n=this._state.matches.findIndex(r=>{let n=r.getSelection(),s=n.start.offset,o=n.start.path[0],a=t.indexOf(o);return!(i>a)&&(i<a||e<=s)})}return n}_computeMatches(){let e=this._state.matches,t=void 0===e?0:e.length;this._state.matches=this._findAllMatches();let r=this._state.matches;r.length!==t&&(this._state.selectedMatch=r.length>0?0:void 0)}_findAllMatches(){let e=this._getAllAffectedTextPropertiesInOrder();const t=this._state.findString;let r=[];return t&&e.forEach(e=>{let n=this._findInTextProperty({path:e,findString:t});r=r.concat(n)}),r}_getAllAffectedTextPropertiesInOrder(){let e=[];const t=this.editorSession.getEditor();return e=(t.find(this.getRootElementSelector())||t).findAll(".sc-text-property").map(e=>e.props.path)}_findInTextProperty({path:e,findString:t}){const r=this.doc,n=r.get(e);let s,i=new RegExp(t,"ig"),o=[];for(;s=i.exec(n);){let t=new yu(r,{type:"match",start:{path:e,offset:s.index},end:{offset:i.lastIndex}});o.push(t)}return o}_propagateUpdate(){this._updateMarkers(),this.editorSession._setDirty("commandStates"),this.editorSession.startFlow()}_updateMarkers(){const e=this._state,t=this.editorSession.markersManager;e.matches.forEach((t,r)=>{t.type=r===e.selectedMatch?"selected-match":"match"}),t.setMarkers("find-and-replace",e.matches)}getRootElementSelector(){return this.editorSession.getConfigurator().getFindAndReplaceConfig().rootElement}}var e_={name:"find-and-replace",configure:function(e,t){e.addCommand("find-and-replace",Gm,{commandGroup:"workflows"}),e.addCommand("toggle-find-and-replace",Jm,{commandGroup:"find-and-replace"}),e.addCommand("close-find-and-replace",Km,{commandGroup:"find-and-replace"}),e.addCommand("find-next",$m,{commandGroup:"find-and-replace"}),e.addCommand("find-previous",Xm,{commandGroup:"find-and-replace"}),e.addCommand("replace-next",Wm,{commandGroup:"find-and-replace"}),e.addCommand("replace-all",Ym,{commandGroup:"find-and-replace"}),e.addTool("find-and-replace",Zm),e.addKeyboardShortcut("CommandOrControl+F",{command:"toggle-find-and-replace"}),e.addKeyboardShortcut("CommandOrControl+Alt+F",{command:"toggle-find-and-replace"}),e.addKeyboardShortcut("CommandOrControl+G",{command:"find-next"}),e.addKeyboardShortcut("CommandOrControl+Shift+G",{command:"find-previous"}),e.addKeyboardShortcut("CommandOrControl+Alt+E",{command:"replace-next"}),e.addKeyboardShortcut("esc",{command:"close-find-and-replace"}),e.addManager("find-and-replace",Qm),e.addLabel("find-and-replace-title",{en:"Find and replace",de:"Suchen und Ersetzen"}),e.setFindAndReplaceConfig(t)},FindAndReplaceCommand:Gm,ToggleFindAndReplaceCommand:Jm,FindNextCommand:$m,FindPreviousCommand:Xm,ReplaceNextCommand:Wm,ReplaceAllCommand:Ym,FindAndReplaceTool:Zm,FindAndReplaceManager:Qm};class t_ extends Vp{isHeading(){return!0}getLevel(){return this.level}}t_.schema={type:"heading",level:{type:"number",default:1}};class r_ extends pf{render(e){return super.render(e).addClass("sc-heading sm-level-"+this.props.node.level)}getTagName(){return"h"+this.props.node.level}}var n_={type:"heading",matchElement:function(e){return/^h\d$/.exec(e.tagName)},import:function(e,t,r){t.level=Number(e.tagName[1]);let n=e.attr("data-text-align");t.textAlign=n||"left",t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.tagName="h"+e.level,"left"!==e.textAlign&&t.attr("data-text-align",e.textAlign),t.append(r.annotatedText([e.id,"content"]))}},s_={name:"heading",configure:function(e){e.addNode(t_),e.addComponent(t_.type,r_),e.addConverter("html",n_),e.addConverter("xml",n_),e.addCommand("heading1",uf,{spec:{type:"heading",level:1},commandGroup:"text-types"}),e.addCommand("heading2",uf,{spec:{type:"heading",level:2},commandGroup:"text-types"}),e.addCommand("heading3",uf,{spec:{type:"heading",level:3},commandGroup:"text-types"}),e.addKeyboardShortcut("CommandOrControl+Alt+1",{command:"heading1"}),e.addKeyboardShortcut("CommandOrControl+Alt+2",{command:"heading2"}),e.addKeyboardShortcut("CommandOrControl+Alt+3",{command:"heading3"}),e.addLabel("heading1",{en:"Heading 1",de:"Überschrift 1"}),e.addLabel("heading2",{en:"Heading 2",de:"Überschrift 2"}),e.addLabel("heading3",{en:"Heading 3",de:"Überschrift 3"}),e.addIcon("heading1",{fontawesome:"fa-header"}),e.addIcon("heading2",{fontawesome:"fa-header"}),e.addIcon("heading3",{fontawesome:"fa-header"})},Heading:t_,HeadingComponent:r_,HeadingHTMLConverter:n_,HeadingMacro:{appliesTo:["paragraph"],execute:function(e){if(-1===this.appliesTo.indexOf(e.node.type))return!1;if("type"!==e.action)return!1;let t=/^#\s/.exec(e.text);if(t){let r=e.editorSession,n=r.getSelection(),s=n.start.path,i=n.start.offset;return r.transaction(function(e){e.setSelection({type:"property",path:s,startOffset:0,endOffset:t[0].length}),e.deleteSelection();let r=e.switchTextType({type:"heading",level:1});e.setSelection({type:"property",path:r.getPath(),startOffset:i-t[0].length})}),!0}}}};class i_ extends wd{getImageFile(){if(this.imageFile)return this.document.get(this.imageFile)}getUrl(){let e=this.getImageFile();if(e)return e.getUrl()}}i_.schema={type:"image",imageFile:{type:"file"}};class o_ extends Yp{didMount(){super.didMount.call(this),this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){super.dispose.call(this),this.context.editorSession.off(this)}_onDocumentChange(e){(e.hasUpdated(this.props.node.id)||e.hasUpdated(this.props.node.imageFile))&&this.rerender()}render(e){let t=super.render(e);return t.addClass("sc-image"),t.append(e("img").attr({src:this.props.node.getUrl()}).ref("image")),t}getDropzoneSpecs(){return[{component:this.refs.image,message:"Replace Image",dropParams:{action:"replace-image",nodeId:this.props.node.id}}]}handleDrop(e,t){let r=t.data.files[0];if(t.external){let t=e.create({type:"file",fileType:"image",mimeType:r.type,url:URL.createObjectURL(r)});e.set([this.props.node.id,"imageFile"],t.id)}else{let r=t.sourceSelection.nodeId,n=e.get(r);"image"===n.type&&e.set([this.props.node.id,"imageFile"],n.imageFile)}}}var a_={type:"image",tagName:"img",import:function(e,t,r){let n=r.getDocument().create({id:"file-"+t.id,type:"file",fileType:"image",url:e.attr("src")});t.imageFile=n.id},export:function(e,t){let r=e.document.get(e.imageFile);t.attr("src",r.getUrl())}};function l_(e,t){let r=e.create({type:"file",fileType:"image",mimeType:t.type,sourceFile:t});e.insertBlockNode({type:"image",imageFile:r.id})}class c_ extends lf{execute(e){e.editorSession.transaction(t=>{e.files.forEach(e=>{l_(t,e)})})}}class h_ extends Bu{getClassNames(){return"sc-insert-image-tool"}renderButton(e){return[super.renderButton(e),e("input").attr("type","file").ref("input").on("change",this.onFileSelect)]}onClick(){this.refs.input.click()}onFileSelect(e){let t=e.currentTarget.files;this.executeCommand({files:Array.prototype.slice.call(t)})}}var d_={type:"drop-asset",match(e){let t=0===e.file.type.indexOf("image/");return"file"===e.type&&t},drop(e,t){l_(e,t.file)}};class u_ extends Pp{}u_.match=function(e){return"image"===e.fileType};var p_={name:"image",configure:function(e){e.addNode(i_),e.addComponent("image",o_),e.addConverter("html",a_),e.addConverter("xml",a_),e.addCommand("insert-image",c_,{nodeType:"image",commandGroup:"insert"}),e.addTool("insert-image",h_),e.addIcon("insert-image",{fontawesome:"fa-image"}),e.addLabel("image",{en:"Image",de:"Bild"}),e.addLabel("insert-image",{en:"Insert image",de:"Bild einfügen"}),e.addDropHandler(d_),e.addFileProxy(u_)},ImageNode:i_,ImageComponent:o_,ImageHTMLConverter:a_,InsertImageCommand:c_,InsertImageTool:h_,DropImage:d_};class f_ extends Ud{static get fragmentation(){return Hh.SHOULD_NOT_SPLIT}static get autoExpandRight(){return!1}}f_.schema={type:"link",title:{type:"string",optional:!0},url:{type:"string",default:""}};class g_ extends Wp{didMount(...e){super.didMount(...e);let t=this.props.node;this.context.editorSession.onRender("document",this.rerender,this,{path:[t.id,"url"]})}dispose(...e){super.dispose(...e),this.context.editorSession.off(this)}render(e){let t=super.render(e);t.tagName="a",t.attr("href",this.props.node.url);let r=[this.props.node.url];return this.props.node.title&&r.push(this.props.node.title),t.attr("title",r.join(" | "))}}class m_ extends Xp{canFuse(){return!1}executeCreate(e){let t=super.executeCreate(e);return this._getEditorSession(e).transaction(e=>{e.setSelection(e.selection.collapse())}),t}}var __={type:"link",tagName:"a",import:function(e,t){t.url=e.attr("href"),t.title=e.attr("title")},export:function(e,t){t.attr({href:e.url,title:e.title})}};class y_ extends Bu{getUrlPath(){let e=this.constructor.urlPropertyPath;return[this.getNodeId()].concat(e)}getNodeId(){return this.props.commandState.nodeId}_openLink(){let e=this.context.editorSession.getDocument();window.open(e.get(this.getUrlPath()),"_blank")}render(e){let t=this.getComponent("input"),r=this.getComponent("button"),n=this.props.commandState,s=e("div").addClass("sc-edit-link-tool");if(n.disabled)return console.warn("Tried to render EditLinkTool while disabled."),s;let i=this.getUrlPath();return s.append(e(t,{type:"url",path:i,placeholder:"Paste or type a link url"}).ref("input"),e(r,{icon:"open-link",theme:this.props.theme}).attr("title",this.getLabel("open-link")).on("click",this._openLink),e(r,{icon:"delete",theme:this.props.theme}).attr("title",this.getLabel("delete-link")).on("click",this.onDelete)),s}onDelete(e){e.preventDefault();let t=this.getNodeId();this.context.surfaceManager.getFocusedSurface()?this.context.editorSession.transaction(function(e,r){return e.delete(t),r}):console.warn("No focused surface. Stopping command execution.")}}y_.urlPropertyPath=["url"];var w_={name:"link",configure:function(e){e.addNode(f_),e.addComponent("link",g_),e.addConverter("html",__),e.addConverter("xml",__),e.addCommand("link",m_,{nodeType:"link",commandGroup:"annotations"}),e.addCommand("edit-link",af,{nodeType:"link",commandGroup:"prompt"}),e.addTool("edit-link",y_),e.addIcon("link",{fontawesome:"fa-link"}),e.addIcon("open-link",{fontawesome:"fa-external-link"}),e.addLabel("link",{en:"Link",de:"Link"}),e.addLabel("open-link",{en:"Open Link",de:"Link öffnen"}),e.addLabel("delete-link",{en:"Remove Link",de:"Link löschen"}),e.addKeyboardShortcut("CommandOrControl+K",{command:"link"})},Link:f_,LinkComponent:g_,LinkCommand:m_,LinkHTMLConverter:__,EditLinkTool:y_};class b_ extends(Hp(wd)){createListItem(e){return this.getDocument().create({type:"list-item",content:e})}getItems(){const e=this.getDocument();return this.items.map(t=>e.get(t))}getItemsPath(){return[this.id,"items"]}insertItemAt(e,t){const r=this.getDocument(),n=t.id;r.update(this.getItemsPath(),{type:"insert",pos:e,value:n})}removeItemAt(e){this.getDocument().update(this.getItemsPath(),{type:"delete",pos:e})}getItemAt(e){return this.getDocument().get(this.items[e])}getItemPosition(e){const t=e.id;let r=this.items.indexOf(t);if(r<0)throw new Error("Item is not within this list: "+t);return r}getLength(){return this.items.length}getListTypeString(){return this.listType}setListTypeString(e){this.getDocument().set([this.id,"listType"],e)}}b_.type="list",b_.schema={items:{type:["array","id"],default:[],owned:!0},listType:{type:"string",default:"bullet"}};class v_ extends zp{getLevel(){return this.level}setLevel(e){this.level!==e&&this.getDocument().set([this.id,"level"],e)}static isListItem(){return!0}}v_.schema={type:"list-item",level:{type:"number",default:1}};class C_ extends Oh{render(e){const t=this.props.node,r=t.getPath();let n=e("li").addClass("sc-list-item");return n.append(e(Jh,{path:r,doc:t.getDocument()}).ref("text")),this.props.children&&n.append(this.props.children),n}}class S_ extends Yp{render(e){let t=this.props.node,r=Of(t,t=>E(t)?e(t):"list-item"===t.type?e(C_,{node:t}).ref(t.id):void 0);return r.addClass("sc-list").attr("data-id",t.id),r}get _isCustomNodeComponent(){return!0}}class x_{get type(){return"list"}matchElement(e){return e.is("ul")||e.is("ol")}import(e,t,r){this._santizeNestedLists(e);let n=[],s=[];Yu(e,(e,t)=>{e.isElementNode()&&(e.is("li")?n.push({el:e,level:t}):s[t]||(e.is("ul")?s[t]="bullet":e.is("ol")&&(s[t]="order")))}),this._createItems(r,t,n,s)}_createItems(e,t,r,n){t.items=r.map(t=>{let r=e.convertElement(t.el);return r.level=t.level,r.id}),t.listType=n.join(",")}export(e,t,r){let n=r.$$,s=Of(e,function(e){if(E(e))return n(e);{let t=e.getPath();return n("li").append(r.annotatedText(t))}});return t.tagName=s.tagName,t.attr(s.getAttributes()),t.append(s.getChildNodes()),t}_santizeNestedLists(e){e.findAll("ol,ul").forEach(e=>{for(;!e.parentNode.is("ol,ul");){let t=e.parentNode,r=t.parentNode,n=r.getChildIndex(t);r.insertAt(n+1,e)}})}}var E_={type:"list-item",matchElement:function(e){return e.is("li")},import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.append(r.annotatedText(e.getPath()))}};class N_ extends $p{getCommandState(e){let t=e.editorSession,r=t.getDocument(),n=t.getSelection();if(n&&n.isPropertySelection()){let e=n.path,t=r.get(e[0]);if(t){if(t.isListItem()){let e=t.getLevel(),r=t.getParent(),n=r.getListType(e)===this.config.spec.listType;return{disabled:!1,active:n,action:n?"toggleList":"setListType",listId:r.id,level:e}}if(t.isText()&&t.isBlock())return{disabled:!1,action:"switchTextType"}}}return{disabled:!0}}execute(e){let t=e.commandState;const{disabled:r,action:n}=t;if(r)return;let s=e.editorSession;switch(n){case"toggleList":s.transaction(e=>{e.toggleList()},{action:"toggleList"});break;case"setListType":{const{listId:e,level:r}=t;s.transaction(t=>{t.get(e).setListType(r,this.config.spec.listType)},{action:"setListType"});break}case"switchTextType":s.transaction(e=>{e.toggleList({listType:this.config.spec.listType})},{action:"toggleList"})}}}class T_ extends $p{getCommandState(e){let t=e.editorSession,r=t.getDocument(),n=t.getSelection();if(n&&n.isPropertySelection()){let e=n.path,t=r.get(e[0]);if(t&&t.isListItem())return{disabled:!1}}return{disabled:!0}}execute(e){let t=e.commandState;const{disabled:r}=t;if(r)return;let n=e.editorSession;switch(this.config.spec.action){case"indent":n.transaction(e=>{e.indent()},{action:"indent"});break;case"dedent":n.transaction(e=>{e.dedent()},{action:"dedent"})}}}var I_={name:"list",configure:function(e){e.addNode(b_),e.addNode(v_),e.addComponent("list",S_),e.addComponent("list-item",C_),e.addConverter("html",x_),e.addConverter("html",E_),e.addCommand("toggle-unordered-list",N_,{spec:{listType:"bullet"},commandGroup:"list"}),e.addLabel("toggle-unordered-list",{en:"Toggle list",de:"Liste entfernen"}),e.addIcon("toggle-unordered-list",{fontawesome:"fa-list-ul"}),e.addCommand("toggle-ordered-list",N_,{spec:{listType:"order"},commandGroup:"list"}),e.addLabel("toggle-ordered-list",{en:"Toggle list",de:"Aufzählung entfernen"}),e.addIcon("toggle-ordered-list",{fontawesome:"fa-list-ol"}),e.addCommand("indent-list",T_,{spec:{action:"indent"},commandGroup:"list"}),e.addLabel("indent-list",{en:"Increase indentation",de:"Einrückung vergrößern"}),e.addIcon("indent-list",{fontawesome:"fa-indent"}),e.addCommand("dedent-list",T_,{spec:{action:"dedent"},commandGroup:"list"}),e.addLabel("dedent-list",{en:"Decrease indentation",de:"Einrückung verringern"}),e.addIcon("dedent-list",{fontawesome:"fa-dedent"})},ListNode:b_,ListItemNode:v_,ListComponent:S_,ListHTMLConverter:x_,ListItemHTMLConverter:E_,ToggleListCommand:N_,IndentListCommand:T_};class A_ extends Oh{didMount(){this._recomputeOrder()}getInitialState(){return{options:this.props.options,selectedOptions:this.props.selectedOptions,collapsed:!0}}render(e){let t=this.state.options,r=this.props.maxItems,n=this.state.selectedOptions,s=this.state.collapsed,i=n.length>r?n.length:r,o=e("div").addClass("sc-multi-select"),a=t.map((t,r)=>{if(!s||r<=i-1){let r=e("div").addClass("se-select-option"),s=n.indexOf(t.id)>-1?"selected-option":"unselected-option";return r.append(this.renderIcon(e,s).addClass("se-option-icon"),e("span").addClass("se-option-label").append(t.label)).on("click",this._onToggleCheckbox.bind(this,t.id)),r}return""});o.append(a);let l=e("div").addClass("se-multi-collapse-label");if(t.length>i)if(s){let e=t.length-i;l.append(this.getLabel("expand-options")+" ("+e+")").on("click",this._onToggleExpand)}else l.append(this.getLabel("collapse-options")).on("click",this._onToggleExpand);return o.append(l),o}renderIcon(e,t){return this.context.iconProvider.renderIcon(e,t)}getSelectedOptions(){return this.state.selectedOptions}_recomputeOrder(){let e=this.state.options,t=this.state.selectedOptions,r=qs(e,e=>t.indexOf(e.id),"desc");this.extendState({options:r})}_onToggleCheckbox(e){let t=this.state.selectedOptions,r=t.indexOf(e);r>-1?t.splice(r,1):t.push(e),this.extendState({selectedOptions:t}),this.el.emit("change")}_onToggleExpand(){let e=this.state.collapsed;this._recomputeOrder(),this.extendState({collapsed:!e})}}var D_={name:"multi-select",configure:function(e){e.addComponent("multi-select",A_),e.addIcon("selected-option",{fontawesome:"fa-check-square-o"}),e.addIcon("unselected-option",{fontawesome:"fa-square-o"}),e.addLabel("expand-options",{en:"Show more",de:"Zeig mehr"}),e.addLabel("collapse-options",{en:"Show less",de:"Zeige weniger"})}};class O_ extends Vp{}O_.type="paragraph";class P_ extends pf{render(e){return super.render(e).addClass("sc-paragraph")}getTagName(){return"p"}}var k_={type:"paragraph",tagName:"p",import:function(e,t,r){let n=e.attr("data-text-align");t.textAlign=n||"left",t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){"left"!==e.textAlign&&t.attr("data-text-align",e.textAlign),t.append(r.annotatedText([e.id,"content"]))}},M_={name:"paragraph",configure:function(e){e.addNode(O_),e.addComponent(O_.type,P_),e.addConverter("html",k_),e.addConverter("xml",k_),e.addCommand("paragraph",uf,{spec:{type:"paragraph"},commandGroup:"text-types"}),e.addIcon("paragraph",{fontawesome:"fa-paragraph"}),e.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"}),e.addKeyboardShortcut("CommandOrControl+Alt+0",{command:"paragraph"})},Paragraph:O_,ParagraphComponent:P_,ParagraphHTMLConverter:k_};class L_ extends $p{constructor(){super({name:"save"})}getCommandState(e){return{disabled:!e.editorSession.hasUnsavedChanges(),active:!1}}execute(e){return e.editorSession.save(),{status:"saving-process-started"}}}var R_={name:"persistence",configure:function(e){e.addCommand("save",L_,{commandGroup:"persistence"}),e.addIcon("save",{fontawesome:"fa-save"}),e.addLabel("save",{en:"Save",de:"Speichern"}),e.addKeyboardShortcut("CommandOrControl+S",{command:"save"})},SaveCommand:L_};class q_ extends Ud{}q_.type="strong",q_.fragmentation=Hh.ANY;var B_={type:"strong",tagName:"strong",matchElement:function(e){return e.is("strong, b")}};class F_ extends Wp{getTagName(){return"strong"}}var j_={name:"strong",configure:function(e){e.addNode(q_),e.addConverter("html",B_),e.addConverter("xml",B_),e.addComponent("strong",F_),e.addCommand("strong",Xp,{nodeType:"strong",commandGroup:"annotations"}),e.addIcon("strong",{fontawesome:"fa-bold"}),e.addLabel("strong",{en:"Strong",de:"Fett"}),e.addKeyboardShortcut("CommandOrControl+B",{command:"strong"})},Strong:q_,StrongComponent:F_,StrongHTMLConverter:B_};class H_ extends Ud{}H_.type="subscript",H_.fragmentation=Hh.ANY;var U_={type:"subscript",tagName:"sub"},z_={name:"subscript",configure:function(e){e.addNode(H_),e.addConverter("html",U_),e.addConverter("xml",U_),e.addComponent("subscript",Wp),e.addCommand("subscript",Xp,{nodeType:"subscript",commandGroup:"annotations"}),e.addIcon("subscript",{fontawesome:"fa-subscript"}),e.addLabel("subscript",{en:"Subscript",de:"Tiefgestellt"})},Subscript:H_,SubscriptHTMLConverter:U_};class V_ extends Ud{}V_.type="superscript",V_.fragmentation=Hh.ANY;var G_={type:"superscript",tagName:"sup"},J_={name:"superscript",configure:function(e){e.addNode(V_),e.addConverter("html",G_),e.addConverter("xml",G_),e.addComponent("superscript",Wp),e.addCommand("superscript",Xp,{nodeType:"superscript",commandGroup:"annotations"}),e.addIcon("superscript",{fontawesome:"fa-superscript"}),e.addLabel("superscript",{en:"Superscript",de:"Hochgestellt"})},Superscript:V_,SuperscriptHTMLConverter:G_};const K_="“",$_="”";class X_ extends $p{getCommandState(e,t){return{disabled:!1}}execute(e,t){let r=e.editorSession,n=r.getSelection(),s=r.getDocument();if(n.isPropertySelection()){let e=n.start.getNodeId(),t=s.get(e);if(t.isText()){let e,s=t.getText(),i=n.start.offset;return e=0===i||/\s/.exec(s.slice(i-1,i))?K_:$_,r.transaction(t=>{t.insertText(e)}),!0}}return!1}}var W_={name:"quote-marks",configure:function(e){e.addCommand("insert-quote-marks",X_,{commandGroup:"text-macros"}),e.addKeyboardShortcut('"',{type:"textinput",command:"insert-quote-marks"})}};class Y_ extends rp{getRowCount(){return this.cells.length}getColCount(){return this.cells.length>0?this.cells[0].length:0}getCellAt(e,t){let r=this.cells[e][t];if(r)return this.document.get(r)}}Y_.schema={type:"table",cells:{type:["array","array","id"],default:[],owned:!0}};class Z_ extends zp{}Z_.schema={type:"table-cell",rowspan:{type:"number",default:0},colspan:{type:"number",default:0}};class Q_ extends Oh{render(e){let t=this.props.node,r=e("td").addClass("sc-table-cell");return r.append(e(ff,{path:t.getPath(),disabled:this.props.disabled}).ref("editor")),t.rowspan>0&&r.attr("rowspan",t.rowspan),t.colspan>0&&r.attr("colspan",t.colspan),r}grabFocus(){let e=this.props.node;this.context.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:e.getLength(),surfaceId:this.refs.editor.id})}}Q_.prototype._isTableCellComponent=!0;class ey extends Oh{render(e){let t=e("table").addClass("sc-table"),r=this.props.node,n=this.props.node.getDocument(),s=this.props.node.cells,i=r.getRowCount(),o=r.getColCount();for(let r=0;r<i;r++){let i=e("tr");for(let t=0;t<o;t++){let o=s[r][t];if(o){let t=n.get(o),r=e(Q_,{node:t,disabled:this.props.disabled}).ref(t.id);i.append(r)}}t.append(i)}return t.on("click",this.onClick),t.on("dblclick",this.onDblClick),t}onClick(e){e.stopPropagation()}onDblClick(e){e.stopPropagation();let t=Oh.unwrap(e.target);if(t){let e;t._isTableCellComponent?e=t:t._isTextPropertyEditor?e=t.getParent():t._isTextPropertyComponent?e=t.getParent().getParent():console.warn("TODO: find the right cell"),e&&e.grabFocus()}}grabFocus(){let e=this.props.node.cells[0][0];if(e){this.refs[e].grabFocus()}}}ey.hasDropzones=!0;var ty={type:"table",tagName:"table",import:function(e,t,r){let n=e.find("tbody").getChildren(),s=0,i=[],o=[];for(let e=0;e<n.length;e++){let t=n[e].getChildren(),a=[];s=Math.max(t.length,s);for(let e=0;e<t.length;e++){let n=t[e];o[e]>1&&(a.push(null),o[e]-=1);let s=r.convertElement(n);a.push(s.id),s.rowspan>1&&(o[e]=s.rowspan),s.colspan>1&&kf(s.colspan-1,()=>{a.push(null)})}i.push(a)}t.cells=i},export:function(e,t,r){let n=r.$$,s=e.getRowCount(),i=e.getColCount();for(let o=0;o<s;o++){let s=n("tr");for(let t=0;t<i;t++){let n=e.cells[o][t];if(n){let e=r.convertNode(n);s.append(e)}}t.append(s)}return t}},ry={type:"table-cell",tagName:"td",import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"]);let n=e.attr("colspan"),s=e.attr("rowspan");n&&(t.colspan=Number(n)),s&&(t.rowspan=Number(s))},export:function(e,t,r){return t.append(r.annotatedText([e.id,"content"])),e.rowspan>0&&t.attr("rowspan",e.rowspan),e.colspan>0&&t.attr("colspan",e.colspan),t}};class ny extends lf{createNodeData(e){let t=e.create({id:d("table-cell"),type:"table-cell",content:"A1"}),r=e.create({id:d("table-cell"),type:"table-cell",content:"B1"}),n=e.create({id:d("table-cell"),type:"table-cell",content:"A2"}),s=e.create({id:d("table-cell"),type:"table-cell",content:"B2"});return{id:d("table"),type:"table",cells:[[t.id,r.id],[n.id,s.id]]}}}var sy={name:"table",configure:function(e){e.addNode(Y_),e.addNode(Z_),e.addComponent("table",ey),e.addConverter("html",ty),e.addConverter("html",ry),e.addConverter("xml",ty),e.addConverter("xml",ry),e.addCommand("insert-table",ny,{nodeType:"table",commandGroup:"insert"}),e.addIcon("insert-table",{fontawesome:"fa-table"}),e.addLabel("insert-table",{en:"Table",de:"Tabelle"}),e.addLabel("table",{en:"Table",de:"Tabelle"}),e.addLabel("table-cell.content",{en:"Cell",de:"Zelle"})},Table:Y_,TableCell:Z_};class iy extends Bp{_initialize(){super._initialize(),this.create({type:"@container",id:"body",nodes:[]})}}class oy extends Np{convertDocument(e){let t=e.find("body");this.convertContainer(t.children,"body")}}var ay={name:"prose-editor",configure:function(e){e.defineSchema({name:"prose-article",DocumentClass:iy,defaultTextType:"paragraph",version:"1.0"}),e.addImporter("html",oy),e.import(Am),e.import(km),e.import(M_),e.import(s_),e.import(jm),e.import(Rm),e.import(Vm),e.import(e_,{targetSurfaces:["body"]}),e.import(j_),e.import(z_),e.import(J_),e.import(w_),e.import(W_),e.import(I_),e.import(sy),e.addToolPanel("main-overlay",[{name:"prompt",type:"tool-group",commandGroups:["prompt"]}]),e.addToolPanel("workflow",[{name:"workflow",type:"tool-group",commandGroups:["workflows"]}]),e.addToolPanel("toolbar",[{name:"text-types",type:"tool-dropdown",showDisabled:!0,style:"descriptive",commandGroups:["text-types"]},{name:"annotations",type:"tool-group",showDisabled:!0,style:"minimal",commandGroups:["annotations"]},{name:"insert",type:"tool-dropdown",showDisabled:!0,style:"descriptive",commandGroups:["insert"]}])},ProseEditor:class extends sd{render(e){let t=this.componentRegistry.get("split-pane"),r=e("div").addClass("sc-prose-editor"),n=this._renderToolbar(e),s=this._renderEditor(e),i=this.getConfigurator(),o=this.componentRegistry.get("scroll-pane"),a=this.componentRegistry.get("overlay"),l=this.componentRegistry.get("context-menu"),c=this.componentRegistry.get("dropzones"),h=e(o,{name:"contentPanel",contextMenu:this.props.contextMenu||"native",scrollbarPosition:"right",scrollbarType:this.props.scrollbarType}).append(s,e(a,{toolPanel:i.getToolPanel("main-overlay"),theme:"dark"}),e(l),e(c)).ref("contentPanel");return r.append(e(t,{splitType:"horizontal"}).append(n,e(t,{splitType:"horizontal",sizeB:"inherit"}).append(h,e(Wu,{toolPanel:i.getToolPanel("workflow")})))),r}_renderToolbar(e){let t=this.getConfigurator();return e("div").addClass("se-toolbar-wrapper").append(e(Ju,{toolPanel:t.getToolPanel("toolbar")}).ref("toolbar"))}_renderEditor(e){let t=this.getConfigurator();return e(sf,{disabled:this.props.disabled,editorSession:this.editorSession,node:this.doc.get("body"),commands:t.getSurfaceCommandNames()}).ref("body")}},ProseArticle:iy};class ly extends Bu{render(e){let t=this.props.node,r=this.getComponent("button"),n=e("div").addClass("sc-correction-tool");return t&&t.suggestions.length>0?t.suggestions.forEach(t=>{n.append(e(r,{label:t,style:this.props.style}).attr("title",this.getLabel("open-link")).attr("data-correction",t).on("click",this._applyCorrection.bind(this,t)))}):n.append(e(r,{label:"No suggestions",style:this.props.style,disabled:!0})),n}_applyCorrection(e){let t=this.context.editorSession,r=this.props.node;t.transaction(t=>{let n=t.getSelection();t.setSelection({type:"property",path:r.start.path,startOffset:r.start.offset,endOffset:r.end.offset,containerId:n.containerId}),t.insertText(e)})}}class cy extends $p{getCommandState(e){let t=e.selectionState.getMarkers();return 0===t.length?{disabled:!0}:(t=t.filter(function(e){return"spell-error"===e.type})).length>0?{disabled:!1,active:!1,mode:null,node:t[0]}:{disabled:!0}}}const hy="http://localhost:4777/api/check";var dy={name:"spell-check",configure:function(e){e.addCommand("correction",cy,{commandGroup:"spell-check"}),e.addTool("correction",ly)},SpellCheckManager:class{constructor(e,t){let r=(t=t||{}).wait||750;this.editorSession=e,this.apiURL=t.apiURL||hy,this.textPropertyManager=e.markersManager,this.markersManager=e.markersManager,this._schedule={},this._scheduleCheck=Xe(this._runSpellCheck.bind(this),r),e.onFinalize("document",this._onDocumentChange,this)}dispose(){this.editorSession.off(this)}check(e){this._runSpellCheck(String(e))}runGlobalCheck(){Object.keys(this.textPropertyManager._textProperties).forEach(e=>{this._runSpellCheck(e)})}_onDocumentChange(e,t){if(t.spellcheck)return;const r=this.textPropertyManager._textProperties;Object.keys(e.updated).forEach(e=>{r[e]&&this._scheduleCheck(e)})}_runSpellCheck(e){let t=e.split(","),r=this.editorSession.getDocument().get(t),n=this.editorSession.getLanguage();r&&E(r)&&Pf({method:"POST",url:this.apiURL,header:{"Content-Type":"application/json; charset=UTF-8"},data:{text:r,lang:n}}).then(e=>{e=JSON.parse(e),this._addSpellErrors(t,e)}).catch(function(e){console.error(e)})}_addSpellErrors(e,t){const r=this.editorSession,n=r.markersManager,s="spell-error:"+e.join("."),i=t.map(t=>({type:"spell-error",start:{path:e,offset:t.start},end:{offset:t.end},suggestions:t.suggestions}));n.setMarkers(s,i),r.startFlow()}}};const{UndoCommand:uy,RedoCommand:py,SelectAllCommand:fy}=Am;class gy extends sd{constructor(e,t={}){super(e,function(e){let t=new Su;t.addNode(zp),t.addCommand("undo",uy),t.addCommand("redo",py),t.addCommand("select-all",fy),t.addKeyboardShortcut("CommandOrControl+Z",{command:"undo"}),t.addKeyboardShortcut("CommandOrControl+Shift+Z",{command:"redo"}),t.addKeyboardShortcut("CommandOrControl+A",{command:"select-all"}),t.defineSchema({name:"text-input",defaultTextType:"text",ArticleClass:my}),e.package&&t.import(e.package);let r=t.createArticle();e.content&&r.set(["input","content"],e.content);return{editorSession:new Pu(r,{configurator:t})}}(t)),this.doc=this.editorSession.getDocument()}render(e){let t=e(this._getTagName()).addClass("sc-text-input");return t.append(e(_y,{path:["input","content"]}).ref("input").on("enter",this._onEnter).on("escape",this._onEscape)),t}didMount(){this.refs.input.selectLast()}dispose(){super.dispose(),this.doc.dispose(),this.editorSession.dispose()}shouldRerender(){return!1}getContent(){return this.getDocument().getContent()}_getDocument(){return this.context.editorSession.getDocument()}_getTagName(){return this.props.tagName||"div"}_onEnter(e){e.stopPropagation(),this.el.emit("confirm")}_onEscape(e){e.stopPropagation(),this.el.emit("cancel")}}class my extends Bp{constructor(...e){super(...e),this.create({type:"text",id:"input",content:""})}getContentNode(){return this.get("input")}getContent(){return this.getContentNode().getText()}}class _y extends ff{onKeyDown(e){let t=!1;27===e.keyCode&&(t=!0,this.el.emit("escape")),t?(e.stopPropagation(),e.preventDefault()):super.onKeyDown(e)}selectLast(){const e=this.getDocument().getContentNode();this.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:e.getLength(),surfaceId:this.id})}selectAll(){const e=this.getDocument().getContentNode();this.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:0,endffset:e.getLength(),surfaceId:this.id})}_handleEnterKey(...e){super._handleEnterKey(...e),this.el.emit("enter")}}var yy={name:"text-input",configure(e){e.addComponent("text-input",gy)},TextInput:gy},wy={name:"toolbar",configure(e){e.addComponent("toolbar",Ju)},Toolbar:Ju};class by extends $p{getCommandState(e){let t=this._getSelection(e),r=e.editorSession.getSelectionState(),n=e.editorSession.getDocument(),s={disabled:!0};if(t.isPropertySelection()&&!r.isInlineNodeSelection){let e=t.getPath(),r=n.get(e[0]);r&&r.isText()&&r.isBlock()&&(s.nodeId=r.id,s.disabled=!1,r.textAlign===this.config.textAlign&&(s.active=!0),s.showInContext=0===t.start.offset&&0===t.end.offset)}return s}execute(e){let t=e.commandState.nodeId;e.editorSession.transaction(e=>{e.set([t,"textAlign"],this.config.textAlign)})}}var vy={name:"text-align",configure:function(e){e.addCommand("align-left",by,{textAlign:"left",commandGroup:"text-align"}),e.addCommand("align-center",by,{textAlign:"center",commandGroup:"text-align"}),e.addCommand("align-right",by,{textAlign:"right",commandGroup:"text-align"}),e.addKeyboardShortcut("CommandOrControl+Shift+L",{command:"align-left"}),e.addKeyboardShortcut("CommandOrControl+Shift+E",{command:"align-center"}),e.addKeyboardShortcut("CommandOrControl+Shift+R",{command:"align-right"}),e.addIcon("align-left",{fontawesome:"fa-align-left"}),e.addIcon("align-center",{fontawesome:"fa-align-center"}),e.addIcon("align-right",{fontawesome:"fa-align-right"}),e.addLabel("align-left","Left"),e.addLabel("align-center","Center"),e.addLabel("align-right","Right"),e.addLabel("text-align","Text Align")}};e.cssSelect=Ea,e.DomUtils=sa,e.ChangeStore=t,e.CollabServer=class extends f{constructor(e){super(e),this.scope="substance/collab",this.configurator=e.configurator,this.documentEngine=this.configurator.getDocumentEngine(),this.collabEngine=new Ki(this.documentEngine)}_error(e,t,r){console.error(r),t.error({scope:this.scope,type:"error",error:{name:e.message.type+"Error",cause:{name:r.name}},documentId:e.message.documentId}),this.next(e,t)}authenticate(e,t){this.config.authenticate?this.config.authenticate(e,(r,s)=>{if(r)return console.error(r),void this._error(e,t,new n("AuthenticationError",{cause:r}));e.setAuthenticated(s),this.next(e,t)}):super.authenticate.apply(this,arguments)}enhanceRequest(e,t){this.config.enhanceRequest?this.config.enhanceRequest(e,r=>{if(r)return console.error("enhanceRequest returned an error",r),void this._error(e,t,r);e.setEnhanced(),this.next(e,t)}):super.enhanceRequest.apply(this,arguments)}onDisconnect(e){this.collabEngine.getDocumentIds(e).forEach(function(t){this._disconnectDocument(e,t)}.bind(this))}execute(e,t){let r=e.message,n=this[r.type];n?n.call(this,e,t):console.error("Method",r.type,"not implemented for CollabServer")}sync(e,t){let n=e.message;this.collabEngine.sync(n,(s,i)=>{if(s)return void this._error(e,t,s);let o=this.collabEngine.getCollaborators(n.documentId,n.collaboratorId);t.send({scope:this.scope,type:"syncDone",documentId:n.documentId,version:i.version,serverChange:i.serverChange}),r(o,e=>{this.send(e.collaboratorId,{scope:this.scope,type:"update",documentId:n.documentId,version:i.version,change:i.change})}),this.next(e,t)})}disconnect(e,t){let r=e.message,n=r.collaboratorId,s=r.documentId;this._disconnectDocument(n,s),t.send({scope:this.scope,type:"disconnectDone",documentId:r.documentId}),this.next(e,t)}_disconnectDocument(e,t){this.collabEngine.disconnect({documentId:t,collaboratorId:e})}},e.DocumentClient=class{constructor(e){this.config=e}createDocument(e,t){$i("POST",this.config.httpUrl,e,t)}getDocument(e,t){$i("GET",this.config.httpUrl+e,null,t)}deleteDocument(e,t){$i("DELETE",this.config.httpUrl+e,null,t)}},e.ServerRequest=u,e.WebSocketConnection=class extends Xi{_createWebSocket(){return new window.WebSocket(this.config.wsUrl)}},e.ClientConnection=Xi,e.CollabServerConfigurator=class{constructor(){this.config={heartbeat:3e4,documentStore:void 0,changeStore:void 0,snapshotStore:void 0}}setHost(e){this.config.host=e}setPort(e){this.config.port=e}setDocumentStore(e){this.config.documentStore=e}setChangeStore(e){this.config.changeStore=e}setSnapshotStore(e){this.config.snapshotStore=e}getHost(){return this.config.host}getPort(){return this.config.port}getDocumentStore(){return this.config.documentStore}getChangeStore(){return this.config.changeStore}getSnapshotStore(){return this.config.snapshotStore}getDocumentEngine(){return this.documentEngine||(this.documentEngine=new Qi({documentStore:this.config.documentStore,changeStore:this.config.changeStore,snapshotStore:this.config.snapshotStore})),this.documentEngine}import(e,t){return e.configure(this,t||{}),this}},e.DocumentEngine=Qi,e.ServerResponse=p,e.computeSnapshot=Wi,e.CollabClient=class extends l{constructor(e){super(),this.config=e,this.connection=e.connection,this.scope="substance/collab",this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this.connection.on("open",this._onConnectionOpen),this.connection.on("close",this._onConnectionClose),this.connection.on("message",this._onMessage)}_onConnectionClose(){this.emit("disconnected")}_onConnectionOpen(){this.emit("connected")}_onMessage(e){e.scope===this.scope?this.emit("message",e):"_internal"!==e.scope&&console.info("Message ignored. Not sent in hub scope",e)}send(e){this.connection.isOpen()?(e.scope=this.scope,this.config.enhanceMessage&&(e=this.config.enhanceMessage(e)),this.connection.send(e)):console.warn("Message could not be sent. Connection not open.",e)}isConnected(){return this.connection.isOpen()}dispose(){this.connection.off(this)}},e.CollabServerPackage=to,e.DocumentServer=class{constructor(e){this.configurator=e.configurator,this.engine=this.configurator.getDocumentEngine(),this.path="/api/documents"}bind(e){e.post(this.path,this._createDocument.bind(this)),e.get(this.path+"/:id",this._getDocument.bind(this)),e.delete(this.path+"/:id",this._deleteDocument.bind(this))}_createDocument(e,t,r){const{documentId:n,change:s}=e.body;this.engine.createDocument(n,s,function(e,n){if(e)return r(e);t.json(n)})}_getDocument(e,t,r){const n=e.params.id;this.engine.getDocument(n,function(e,n,s){if(e)return r(e);t.json({data:n,version:s})})}_deleteDocument(e,t,r){let n=e.params.id;this.engine.deleteDocument(n,function(e,n){if(e)return r(e);t.json(n)})}},e.SnapshotEngine=Zi,e.CollabEngine=Ki,e.CollabSession=class extends Pu{constructor(e,t){if(super(e,t),t=t||{},this.config=t,this.collabClient=t.collabClient,t.docVersion&&console.warn("config.docVersion is deprecated: Use config.version instead"),t.docVersion&&console.warn("config.docId is deprecated: Use config.documentId instead"),this.version=t.version,this.documentId=t.documentId||t.docId,void 0!==t.autoSync?this.autoSync=t.autoSync:this.autoSync=!0,!this.documentId)throw new n("InvalidArgumentsError",{message:"documentId is mandatory"});if(void 0===this.version)throw new n("InvalidArgumentsError",{message:"version is mandatory"});this._connected=!1,this._nextChange=null,this._pendingChange=null,this._pendingSync=!1,this._error=null,this.onUpdate("document",this.afterDocumentChange,this),this.collabClient.on("connected",this.onCollabClientConnected,this),this.collabClient.on("disconnected",this.onCollabClientDisconnected,this),this.collabClient.on("message",this._onMessage.bind(this)),this.collabClient.isConnected()&&this.autoSync&&this.sync()}dispose(){this.disconnect(),this.collabClient.off(this)}disconnect(){let e={type:"disconnect",documentId:this.documentId};this._abortSync(),this._send(e)}sync(){if(this.__canSync()){let e=this._nextChange,t={type:"sync",documentId:this.documentId,version:this.version,change:e?this.serializeChange(e):void 0};this._send(t),this._pendingSync=!0,this._pendingChange=e,this.emit("sync"),this._nextChange=null,this._error=null}else console.error("Can not sync. Either collabClient is not connected or already syncing")}getCollaborators(){return this.collaborators}isConnected(){return this._connected}serializeChange(e){return e.toJSON()}deserializeChange(e){return ji.fromJSON(e)}_onMessage(e){if(e.documentId!==this.documentId)return!1;switch((e=v(e)).type){case"syncDone":this.syncDone(e);break;case"syncError":this.syncError(e);break;case"update":this.update(e);break;case"disconnectDone":this.disconnectDone(e);break;case"error":this.error(e);break;default:return console.error("CollabSession: unsupported message",e.type,e),!1}return!0}_send(e){return this.collabClient.isConnected()?(this.collabClient.send(e),!0):(console.warn("Try not to call _send when disconnected. Skipping message",e),!1)}update(e){let t=e.change,r=e.version;this._nextChange||this._pendingSync?console.info("skipped remote update. Pending sync or local changes."):(t&&(t=this.deserializeChange(t),this._applyRemoteChange(t)),r&&(this.version=r),this.startFlow())}syncDone(e){let t=e.serverChange,r=e.version;t&&(t=this.deserializeChange(t),this._applyRemoteChange(t)),this.version=r,this._pendingChange=null,this._pendingSync=!1,this._error=null,this._connected=!0,this.startFlow(),this.emit("connected"),this._requestSync()}syncError(e){console.info("SyncError occured. Aborting sync",e),this._abortSync()}disconnectDone(){this._afterDisconnected()}error(e){let t=e.error,r=this[t.name],s=n.fromJSON(t);if(!r)return t("CollabSession: unsupported error",t.name),!1;this.emit("error",s),(r=r.bind(this))(s)}afterDocumentChange(e,t){t.remote||this._recordChange(e)}onCollabClientConnected(){this.autoSync&&this.sync()}onCollabClientDisconnected(){this._abortSync(),this._connected&&this._afterDisconnected()}_commit(e,t){this._commitChange(e,t),this.startFlow()}_applyRemoteChange(e){e.ops.length>0&&(this._transaction.__applyChange__(e),this.getDocument()._apply(e),this._setDirty("document"),this._transformLocalChangeHistory(e),this._setSelection(this._transformSelection(e)),this._change=e,this._info={remote:!0},this.startFlow())}_recordChange(e){this._nextChange?(this._nextChange.ops=this._nextChange.ops.concat(e.ops),this._nextChange.after=e.after):this._nextChange=e,this._requestSync()}__canSync(){return this.collabClient.isConnected()&&!this._pendingSync}_requestSync(){this._nextChange&&this.__canSync()&&this.sync()}_abortSync(){let e=this._nextChange;this._pendingChange&&(e=this._pendingChange,this._nextChange&&(e.ops=e.ops.concat(this._nextChange.ops),e.after=this._nextChange.after),this._pendingChange=null),this._pendingSync=!1,this._error=null,this._nextChange=e}_afterDisconnected(){this._connected=!1,this.emit("disconnected")}_hasLocalChanges(){return this._nextChange&&this._nextChange.ops.length>0}},e.Server=f,e.SnapshotStore=eo,e.DOMElement=lo,e.DOMEventListener=oo,e.DefaultDOMElement=nh,e.BrowserDOMElement=go,e.MemoryDOMElement=zc,e.domHelpers=Zu,e.documentHelpers=Bd,e.operationHelpers=Ji,e.selectionHelpers=Fi,e.annotationHelpers=xd,e.AnnotationIndex=tp,e.AnnotationMixin=Hd,e.ArrayOperation=Ks,e.BlockNode=rp,e.ChangeHistory=Au,e.ChangeRecorder=hp,e.ClipboardExporter=_p,e.ClipboardImporter=Ip,e.Conflict=Fs,e.Container=jd,e.ContainerAdapter=class extends jd{constructor(e,t){super(e,{id:String(t)}),this.document=e,this.path=t,e.data.nodes[this.id]=this}getContentPath(){return this.path}get nodes(){return this.document.get(this.path)}get _isDocumentNode(){return!1}get _isContainer(){return!1}},e.ContainerAddress=bd,e.ContainerAnnotation=zd,e.ContainerAnnotationIndex=Ap,e.ContainerMixin=Fd,e.ContainerSelection=Ei,e.Coordinate=Si,e.CoordinateAdapter=class extends Si{constructor(e,t,r){super("SKIP"),this._owner=e,this._pathProp=t,this._offsetProp=r,Object.freeze(this)}equals(e){return e===this||Ci(e.path,this.path)&&e.offset===this.offset}get path(){return this._owner[this._pathProp]}set path(e){this._owner[this._pathProp]=e}get offset(){return this._owner[this._offsetProp]}set offset(e){this._owner[this._offsetProp]=e}toJSON(){return{path:this.path,offset:this.offset}}toString(){return"("+this.path.join(".")+", "+this.offset+")"}},e.CoordinateOperation=Ys,e.copySelection=np,e.createDocumentFactory=function(e,t){return{ArticleClass:e,createEmptyArticle:function(){return new e},createArticle:function(){const r=new e;return t(r),r},createChangeset:function(){const r=new e,n=new hp(r);return t(n),[n.generateChange().toJSON()]}}},e.CustomSelection=Ii,e.Data=Dp,e.DefaultChangeCompressor=class{shouldMerge(e,t){return!1}merge(e,t){var r=e.ops[0],n=t.ops[0],s=r.diff,i=n.diff,o=!1;return s.isInsert()?s.pos+s.getLength()===i.pos&&((o=r.toJSON()).diff.str+=i.str):s.isDelete()&&(s.pos===i.pos?(o=r.toJSON()).diff.str+=i.str:i.pos+i.getLength()===s.pos&&((o=r.toJSON()).diff=i,o.diff.str+=s.str)),!!o&&(e.ops[0]=ni.fromJSON(o),e.ops.length>1&&(e.ops=e.ops.concat(t.ops.slice(1)),e.after=t.after),!0)}},e.DefaultFileProxy=Pp,e.Document=Bp,e.DocumentChange=ji,e.DocumentIndex=Sd,e.DocumentNode=wd,e.DocumentNodeFactory=Lp,e.DocumentSchema=Vd,e.DOMExporter=up,e.DOMImporter=Ep,e.Editing=lp,e.EditingInterface=cp,e.FileNode=Fp,e.FileProxy=Op,e.Fragmenter=Hh,e.getChangeFromDocument=function(e){return new hp(e).generateChange()},e.HTMLExporter=pp,e.HTMLImporter=Np,e.importNodeIntoDocument=function(e,t){let r=sp(t.getDocument(),e,t.id,{});return e.get(r)},e.IncrementalData=Mp,e.InlineNode=class extends(Hd(wd)){static isInlineNode(){return!0}},e.JSONConverter=mp,e.ListMixin=Hp,e.Marker=yu,e.Node=ud,e.NodeIndex=Cd,e.NodeProperty=cd,e.NodeRegistry=ld,e.NodeSelection=Ti,e.ObjectOperation=ni,e.OperationSerializer=_i,e.ParentNodeHook=Rp,e.paste=op,e.PropertyAnnotation=Ud,e.PropertyIndex=kp,e.PropertySelection=xi,e.Range=qh,e.Schema=yd,e.Selection=bi,e.TextBlock=Vp,e.TextNode=zp,e.TextNodeMixin=Up,e.TextOperation=Us,e.Transaction=Du,e.XMLExporter=class extends up{constructor(e,t){super(function(e){if(!(e=Object.assign({idAttribute:"id"},e)).elementFactory){let t={version:e.xmlVersion||"1.0",encoding:e.xmlEncoding||"UTF-8"};e.elementFactory=nh.createDocument("xml",t)}return e}(e),t)}getDefaultBlockConverter(){return Jp}getDefaultPropertyAnnotationConverter(){return Gp}},e.XMLImporter=class extends Ep{constructor(e,t){super(Object.assign({idAttribute:"id"},e),t)}importDocument(e){this.reset();let t=nh.parseXML(e);return this.convertDocument(t),this.state.doc}convertDocument(e){let t=e.children[0];if(!t)throw new Error("XML Root node could not be found.");this.convertElement(t)}},e.AbstractClipboard=Kp,e.AbstractIsolatedNodeComponent=Xh,e.AbstractScrollPane=Vu,e.AbstractGlobalEventHandler=au,e.AbstractKeyboardManager=du,e.AnnotatedTextComponent=Vh,e.AnnotationCommand=Xp,e.AnnotationComponent=Wp,e.BlockNodeComponent=class extends Yp{},e.Button=Zp,e.Clipboard=Qp,e.Command=$p,e.Component=Oh,e.ComponentRegistry=Gd,e.ContainerEditor=sf,e.CustomSurface=class extends Oh{constructor(...e){super(...e),this._name=this._getCustomResourceId(),this._surfaceId=this._createSurfaceId()}getChildContext(){return{surface:this,parentSurfaceId:this.getId()}}didMount(){this._getSurfaceManager().registerSurface(this)}dispose(){this._getSurfaceManager().unregisterSurface(this)}rerenderDOMSelection(){}get name(){return this._name}getId(){return this._surfaceId}getSurfaceId(){return this.getId()}getContainer(){}getContainerId(){}isContainerEditor(){return!1}isCustomEditor(){return!0}isDisabled(){return Boolean(this.props.disabled)}_focus(){}_createSurfaceId(){let e=this.context.isolatedNodeComponent;return e?e.context.surface.id+"/"+e.props.node.id+"/"+this._name:this._name}_getCustomResourceId(){throw new Error("This method needs to be implemented by a CustomSurface")}_getSurfaceManager(){return this.context.surfaceManager}},e.DefaultLabelProvider=$d,e.DOMSelection=td,e.DragAndDropHandler=Qd,e.EditAnnotationCommand=af,e.EditInlineNodeCommand=of,e.FontAwesomeIcon=Jd,e.FontAwesomeIconProvider=Kd,e.HandlerParams=hu,e.Highlights=class extends l{constructor(e){super(),this.doc=e,this._highlights={}}get(){return this._highlights}set(e){let t=this._highlights,n=this.doc;r(e,function(e,s){let i=t[s]||[],o=ks(i,e),a=ks(e,i);r(o,function(e){let t=n.get(e);t&&(t.setHighlighted?t.setHighlighted(!1,s):console.warn("setHighlighted is not defined on target node"))}),r(a,function(e){let t=n.get(e);t&&(t.setHighlighted?t.setHighlighted(!0,s):console.warn("setHighlighted is not defined on target node"))})}),this._highlights=e,this.emit("highlights:updated",e)}},e.InsertInlineNodeCommand=class extends $p{getCommandState(e,t){let r=e.selection;return{disabled:this.isDisabled(e,t),active:!1,showInContext:this.showInContext(r,e,t)}}showInContext(e,t){return!e.isCollapsed()}isDisabled(e,t){const r=this.getEditorSession(e,t);let n=r.getSelection(),s=r.getSelectionState();return!n.isPropertySelection()||!!s.isInlineNodeSelection}isAnnotationCommand(){return!0}execute(e,t){let r=e.commandState,n=e.editorSession;r.disabled||n.transaction(r=>{let n=this.createNodeData(r,e,t);r.insertInlineNode(n)})}createNodeData(e,t,r){throw new Error("This method is abstract")}},e.InsertNodeCommand=lf,e.IsolatedNodeComponent=Zh,e.IsolatedInlineNodeComponent=cf,e.NodeComponent=Yp,e.RenderingEngine=gh,e.Router=df,e.SelectionFragmentComponent=Gh,e.Surface=nf,e.SwitchTextTypeCommand=uf,e.TextBlockComponent=pf,e.TextPropertyComponent=Jh,e.TextPropertyEditor=ff,e.Tooltip=qu,e.UnsupportedNodeComponent=tf,e.VirtualElement=hh,e.SplitPane=gf,e.UndoCommand=mf,e.RedoCommand=_f,e.SelectAllCommand=yf,e.InlineNodeComponent=cf,e.findParentComponent=function(e){for(;e;){const t=Oh.unwrap(e);if(t)return t;e=e.parentNode}},e.async=wf,e.tableHelpers=Nf,e.ArrayIterator=so,e.ArrayTree=_u,e.array2table=Tf,e.camelCase=Re,e.capitalize=de,e.clone=y,e.cloneDeep=v,e.createCountingIdGenerator=yp,e.debounce=Xe,e.deleteFromArray=mu,e.diff=function(e,t,r){if(!E(e)||!E(t))throw new Error("Illegal arguments.");r=r||0;let n=[];(e||t)&&(!e&&t?n.push({type:"insert",start:r,text:t}):e&&!t?n.push({type:"delete",start:r,end:r+e.length}):n=function(e,t,r,n){let s,i=t.length,o=e.length,a=[];for(;i>0&&o>0;)l();return c(),a;function l(){let e=r[i][o],n=i-1,a=o-1;r[n][a]<e?(s&&"replace"===s.type?(s.start--,s.text.unshift(t.charAt(n))):(c(),s={type:"replace",start:a,end:o,text:[t.charAt(n)]}),i--,o--):r[n][o]<e?(s&&"insert"===s.type?(s.start--,s.text.unshift(t.charAt(n))):(c(),s={type:"insert",start:a,text:[t.charAt(n)]}),i--):r[i][a]<e?(s&&"delete"===s.type?s.start--:(c(),s={type:"delete",start:a,end:o}),o--):(c(),i--,o--)}function c(){if(s){switch(s.type){case"insert":s.start+=n,s.text=s.text.join("");break;case"delete":s.start+=n,s.end+=n;break;case"replace":s.start+=n,s.end+=n,s.text=s.text.join("");break;default:throw new Error("Invalid state")}a.push(s),s=null}}}(e,t,If(e,t),r));return n},e.encodeXMLEntities=dp,e.EventEmitter=l,e.extend=ro,e.Factory=class extends od{create(e){var t=this.get(e);if(!t)throw new Error("No class registered by that name: "+e);var r=Array.prototype.slice.call(arguments,1),n=Object.create(t.prototype);return t.apply(n,r),n}},e.filter=vd,e.find=Bn,e.findIndex=io,e.flatten=ah,e.flattenOften=lh,e.forEach=r,e.getRangeFromMatrix=function(e,t,r,n,s,i){if(!i){if(t===n&&r===s){let t=e[r];return t?t[s]:void 0}if(t===n){let n=e[t];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let i=t;i<=n;i++){let t=e[i];t&&s.push(t[r])}return s}}let o=[];for(var a=t;a<n+1;a++){let t=e[a];t&&o.push(t.slice(r,s+1))}return o},e.getRelativeBoundingRect=Nu,e.getRelativeMouseBounds=zu,e.inBrowser=wo,e.includes=function(e,t){return!!e&&e.indexOf(t)>=0},e.isArray=_,e.isArrayEqual=Ci,e.isBoolean=ch,e.isEqual=S,e.isFunction=no,e.isMatch=Fn,e.isNil=x,e.isNumber=C,e.isObject=s,e.isPlainObject=m,e.isString=E,e.keys=$h,e.last=wi,e.levenshtein=If,e.makeMap=Tf,e.map=g,e.merge=function(e,t,r){var n=null;return"replace"===(r=r||{}).array?n=Df:"concat"===r.array&&(n=Af),n?xs(e,t,n):Ss(e,t)},e.parseKeyCombo=uu,e.parseKeyEvent=cu,e.PathObject=Bs,e.percentage=function(e){return String(Math.floor(100*e*100)/100)+" %"},e.platform=w,e.pluck=function(e,t){return g(e,function(e){return e[t]})},e.printStacktrace=function(){try{throw new Error}catch(e){console.error(e.stack)}},e.request=$i,e.renderListNode=Of,e.sendRequest=Pf,e.startsWith=ef,e.SubstanceError=n,e.substanceGlobals=oh,e.times=kf,e.toUnixLineEndings=function(e){return e.replace(/\r?\n/g,"\n")},e.TreeIndex=ep,e.uniq=function(e){return e&&e.length?function(e,t,r){var n=-1,s=Ts,i=e.length,o=!0,a=[],l=a;if(r)o=!1,s=Is;else if(i>=Ds){var c=t?null:As(e);if(c)return er(c);o=!1,s=$t,l=new Jt}else l=t?[]:a;e:for(;++n<i;){var h=e[n],d=t?t(h):h;if(h=r||0!==h?h:0,o&&d==d){for(var u=l.length;u--;)if(l[u]===d)continue e;t&&l.push(d),a.push(h)}else s(l,d,r)||(l!==a&&l.push(d),a.push(h))}return a}(e):[]},e.uuid=d,e.without=ks,e.orderBy=qs,e.getDOMRangeFromEvent=Xd,e.getRelativeRect=Wd,e.getSelectionRect=Yd,e.isMouseInsideDOMSelection=Zd,e.getQueryStringParam=function(e,t){if("undefined"==typeof window)return null;let r=t||window.location.href,n=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(r);return n?decodeURIComponent(n[1]):null},e.setDOMSelection=function(e,t,r,n){let s=window.getSelection(),i=window.document.createRange();e._isDOMElement&&(e=e.getNativeElement()),r||(r=e,n=t),r._isDOMElement&&(r=r.getNativeElement()),i.setStart(e,t),i.setEnd(r,n),s.removeAllRanges(),s.addRange(i)},e.XMLAnchorNode=Jf,e.XMLAnnotationNode=Kf,e.XMLContainerNode=Xf,e.XMLDocument=Zf,e.XMLDocumentImporter=og,e.XMLEditingInterface=Yf,e.XMLElementNode=$f,e.XMLElementNodeConverter=lg,e.XMLExternalNode=cg,e.XMLExternalNodeConverter=hg,e.XMLInlineElementNode=dg,e.XMLNodeConverter=ag,e.XMLSchema=Lg,e.XMLTextElement=Bg,e.XMLTextElementConverter=jg,e._analyzeElementSchemas=Ug,e.checkSchema=function(e){const t=e.getTagNames();let r=[];for(let n=0;n<t.length;n++){const s=t[n],i=e.getElementSchema(s);switch(i.type){case"text":r=r.concat(zg(i));break;case"element":case"container":r=r.concat(Vg(i));break;case"hybrid":r=r.concat(Gg(i));break;case"annotation":r=r.concat(Jg(i));break;case"inline-element":r=r.concat(Kg(i));break;case"anchor":r=r.concat($g(i));break;case"external":case"not-implemented":break;default:throw new Error("Unsupported element classification.")}}return r},e.compileRNG=function(e,t,r){let n,s=(n=1===arguments.length&&E(arguments[0])?nh.parseXML(arguments[0]):tm(e,t,r)).find("grammar");if(!s)throw new Error("<grammar> not found.");return function(e){let t={};e.children.forEach(e=>{const r=zf(e.tagName);"define"===r&&function(e,t){const r=e.attr("name");"interleave"===e.attr("combine")?t[r]?t[r].append(e.children):t[r]=e:(t[r],t[r]=e)}(e,t)}),e.defs=t}(s),function(e){const t={};e.children.filter(e=>"element"===e.tagName).forEach(r=>{const n=r.attr("name"),s=function e(t,r,n={}){if(!t)return{};let s=t.children;for(let t=0;t<s.length;t++){const i=s[t];switch(i.tagName){case"attribute":{const e=cm(i);n[e.name]=e;break}case"group":case"choice":case"optional":case"oneOrMore":case"zeroOrMore":e(i,r,n)}}return n}(r.find("attributes")),i=r.find("children"),o=r.attr("type");let a=sm(i,e),l=Cg(n,a),c={name:n,type:o,attributes:s,expr:l};t[n]=c}),Ug(t);const r=e.find("start");if(!r)throw new Error("<start> is mandatory");const n=r.attr("name");if(!n)throw new Error('<start> must have "name" set');return new Lg(t,n)}(function(e){const t=e.createElement.bind(e);e.findAll("removed").forEach(t=>{let r=t.attr("name");e.findAll(`element[name="${r}"]`).forEach(e=>{e.remove()}),e.findAll(`ref[name="${r}"]`).forEach(e=>{e.remove()})});const r={},n=e.defs,s=e.findAll("define > element"),i=nh.createDocument("xml"),o=i.createElement("grammar"),a=e.findAll("not-implemented").reduce((e,t)=>{let r=t.attr("name");return r&&e.add(r),e},new Set);s.forEach(e=>{const s=e.attr("name");if(!s)throw new Error("'name' is mandatory.");let l;l=a.has(s)?t("element").attr("name",s).attr("type","not-implemented"):function(e,t,r,n){let s=e.createElement("element").attr("name",t);s.attr("type","implicit");let i=e.createElement("attributes"),o=e.createElement("children");for(r.children.forEach(t=>{let r=nm(e,t,n,{});r.forEach(e=>{e.find("attribute")||e.is("attribute")?i.appendChild(e):o.appendChild(e)})}),s.appendChild(i),s.appendChild(o);;){let e=o.find("choice > choice");if(!e)break;{let t=e.parentNode,r=e.children;r.forEach(r=>{t.insertBefore(r,e)}),t.removeChild(e)}}let a=o.findAll("choice");for(let e=0;e<a.length;e++){let t=a[e],r=t.children;1===r.length&&t.parentNode.replaceChild(t,r[0])}let l=o.findAll("optional > text, zeroOrMore > text");for(let e=0;e<l.length;e++){let t=l[e],r=t.parentNode;1===r.getChildCount()&&r.parentNode.replaceChild(r,t)}let c=o.findAll("optional, zeroOrMore, oneOrMore");for(let e=0;e<c.length;e++){let t=c[e];0===t.getChildCount()&&t.remove()}return s}(i,s,e,n),r[s]=l,o.appendChild(l)}),e.findAll("elementType").forEach(e=>{const t=e.attr("name");let n=e.attr("s:type")||e.attr("type");if(!t||!n)throw new Error("Attributes name and type are mandatory.");const s=r[t];if(!s)throw new Error(`Unknown element ${t}.`);s.attr("type",n)});const l=function(e){const t=e.find("start");if(!t)throw new Error("<grammar> must have a <start> element");const r=t.find("ref");if(!r)throw new Error("Expecting one <ref> inside of <start>.");return r.attr("name")}(e);if(!l)throw new Error("<start> is mandatory.");return o.appendChild(i.createElement("start").attr("name",l)),o}(s))},e.registerSchema=function(e,t,n,s={}){const i=t.getName();let o;t.getDefaultTextType&&(o=t.getDefaultTextType()),e.defineSchema({name:i,version:t.getVersion(),defaultTextType:o,DocumentClass:n,xmlSchema:t}),t.getTagNames().forEach(n=>{const o=t.getElementSchema(n),a=o.name;let l,c;switch(o.type){case"element":l=$f,c=lg;break;case"hybrid":throw new Error("Mixed element types are not supported yet.");case"text":l=Bg,c=jg;break;case"annotation":l=Kf,c=ag;break;case"anchor":l=Jf,c=ag;break;case"inline-element":l=dg,c=lg;break;case"external":case"not-implemented":l=cg,c=hg;break;case"container":l=Xf,c=lg;break;default:throw new Error("Illegal state")}class h extends l{}h.type=a,r(o.attributes,(e,t)=>{!function(e,t){let r=t.replace(":","_");r=Re(r),hm.indexOf(r)>=0||Object.defineProperty(e.prototype,r,{get(){return this.getAttribute(t)},set(e){return this.setAttribute(t,e),this}})}(h,t)}),e.addNode(h);let d=new c(a);e.addConverter(i,d);let u=s.ImporterClass||og;e.addImporter(i,u)})},e.SchemaDrivenCommandManager=class extends ad{_initialize(){const e=new Map,t=new Map,r=new Map,n=new Map;this.commands.forEach(s=>{const i=s.getName();s.isAnnotationCommand()?e.set(i,s):s.isInsertCommand()?t.set(i,s):s.isSwitchTypeCommand()?r.set(i,s):n.set(i,s)}),this.annotationCommands=e,this.insertCommands=t,this.switchTypeCommands=r,this.otherCommands=n}_getCommand(e){return this.annotationCommands.get(e)||this.insertCommands.get(e)||this.switchTypeCommands.get(e)||this.otherCommands.get(e)}_updateCommandStates(e){const t={},r=this.annotationCommands,n=this.insertCommands,s=this.switchTypeCommands,i=this._getCommandContext(),o=this._getCommandParams(),a=e.getDocument(),l=o.selectionState,c=o.selection,h=o.editorSession.isBlurred(),d=!c||c.isNull()||!c.isAttached();if(h||d||c.isCustomSelection())u(r),u(n),u(s);else{const e=c.start.path,t=a.get(e[0]);if(!t)throw new Error("FIXME: explain when this happens");const r=t.isText(),n=a.getXMLSchema();if(r&&c.isPropertySelection()&&!l.isInlineNodeSelection()){const e=n.getElementSchema(t.type);p(this.annotationCommands,e)}else u(this.annotationCommands);let s=t.parentNode;if(s&&s.isContainer()){const e=n.getElementSchema(s.type);p(this.insertCommands,e)}else u(this.insertCommands);if(s&&c.containerId&&r&&s.isContainer()){const e=n.getElementSchema(s.type);p(this.switchTypeCommands,e)}else u(this.switchTypeCommands)}function u(e){e.forEach((e,r)=>{t[r]=dm})}function p(e,r){e.forEach((e,n)=>{const s=e.getType();r.isAllowed(s)?t[n]=e.getCommandState(o,i):t[n]=dm})}this.otherCommands.forEach((e,r)=>{t[r]=e.getCommandState(o,i)}),e.setCommandStates(t)}},e.loadRNG=tm,e.validateXMLSchema=function(e,t){let r=t.find(e.getStartElement());return r?function(e,t){let r=[],n=!0,s=[t];for(;s.length>0;){let t=s.shift(),i=e.validateElement(t);i.ok||(r=r.concat(i.errors),n=!1),t.isElementNode()&&(s=s.concat(t.getChildren()))}return{errors:r,ok:n}}(e,r):{errors:[{msg:"Start element is missing.",el:t}]}},e.ValidatingChildNodeIterator=ig,e.prettyPrintXML=function(e){let t;const r=[];let n=(t=E(e)?nh.parseXML(e):e).getChildNodes();if(t.isDocumentNode()){let e=t.empty().serialize();/<\?\s*xml/.exec(e)&&r.push(e)}return n.forEach(e=>{!function e(t,r,n){let s=new Array(2*n).fill(" ").join("");if(r.isElementNode()){const i=function(e){const t=e.childNodes;for(let e=0;e<t.length;e++){let r=t[e];if(r.isTextNode()&&!ng(r))return!0}}(r),o=function(e){const t=e.childNodes;for(let e=0;e<t.length;e++){let r=t[e];if("cdata"===r.getNodeType())return!0}}(r);if(i||o)t.push(s+r.outerHTML);else{let i=r.children;const o=r.tagName;let a=[`<${o}`];r.getAttributes().forEach((e,t)=>{a.push(`${t}="${e}"`)}),i.length>0?(t.push(s+a.join(" ")+">"),r.children.forEach(r=>{e(t,r,n+1)}),t.push(s+`</${o}>`)):t.push(s+a.join(" ")+" />")}}else 0===n&&r.isTextNode()||t.push(s+r.outerHTML)}(r,e,0)}),r.join("\n")},e.BasePackage=Am,e.BlockquotePackage=km,e.BodyScrollPanePackage=Sm,e.ButtonPackage=um,e.CodePackage=Rm,e.CodeblockPackage=jm,e.ContextMenuPackage=pm,e.DropzonesPackage=wm,e.EmphasisPackage=Vm,e.FilePackage=Tm,e.FindAndReplacePackage=e_,e.HeadingPackage=s_,e.ImagePackage=p_,e.InputPackage=gm,e.LinkPackage=w_,e.ListPackage=I_,e.ModalPackage=_m,e.MultiSelectPackage=D_,e.OverlayPackage=ym,e.ParagraphPackage=M_,e.PersistencePackage=R_,e.ProseEditorPackage=ay,e.QuoteMarksPackage=W_,e.ScrollPanePackage=vm,e.ScrollbarPackage=bm,e.SpellCheckPackage=dy,e.SplitPanePackage=xm,e.StrongPackage=j_,e.SubscriptPackage=z_,e.SuperscriptPackage=J_,e.TabbedPanePackage=Nm,e.TablePackage=sy,e.TextInputPackage=yy,e.ToolbarPackage=wy,e.ToolPanelPackage=Im,e.TextAlignPackage=vy,e.AbstractEditor=sd,e.CommandManager=ad,e.Configurator=Su,e.ContextMenu=Eu,e.DragManager=eu,e.Dropzones=Iu,e.EditorSession=Pu,e.FileManager=iu,e.GlobalEventHandler=lu,e.KeyboardManager=pu,e.MacroManager=gu,e.MarkersManager=wu,e.Menu=Ru,e.MenuGroup=ju,e.MenuItem=Lu,e.Overlay=Hu,e.Registry=od,e.ResourceManager=nd,e.ResponsiveApplication=class extends Oh{constructor(...e){super(...e),this.pages={},this.handleActions({navigate:this.navigate})}getInitialState(){return{route:void 0,mobile:this._isMobile()}}didMount(){w.inBrowser&&nh.getBrowserWindow().on("resize",this._onResize,this),this.router=this.getRouter(),this.router.on("route:changed",this._onRouteChanged,this);let e=this.router.readRoute();this.navigate(e,{replace:!0})}dispose(){this.router.off(this),this.router.dispose()}navigate(e,t){this.extendState({route:e}),this.router.writeRoute(e,t)}_onRouteChanged(e){this.navigate(e,{replace:!0})}_isMobile(){if(w.inBrowser)return window.innerWidth<700}_onResize(){this._isMobile()?this.state.mobile||this.extendState({mobile:!0}):this.state.mobile&&this.extendState({mobile:!1})}_getPage(){return this.state.route.page||this.getDefaultPage()}_getPageClass(){let e=this._getPage();return this.pages[e]}_getPageProps(){let e=v(this.state.route);return delete e.page,e.mobile=this.state.mobile,e}addPage(e,t){this.pages[e]=t}renderPage(e){let t=this._getPageClass(),r=this._getPage();return e(t,this._getPageProps()).ref(r)}render(e){let t=e("div").addClass("sc-responsive-application");return void 0===this.state.route?t:(t.append(this.renderPage(e)),t)}},e.Scrollbar=Uu,e.ScrollPane=Gu,e.SelectionState=Ou,e.Tool=Bu,e.ToggleTool=Bu,e.Toolbar=Ju,e.ToolDropdown=Ku,e.ToolGroup=Fu,e.ToolPanel=xu,e.ToolPrompt=$u,e.ToolSeparator=Xu,e.WorkflowPane=Wu,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=./substance.min.js.map